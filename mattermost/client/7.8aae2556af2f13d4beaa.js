webpackJsonp([7],{2005:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t,{theme:(0,c.getTheme)(e)})}function r(e){return{actions:(0,d.bindActionCreators)({viewChannel:u.viewChannel,getMyChannelMembers:u.getMyChannelMembers},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(54),c=a(62),f=a(2252),m=n(f);t.default=(0,l.connect)(s,r)(m.default)},2035:function(e,t,a){var n=(a(0),a(0),!0),s=!0,r={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){s&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,a){var n=e.match(t);return n&&n.length>=a&&parseInt(n[a],10)},detectBrowser:function(e){var t=e&&e.navigator,a={};if(a.browser=null,a.version=null,void 0===e||!e.navigator)return a.browser="Not a browser.",a;if(t.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return a}};e.exports={log:r.log,deprecated:r.deprecated,disableLog:r.disableLog,disableWarnings:r.disableWarnings,extractVersion:r.extractVersion,shimCreateObjectURL:r.shimCreateObjectURL,detectBrowser:r.detectBrowser.bind(r)}},2057:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(35),b=a(17),y=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onHide=function(){a.setState({copiedLink:!1}),a.props.onHide()},a.copyLink=function(){var e=a.refs.textarea;e.focus(),e.setSelectionRange(0,a.props.link.length);try{document.execCommand("copy")?a.setState({copiedLink:!0}):a.setState({copiedLink:!1})}catch(e){a.setState({copiedLink:!1})}},a.state={copiedLink:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=null;this.props.helpText&&(e=v.default.createElement("p",null,this.props.helpText,v.default.createElement("br",null),v.default.createElement("br",null)));var t=null;document.queryCommandSupported("copy")&&(t=v.default.createElement("button",{id:"linkModalCopyLink","data-copy-btn":"true",type:"button",className:"btn btn-primary pull-left",onClick:this.copyLink},v.default.createElement(b.FormattedMessage,{id:"get_link.copy",defaultMessage:"Copy Link"})));var a=v.default.createElement("textarea",{id:"linkModalTextArea",className:"form-control no-resize min-height",ref:"textarea",value:this.props.link,onClick:this.copyLink,readOnly:!0}),n=null;return this.state.copiedLink&&(n=v.default.createElement("p",{className:"alert alert-success alert--confirm"},v.default.createElement("i",{className:"fa fa-check"}),v.default.createElement(b.FormattedMessage,{id:"get_link.clipboard",defaultMessage:" Link copied"}))),v.default.createElement(E.Modal,{show:this.props.show,onHide:this.onHide},v.default.createElement(E.Modal.Header,{closeButton:!0},v.default.createElement("h4",{className:"modal-title"},this.props.title)),v.default.createElement(E.Modal.Body,null,e,a),v.default.createElement(E.Modal.Footer,null,v.default.createElement("button",{id:"linkModalCloseButton",type:"button",className:"btn btn-default",onClick:this.onHide},v.default.createElement(b.FormattedMessage,{id:"get_link.close",defaultMessage:"Close"})),t,n))}}]),t}(v.default.PureComponent);y.propTypes={show:h.default.bool.isRequired,onHide:h.default.func.isRequired,title:h.default.string.isRequired,helpText:h.default.string,link:h.default.string.isRequired},y.defaultProps={helpText:null},t.default=y},2064:function(e,t,a){a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.Scrollbars=void 0;var n=a(2284),s=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=s.default,t.Scrollbars=s.default},2065:function(e,t,a){function n(e,t,a){var n=d[t];if(void 0===n&&(n=r(t)),n){if(void 0===a)return e.style[n];e.style[n]=u(n,a)}}function s(e,t){for(var a in t)t.hasOwnProperty(a)&&n(e,a,t[a])}function r(e){var t=l(e),a=o(t);return d[t]=d[e]=d[a]=a,a}function i(){2===arguments.length?"string"==typeof arguments[1]?arguments[0].style.cssText=arguments[1]:s(arguments[0],arguments[1]):n(arguments[0],arguments[1],arguments[2])}var o=(a(0),a(0),a(2287)),l=a(2288),d={float:"cssFloat"},u=a(2291);e.exports=i,e.exports.set=i,e.exports.get=function(e,t){return Array.isArray(t)?t.reduce(function(t,a){return t[a]=n(e,a||""),t},{}):n(e,t||"")}},2066:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(73),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleClick=a.handleClick.bind(a),a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleClick",value:function(e,t){t.preventDefault(),this.props.updateTab(e.name),(0,h.default)(t.target).closest(".settings-modal").addClass("display--content")}},{key:"componentDidMount",value:function(){S.isFirefox()&&(0,h.default)(".settings-modal .settings-table .nav").addClass("position--top")}},{key:"render",value:function(){var e=this,t=this.props.tabs.map(function(t){var a=t.name+"_li",n="";return e.props.activeTab===t.name&&(n="active"),b.default.createElement("li",{id:t.name+"Li",key:a,className:n},b.default.createElement("button",{id:t.name+"Button",className:"cursor--pointer style--none",onClick:e.handleClick.bind(null,t)},b.default.createElement("i",{className:t.icon}),t.uiName))});return b.default.createElement("div",null,b.default.createElement("ul",{id:"tabList",className:"nav nav-pills nav-stacked"},t))}}]),t}(b.default.Component);t.default=_,_.propTypes={tabs:v.default.arrayOf(v.default.shape({name:v.default.string.isRequired,uiName:v.default.string.isRequired,icon:v.default.string.isRequired})).isRequired,activeTab:v.default.string,updateTab:v.default.func.isRequired}},2067:function(e,t,a){e.exports=a.p+"files/a4a8b617d1f6c75ad4bf17bafc2aec6a.mp3"},2068:function(e,t,a){var n=(a(0),a(0),{});n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var a={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":a.relatedAddress=t[n+1];break;case"rport":a.relatedPort=parseInt(t[n+1],10);break;case"tcptype":a.tcpType=t[n+1];break;case"ufrag":a.ufrag=t[n+1],a.usernameFragment=t[n+1];break;default:a[t[n]]=t[n+1]}return a},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var a=e.type;return t.push("typ"),t.push(a),"host"!==a&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),a={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),a.name=t[0],a.clockRate=parseInt(t[1],10),a.numChannels=3===t.length?parseInt(t[2],10):1,a},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,a={},n=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)t=n[s].trim().split("="),a[t[0].trim()]=t[1];return a},n.writeFmtp=function(e){var t="",a=e.payloadType;if(void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+a+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",a=e.payloadType;return void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+a+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),a={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(a.attribute=e.substr(t+1,n-t-1),a.value=e.substr(n+1)):a.attribute=e.substr(t+1),a},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var a="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){a+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),a},n.getIceParameters=function(e,t){var a=n.splitLines(e);return a=a.concat(n.splitLines(t)),{usernameFragment:a.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=n.splitLines(e),s=a[0].split(" "),r=3;r<s.length;r++){var i=s[r],o=n.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var l=n.parseRtpMap(o),d=n.matchPrefix(e,"a=fmtp:"+i+" ");switch(l.parameters=d.length?n.parseFmtp(d[0]):{},l.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(n.parseRtcpFb),t.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(l.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ",a+=t.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){a+=n.writeRtpMap(e),a+=n.writeFmtp(e),a+=n.writeRtcpFb(e)});var s=0;return t.codecs.forEach(function(e){e.maxptime>s&&(s=e.maxptime)}),s>0&&(a+="a=maxptime:"+s+"\r\n"),a+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){a+=n.writeExtmap(e)}),a},n.parseRtpEncodingParameters=function(e){var t,a=[],s=n.parseRtpParameters(e),r=-1!==s.fecMechanisms.indexOf("RED"),i=-1!==s.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=o.length>0&&o[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===l&&(t=d[0][1]),s.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};a.push(n),r&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:i?"red+ulpfec":"red"},a.push(n))}}),0===a.length&&l&&a.push({ssrc:l});var u=n.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,a.forEach(function(e){e.maxBitrate=u})),a},n.parseRtcpParameters=function(e){var t={},a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];a&&(t.cname=a.value,t.ssrc=a.ssrc);var s=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=0===s.length;var r=n.matchPrefix(e,"a=rtcp-mux");return t.mux=r.length>0,t},n.parseMsid=function(e){var t,a=n.matchPrefix(e,"a=msid:");if(1===a.length)return t=a[0].substr(7).split(" "),{stream:t[0],track:t[1]};var s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return s.length>0?(t=s[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var a=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||n.generateSessionId())+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,a,s){var r=n.writeRtpDescription(e.kind,t);if(r+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var i="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+i,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),r},n.getDirection=function(e,t){for(var a=n.splitLines(e),s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),a=t[0].split(" ");return{kind:a[0].substr(2),port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.exports=n},2252:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(57),i=s(r),o=a(58),l=s(o),d=a(5),u=s(d),c=a(3),f=s(c),m=a(4),p=s(m),h=a(6),g=s(h),v=a(7),E=s(v),b=a(0),y=s(b),S=a(8),_=s(S),M=a(1),C=s(M),w=a(34),k=a(2253),T=s(k),N=a(224),P=a(66),R=a(286),I=a(31),D=s(I),L=a(113),A=s(L),O=a(36),F=s(O),x=a(27),U=s(x),H=a(221),j=s(H),B=a(9),G=s(B),V=a(73),z=n(V),q=a(16),W=n(q),Y=a(1951),K=s(Y),J=a(2254),X=s(J),Q=a(2255),Z=s(Q),$=a(2259),ee=s($),te=a(2261),ae=s(te),ne=a(2263),se=s(ne),re=a(2265),ie=s(re),oe=a(2266),le=s(oe),de=a(2267),ue=s(de),ce=a(2268),fe=s(ce),me=a(2276),pe=s(me),he=a(2277),ge=s(he),ve=a(2279),Ee=s(ve),be=a(2280),ye=s(be),Se=a(2315),_e=s(Se),Me=a(2317),Ce=s(Me),we=a(2322),ke=s(we),Te=a(2323),Ne=s(Te),Pe=a(2348),Re=s(Pe),Ie=a(2349),De=s(Ie),Le=a(2364),Ae=s(Le),Oe=G.default.TutorialSteps,Fe=G.default.Preferences,xe=function(e){function t(e){(0,f.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));a.teamChanged=function(e){return a.onTeamChanged(e)},a.shortcutKeyDown=function(e){return a.onShortcutKeyDown(e)},a.blurTime=(new Date).getTime();var n=F.default.getCurrent();return a.state={team:n},a}return(0,E.default)(t,e),(0,p.default)(t,[{key:"onShortcutKeyDown",value:function(e){e.shiftKey&&W.cmdOrCtrlPressed(e)&&e.keyCode===G.default.KeyCodes.L&&(document.getElementById("sidebar-right").className.match("sidebar--right sidebar--right--expanded")?document.getElementById("reply_textbox").focus():document.getElementById("post_textbox").focus())}},{key:"onTeamChanged",value:function(){var e=F.default.getCurrent();this.setState({team:e})}},{key:"componentWillMount",value:function(){A.default.getInt(Fe.TUTORIAL_STEP,U.default.getCurrentId(),999)<=Oe.INTRO_SCREENS&&w.browserHistory.push(F.default.getCurrentTeamRelativeUrl()+"/tutorial")}},{key:"componentDidMount",value:function(){var e=this;F.default.addChangeListener(this.teamChanged),(0,N.startPeriodicStatusUpdates)(),(0,R.startPeriodicSync)(),window.isActive=!0,(0,y.default)(window).on("focus",(0,l.default)(i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return D.default.resetCounts([D.default.getCurrentId()]),D.default.emitChange(),window.isActive=!0,t.next=5,e.props.actions.viewChannel(D.default.getCurrentId());case 5:(new Date).getTime()-e.blurTime>1e4&&e.props.actions.getMyChannelMembers(F.default.getCurrentId()).then(P.loadProfilesForSidebar);case 6:case"end":return t.stop()}},t,e)}))),(0,y.default)(window).on("blur",function(){window.isActive=!1,e.blurTime=(new Date).getTime(),U.default.getCurrentUser()&&e.props.actions.viewChannel("")}),W.applyTheme(this.props.theme),z.isIosSafari()&&T.default.enable(),document.addEventListener("keydown",this.shortcutKeyDown)}},{key:"componentWillUnmount",value:function(){F.default.removeChangeListener(this.teamChanged),(0,y.default)(window).off("focus"),(0,y.default)(window).off("blur"),z.isIosSafari()&&T.default.disable(),(0,N.stopPeriodicStatusUpdates)(),(0,R.stopPeriodicSync)(),document.removeEventListener("keydown",this.shortcutKeyDown)}},{key:"componentDidUpdate",value:function(e){var t=this.props.theme;W.areObjectsEqual(e.theme,t)||W.applyTheme(t)}},{key:"render",value:function(){var e=[];return this.props.children?e=this.props.children:(e.push(this.props.navbar),e.push(this.props.team_sidebar),e.push(this.props.sidebar),e.push(C.default.createElement("div",{id:"inner-wrap-webrtc",key:"inner-wrap",className:"inner-wrap channel__wrap"},C.default.createElement("div",{className:"row header"},C.default.createElement("div",{id:"navbar"},C.default.createElement(fe.default,null))),C.default.createElement("div",{className:"row main"},C.default.cloneElement(this.props.center,{user:this.props.user,team:this.state.team}))))),C.default.createElement("div",{className:"channel-view"},C.default.createElement(K.default,null),C.default.createElement(Re.default,null),C.default.createElement("div",{className:"container-fluid"},C.default.createElement(ye.default,null),C.default.createElement(_e.default,{teamType:this.state.team.type}),C.default.createElement(De.default,null),e,C.default.createElement(j.default,{pluggableName:"Root"}),C.default.createElement(Ne.default,null),C.default.createElement(ee.default,null),C.default.createElement(se.default,null),C.default.createElement(ae.default,null),C.default.createElement(ie.default,null),C.default.createElement(le.default,null),C.default.createElement(ke.default,null),C.default.createElement(Ce.default,null),C.default.createElement(Z.default,null),C.default.createElement(X.default,null),C.default.createElement(pe.default,null),C.default.createElement(ge.default,null),C.default.createElement(ue.default,null),C.default.createElement(Ee.default,{isMac:W.isMac()}),C.default.createElement(Ae.default,null)))}}]),t}(C.default.Component);xe.propTypes={children:_.default.oneOfType([_.default.arrayOf(_.default.element),_.default.element]),navbar:_.default.element,params:_.default.object,sidebar:_.default.element,team_sidebar:_.default.element,center:_.default.element,user:_.default.object,actions:_.default.shape({viewChannel:_.default.func.isRequired,getMyChannelMembers:_.default.func.isRequired}).isRequired,theme:_.default.object.isRequired},t.default=xe},2253:function(e,t,a){a(0),a(0);!function(t){var a=0,n=!1,s=function(e){for(var t=e.target;t!==document.body&&t!==document;){var n=window.getComputedStyle(t);if(!n)break;if("INPUT"===t.nodeName&&"range"===t.getAttribute("type"))return;var s=n.getPropertyValue("-webkit-overflow-scrolling"),r=n.getPropertyValue("overflow-y"),i=parseInt(n.getPropertyValue("height"),10),o="touch"===s&&("auto"===r||"scroll"===r),l=t.scrollHeight>t.offsetHeight;if(o&&l){var d=e.touches?e.touches[0].screenY:e.screenY,u=a<=d&&0===t.scrollTop,c=a>=d&&t.scrollHeight-t.scrollTop===i;return void((u||c)&&e.preventDefault())}t=t.parentNode}e.preventDefault()},r=function(e){a=e.touches?e.touches[0].screenY:e.screenY},i=function(){window.addEventListener("touchstart",r,!1),window.addEventListener("touchmove",s,!1),n=!0},o=function(){window.removeEventListener("touchstart",r,!1),window.removeEventListener("touchmove",s,!1),n=!1},l=function(){return n},d=document.createElement("div");document.documentElement.appendChild(d),d.style.WebkitOverflowScrolling="touch";var u="getComputedStyle"in window&&"touch"===window.getComputedStyle(d)["-webkit-overflow-scrolling"];document.documentElement.removeChild(d),u&&i();var c={enable:i,disable:o,isEnabled:l};void 0!==e&&e.exports&&(e.exports=c),"function"==typeof t.define?function(e){e("iNoBounce",[],function(){return c})}(t.define):t.iNoBounce=c}(this)},2254:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(1),v=n(g),E=a(35),b=a(41),y=n(b),S=a(17),_=a(71),M=a(1948),C=n(M),w=a(9),k=n(w),T=k.default.ActionTypes,N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleDelete=a.handleDelete.bind(a),a.handleToggle=a.handleToggle.bind(a),a.handleHide=a.handleHide.bind(a),a.state={show:!1,post:null,commentCount:0,error:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){C.default.addModalListener(T.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){C.default.removeModalListener(T.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.state.show&&!t.show&&setTimeout(function(){(0,h.default)(y.default.findDOMNode(a.refs.deletePostBtn)).focus()},0)}},{key:"handleDelete",value:function(){var e=this;(0,_.deletePost)(this.state.post.channel_id,this.state.post,function(){e.handleHide()},function(t){e.setState({error:t.message})})}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post,commentCount:t.commentCount,error:""})}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){if(!this.state.post)return null;var e=null;this.state.error&&(e=v.default.createElement("div",{className:"form-group has-error"},v.default.createElement("label",{className:"control-label"},this.state.error)));var t="";this.state.commentCount>0&&(t=v.default.createElement(S.FormattedMessage,{id:"delete_post.warning",defaultMessage:"This post has {count, number} {count, plural, one {comment} other {comments}} on it.",values:{count:this.state.commentCount}}));var a=this.state.post.root_id?v.default.createElement(S.FormattedMessage,{id:"delete_post.comment",defaultMessage:"Comment"}):v.default.createElement(S.FormattedMessage,{id:"delete_post.post",defaultMessage:"Post"});return v.default.createElement(E.Modal,{show:this.state.show,onHide:this.handleHide},v.default.createElement(E.Modal.Header,{closeButton:!0},v.default.createElement(E.Modal.Title,null,v.default.createElement(S.FormattedMessage,{id:"delete_post.confirm",defaultMessage:"Confirm {term} Delete",values:{term:a}}))),v.default.createElement(E.Modal.Body,null,v.default.createElement(S.FormattedMessage,{id:"delete_post.question",defaultMessage:"Are you sure you want to delete this {term}?",values:{term:a}}),v.default.createElement("br",null),v.default.createElement("br",null),t,e),v.default.createElement(E.Modal.Footer,null,v.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},v.default.createElement(S.FormattedMessage,{id:"delete_post.cancel",defaultMessage:"Cancel"})),v.default.createElement("button",{ref:"deletePostBtn",type:"button",className:"btn btn-danger",onClick:this.handleDelete},v.default.createElement(S.FormattedMessage,{id:"delete_post.del",defaultMessage:"Delete"}))))}}]),t}(v.default.Component);t.default=N},2255:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t,{ctrlSend:(0,f.getBool)(e,c.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),config:(0,m.getConfig)(e),editingPost:(0,g.getEditingPost)(e)})}function r(e){return{actions:(0,d.bindActionCreators)({editPost:h.editPost,setEditingPost:p.setEditingPost,addMessageIntoHistory:u.addMessageIntoHistory},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(74),c=a(25),f=a(62),m=a(192),p=a(71),h=a(2256),g=a(2257),v=a(2258),E=n(v);t.default=(0,l.connect)(s,r)(E.default)},2256:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=this;return function(){var a=(0,u.default)(i.default.mark(function a(n,s){var r;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.editPost(e)(n,s);case 2:return r=t.sent,r.error&&p.default.handleServerAction({type:h.ActionTypes.RECEIVED_ERROR,err:(0,l.default)({id:r.error.server_error_id},r.error)}),t.abrupt("return",r);case 5:case"end":return t.stop()}},a,t)}));return function(e,t){return a.apply(this,arguments)}}()}Object.defineProperty(t,"__esModule",{value:!0});var r=a(57),i=n(r),o=a(19),l=n(o),d=a(58),u=n(d);t.editPost=s;var c=a(74),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(c),m=a(39),p=n(m),h=a(9)},2257:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEditingPost=void 0;var n=a(19),s=function(e){return e&&e.__esModule?e:{default:e}}(n),r=a(63),i=a(92);t.getEditingPost=(0,r.createSelector)(function(e){return e.views.posts.editingPost&&e.views.posts.editingPost.postId?(0,i.getPost)(e,e.views.posts.editingPost.postId):null},function(e){return e.views.posts.editingPost},function(e,t){return(0,s.default)({},t,{post:e})})},2258:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(57),i=s(r),o=a(58),l=s(o),d=a(5),u=s(d),c=a(3),f=s(c),m=a(4),p=s(m),h=a(6),g=s(h),v=a(7),E=s(v),b=a(1),y=s(b),S=a(41),_=s(S),M=a(35),C=a(17),w=a(8),k=s(w),T=a(92),N=n(T),P=a(56),R=n(P),I=a(32),D=s(I),L=a(9),A=s(L),O=a(73),F=n(O),x=a(16),U=n(x),H=a(284),j=s(H),B=a(393),G=s(B),V=A.default.KeyCodes,z=D.default.getState,q=function(e){function t(e){var a=this;(0,f.default)(this,t);var n=(0,g.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return n.mustBeShown=function(){return!n.state.hidding&&!(!n.props.editingPost||!n.props.editingPost.post)},n.getContainer=function(){return n.refs.editModalBody},n.toggleEmojiPicker=function(){n.setState({showEmojiPicker:!n.state.showEmojiPicker})},n.hideEmojiPicker=function(){n.setState({showEmojiPicker:!1})},n.handleEmojiClick=function(e){var t=e&&(e.name||e.aliases&&e.aliases[0]);if(t){if(""===n.state.editText)n.setState({editText:":"+t+": "});else{var a=/\s+$/.test(n.state.editText)?n.state.editText+":"+t+": ":n.state.editText+" :"+t+": ";n.setState({editText:a})}n.setState({showEmojiPicker:!1}),n.refs.editbox.focus()}},n.getEditPostControls=function(){return n.refs.editPostEmoji},n.handlePostError=function(e){n.state.postError!==e&&n.setState({postError:e})},n.handleEdit=(0,l.default)(i.default.mark(function e(){var t,s,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={message:n.state.editText,id:n.props.editingPost.postId,channel_id:n.props.editingPost.post.channel_id},!n.state.postError){e.next=5;break}return n.setState({errorClass:"animation--highlight"}),setTimeout(function(){n.setState({errorClass:null})},A.default.ANIMATION_TIMEOUT),e.abrupt("return");case 5:if(t.message!==n.props.editingPost.post.message){e.next=8;break}return n.handleHide(),e.abrupt("return");case 8:if(0!==t.message.trim().length){e.next=12;break}return n.handleHide(),R.showDeletePostModal(N.getPost(z(),n.props.editingPost.postId),n.props.editingPost.commentsCount),e.abrupt("return");case 12:return n.props.actions.addMessageIntoHistory(t.message),e.next=15,n.props.actions.editPost(t);case 15:s=e.sent,r=s.data,r&&window.scrollTo(0,0),n.handleHide();case 19:case"end":return e.stop()}},e,a)})),n.handleChange=function(e){var t=e.target.value;n.setState({editText:t})},n.handleEditKeyPress=function(e){F.isMobile()||n.props.ctrlSend||e.which!==V.ENTER||e.shiftKey||e.altKey?n.props.ctrlSend&&e.ctrlKey&&e.which===V.ENTER&&(e.preventDefault(),_.default.findDOMNode(n.refs.editbox).blur(),n.handleEdit()):(e.preventDefault(),_.default.findDOMNode(n.refs.editbox).blur(),n.handleEdit())},n.handleKeyDown=function(e){n.props.ctrlSend&&e.keyCode===V.ENTER&&!0===e.ctrlKey&&n.handleEdit()},n.handleHide=function(){n.setState({hidding:!0})},n.handleEnter=function(){n.setState({editText:n.props.editingPost.post.message})},n.handleEntered=function(){n.refs.editbox.focus(),n.refs.editbox.recalculateSize()},n.handleExit=function(){n.refs.editbox.hidePreview()},n.handleExited=function(){var e=n.props.editingPost.refocusId;""!==e&&setTimeout(function(){var t=document.getElementById(e);t&&t.focus()}),n.props.actions.setEditingPost(),n.setState({editText:"",postError:"",errorClass:null,hidding:!1,showEmojiPicker:!1})},n.state={editText:"",postError:"",errorClass:null,showEmojiPicker:!1,hidding:!1},n}return(0,E.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){var e="edit-post-footer"+(this.state.postError?" has-error":""),t=null;if(this.state.postError){var a="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");t=y.default.createElement("label",{className:a},this.state.postError)}var n=null;return"true"===this.props.config.EnableEmojiPicker&&(n=y.default.createElement("span",{className:"emoji-picker__container"},y.default.createElement(j.default,{show:this.state.showEmojiPicker,container:this.getContainer,target:this.getEditPostControls,onHide:this.hideEmojiPicker,onEmojiClick:this.handleEmojiClick,rightOffset:50,topOffset:-20}),y.default.createElement("span",{className:"icon icon--emoji",onClick:this.toggleEmojiPicker,dangerouslySetInnerHTML:{__html:A.default.EMOJI_ICON_SVG}}))),y.default.createElement(M.Modal,{dialogClassName:"edit-modal",show:this.mustBeShown(),onKeyDown:this.handleKeyDown,onHide:this.handleHide,onEnter:this.handleEnter,onEntered:this.handleEntered,onExit:this.handleExit,onExited:this.handleExited},y.default.createElement(M.Modal.Header,{closeButton:!0},y.default.createElement(M.Modal.Title,null,y.default.createElement(C.FormattedMessage,{id:"edit_post.edit",defaultMessage:"Edit {title}",values:{title:this.props.editingPost.title}}))),y.default.createElement(M.Modal.Body,{bsClass:"modal-body edit-modal-body",ref:"editModalBody"},y.default.createElement(G.default,{onChange:this.handleChange,onKeyPress:this.handleEditKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:this.state.editText,channelId:this.props.editingPost.post&&this.props.editingPost.post.channel_id,emojiEnabled:"true"===this.props.config.EnableEmojiPicker,createMessage:U.localizeMessage("edit_post.editPost","Edit the post..."),supportsCommands:!1,suggestionListStyle:"bottom",id:"edit_textbox",ref:"editbox"}),y.default.createElement("span",{ref:"editPostEmoji",className:"edit-post__actions"},n),y.default.createElement("div",{className:e},t)),y.default.createElement(M.Modal.Footer,null,y.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},y.default.createElement(C.FormattedMessage,{id:"edit_post.cancel",defaultMessage:"Cancel"})),y.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleEdit},y.default.createElement(C.FormattedMessage,{id:"edit_post.save",defaultMessage:"Save"}))))}}]),t}(y.default.PureComponent);q.propTypes={ctrlSend:k.default.bool,config:k.default.object.isRequired,editingPost:k.default.object.isRequired,actions:k.default.shape({editPost:k.default.func.isRequired,addMessageIntoHistory:k.default.func.isRequired,setEditingPost:k.default.func.isRequired}).isRequired},t.default=q},2259:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=(0,l.getCurrentTeam)(e),n=(0,d.getSiteURL)()+"/"+a.name;return(0,i.default)({},t,{currentTeamUrl:n})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),i=n(r),o=a(26),l=a(81),d=a(70),u=a(2260),c=n(u);t.default=(0,o.connect)(s)(c.default)},2260:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(8),v=n(g),E=a(1948),b=n(E),y=a(9),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=a(2057),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.hide=a.hide.bind(a),a.state={show:!1,post:{}},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(S.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(S.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this.props.currentTeamUrl+"/pl/"+this.state.post.id;return h.default.createElement(w.default,{show:this.state.show,onHide:this.hide,title:M.localizeMessage("get_post_link_modal.title","Copy Permalink"),helpText:M.localizeMessage("get_post_link_modal.help","The link below allows authorized users to see your post."),link:e})}}]),t}(h.default.PureComponent);k.propTypes={currentTeamUrl:v.default.string.isRequired},t.default=k},2261:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,i.default)({},t,{currentTeam:(0,l.getCurrentTeam)(e),config:(0,d.getConfig)(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),i=n(r),o=a(26),l=a(81),d=a(192),u=a(2262),c=n(u);t.default=(0,o.connect)(s)(c.default)},2262:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(8),v=n(g),E=a(1948),b=n(E),y=a(9),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=a(70),w=a(2057),k=n(w),T=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleToggle=function(e){a.setState({show:e})},a.state={show:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(S.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(S.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"render",value:function(){var e=this,t=(0,C.getSiteURL)()+"/signup_user_complete/?id="+this.props.currentTeam.invite_id,a=void 0;return a="true"===this.props.config.EnableUserCreation?M.localizeMessage("get_team_invite_link_modal.help","Send teammates the link below for them to sign-up to this team site. The Team Invite Link can be shared with multiple teammates as it does not change unless it's regenerated in Team Settings by a Team Admin."):M.localizeMessage("get_team_invite_link_modal.helpDisabled","User creation has been disabled for your team. Please ask your team administrator for details."),h.default.createElement(k.default,{show:this.state.show,onHide:function(){return e.handleToggle(!1)},title:M.localizeMessage("get_team_invite_link_modal.title","Team Invite Link"),helpText:a,link:t})}}]),t}(h.default.PureComponent);T.propTypes={currentTeam:v.default.object.isRequired,config:v.default.object.isRequired},t.default=T},2263:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t,{link:f.getFilePublicLink(e).link})}function r(e){return{actions:(0,d.bindActionCreators)({getFilePublicLink:u.getFilePublicLink},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(398),c=a(399),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(c),m=a(2264),p=n(m);t.default=(0,l.connect)(s,r)(p.default)},2264:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(8),v=n(g),E=a(1948),b=n(E),y=a(9),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=a(2057),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleToggle=function(e,t){a.setState({show:e,fileId:t.fileId})},a.onHide=function(){a.setState({show:!1})},a.state={show:!1,fileId:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentWillUnmount",value:function(){b.default.removeModalListener(S.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"componentDidMount",value:function(){b.default.addModalListener(S.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){this.state.show&&!t.show&&this.props.actions.getFilePublicLink(this.state.fileId)}},{key:"render",value:function(){return h.default.createElement(w.default,{show:this.state.show,onHide:this.onHide,title:M.localizeMessage("get_public_link_modal.title","Copy Public Link"),helpText:M.localizeMessage("get_public_link_modal.help","The link below allows anyone to see this file without being registered on this server."),link:this.props.link})}}]),t}(h.default.PureComponent);k.propTypes={link:v.default.string,actions:v.default.shape({getFilePublicLink:v.default.func.isRequired}).isRequired},k.defaultProps={link:""},t.default=k},2265:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(1),g=s(h),v=a(35),E=a(41),b=s(E),y=a(17),S=a(56),_=n(S),M=a(387),C=a(31),w=s(C),k=a(1948),T=s(k),N=a(36),P=s(N),R=a(27),I=s(R),D=a(9),L=s(D),A=a(16),O=n(A),F=a(283),x=s(F),U=L.default.ActionTypes,H=(0,y.defineMessages)({emailError:{id:"invite_member.emailError",defaultMessage:"Please enter a valid email address"},firstname:{id:"invite_member.firstname",defaultMessage:"First name"},lastname:{id:"invite_member.lastname",defaultMessage:"Last name"},modalTitle:{id:"invite_member.modalTitle",defaultMessage:"Discard Invitations?"},modalMessage:{id:"invite_member.modalMessage",defaultMessage:"You have unsent invitations, are you sure you want to discard them?"},modalButton:{id:"invite_member.modalButton",defaultMessage:"Yes, Discard"}}),j=function(t){function a(t){(0,l.default)(this,a);var n=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,t));n.teamChange=n.teamChange.bind(n),n.handleToggle=n.handleToggle.bind(n),n.handleSubmit=n.handleSubmit.bind(n),n.handleHide=n.handleHide.bind(n),n.addInviteFields=n.addInviteFields.bind(n),n.clearFields=n.clearFields.bind(n),n.removeInviteFields=n.removeInviteFields.bind(n),n.showGetTeamInviteLinkModal=n.showGetTeamInviteLinkModal.bind(n),n.handleKeyDown=n.handleKeyDown.bind(n);var s=P.default.getCurrent();return n.state={show:!1,inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{},emailEnabled:"true"===e.window.mm_config.SendEmailNotifications,userCreationEnabled:"true"===e.window.mm_config.EnableUserCreation,showConfirmModal:!1,isSendingEmails:!1,teamType:s?s.type:null},n}return(0,p.default)(a,t),(0,u.default)(a,[{key:"teamChange",value:function(){var e=P.default.getCurrent(),t=e?e.type:null;this.setState({teamType:t})}},{key:"componentDidMount",value:function(){T.default.addModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),P.default.addChangeListener(this.teamChange)}},{key:"componentWillUnmount",value:function(){T.default.removeModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),P.default.removeChangeListener(this.teamChange)}},{key:"handleToggle",value:function(e){this.setState({show:e,serverError:null})}},{key:"handleSubmit",value:function(){var e=this;if(this.state.emailEnabled){for(var t=this.state.inviteIds,a=t.length,n=[],s=this.state.emailErrors,r=this.state.firstNameErrors,i=this.state.lastNameErrors,o=!0,l=0;l<a;l++){var d={},u=t[l];d.email=b.default.findDOMNode(this.refs["email"+u]).value.trim(),d.firstName=b.default.findDOMNode(this.refs["first_name"+u]).value.trim(),d.lastName=b.default.findDOMNode(this.refs["last_name"+u]).value.trim(),""===d.email&&0!==u||(d.email&&O.isEmail(d.email)?s[u]="":(s[u]=this.props.intl.formatMessage(H.emailError),o=!1),n.push(d))}if(this.setState({emailErrors:s,firstNameErrors:r,lastNameErrors:i}),o&&0!==n.length){var c={};c.invites=n,this.setState({isSendingEmails:!0}),(0,M.inviteMembers)(c,function(){e.handleHide(!1),e.setState({isSendingEmails:!1})},function(t){"api.team.invite_members.already.app_error"===t.id?(s[t.detailed_error]=t.message,e.setState({emailErrors:s})):e.setState({serverError:t.message}),e.setState({isSendingEmails:!1})})}}}},{key:"handleHide",value:function(e){if(e){for(var t=!1,a=0;a<this.state.inviteIds.length;a++){var n=this.state.inviteIds[a];if(""!==b.default.findDOMNode(this.refs["email"+n]).value.trim()){t=!0;break}}if(t)return void this.setState({showConfirmModal:!0})}this.clearFields(),this.setState({show:!1,showConfirmModal:!1})}},{key:"addInviteFields",value:function(){var e=this.state.idCount+1,t=this.state.inviteIds;t.push(e),this.setState({inviteIds:t,idCount:e})}},{key:"clearFields",value:function(){for(var e=this.state.inviteIds,t=0;t<e.length;t++){var a=e[t];b.default.findDOMNode(this.refs["email"+a]).value="",b.default.findDOMNode(this.refs["first_name"+a]).value="",b.default.findDOMNode(this.refs["last_name"+a]).value=""}this.setState({inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{}})}},{key:"removeInviteFields",value:function(e){var t=this.state.idCount,a=this.state.inviteIds,n=a.indexOf(e);n>-1&&a.splice(n,1),a.length||a.push(++t),this.setState({inviteIds:a,idCount:t})}},{key:"showGetTeamInviteLinkModal",value:function(){this.handleHide(!1),_.showGetTeamInviteLinkModal()}},{key:"handleKeyDown",value:function(e){e.keyCode===L.default.KeyCodes.ENTER&&(e.preventDefault(),this.handleSubmit())}},{key:"render",value:function(){var e=this,t=I.default.getCurrentUser(),a=this.props.intl.formatMessage;if(null!=t&&null!=this.state.teamType){for(var n=[],s=this.state.inviteIds,r=0;r<s.length;r++){var i=s[r],o=null;this.state.emailErrors[i]&&(o=g.default.createElement("label",{className:"control-label"},this.state.emailErrors[i]));var l=null;this.state.firstNameErrors[i]&&(l=g.default.createElement("label",{className:"control-label"},this.state.firstNameErrors[i]));var d=null;this.state.lastNameErrors[i]&&(d=g.default.createElement("label",{className:"control-label"},this.state.lastNameErrors[i]));var u=null;i&&(u=g.default.createElement("div",null,g.default.createElement("button",{type:"button",className:"btn btn-link remove__member",onClick:this.removeInviteFields.bind(this,i)},g.default.createElement("span",{className:"fa fa-trash"}))));var c="form-group invite";o&&(c+=" has-error");var f=null,m="form-group";l&&(m+=" has-error");var p="form-group";d&&(p+=" has-error"),f=g.default.createElement("div",{className:"row row--invite"},g.default.createElement("div",{className:"col-sm-6"},g.default.createElement("div",{className:m},g.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"first_name"+i,placeholder:a(H.firstname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),l)),g.default.createElement("div",{className:"col-sm-6"},g.default.createElement("div",{className:p},g.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"last_name"+i,placeholder:a(H.lastname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),d))),n[i]=g.default.createElement("div",{key:"key"+i},u,g.default.createElement("div",{className:c},g.default.createElement("input",{onKeyUp:this.displayNameKeyUp,onKeyDown:this.handleKeyDown,type:"text",ref:"email"+i,className:"form-control",placeholder:"email@domain.com",maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),o),f)}var h=null;this.state.serverError&&(h=g.default.createElement("div",{className:"form-group has-error"},g.default.createElement("label",{className:"control-label"},this.state.serverError)));var E=null,b=null,S="";if(w.default.getByName(L.default.DEFAULT_CHANNEL)&&(S=w.default.getByName(L.default.DEFAULT_CHANNEL).display_name),this.state.emailEnabled&&this.state.userCreationEnabled){E=g.default.createElement("div",null,h,g.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.addInviteFields},g.default.createElement(y.FormattedMessage,{id:"invite_member.addAnother",defaultMessage:"Add another"})),g.default.createElement("br",null),g.default.createElement("br",null),g.default.createElement("span",null,g.default.createElement(y.FormattedHTMLMessage,{id:"invite_member.autoJoin",defaultMessage:"People invited automatically join the <strong>{channel}</strong> channel.",values:{channel:S}})));var _=g.default.createElement(y.FormattedMessage,{id:"invite_member.send",defaultMessage:"Send Invitation"});this.state.isSendingEmails?_=g.default.createElement("span",null,g.default.createElement("i",{className:"fa fa-spinner fa-spin"}),g.default.createElement(y.FormattedMessage,{id:"invite_member.sending",defaultMessage:" Sending"})):this.state.inviteIds.length>1&&(_=g.default.createElement(y.FormattedMessage,{id:"invite_member.send2",defaultMessage:"Send Invitations"})),b=g.default.createElement("button",{onClick:this.handleSubmit,type:"button",className:"btn btn-primary",disabled:this.state.isSendingEmails},_)}else if(this.state.userCreationEnabled){var M=null;if(t&&"O"===this.state.teamType){var C=g.default.createElement("button",{className:"color--link style--none",onClick:this.showGetTeamInviteLinkModal},g.default.createElement(y.FormattedMessage,{id:"invite_member.inviteLink",defaultMessage:"Team Invite Link"}));M=g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.teamInviteLink",defaultMessage:"You can also invite people using the {link}.",values:{link:C}}))}E=g.default.createElement("div",null,g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.content",defaultMessage:"Email is currently disabled for your team, and email invitations cannot be sent. Contact your System Administrator to enable email and email invitations."})),M)}else E=g.default.createElement("div",null,g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.disabled",defaultMessage:"User creation has been disabled for your team. Please ask your Team Administrator for details."})));return g.default.createElement("div",null,g.default.createElement(v.Modal,{dialogClassName:"modal-invite-member",show:this.state.show,onHide:this.handleHide.bind(this,!0),enforceFocus:!this.state.showConfirmModal,backdrop:!this.state.isSendingEmails||"static"},g.default.createElement(v.Modal.Header,{closeButton:!this.state.isSendingEmails},g.default.createElement(v.Modal.Title,null,g.default.createElement(y.FormattedMessage,{id:"invite_member.newMember",defaultMessage:"Send Email Invite"}))),g.default.createElement(v.Modal.Body,{ref:"modalBody"},g.default.createElement("form",{role:"form"},n),E),g.default.createElement(v.Modal.Footer,null,g.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide.bind(this,!0),disabled:this.state.isSendingEmails},g.default.createElement(y.FormattedMessage,{id:"invite_member.cancel",defaultMessage:"Cancel"})),b)),g.default.createElement(x.default,{title:a(H.modalTitle),message:a(H.modalMessage),confirmButtonText:a(H.modalButton),show:this.state.showConfirmModal,onConfirm:this.handleHide.bind(this,!1),onCancel:function(){return e.setState({showConfirmModal:!1})}}))}return null}}]),a}(g.default.Component);j.propTypes={intl:y.intlShape.isRequired},t.default=(0,y.injectIntl)(j)}).call(t,a(23))},2266:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(35),v=a(17),E=a(56),b=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(E),y=a(1948),S=n(y),_=a(27),M=n(_),C=a(388),w=n(C),k=a(9),T=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleHide=a.handleHide.bind(a),a.handleKeyPress=a.handleKeyPress.bind(a),a.state={show:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){S.default.addModalListener(k.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle),document.addEventListener("keypress",this.handleKeyPress)}},{key:"componentWillUnmount",value:function(){S.default.removeModalListener(k.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle),document.removeEventListener("keypress",this.handleKeyPress)}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.state.show&&this.handleSubmit(e)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleSubmit",value:function(e){if(this.setState({show:!1}),w.default.isBusy())return w.default.emitChanged({action:k.WebrtcActionTypes.IN_PROGRESS}),void e.preventDefault();b.emitLeaveTeam(),b.toggleSideBarRightMenuAction()}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return null!=M.default.getCurrentUser()?h.default.createElement(g.Modal,{className:"modal-confirm",show:this.state.show,onHide:this.handleHide},h.default.createElement(g.Modal.Header,{closeButton:!1},h.default.createElement(g.Modal.Title,null,h.default.createElement(v.FormattedMessage,{id:"leave_team_modal.title",defaultMessage:"Leave the team?"}))),h.default.createElement(g.Modal.Body,null,h.default.createElement(v.FormattedMessage,{id:"leave_team_modal.desc",defaultMessage:"You will be removed from all public and private channels.  If the team is private you will not be able to rejoin the team.  Are you sure?"})),h.default.createElement(g.Modal.Footer,null,h.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},h.default.createElement(v.FormattedMessage,{id:"leave_team_modal.no",defaultMessage:"No"})),h.default.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleSubmit},h.default.createElement(v.FormattedMessage,{id:"leave_team_modal.yes",defaultMessage:"Yes"})))):null}}]),t}(h.default.Component);T.propTypes={intl:v.intlShape.isRequired},t.default=(0,v.injectIntl)(T)},2267:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(17),v=a(82),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(1948),y=n(b),S=a(9),_=n(S),M=a(283),C=n(M),w=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleHide=a.handleHide.bind(a),a.handleKeyPress=a.handleKeyPress.bind(a),a.state={show:!1,channel:null},a.mounted=!1,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,y.default.addModalListener(_.default.ActionTypes.TOGGLE_LEAVE_PRIVATE_CHANNEL_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,y.default.removeModalListener(_.default.ActionTypes.TOGGLE_LEAVE_PRIVATE_CHANNEL_MODAL,this.handleToggle)}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.state.show&&this.handleSubmit()}},{key:"handleSubmit",value:function(){var e=this.state.channel.id;this.setState({show:!1,channel:null}),E.leaveChannel(e)}},{key:"handleToggle",value:function(e){this.setState({channel:e,show:null!==e})}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e="",t="";this.state.channel&&(e=h.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.title",defaultMessage:"Leave Private Channel {channel}",values:{channel:h.default.createElement("b",null,this.state.channel.display_name)}}),t=h.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.message",defaultMessage:"Are you sure you wish to leave the private channel {channel}? You must be re-invited in order to re-join this channel in the future.",values:{channel:h.default.createElement("b",null,this.state.channel.display_name)}}));var a=h.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.leave",defaultMessage:"Yes, leave channel"});return h.default.createElement(C.default,{show:this.state.show,title:e,message:t,confirmButtonClass:"btn btn-danger",confirmButtonText:a,onConfirm:this.handleSubmit,onCancel:this.handleHide})}}]),t}(h.default.Component);w.propTypes={intl:g.intlShape.isRequired},t.default=(0,g.injectIntl)(w)},2268:function(e,t,a){"use strict";function n(e){return{isPinnedPosts:(0,l.getRhsState)(e)===d.RHSStates.PIN}}function s(e){return{actions:(0,i.bindActionCreators)({closeRightHandSide:o.closeRightHandSide,updateRhsState:o.updateRhsState},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(26),i=a(21),o=a(219),l=a(218),d=a(9),u=a(2269),c=function(e){return e&&e.__esModule?e:{default:e}}(u);t.default=(0,r.connect)(n,s)(c.default)},2269:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),i=s(r),o=a(5),l=s(o),d=a(3),u=s(d),c=a(4),f=s(c),m=a(6),p=s(m),h=a(7),g=s(h),v=a(0),E=s(v),b=a(8),y=s(b),S=a(1),_=s(S),M=a(17),C=a(34),w=a(400),k=s(w),T=a(691),N=s(T),P=a(82),R=n(P),I=a(56),D=n(I),L=a(285),A=n(L),O=a(71),F=a(39),x=s(F),U=a(31),H=s(U),j=a(1948),B=s(j),G=a(113),V=s(G),z=a(36),q=s(z),W=a(27),Y=s(W),K=a(388),J=s(K),X=a(101),Q=n(X),Z=a(9),$=a(16),ee=n($),te=a(692),ae=s(te),ne=a(290),se=s(ne),re=a(403),ie=s(re),oe=a(695),le=s(oe),de=a(696),ue=s(de),ce=a(2270),fe=s(ce),me=a(2271),pe=s(me),he=a(697),ge=s(he),ve=a(390),Ee=s(ve),be=a(659),ye=s(be),Se=a(698),_e=s(Se),Me=a(221),Ce=s(Me),we=a(2275),ke=s(we),Te=function(t){function a(e){(0,u.default)(this,a);var t=(0,p.default)(this,(a.__proto__||(0,l.default)(a)).call(this,e));return t.getStateFromStores=function(){var e=H.default.getCurrent(),t=null;return e&&"D"===e.type&&(t=ee.getUserIdFromChannelName(e)),{channel:e,member:H.default.getCurrentMember(),users:[],userCount:H.default.getCurrentStats().member_count,currentUser:Y.default.getCurrentUser(),isFavorite:e&&Q.isFavoriteChannel(e),contactId:t,isBusy:J.default.isBusy()}},t.isStateValid=function(){return t.state.channel&&t.state.member&&t.state.users&&t.state.currentUser},t.handleLeave=function(){t.state.channel.type===Z.Constants.PRIVATE_CHANNEL?D.showLeavePrivateChannelModal(t.state.channel):R.leaveChannel(t.state.channel.id)},t.hideSidebars=function(e){(0,E.default)(window).outerWidth()<=768&&(t.props.actions.closeRightHandSide(),"navbar-toggle"!==e.target.className&&"icon-bar"!==e.target.className&&((0,E.default)(".app__body .inner-wrap").removeClass("move--right move--left move--left-small"),(0,E.default)(".app__body .sidebar--left").removeClass("move--right"),(0,E.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,E.default)(".app__body .sidebar--right").removeClass("move--left"),(0,E.default)(".app__body .sidebar--menu").removeClass("move--left")))},t.toggleLeftSidebar=function(){(0,E.default)(".app__body .inner-wrap").toggleClass("move--right"),(0,E.default)(".app__body .sidebar--left").toggleClass("move--right"),(0,E.default)(".multi-teams .team-sidebar").toggleClass("move--right")},t.toggleRightSidebar=function(){(0,E.default)(".app__body .inner-wrap").toggleClass("move--left-small"),(0,E.default)(".app__body .sidebar--menu").toggleClass("move--left")},t.showSearch=function(){t.props.actions.updateRhsState(Z.RHSStates.SEARCH)},t.onChange=function(){t.setState(t.getStateFromStores())},t.showEditChannelHeaderModal=function(){t.setState({showEditChannelHeaderModal:!0})},t.hideEditChannelHeaderModal=function(){t.setState({showEditChannelHeaderModal:!1})},t.showChannelNotificationsModal=function(e){e.preventDefault(),t.setState({showChannelNotificationsModal:!0})},t.hideChannelNotificationsModal=function(){t.setState({showChannelNotificationsModal:!1})},t.showChannelPurposeModal=function(){t.setState({showEditChannelPurposeModal:!0})},t.hideChannelPurposeModal=function(){t.setState({showEditChannelPurposeModal:!1})},t.showRenameChannelModal=function(){t.setState({showRenameChannelModal:!0})},t.hideRenameChannelModal=function(){t.setState({showRenameChannelModal:!1})},t.showMembersModal=function(e){e.preventDefault(),t.setState({showMembersModal:!0})},t.hideMembersModal=function(){t.setState({showMembersModal:!1})},t.handleQuickSwitchKeyPress=function(e){ee.cmdOrCtrlPressed(e)&&!e.shiftKey&&e.keyCode===Z.Constants.KeyCodes.K&&(e.altKey||(e.preventDefault(),t.toggleQuickSwitchModal("channel")))},t.toggleQuickSwitchModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"channel";t.state.showQuickSwitchModal?t.setState({showQuickSwitchModal:!1,quickSwitchMode:"channel"}):t.setState({showQuickSwitchModal:!0,quickSwitchMode:e})},t.hideQuickSwitchModal=function(){t.setState({showQuickSwitchModal:!1,quickSwitchMode:"channel"})},t.openDirectMessageModal=function(){x.default.handleViewAction({type:Z.ActionTypes.TOGGLE_DM_MODAL,value:!0,channelId:t.state.channel.id})},t.getPinnedPosts=function(e){e.preventDefault(),t.props.isPinnedPosts?D.emitCloseRightHandSide():(0,O.getPinnedPosts)(t.state.channel.id)},t.toggleFavorite=function(e){e.preventDefault(),t.state.isFavorite?R.unmarkFavorite(t.state.channel.id):R.markFavorite(t.state.channel.id)},t.onBusy=function(e){t.setState({isBusy:e})},t.initWebrtc=function(){t.isContactNotAvailable()||(D.emitCloseRightHandSide(),A.initWebrtc(t.state.contactId,!0))},t.createDropdown=function(e,a,n,s,r,i,o){if(e){var l=void 0,d=void 0,u=void 0,c=void 0,f=void 0,m=void 0,p=void 0,h=void 0,g=void 0,v=void 0,E=void 0;i?(m=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showEditChannelHeaderModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Edit Channel Header"}))),d=t.generateWebrtcDropdown()):o?(m=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showEditChannelHeaderModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Edit Channel Header"}))),h=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showChannelNotificationsModal},_.default.createElement(M.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),c=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.openDirectMessageModal},_.default.createElement(M.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"})))):(l=_.default.createElement("li",{role:"presentation"},_.default.createElement(_e.default,{role:"menuitem",modalId:Z.ModalIdentifiers.CHANNEL_INFO,dialogType:ae.default,dialogProps:{channel:e}},_.default.createElement(M.FormattedMessage,{id:"navbar.viewInfo",defaultMessage:"View Info"}))),u=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.getPinnedPosts},_.default.createElement(M.FormattedMessage,{id:"navbar.viewPinnedPosts",defaultMessage:"View Pinned Posts"}))),H.default.isDefault(e)?f=_.default.createElement("li",{key:"view_members",role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showMembersModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.viewMembers",defaultMessage:"View Members"}))):(c=_.default.createElement("li",{role:"presentation"},_.default.createElement(ye.default,{ref:"channelInviteModalButton",role:"menuitem",dialogType:se.default,dialogProps:{channel:e,currentUser:t.state.currentUser}},_.default.createElement(M.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"}))),f=Q.canManageMembers(e,r,s,n)?_.default.createElement("li",{key:"manage_members",role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showMembersModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.manageMembers",defaultMessage:"Manage Members"}))):_.default.createElement("li",{key:"view_members",role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showMembersModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.viewMembers",defaultMessage:"View Members"})))),h=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showChannelNotificationsModal},_.default.createElement(M.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),Q.showManagementOptions(e,r,s,n)&&(m=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showEditChannelHeaderModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.setHeader",defaultMessage:"Edit Channel Header"}))),p=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showChannelPurposeModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.setPurpose",defaultMessage:"Edit Channel Purpose"}))),g=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.showRenameChannelModal},_.default.createElement(M.FormattedMessage,{id:"channel_header.rename",defaultMessage:"Rename Channel"})))),Q.showDeleteOptionForCurrentUser(e,r,s,n)&&(v=_.default.createElement("li",{role:"presentation"},_.default.createElement(ye.default,{role:"menuitem",dialogType:ue.default,dialogProps:{channel:e}},_.default.createElement(M.FormattedMessage,{id:"channel_header.delete",defaultMessage:"Delete Channel"})))),H.default.isDefault(e)||(E=_.default.createElement("li",{role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.handleLeave},_.default.createElement(M.FormattedMessage,{id:"channel_header.leave",defaultMessage:"Leave Channel"})))));var b=_.default.createElement("li",{key:"toggle_favorite",role:"presentation"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:t.toggleFavorite},t.state.isFavorite?_.default.createElement(M.FormattedMessage,{id:"channelHeader.removeFromFavorites",defaultMessage:"Remove from Favorites"}):_.default.createElement(M.FormattedMessage,{id:"channelHeader.addToFavorites",defaultMessage:"Add to Favorites"})));return _.default.createElement("div",{className:"navbar-brand"},_.default.createElement("div",{className:"dropdown"},t.generateWebrtcIcon(),_.default.createElement("a",{href:"#",className:"dropdown-toggle theme",type:"button","data-toggle":"dropdown","aria-expanded":"true"},_.default.createElement("span",{className:"heading"},_.default.createElement(Ee.default,{status:t.getTeammateStatus()}),a," "),_.default.createElement("span",{className:"fa fa-angle-down header-dropdown__icon"})),_.default.createElement("ul",{className:"dropdown-menu",role:"menu"},l,d,u,h,c,f,m,p,g,v,E,b,_.default.createElement("div",{className:"close visible-xs-block",onClick:function(){return t.refs.headerOverlay.hide()}},"×"))))}return _.default.createElement("div",{className:"navbar-brand"},_.default.createElement(C.Link,{to:q.default.getCurrentTeamUrl()+"/channels/town-square",className:"heading"},a))},t.createCollapseButtons=function(e){var a=[],n=Z.Constants.MENU_ICON_SVG;return null==e?a.push(_.default.createElement("button",{key:"navbar-toggle-collapse",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#navbar-collapse-1"},_.default.createElement("span",{className:"sr-only"},_.default.createElement(M.FormattedMessage,{id:"navbar.toggle1",defaultMessage:"Toggle sidebar"})),_.default.createElement("span",{className:"icon-bar"}),_.default.createElement("span",{className:"icon-bar"}),_.default.createElement("span",{className:"icon-bar"}))):(a.push(_.default.createElement("button",{key:"navbar-toggle-sidebar",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:t.toggleLeftSidebar},_.default.createElement("span",{className:"sr-only"},_.default.createElement(M.FormattedMessage,{id:"navbar.toggle2",defaultMessage:"Toggle sidebar"})),_.default.createElement("span",{className:"icon icon__menu icon--sidebarHeaderTextColor",dangerouslySetInnerHTML:{__html:n},"aria-hidden":"true"}),_.default.createElement(fe.default,null))),a.push(_.default.createElement("button",{key:"navbar-toggle-menu",type:"button",className:"navbar-toggle navbar-right__icon menu-toggle pull-right","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:t.toggleRightSidebar},_.default.createElement("span",{dangerouslySetInnerHTML:{__html:Z.Constants.MENU_ICON}})))),a},t.getTeammateStatus=function(){if("D"===t.state.channel.type){var e=t.state.currentUser.id,a=t.state.users.find(function(t){return t.id!==e});if(a)return Y.default.getStatus(a.id)}return null},t.state=(0,i.default)({},t.getStateFromStores(),{showEditChannelPurposeModal:!1,showEditChannelHeaderModal:!1,showMembersModal:!1,showRenameChannelModal:!1,showQuickSwitchModal:!1,showChannelNotificationsModal:!1,quickSwitchMode:"channel"}),t}return(0,g.default)(a,t),(0,f.default)(a,[{key:"componentDidMount",value:function(){H.default.addChangeListener(this.onChange),H.default.addStatsChangeListener(this.onChange),Y.default.addStatusesChangeListener(this.onChange),Y.default.addChangeListener(this.onChange),V.default.addChangeListener(this.onChange),B.default.addModalListener(Z.ActionTypes.TOGGLE_QUICK_SWITCH_MODAL,this.toggleQuickSwitchModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_HEADER_UPDATE_MODAL,this.showEditChannelHeaderModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_PURPOSE_UPDATE_MODAL,this.showChannelPurposeModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_NAME_UPDATE_MODAL,this.showRenameChannelModal),J.default.addChangedListener(this.onChange),J.default.addBusyListener(this.onBusy),(0,E.default)(".inner-wrap").click(this.hideSidebars),document.addEventListener("keydown",this.handleQuickSwitchKeyPress)}},{key:"componentWillUnmount",value:function(){H.default.removeChangeListener(this.onChange),H.default.removeStatsChangeListener(this.onChange),Y.default.removeStatusesChangeListener(this.onChange),Y.default.removeChangeListener(this.onChange),V.default.removeChangeListener(this.onChange),B.default.removeModalListener(Z.ActionTypes.TOGGLE_QUICK_SWITCH_MODAL,this.toggleQuickSwitchModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_HEADER_UPDATE_MODAL,this.hideEditChannelHeaderModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_PURPOSE_UPDATE_MODAL,this.hideChannelPurposeModal),B.default.addModalListener(Z.ActionTypes.TOGGLE_CHANNEL_NAME_UPDATE_MODAL,this.hideRenameChannelModal),J.default.removeChangedListener(this.onChange),J.default.removeBusyListener(this.onBusy),document.removeEventListener("keydown",this.handleQuickSwitchKeyPress)}},{key:"isContactNotAvailable",value:function(){var e=Y.default.getStatus(this.state.contactId);return e===Z.UserStatuses.OFFLINE||e===Z.UserStatuses.DND||this.state.isBusy}},{key:"isWebrtcEnabled",value:function(){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,a=Z.Constants.PRE_RELEASE_FEATURES;return"true"===e.mm_config.EnableWebrtc&&t&&ee.isFeatureEnabled(a.WEBRTC_PREVIEW)}},{key:"generateWebrtcDropdown",value:function(){if(!this.isWebrtcEnabled())return null;var e="";return this.isContactNotAvailable()&&(e="disable-links"),_.default.createElement("li",{role:"presentation",className:"webrtc__option"},_.default.createElement("a",{role:"menuitem",href:"#",onClick:this.initWebrtc,className:e},_.default.createElement(M.FormattedMessage,{id:"navbar_dropdown.webrtc.call",defaultMessage:"Start Video Call"})))}},{key:"generateWebrtcIcon",value:function(){if(!this.isWebrtcEnabled())return null;var e="";return this.isContactNotAvailable()&&(e="offline"),_.default.createElement("div",{className:"pull-right description navbar-right__icon webrtc__button "+e},_.default.createElement("a",{onClick:this.initWebrtc},"WebRTC"))}},{key:"render",value:function(){var e=this;if(!this.isStateValid())return null;var t=this.state.currentUser.id,a=this.state.channel,n=this.props.teamDisplayName,s=q.default.isTeamAdminForCurrentTeam(),r=Y.default.isSystemAdminForCurrentUser(),i=!1,o=!1,l=!1,d=null,u=null,c=null,f=null,m=null,p=null;if(a){if(i=H.default.isChannelAdminForCurrentChannel(),n=a.display_name,a.type===Z.Constants.DM_CHANNEL){o=!0;var h=ee.getUserIdFromChannelName(a);n=ee.displayUsername(h)}else a.type===Z.Constants.GM_CHANNEL&&(l=!0);this.state.showEditChannelHeaderModal&&(d=_.default.createElement(k.default,{onHide:function(){return e.setState({showEditChannelHeaderModal:!1})},channel:a})),this.state.showEditChannelPurposeModal&&(u=_.default.createElement(N.default,{onModalDismissed:this.hideChannelPurposeModal,channel:a})),c=_.default.createElement(ge.default,{show:this.state.showRenameChannelModal,onHide:this.hideRenameChannelModal,channel:a}),this.state.showMembersModal&&(f=_.default.createElement(ie.default,{show:!0,onModalDismissed:this.hideMembersModal,showInviteModal:function(){return e.refs.channelInviteModalButton.show()},channel:a,isAdmin:s||r})),m=_.default.createElement(le.default,{show:this.state.showChannelNotificationsModal,onHide:this.hideChannelNotificationsModal,channel:a,channelMember:this.state.member,currentUser:this.state.currentUser}),p=_.default.createElement(pe.default,{show:this.state.showQuickSwitchModal,onHide:this.hideQuickSwitchModal,initialMode:this.state.quickSwitchMode})}var g=this.createCollapseButtons(t),v=Z.Constants.SEARCH_ICON_SVG,E=_.default.createElement("button",{type:"button",className:"navbar-toggle navbar-right__icon navbar-search pull-right",onClick:this.showSearch},_.default.createElement("span",{className:"icon icon__search",dangerouslySetInnerHTML:{__html:v},"aria-hidden":"true"})),b=this.createDropdown(a,n,r,s,i,o,l);return _.default.createElement("div",null,_.default.createElement("nav",{className:"navbar navbar-default navbar-fixed-top",role:"navigation"},_.default.createElement("div",{className:"container-fluid theme"},_.default.createElement("div",{className:"navbar-header"},g,E,_.default.createElement(ke.default,{ref:"headerOverlay",channel:a,showEditChannelHeaderModal:this.showEditChannelHeaderModal}),_.default.createElement(Ce.default,{pluggableName:"MobileChannelHeaderButton"}),b))),d,u,c,f,m,p)}}]),a}(_.default.Component);Te.propTypes={teamDisplayName:y.default.string,isPinnedPosts:y.default.bool,actions:y.default.shape({closeRightHandSide:y.default.func,updateRhsState:y.default.func})},Te.defaultProps={teamDisplayName:""},t.default=Te}).call(t,a(23))},2270:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(31),v=n(g),E=a(36),b=n(E),y=a(101),S=a(16),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(S),M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onListenerChange=a.onListenerChange.bind(a),a.state=(0,y.getCountsStateFromStores)(),a.mounted=!1,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,v.default.addChangeListener(this.onListenerChange),b.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,v.default.removeChangeListener(this.onListenerChange),b.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){if(this.mounted){var e=(0,y.getCountsStateFromStores)();_.areObjectsEqual(e,this.state)||this.setState(e)}}},{key:"render",value:function(){return this.state.mentionCount?h.default.createElement("span",{className:"badge badge-notify"},this.state.mentionCount):this.state.messageCount?h.default.createElement("span",{className:"badge badge-notify"},"•"):null}}]),t}(h.default.Component);t.default=M},2271:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,i.default)({},t,{showTeamSwitcher:!1})}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),i=n(r),o=a(26),l=a(2272),d=n(l);t.default=(0,o.connect)(s)(d.default)},2272:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(8),g=s(h),v=a(1),E=s(v),b=a(35),y=a(17),S=a(34),_=a(91),M=a(82),C=a(32),w=s(C),k=a(9),T=s(k),N=a(16),P=n(N),R=a(73),I=n(R),D=a(394),L=s(D),A=a(395),O=s(A),F=a(2273),x=s(F),U=a(2274),H=s(U),j=w.default.getState,B=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.setSwitchBoxRef=function(e){a.switchBox=e,a.focusTextbox()},a.onChange=a.onChange.bind(a),a.onShow=a.onShow.bind(a),a.onHide=a.onHide.bind(a),a.onExited=a.onExited.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.switchToChannel=a.switchToChannel.bind(a),a.switchMode=a.switchMode.bind(a),a.focusTextbox=a.focusTextbox.bind(a),a.enableChannelProvider=a.enableChannelProvider.bind(a),a.enableTeamProvider=a.enableTeamProvider.bind(a),a.channelProviders=[new x.default],a.teamProviders=[new H.default],a.switchBox=null,a.state={text:"",mode:e.initialMode},a}return(0,p.default)(t,e),(0,u.default)(t,[{key:"componentWillReceiveProps",value:function(e){!this.props.show&&e.show&&this.setState({mode:e.initialMode,text:""})}},{key:"focusTextbox",value:function(){if(null!=this.switchBox){var e=this.switchBox.getTextbox();document.activeElement!==e&&(e.focus(),P.placeCaretAtEnd(e))}}},{key:"onShow",value:function(){this.setState({text:""})}},{key:"onHide",value:function(){this.setState({text:""}),this.props.onHide()}},{key:"onExited",value:function(){I.isMobile()||setTimeout(function(){var e=document.querySelector("#post_textbox");e&&e.focus()})}},{key:"onChange",value:function(e){this.setState({text:e.target.value})}},{key:"handleKeyDown",value:function(e){e.keyCode===T.default.KeyCodes.TAB&&(e.preventDefault(),this.switchMode())}},{key:"handleSubmit",value:function(e){var t=this,a=null;if(e)if("channel"===this.state.mode){var n=e.channel;n.type===T.default.DM_CHANNEL?(0,M.openDirectChannelToUser)(n.id,function(e){a=e,t.switchToChannel(a)},function(){a=null,t.switchToChannel(a)}):n.type===T.default.GM_CHANNEL?(a=(0,_.getChannel)(j(),n.id),this.switchToChannel(a)):this.switchToChannel(n)}else S.browserHistory.push("/"+e.name),this.onHide()}},{key:"switchToChannel",value:function(e){null!=e&&((0,M.goToChannel)(e),this.onHide())}},{key:"enableChannelProvider",value:function(){this.channelProviders[0].disableDispatches=!1,this.teamProviders[0].disableDispatches=!0}},{key:"enableTeamProvider",value:function(){this.teamProviders[0].disableDispatches=!1,this.channelProviders[0].disableDispatches=!0}},{key:"switchMode",value:function(){"channel"===this.state.mode&&this.props.showTeamSwitcher?(this.enableTeamProvider(),this.setState({mode:"team"})):"team"===this.state.mode&&(this.enableChannelProvider(),this.setState({mode:"channel"}))}},{key:"render",value:function(){var e=this,t=this.channelProviders,a=void 0,n=!0,s="quick_switch_modal.channelsShortcut.windows",r="CTRL+K";P.isMac()&&(s="quick_switch_modal.channelsShortcut.mac",r="CMD+K");var i="quick_switch_modal.teamsShortcut.windows",o="CTRL+ALT+K";if(P.isMac()&&(i="quick_switch_modal.teamsShortcut.mac",o="CMD+ALT+K"),this.props.showTeamSwitcher){var l="",d="";"team"===this.state.mode?(t=this.teamProviders,n=!1,d="active"):l="active",a=E.default.createElement("div",{className:"nav nav-tabs"},E.default.createElement("li",{className:l},E.default.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.enableChannelProvider(),e.setState({mode:"channel"}),e.focusTextbox()}},E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.channels",defaultMessage:"Channels"}),E.default.createElement("span",{className:"small"},E.default.createElement(y.FormattedMessage,{id:s,defaultMessage:r})))),E.default.createElement("li",{className:d},E.default.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.enableTeamProvider(),e.setState({mode:"team"}),e.focusTextbox()}},E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.teams",defaultMessage:"Teams"}),E.default.createElement("span",{className:"small"},E.default.createElement(y.FormattedMessage,{id:i,defaultMessage:o})))))}var u=void 0;return u=P.isMobile()?E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help_mobile",defaultMessage:"Type to find a channel."}):this.props.showTeamSwitcher?E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help",defaultMessage:"Start typing then use TAB to toggle channels/teams, ↑↓ to browse, ↵ to select, and ESC to dismiss."}):E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help_no_team",defaultMessage:"Type to find a channel. Use ↑↓ to browse, ↵ to select, ESC to dismiss."}),E.default.createElement(b.Modal,{dialogClassName:"channel-switch-modal modal--overflow",ref:"modal",show:this.props.show,onHide:this.onHide,onExited:this.onExited},E.default.createElement(b.Modal.Header,{closeButton:!0}),E.default.createElement(b.Modal.Body,null,a,E.default.createElement("div",{className:"modal__hint"},u),E.default.createElement(L.default,{ref:this.setSwitchBoxRef,className:"form-control focused",type:"input",onChange:this.onChange,value:this.state.text,onKeyDown:this.handleKeyDown,onItemSelected:this.handleSubmit,listComponent:O.default,maxLength:"64",providers:t,listStyle:"bottom",completeOnTab:!1,renderDividers:n})))}}]),t}(E.default.PureComponent);B.propTypes={initialMode:g.default.string.isRequired,show:g.default.bool.isRequired,onHide:g.default.func.isRequired,showTeamSwitcher:g.default.bool},B.defaultProps={initialMode:"channel"},t.default=B},2273:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(e.type===U.Constants.MENTION_CHANNELS&&t.type===U.Constants.MENTION_MORE_CHANNELS)return-1;if(t.type===U.Constants.MENTION_CHANNELS&&e.type===U.Constants.MENTION_MORE_CHANNELS)return 1;if(e.deactivated&&!t.deactivated)return 1;if(t.deactivated&&!e.deactivated)return-1;var a=e.channel,n=t.channel,s=(0,x.getChannelDisplayName)(a).toLowerCase(),r=(0,x.getChannelDisplayName)(n).toLowerCase();a.type===U.Constants.DM_CHANNEL&&(s=s.substring(1)),n.type===U.Constants.DM_CHANNEL&&(r=r.substring(1));var i=s.startsWith(Y),o=r.startsWith(Y);return i&&o?(0,x.sortChannelsByDisplayName)(a,n):i||o?i?-1:1:(0,x.sortChannelsByDisplayName)(a,n)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(51),i=n(r),o=a(45),l=n(o),d=a(57),u=n(d),c=a(58),f=n(c),m=a(42),p=n(m),h=a(5),g=n(h),v=a(3),E=n(v),b=a(4),y=n(b),S=a(6),_=n(S),M=a(7),C=n(M),w=a(1),k=n(w),T=a(28),N=a(25),P=a(91),R=a(62),I=a(81),D=a(46),L=a(39),A=n(L),O=a(32),F=n(O),x=a(101),U=a(9),H=a(16),j=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(H),B=a(222),G=n(B),V=a(167),z=n(V),q=F.default.getState,W=function(e){function t(){return(0,E.default)(this,t),(0,_.default)(this,(t.__proto__||(0,g.default)(t)).apply(this,arguments))}return(0,C.default)(t,e),(0,y.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isSelection,n=t.channel,s=U.Constants.GLOBE_ICON_SVG,r=U.Constants.LOCK_ICON_SVG,i="mentions__name";a&&(i+=" suggestion--selected");var o=n.display_name,l=null;return n.type===U.Constants.OPEN_CHANNEL?l=k.default.createElement("span",{className:"icon icon__globe icon--body",dangerouslySetInnerHTML:{__html:s}}):n.type===U.Constants.PRIVATE_CHANNEL?l=k.default.createElement("span",{className:"icon icon__lock icon--body",dangerouslySetInnerHTML:{__html:r}}):n.type===U.Constants.GM_CHANNEL?(o=(0,x.getChannelDisplayName)(n),l=k.default.createElement("div",{className:"status status--group"},"G")):l=k.default.createElement("div",{className:"pull-left"},k.default.createElement("img",{className:"mention__image",src:j.imageURLForUser(n)})),k.default.createElement("div",{onClick:this.handleClick,className:i},l,o)}}]),t}(z.default),Y="",K=function(t){function a(){return(0,E.default)(this,a),(0,_.default)(this,(a.__proto__||(0,g.default)(a)).apply(this,arguments))}return(0,C.default)(a,t),(0,y.default)(a,[{key:"handlePretextChanged",value:function(e,t){if(t){Y=t,this.startNewRequest(e,t);var a=(0,P.getChannelsInCurrentTeam)(q()).concat((0,P.getGroupChannels)(q())),n=(0,p.default)([],(0,D.searchProfiles)(q(),t,!0));return this.formatChannelsAndDispatch(t,e,a,n,!0),this.fetchUsersAndChannels(t,e),!0}return!1}},{key:"fetchUsersAndChannels",value:function(){function t(e,t){return a.apply(this,arguments)}var a=(0,f.default)(u.default.mark(function t(a,n){var s,r,i,o,l,d,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=(0,I.getCurrentTeamId)(q())){t.next=3;break}return t.abrupt("return");case 3:return r=void 0,r="team"===e.window.mm_config.RestrictDirectMessage?T.Client4.autocompleteUsers(a,s,""):T.Client4.autocompleteUsers(a,"",""),i=T.Client4.searchChannels(s,a),o=[],l=[],t.prev=8,t.next=11,r;case 11:return o=t.sent,t.next=14,i;case 14:l=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(8),A.default.handleServerAction({type:U.ActionTypes.RECEIVED_ERROR,err:t.t0});case 20:if(!this.shouldCancelDispatch(a)){t.next=22;break}return t.abrupt("return");case 22:d=(0,p.default)([],(0,D.searchProfiles)(q(),a,!0)).concat(o.users),c=(0,P.getChannelsInCurrentTeam)(q()).concat((0,P.getGroupChannels)(q())).concat(l),this.formatChannelsAndDispatch(a,n,c,d);case 25:case"end":return t.stop()}},t,this,[[8,17]])}));return t}()},{key:"formatChannelsAndDispatch",value:function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[],d=(0,P.getMyChannelMemberships)(q());if(!this.shouldCancelDispatch(e)){var u=(0,D.getCurrentUserId)(q()),c={},f=!0,m=!1,h=void 0;try{for(var g,v=(0,l.default)((0,i.default)(a));!(f=(g=v.next()).done);f=!0){var E=g.value,b=a[E];if(!c[b.id]){var y=d[b.id];if(-1!==b.display_name.toLowerCase().indexOf(e.toLowerCase())){var S=(0,p.default)({},b),_={channel:S,name:S.name,deactivated:!1};if(S.type===U.Constants.GM_CHANNEL){S.name=(0,x.getChannelDisplayName)(S),_.name=S.name;if((0,R.getBool)(q(),N.Preferences.CATEGORY_GROUP_CHANNEL_SHOW,S.id,!1))_.type=U.Constants.MENTION_CHANNELS;else if(_.type=U.Constants.MENTION_MORE_CHANNELS,r)continue}else if(y)_.type=U.Constants.MENTION_CHANNELS;else if(_.type=U.Constants.MENTION_MORE_CHANNELS,r||!S.display_name.toLowerCase().startsWith(e))continue;c[b.id]=!0,o.push(_)}}}}catch(e){m=!0,h=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw h}}for(var M=0;M<n.length;M++){var C=n[M];if(!c[C.id]){var w=(0,R.getBool)(q(),N.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW,C.id,!1),k="@"+C.username;if(C.id!==u){(C.first_name||C.last_name)&&C.nickname?k+=" - "+j.getFullName(C)+" ("+C.nickname+")":C.nickname?k+=" - ("+C.nickname+")":(C.first_name||C.last_name)&&(k+=" - "+j.getFullName(C)),C.delete_at&&(k+=" - "+j.localizeMessage("channel_switch_modal.deactivated","Deactivated"));var T={channel:{display_name:k,name:C.username,id:C.id,update_at:C.update_at,type:U.Constants.DM_CHANNEL,last_picture_update:C.last_picture_update||0},name:C.username,deactivated:C.delete_at};if(w)T.type=U.Constants.MENTION_CHANNELS;else if(T.type=U.Constants.MENTION_MORE_CHANNELS,r)continue;c[C.id]=!0,o.push(T)}}}var I=o.sort(s).map(function(e){return e.channel.name});r&&o.push({type:U.Constants.MENTION_MORE_CHANNELS,loading:!0}),setTimeout(function(){A.default.handleServerAction({type:U.ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS,id:t,matchedPretext:e,terms:I,items:o,component:W})},0)}}}]),a}(G.default);t.default=K}).call(t,a(23))},2274:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=e.display_name.toLowerCase(),n=t.display_name.toLowerCase(),s=a.startsWith(D),r=n.startsWith(D);if(s&&r){var i=_.default.getLocale();return a!==n?a.localeCompare(n,i,{numeric:!0}):e.name.localeCompare(t.name,i,{numeric:!0})}return s?-1:1}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=n(r),o=a(3),l=n(o),d=a(4),u=n(d),c=a(6),f=n(c),m=a(7),p=n(m),h=a(1),g=n(h),v=a(81),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(39),y=n(b),S=a(195),_=n(S),M=a(32),C=n(M),w=a(9),k=a(222),T=n(k),N=a(167),P=n(N),R=C.default.getState,I=function(e){function t(){return(0,l.default)(this,t),(0,f.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,p.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isSelection,n="mentions__name";return a&&(n+=" suggestion--selected"),g.default.createElement("div",{onClick:this.handleClick,className:n},g.default.createElement("div",{className:"status"},g.default.createElement("i",{className:"fa fa-group"})),t.display_name)}}]),t}(P.default),D="",L=function(e){function t(){return(0,l.default)(this,t),(0,f.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,p.default)(t,e),(0,u.default)(t,[{key:"handlePretextChanged",value:function(e,t){if(t){D=t,this.startNewRequest(e,t);var a=E.getMyTeams(R()),n=a.filter(function(e){return-1!==e.display_name.toLowerCase().indexOf(t)||-1!==e.name.indexOf(t)}),r=n.sort(s).map(function(e){return e.name});return setTimeout(function(){y.default.handleServerAction({type:w.ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS,id:e,matchedPretext:t,terms:r,items:n,component:I})},0),!0}return!1}}]),t}(T.default);t.default=L},2275:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(35),b=a(17),y=a(9),S=n(y),_=a(699),M=n(_),C=function(e){function t(){var e,a,n,s;(0,o.default)(this,t);for(var i=arguments.length,l=Array(i),d=0;d<i;d++)l[d]=arguments[d];return a=n=(0,c.default)(this,(e=t.__proto__||(0,r.default)(t)).call.apply(e,[this].concat(l))),n.showEditChannelHeaderModal=function(){n.refs.headerOverlay.hide(),n.props.showEditChannelHeaderModal()},n.hide=function(){n.refs.headerOverlay.hide()},s=a,(0,c.default)(n,s)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=null;if(this.props.channel)if(this.props.channel.header)e=v.default.createElement(M.default,{message:this.props.channel.header,options:{singleline:!0,mentionHighlight:!1}});else{var t=v.default.createElement("a",{href:"#",onClick:this.showEditChannelHeaderModal},v.default.createElement(b.FormattedMessage,{id:"navbar.click",defaultMessage:"Click here"}));e=v.default.createElement("div",null,v.default.createElement(b.FormattedMessage,{id:"navbar.noHeader",defaultMessage:"No channel header yet.{newline}{link} to add one.",values:{newline:v.default.createElement("br",null),link:t}}))}var a=v.default.createElement(E.Popover,{bsStyle:"info",placement:"bottom",id:"header-popover"},e,v.default.createElement("div",{className:"close visible-xs-block",onClick:this.hide},"×"));return v.default.createElement(E.OverlayTrigger,{ref:"headerOverlay",trigger:"click",placement:"bottom",overlay:a,className:"description",rootClose:!0},v.default.createElement("div",{className:"navbar-toggle navbar-right__icon navbar-info-button pull-right"},v.default.createElement("span",{className:"icon icon__info",dangerouslySetInnerHTML:{__html:S.default.INFO_ICON_SVG},"aria-hidden":"true"})))}}]),t}(v.default.PureComponent);C.propTypes={channel:h.default.object,showEditChannelHeaderModal:h.default.func.isRequired},t.default=C},2276:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(1),v=n(g),E=a(41),b=n(E),y=a(17),S=a(34),_=a(126),M=n(_),C=a(31),w=n(C),k=a(36),T=n(k),N=a(27),P=n(N),R=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.handleShow=a.handleShow.bind(a),a.handleClose=a.handleClose.bind(a),a.state={channelName:"",remover:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleShow",value:function(){var e={};M.default.getItem("channel-removed-state")&&(e=M.default.getItem("channel-removed-state"),M.default.removeItem("channel-removed-state"));var t=w.default.getByName("town-square");setTimeout(function(){S.browserHistory.push(T.default.getCurrentTeamRelativeUrl()+"/channels/"+t.name)},1),this.setState(e)}},{key:"handleClose",value:function(){this.setState({channelName:"",remover:""})}},{key:"componentDidMount",value:function(){(0,h.default)(b.default.findDOMNode(this)).on("show.bs.modal",this.handleShow),(0,h.default)(b.default.findDOMNode(this)).on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,h.default)(b.default.findDOMNode(this)).off("show.bs.modal",this.handleShow),(0,h.default)(b.default.findDOMNode(this)).off("hidden.bs.modal",this.handleClose)}},{key:"render",value:function(){var e=P.default.getCurrentUser(),t=v.default.createElement(y.FormattedMessage,{id:"removed_channel.channelName",defaultMessage:"the channel"});this.state.channelName&&(t=this.state.channelName);var a=v.default.createElement(y.FormattedMessage,{id:"removed_channel.someone",defaultMessage:"Someone"});return this.state.remover&&(a=this.state.remover),null!=e?v.default.createElement("div",{className:"modal fade",ref:"modal",id:"removed_from_channel",tabIndex:"-1",role:"dialog","aria-hidden":"true"},v.default.createElement("div",{className:"modal-dialog"},v.default.createElement("div",{className:"modal-content"},v.default.createElement("div",{className:"modal-header"},v.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},v.default.createElement("span",{"aria-hidden":"true"},"×")),v.default.createElement("h4",{className:"modal-title"},v.default.createElement(y.FormattedMessage,{id:"removed_channel.from",defaultMessage:"Removed from "}),v.default.createElement("span",{className:"name"},t))),v.default.createElement("div",{className:"modal-body"},v.default.createElement("p",null,v.default.createElement(y.FormattedMessage,{id:"removed_channel.remover",defaultMessage:"{remover} removed you from {channel}",values:{remover:a,channel:t}}))),v.default.createElement("div",{className:"modal-footer"},v.default.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal"},v.default.createElement(y.FormattedMessage,{id:"removed_channel.okay",defaultMessage:"Okay"})))))):v.default.createElement("div",null)}}]),t}(v.default.Component);t.default=R},2277:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=e.entities.users.currentUserId;return(0,o.default)({},t,{autoResetPref:(0,m.get)(e,f.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,a,"")})}function r(e){return{actions:(0,d.bindActionCreators)({autoResetStatus:p.autoResetStatus,setStatus:c.setStatus,savePreferences:u.savePreferences},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(194),c=a(61),f=a(25),m=a(62),p=a(66),h=a(2278),g=n(h);t.default=(0,l.connect)(s,r)(g.default)},2278:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),r=n(s),i=a(5),o=n(i),l=a(3),d=n(l),u=a(4),c=n(u),f=a(6),m=n(f),p=a(7),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(17),S=a(25),_=a(16),M=a(283),C=n(M),w=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.onConfirm=function(e){a.setState({show:!1});var t=(0,r.default)({},a.state.currentUserStatus);if(t.status="online",a.props.actions.setStatus(t),e){var n={category:S.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,user_id:t.user_id,name:t.user_id,value:"true"};a.props.actions.savePreferences(n.user_id,[n])}},a.onCancel=function(e){if(a.setState({show:!1}),e){var t=(0,r.default)({},a.state.currentUserStatus),n={category:S.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,user_id:t.user_id,name:t.user_id,value:"false"};a.props.actions.savePreferences(n.user_id,[n])}},a.state={show:!1,currentUserStatus:{}},a}return(0,h.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.actions.autoResetStatus().then(function(t){var a=t.manual,n=""===e.props.autoResetPref;e.setState({currentUserStatus:t,show:Boolean(a&&n)})})}},{key:"render",value:function(){var e=this.state.currentUserStatus.status||"",t="modal.manaul_status.title_"+e,a=b.default.createElement(y.FormattedMessage,{id:t,defaultMessage:'Your status is set to "{status}"',values:{status:(0,_.toTitleCase)(e)}}),n=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.message",defaultMessage:'Would you like to switch your status to "Online"?'}),s=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.button",defaultMessage:'Yes, set my status to "Online"'}),r="modal.manual_status.cancel_"+e,i=b.default.createElement(y.FormattedMessage,{id:r,defaultMessage:'No, keep it as "{status}"',values:{status:(0,_.toTitleCase)(e)}}),o=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.ask",defaultMessage:"Do not ask me again"});return b.default.createElement(C.default,{show:this.state.show,title:a,message:n,confirmButtonText:s,onConfirm:this.onConfirm,cancelButtonText:i,onCancel:this.onCancel,showCheckbox:!0,checkboxText:o})}}]),t}(b.default.PureComponent);w.propTypes={autoResetPref:v.default.string,actions:v.default.shape({autoResetStatus:v.default.func.isRequired,setStatus:v.default.func.isRequired,savePreferences:v.default.func.isRequired}).isRequired},t.default=w},2279:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){if(!e)return null;var t=e.split("\t"),a=y.default.createElement("span",null,t[0]),n=null;return t.length>1&&(n=t[1].split("|").map(function(e){return y.default.createElement("span",{className:"shortcut-key",key:e},e)})),y.default.createElement("div",{className:"shortcut-line"},a,n)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(51),i=n(r),o=a(5),l=n(o),d=a(3),u=n(d),c=a(4),f=n(c),m=a(6),p=n(m),h=a(7),g=n(h),v=a(8),E=n(v),b=a(1),y=n(b),S=a(35),_=a(17),M=a(1948),C=n(M),w=a(9),k=n(w),T=(0,_.defineMessages)({mainHeader:{default:{id:"shortcuts.header",defaultMessage:"Keyboard Shortcuts\tCtrl|/"},mac:{id:"shortcuts.header.mac",defaultMessage:"Keyboard Shortcuts\t⌘|/"}},navHeader:{id:"shortcuts.nav.header",defaultMessage:"Navigation"},navPrev:{default:{id:"shortcuts.nav.prev",defaultMessage:"Previous channel:\tAlt|Up"},mac:{id:"shortcuts.nav.prev.mac",defaultMessage:"Previous channel:\t⌥|Up"}},navNext:{default:{id:"shortcuts.nav.next",defaultMessage:"Next channel:\tAlt|Down"},mac:{id:"shortcuts.nav.next.mac",defaultMessage:"Next channel:\t⌥|Down"}},navUnreadPrev:{default:{id:"shortcuts.nav.unread_prev",defaultMessage:"Previous unread channel:\tAlt|Shift|Up"},mac:{id:"shortcuts.nav.unread_prev.mac",defaultMessage:"Previous unread channel:\t⌥|Shift|Up"}},navUnreadNext:{default:{id:"shortcuts.nav.unread_next",defaultMessage:"Next unread channel:\tAlt|Shift|Down"},mac:{id:"shortcuts.nav.unread_next.mac",defaultMessage:"Next unread channel:\t⌥|Shift|Down"}},navSwitcher:{default:{id:"shortcuts.nav.switcher",defaultMessage:"Quick channel switcher:\tCtrl|K"},mac:{id:"shortcuts.nav.switcher.mac",defaultMessage:"Quick channel switcher:\t⌘|K"}},navDMMenu:{default:{id:"shortcuts.nav.direct_messages_menu",defaultMessage:"Direct messages menu:\tCtrl|Shift|K"},mac:{id:"shortcuts.nav.direct_messages_menu.mac",defaultMessage:"Direct messages menu:\t⌘|Shift|K"}},navSettings:{default:{id:"shortcuts.nav.settings",defaultMessage:"Account settings:\tCtrl|Shift|A"},mac:{id:"shortcuts.nav.settings.mac",defaultMessage:"Account settings:\t⌘|Shift|A"}},navMentions:{default:{id:"shortcuts.nav.recent_mentions",defaultMessage:"Recent mentions:\tCtrl|Shift|M"},mac:{id:"shortcuts.nav.recent_mentions.mac",defaultMessage:"Recent mentions:\t⌘|Shift|M"}},navFocusCenter:{default:{id:"shortcuts.nav.focus_center",defaultMessage:"Set focus to input field:\tCtrl|Shift|L"},mac:{id:"shortcuts.nav.focus_center.mac",defaultMessage:"Set focus to input field:\t⌘|Shift|L"}},msgHeader:{id:"shortcuts.msgs.header",defaultMessage:"Messages"},msgInputHeader:{id:"shortcuts.msgs.input.header",defaultMessage:"Works inside an empty input field"},msgEdit:{id:"shortcuts.msgs.edit",defaultMessage:"Edit last message in channel:\tUp"},msgReply:{id:"shortcuts.msgs.reply",defaultMessage:"Reply to last message in channel:\tShift|Up"},msgReprintPrev:{default:{id:"shortcuts.msgs.reprint_prev",defaultMessage:"Reprint previous message:\tCtrl|Up"},mac:{id:"shortcuts.msgs.reprint_prev.mac",defaultMessage:"Reprint previous message:\t⌘|Up"}},msgReprintNext:{default:{id:"shortcuts.msgs.reprint_next",defaultMessage:"Reprint next message:\tCtrl|Down"},mac:{id:"shortcuts.msgs.reprint_next.mac",defaultMessage:"Reprint next message:\t⌘|Down"}},msgCompHeader:{id:"shortcuts.msgs.comp.header",defaultMessage:"Autocomplete"},msgCompUsername:{id:"shortcuts.msgs.comp.username",defaultMessage:"Username:\t@|[a-z]|Tab"},msgCompChannel:{id:"shortcuts.msgs.comp.channel",defaultMessage:"Channel:\t~|[a-z]|Tab"},msgCompEmoji:{id:"shortcuts.msgs.comp.emoji",defaultMessage:"Emoji:\t:|[a-z]|Tab"},filesHeader:{id:"shortcuts.files.header",defaultMessage:"Files"},filesUpload:{default:{id:"shortcuts.files.upload",defaultMessage:"Upload files:\tCtrl|U"},mac:{id:"shortcuts.files.upload.mac",defaultMessage:"Upload files:\t⌘|U"}},browserHeader:{id:"shortcuts.browser.header",defaultMessage:"Built-in Browser Commands"},browserChannelPrev:{default:{id:"shortcuts.browser.channel_prev",defaultMessage:"Back in history:\tAlt|Left"},mac:{id:"shortcuts.browser.channel_prev.mac",defaultMessage:"Back in history:\t⌘|["}},browserChannelNext:{default:{id:"shortcuts.browser.channel_next",defaultMessage:"Forward in history:\tAlt|Right"},mac:{id:"shortcuts.browser.channel_next.mac",defaultMessage:"Forward in history:\t⌘|]"}},browserFontIncrease:{default:{id:"shortcuts.browser.font_increase",defaultMessage:"Zoom in:\tCtrl|+"},mac:{id:"shortcuts.browser.font_increase.mac",defaultMessage:"Zoom in:\t⌘|+"}},browserFontDecrease:{default:{id:"shortcuts.browser.font_decrease",defaultMessage:"Zoom out:\tCtrl|-"},mac:{id:"shortcuts.browser.font_decrease.mac",defaultMessage:"Zoom out:\t⌘|-"}},browserInputHeader:{id:"shortcuts.browser.input.header",defaultMessage:"Works inside an input field"},browserHighlightPrev:{id:"shortcuts.browser.highlight_prev",defaultMessage:"Highlight text to the previous line:\tShift|Up"},browserHighlightNext:{id:"shortcuts.browser.highlight_next",defaultMessage:"Highlight text to the next line:\tShift|Down"},browserNewline:{id:"shortcuts.browser.newline",defaultMessage:"Create a new line:\tShift|Enter"},info:{id:"shortcuts.info",defaultMessage:"Begin a message with / for a list of all the commands at your disposal."}}),N=function(e){function t(e){(0,u.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return a.handleToggle=function(){a.setState({show:!a.state.show})},a.handleHide=function(){a.setState({show:!1})},a.state={show:!1},a}return(0,g.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){C.default.addModalListener(k.default.ActionTypes.TOGGLE_SHORTCUTS_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){C.default.removeModalListener(k.default.ActionTypes.TOGGLE_SHORTCUTS_MODAL,this.handleToggle)}},{key:"getShortcuts",value:function(){var e=this.props.isMac,t={};return(0,i.default)(T).forEach(function(a){e&&T[a].mac?t[a]=T[a].mac:!e&&T[a].default?t[a]=T[a].default:t[a]=T[a]}),t}},{key:"render",value:function(){var e=this.getShortcuts(),t=this.props.intl.formatMessage;return y.default.createElement(S.Modal,{dialogClassName:"shortcuts-modal",show:this.state.show,onHide:this.handleHide,onExited:this.handleHide},y.default.createElement("div",{className:"shortcuts-content"},y.default.createElement(S.Modal.Header,{closeButton:!0},y.default.createElement(S.Modal.Title,null,y.default.createElement("strong",null,s(t(e.mainHeader))))),y.default.createElement(S.Modal.Body,{ref:"modalBody"},y.default.createElement("div",{className:"row"},y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.navHeader))),s(t(e.navPrev)),s(t(e.navNext)),s(t(e.navUnreadPrev)),s(t(e.navUnreadNext)),s(t(e.navSwitcher)),s(t(e.navDMMenu)),s(t(e.navSettings)),s(t(e.navMentions)),s(t(e.navFocusCenter))))),y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.msgHeader))),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.msgInputHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.msgEdit)),s(t(e.msgReply)),s(t(e.msgReprintPrev)),s(t(e.msgReprintNext))),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.msgCompHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.msgCompUsername)),s(t(e.msgCompChannel)),s(t(e.msgCompEmoji)))))),y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.filesHeader))),s(t(e.filesUpload))),y.default.createElement("div",{className:"section--lower"},y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.browserHeader))),s(t(e.browserChannelPrev)),s(t(e.browserChannelNext)),s(t(e.browserFontIncrease)),s(t(e.browserFontDecrease)),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.browserInputHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.browserHighlightPrev)),s(t(e.browserHighlightNext)),s(t(e.browserNewline))))))),y.default.createElement("div",{className:"info__label"},t(e.info)))))}}]),t}(y.default.PureComponent);N.propTypes={intl:_.intlShape.isRequired,isMac:E.default.bool.isRequired},t.default=(0,_.injectIntl)(N)},2280:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=(0,p.getRhsState)(e),a=(0,p.getSelectedChannelId)(e),n=null;if(a&&null==(n=(0,d.getChannel)(e,a))){var s=f.default.getFocusedPostId(),r=(0,u.getPost)(e,s);null!=r&&(n=(0,d.getChannel)(e,r.channel_id))}return{channel:n,currentUser:(0,l.getCurrentUser)(e),postRightVisible:Boolean((0,p.getSelectedPostId)(e)),searchVisible:Boolean(t),previousRhsState:(0,p.getPreviousRhsState)(e),isMentionSearch:t===h.RHSStates.MENTION,isFlaggedPosts:t===h.RHSStates.FLAG,isPinnedPosts:t===h.RHSStates.PIN}}function r(e){return{actions:(0,o.bindActionCreators)({getPinnedPosts:m.getPinnedPosts,getFlaggedPosts:m.getFlaggedPosts},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(26),o=a(21),l=a(46),d=a(91),u=a(92),c=a(287),f=n(c),m=a(219),p=a(218),h=a(9),g=a(2281),v=n(g);t.default=(0,i.connect)(s,r)(v.default)},2281:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(215),S=a(56),_=a(287),M=n(_),C=a(113),w=n(C),k=a(388),T=n(k),N=a(9),P=n(N),R=a(16),I=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(R),D=a(1963),L=n(D),A=a(2282),O=n(A),F=a(669),x=n(F),U=a(2310),H=n(U),j=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.doStrangeThings=function(){return(0,h.default)(".app__body .inner-wrap").removeClass(".move--right"),(0,h.default)(".app__body .inner-wrap").addClass("move--left"),(0,h.default)(".app__body .sidebar--left").removeClass("move--right"),(0,h.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,h.default)(".app__body .sidebar--right").addClass("move--left"),a.props.searchVisible||a.props.postRightVisible?null:((0,h.default)(".app__body .inner-wrap").removeClass("move--left").removeClass("move--right"),(0,h.default)(".app__body .sidebar--right").removeClass("move--left"),b.default.createElement("div",null))},a.onPreferenceChange=function(){a.props.isFlaggedPosts&&a.props.actions.getFlaggedPosts(),a.setState({useMilitaryTime:w.default.getBool(P.default.Preferences.CATEGORY_DISPLAY_SETTINGS,P.default.Preferences.USE_MILITARY_TIME,!1)})},a.onPostPinnedChange=function(){a.props.channel&&a.props.isPinnedPosts&&a.props.actions.getPinnedPosts(a.props.channel.id)},a.onShrink=function(){a.setState({expanded:!1})},a.toggleSize=function(){a.setState({expanded:!a.state.expanded})},a.plScrolledToBottom=!0,a.state={expanded:!1,useMilitaryTime:w.default.getBool(P.default.Preferences.CATEGORY_DISPLAY_SETTINGS,P.default.Preferences.USE_MILITARY_TIME,!1)},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){M.default.addPostPinnedChangeListener(this.onPostPinnedChange),w.default.addChangeListener(this.onPreferenceChange),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){M.default.removePostPinnedChangeListener(this.onPostPinnedChange),w.default.removeChangeListener(this.onPreferenceChange)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.searchVisible||this.props.postRightVisible,a=e.searchVisible||e.postRightVisible;!t&&a&&(0,y.trackEvent)("ui","ui_rhs_opened"),!t&&a&&this.setState({expanded:!1})}},{key:"componentDidUpdate",value:function(e){var t=this.props.searchVisible||this.props.postRightVisible;T.default.emitRhsChanged(t),this.doStrangeThings();var a=e.searchVisible||e.postRightVisible;t&&!a&&setTimeout(function(){return(0,S.postListScrollChange)()},0)}},{key:"render",value:function(){var e=null,t="";this.state.expanded&&(t="sidebar--right--expanded");var a=this.props.currentUser.id,n=null;a&&(n=b.default.createElement(x.default,{isFocus:this.props.searchVisible&&I.isMobile()}));var s=this.props.channel,r="";return s&&(r=s.type===P.default.DM_CHANNEL||s.type===P.default.GM_CHANNEL?I.localizeMessage("rhs_root.direct","Direct Message"):s.display_name),this.props.searchVisible?e=b.default.createElement("div",{className:"sidebar--right__content"},b.default.createElement("div",{className:"search-bar__container channel-header alt"},n),b.default.createElement(H.default,{isMentionSearch:this.props.isMentionSearch,isFlaggedPosts:this.props.isFlaggedPosts,isPinnedPosts:this.props.isPinnedPosts,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink,channelDisplayName:r})):this.props.postRightVisible&&(e=b.default.createElement("div",{className:"post-right__container"},b.default.createElement(L.default,{overlayType:"right"}),b.default.createElement("div",{className:"search-bar__container channel-header alt"},n),b.default.createElement(O.default,{previousRhsState:this.props.previousRhsState,isWebrtc:T.default.isBusy(),currentUser:this.props.currentUser,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink}))),e||(t=""),b.default.createElement("div",{className:"sidebar--right "+t,id:"sidebar-right"},b.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),b.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(b.default.Component);j.propTypes={currentUser:v.default.object,channel:v.default.object,postRightVisible:v.default.bool,searchVisible:v.default.bool,isMentionSearch:v.default.bool,isFlaggedPosts:v.default.bool,isPinnedPosts:v.default.bool,previousRhsState:v.default.string,actions:v.default.shape({getPinnedPosts:v.default.func,getFlaggedPosts:v.default.func})},t.default=j},2282:function(e,t,a){"use strict";function n(){var e=(0,l.makeGetPostsForThread)(),t=(0,f.makeGetPostsEmbedVisibleObj)();return function(a){var n=(0,f.getSelectedPost)(a),s=null,r=[];return n&&(r=e(a,{rootId:n.id}),s=(0,o.getChannel)(a,n.channel_id)),{selected:n,channel:s,posts:r,previewCollapsed:(0,d.get)(a,c.Preferences.CATEGORY_DISPLAY_SETTINGS,c.Preferences.COLLAPSE_DISPLAY,c.Preferences.COLLAPSE_DISPLAY_DEFAULT),postsEmbedVisibleObj:t(a,r),previewEnabled:(0,d.getBool)(a,c.Preferences.CATEGORY_DISPLAY_SETTINGS,c.Preferences.LINK_PREVIEW_DISPLAY,c.Preferences.LINK_PREVIEW_DISPLAY_DEFAULT)}}}function s(e){return{actions:(0,i.bindActionCreators)({removePost:u.removePost},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(26),i=a(21),o=a(91),l=a(92),d=a(62),u=a(74),c=a(9),f=a(218),m=a(2283),p=function(e){return e&&e.__esModule?e:{default:e}}(m);t.default=(0,r.connect)(n,s)(p.default)},2283:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return P.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--view"}))}function r(e){return P.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--horizontal"}))}function i(e){return P.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--vertical"}))}Object.defineProperty(t,"__esModule",{value:!0});var o=a(42),l=n(o),d=a(164),u=n(d),c=a(5),f=n(c),m=a(3),p=n(m),h=a(4),g=n(h),v=a(6),E=n(v),b=a(7),y=n(b),S=a(19),_=n(S);t.renderView=s,t.renderThumbHorizontal=r,t.renderThumbVertical=i;var M=a(0),C=n(M),w=a(17),k=a(8),T=n(k),N=a(1),P=n(N),R=a(2064),I=n(R),D=a(113),L=n(D),A=a(27),O=n(A),F=a(388),x=n(F),U=a(9),H=n(U),j=a(227),B=n(j),G=a(16),V=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(G),z=a(2302),q=n(z),W=a(2305),Y=n(W),K=a(704),J=n(K),X=a(2306),Q=n(X),Z=a(2307),$=n(Z),ee=a(2309),te=n(ee),ae=H.default.Preferences,ne=function(e){function t(e){(0,p.default)(this,t);var a=(0,E.default)(this,(t.__proto__||(0,f.default)(t)).call(this,e));se.call(a),a.scrollStopAction=new B.default(a.handleScrollStop);var n=(new Date).getTime();return a.state={windowWidth:V.windowWidth(),windowHeight:V.windowHeight(),profiles:JSON.parse((0,u.default)(O.default.getProfiles())),compactDisplay:L.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.MESSAGE_DISPLAY,ae.MESSAGE_DISPLAY_DEFAULT)===ae.MESSAGE_DISPLAY_COMPACT,flaggedPosts:L.default.getCategory(H.default.Preferences.CATEGORY_FLAGGED_POST),statuses:(0,l.default)({},O.default.getStatuses()),previewsCollapsed:L.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.COLLAPSE_DISPLAY,"false"),isBusy:x.default.isBusy(),isScrolling:!1,topRhsPostCreateAt:0,openTime:n},a}return(0,y.default)(t,e),(0,g.default)(t,[{key:"componentDidMount",value:function(){L.default.addChangeListener(this.onPreferenceChange),O.default.addChangeListener(this.onUserChange),O.default.addStatusesChangeListener(this.onStatusChange),x.default.addBusyListener(this.onBusy),this.scrollToBottom(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){L.default.removeChangeListener(this.onPreferenceChange),O.default.removeChangeListener(this.onUserChange),O.default.removeStatusesChangeListener(this.onStatusChange),x.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize)}},{key:"componentWillReceiveProps",value:function(e){this.props.selected&&e.selected&&this.props.selected.id!==e.selected.id&&this.setState({openTime:(new Date).getTime()})}},{key:"componentDidUpdate",value:function(e){var t=e.posts||[],a=this.props.posts||[];if(!(t.length>=a.length)){a[a.length-1].user_id===O.default.getCurrentId()&&this.scrollToBottom()}}},{key:"shouldComponentUpdate",value:function(e,t){return!V.areObjectsEqual(t.statuses,this.state.statuses)||(!V.areObjectsEqual(t.postsArray,this.props.posts)||(!V.areObjectsEqual(t.selected,this.props.selected)||(t.compactDisplay!==this.state.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.previewEnabled!==this.props.previewEnabled||(!V.areObjectsEqual(t.flaggedPosts,this.state.flaggedPosts)||(!V.areObjectsEqual(t.profiles,this.state.profiles)||(!V.areObjectsEqual(e.currentUser,this.props.currentUser)||(t.isBusy!==this.state.isBusy||(t.isScrolling!==this.state.isScrolling||(t.topRhsPostCreateAt!==this.state.topRhsPostCreateAt||e.postsEmbedVisibleObj!==this.props.postsEmbedVisibleObj)))))))))))}},{key:"render",value:function(){if(null==this.props.posts||null==this.props.selected)return P.default.createElement("div",null);var e=this.filterPosts(this.props.posts,this.props.selected,this.state.openTime),t=this.props.selected,a=this.state.profiles||{},n=void 0;n=O.default.getCurrentId()===t.user_id?this.props.currentUser:a[t.user_id];var o=!1;this.state.flaggedPosts&&(o=null!=this.state.flaggedPosts.get(t.id));var l="offline";this.state.statuses&&(l=this.state.statuses[t.user_id]||"offline");var d=t.create_at;d||(d=this.props.posts[0].create_at);for(var u=V.getDateForUnixTicks(d),c=u,f=[],m=e.length,p=0;p<m;p++){var h=e[p],g=void 0;g=O.default.getCurrentId()===h.user_id?O.default.getCurrentUser():a[h.user_id];var v=!1;this.state.flaggedPosts&&(v=null!=this.state.flaggedPosts.get(h.id));var E="offline";this.state.statuses&&g&&g.id&&(E=this.state.statuses[g.id]||"offline");var b=V.getDateForUnixTicks(h.create_at);b.toDateString()!==c.toDateString()&&(c=b,f.push(P.default.createElement(Y.default,{key:b,date:b})));var y=h.id?h.id:h.pending_post_id,S=m-p-1;f.push(P.default.createElement("div",{key:y+"commentKey"},P.default.createElement(Q.default,{ref:h.id,post:h,lastPostCount:S>=0&&S<H.default.TEST_ID_COUNT?S:-1,user:g,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:v,status:E,isBusy:this.state.isBusy,removePost:this.props.actions.removePost,previewCollapsed:this.props.previewCollapsed,previewEnabled:this.props.previewEnabled,isEmbedVisible:this.props.postsEmbedVisibleObj[h.id]})))}var _=void 0;if(t.type!==H.default.PostTypes.FAKE_PARENT_DELETED&&(_=P.default.createElement("div",{className:"post-create__container"},P.default.createElement(q.default,{channelId:t.channel_id,rootId:t.id,latestPostId:m>0?e[m-1].id:t.id,getSidebarBody:this.getSidebarBody}))),this.props.channel.type===H.default.DM_CHANNEL){var M=V.getDirectTeammate(this.props.channel.id);M&&M.delete_at&&(_=P.default.createElement("div",{className:"post-create-message"},P.default.createElement(w.FormattedMessage,{id:"create_post.deactivated",defaultMessage:"You are viewing an archived channel with a deactivated user."})))}return P.default.createElement("div",{className:"sidebar-right__body",ref:"sidebarbody"},P.default.createElement(J.default,{isScrolling:this.state.isScrolling,isMobile:V.isMobile(),createAt:this.state.topRhsPostCreateAt,isRhsPost:!0}),P.default.createElement($.default,{previousRhsState:this.props.previousRhsState,isWebrtc:this.props.isWebrtc,toggleSize:this.props.toggleSize,shrink:this.props.shrink}),P.default.createElement(I.default,{autoHide:!0,autoHideTimeout:500,autoHideDuration:500,renderThumbHorizontal:r,renderThumbVertical:i,renderView:s,onScroll:this.handleScroll},P.default.createElement("div",{className:"post-right__scroll"},P.default.createElement(Y.default,{date:u}),P.default.createElement(te.default,{ref:t.id,post:t,commentCount:m,user:n,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:o,status:l,previewCollapsed:this.props.previewCollapsed,previewEnabled:this.props.previewEnabled,isBusy:this.state.isBusy,isEmbedVisible:this.props.postsEmbedVisibleObj[t.id]}),P.default.createElement("div",{ref:"rhspostlist",className:"post-right-comments-container"},f),_)))}}]),t}(P.default.Component);ne.propTypes={posts:T.default.arrayOf(T.default.object).isRequired,channel:T.default.object.isRequired,selected:T.default.object.isRequired,previousRhsState:T.default.string,isWebrtc:T.default.bool,currentUser:T.default.object.isRequired,useMilitaryTime:T.default.bool.isRequired,toggleSize:T.default.func,shrink:T.default.func,previewCollapsed:T.default.string.isRequired,previewEnabled:T.default.bool.isRequired,postsEmbedVisibleObj:T.default.object,actions:T.default.shape({removePost:T.default.func.isRequired}).isRequired};var se=function(){var e=this;this.forceUpdateInfo=function(){if(e.state.postList)for(var t in e.state.postList.posts)e.refs[t]&&e.refs[t].forceUpdate()},this.handleResize=function(){e.setState({windowWidth:V.windowWidth(),windowHeight:V.windowHeight()})},this.onPreferenceChange=function(){e.setState({compactDisplay:L.default.get(ae.CATEGORY_DISPLAY_SETTINGS,ae.MESSAGE_DISPLAY,ae.MESSAGE_DISPLAY_DEFAULT)===ae.MESSAGE_DISPLAY_COMPACT,flaggedPosts:L.default.getCategory(H.default.Preferences.CATEGORY_FLAGGED_POST)}),e.forceUpdateInfo()},this.onStatusChange=function(){e.setState({statuses:(0,l.default)({},O.default.getStatuses())})},this.onBusy=function(t){e.setState({isBusy:t})},this.filterPosts=function(e,t,a){var n=[];return e.forEach(function(e){"system_ephemeral"===e.type&&e.create_at<a||e.root_id===t.id&&n.unshift(e)}),n},this.onUserChange=function(){var t=JSON.parse((0,u.default)(O.default.getProfiles()));e.setState({profiles:t})},this.scrollToBottom=function(){(0,C.default)(".post-right__scroll")[0]&&(0,C.default)(".post-right__scroll").parent().scrollTop((0,C.default)(".post-right__scroll")[0].scrollHeight)},this.updateFloatingTimestamp=function(){if(V.isMobile()&&e.props.posts){for(var t=e.refs.rhspostlist.childNodes,a=e.refs.rhspostlist.getBoundingClientRect(),n=0,s=0;s<t.length;s++)if(t[s].offsetTop+a.top-100>0){n=e.props.posts[s].create_at;break}n!==e.state.topRhsPostCreateAt&&e.setState({topRhsPostCreateAt:n})}},this.handleScroll=function(){e.updateFloatingTimestamp(),e.state.isScrolling||e.setState({isScrolling:!0}),e.scrollStopAction.fireAfter(H.default.SCROLL_DELAY)},this.handleScrollStop=function(){e.setState({isScrolling:!1})},this.getSidebarBody=function(){return e.refs.sidebarbody}};t.default=ne},2284:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=a(2285),c=n(u),f=a(2065),m=n(f),p=a(1),h=a(2292),g=n(h),v=a(2295),E=n(v),b=a(2296),y=n(b),S=a(2297),_=n(S),M=a(2298),C=n(M),w=a(2299),k=n(w),T=a(2300),N=a(2301),P=function(e){function t(e){var a;r(this,t);for(var n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=i(this,(a=t.__proto__||Object.getPrototypeOf(t)).call.apply(a,[this,e].concat(s)));return l.getScrollLeft=l.getScrollLeft.bind(l),l.getScrollTop=l.getScrollTop.bind(l),l.getScrollWidth=l.getScrollWidth.bind(l),l.getScrollHeight=l.getScrollHeight.bind(l),l.getClientWidth=l.getClientWidth.bind(l),l.getClientHeight=l.getClientHeight.bind(l),l.getValues=l.getValues.bind(l),l.getThumbHorizontalWidth=l.getThumbHorizontalWidth.bind(l),l.getThumbVerticalHeight=l.getThumbVerticalHeight.bind(l),l.getScrollLeftForOffset=l.getScrollLeftForOffset.bind(l),l.getScrollTopForOffset=l.getScrollTopForOffset.bind(l),l.scrollLeft=l.scrollLeft.bind(l),l.scrollTop=l.scrollTop.bind(l),l.scrollToLeft=l.scrollToLeft.bind(l),l.scrollToTop=l.scrollToTop.bind(l),l.scrollToRight=l.scrollToRight.bind(l),l.scrollToBottom=l.scrollToBottom.bind(l),l.handleTrackMouseEnter=l.handleTrackMouseEnter.bind(l),l.handleTrackMouseLeave=l.handleTrackMouseLeave.bind(l),l.handleHorizontalTrackMouseDown=l.handleHorizontalTrackMouseDown.bind(l),l.handleVerticalTrackMouseDown=l.handleVerticalTrackMouseDown.bind(l),l.handleHorizontalThumbMouseDown=l.handleHorizontalThumbMouseDown.bind(l),l.handleVerticalThumbMouseDown=l.handleVerticalThumbMouseDown.bind(l),l.handleWindowResize=l.handleWindowResize.bind(l),l.handleScroll=l.handleScroll.bind(l),l.handleDrag=l.handleDrag.bind(l),l.handleDragEnd=l.handleDragEnd.bind(l),l.state={didMountUniversal:!1},l}return o(t,e),d(t,[{key:"componentDidMount",value:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()}},{key:"componentDidMountUniversal",value:function(){this.props.universal&&this.setState({didMountUniversal:!0})}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){this.removeListeners(),(0,u.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)}},{key:"getScrollLeft",value:function(){return this.view?this.view.scrollLeft:0}},{key:"getScrollTop",value:function(){return this.view?this.view.scrollTop:0}},{key:"getScrollWidth",value:function(){return this.view?this.view.scrollWidth:0}},{key:"getScrollHeight",value:function(){return this.view?this.view.scrollHeight:0}},{key:"getClientWidth",value:function(){return this.view?this.view.clientWidth:0}},{key:"getClientHeight",value:function(){return this.view?this.view.clientHeight:0}},{key:"getValues",value:function(){var e=this.view||{},t=e.scrollLeft,a=void 0===t?0:t,n=e.scrollTop,s=void 0===n?0:n,r=e.scrollWidth,i=void 0===r?0:r,o=e.scrollHeight,l=void 0===o?0:o,d=e.clientWidth,u=void 0===d?0:d,c=e.clientHeight,f=void 0===c?0:c;return{left:a/(i-u)||0,top:s/(l-f)||0,scrollLeft:a,scrollTop:s,scrollWidth:i,scrollHeight:l,clientWidth:u,clientHeight:f}}},{key:"getThumbHorizontalWidth",value:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.view,s=n.scrollWidth,r=n.clientWidth,i=(0,C.default)(this.trackHorizontal),o=Math.ceil(r/s*i);return i===o?0:t||Math.max(o,a)}},{key:"getThumbVerticalHeight",value:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.view,s=n.scrollHeight,r=n.clientHeight,i=(0,k.default)(this.trackVertical),o=Math.ceil(r/s*i);return i===o?0:t||Math.max(o,a)}},{key:"getScrollLeftForOffset",value:function(e){var t=this.view,a=t.scrollWidth,n=t.clientWidth;return e/((0,C.default)(this.trackHorizontal)-this.getThumbHorizontalWidth())*(a-n)}},{key:"getScrollTopForOffset",value:function(e){var t=this.view,a=t.scrollHeight,n=t.clientHeight;return e/((0,k.default)(this.trackVertical)-this.getThumbVerticalHeight())*(a-n)}},{key:"scrollLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view&&(this.view.scrollLeft=e)}},{key:"scrollTop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view&&(this.view.scrollTop=e)}},{key:"scrollToLeft",value:function(){this.view&&(this.view.scrollLeft=0)}},{key:"scrollToTop",value:function(){this.view&&(this.view.scrollTop=0)}},{key:"scrollToRight",value:function(){this.view&&(this.view.scrollLeft=this.view.scrollWidth)}},{key:"scrollToBottom",value:function(){this.view&&(this.view.scrollTop=this.view.scrollHeight)}},{key:"addListeners",value:function(){if("undefined"!=typeof document&&this.view){var e=this.view,t=this.trackHorizontal,a=this.trackVertical,n=this.thumbHorizontal,s=this.thumbVertical;e.addEventListener("scroll",this.handleScroll),(0,y.default)()&&(t.addEventListener("mouseenter",this.handleTrackMouseEnter),t.addEventListener("mouseleave",this.handleTrackMouseLeave),t.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),a.addEventListener("mouseenter",this.handleTrackMouseEnter),a.addEventListener("mouseleave",this.handleTrackMouseLeave),a.addEventListener("mousedown",this.handleVerticalTrackMouseDown),n.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),s.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}}},{key:"removeListeners",value:function(){if("undefined"!=typeof document&&this.view){var e=this.view,t=this.trackHorizontal,a=this.trackVertical,n=this.thumbHorizontal,s=this.thumbVertical;e.removeEventListener("scroll",this.handleScroll),(0,y.default)()&&(t.removeEventListener("mouseenter",this.handleTrackMouseEnter),t.removeEventListener("mouseleave",this.handleTrackMouseLeave),t.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),a.removeEventListener("mouseenter",this.handleTrackMouseEnter),a.removeEventListener("mouseleave",this.handleTrackMouseLeave),a.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),n.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),s.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}}},{key:"handleScroll",value:function(e){var t=this,a=this.props,n=a.onScroll,s=a.onScrollFrame;n&&n(e),this.update(function(e){var a=e.scrollLeft,n=e.scrollTop;t.viewScrollLeft=a,t.viewScrollTop=n,s&&s(e)}),this.detectScrolling()}},{key:"handleScrollStart",value:function(){var e=this.props.onScrollStart;e&&e(),this.handleScrollStartAutoHide()}},{key:"handleScrollStartAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleScrollStop",value:function(){var e=this.props.onScrollStop;e&&e(),this.handleScrollStopAutoHide()}},{key:"handleScrollStopAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleWindowResize",value:function(){this.update()}},{key:"handleHorizontalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,a=e.clientX,n=t.getBoundingClientRect(),s=n.left,r=this.getThumbHorizontalWidth(),i=Math.abs(s-a)-r/2;this.view.scrollLeft=this.getScrollLeftForOffset(i)}},{key:"handleVerticalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,a=e.clientY,n=t.getBoundingClientRect(),s=n.top,r=this.getThumbVerticalHeight(),i=Math.abs(s-a)-r/2;this.view.scrollTop=this.getScrollTopForOffset(i)}},{key:"handleHorizontalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientX,n=t.offsetWidth,s=t.getBoundingClientRect(),r=s.left;this.prevPageX=n-(a-r)}},{key:"handleVerticalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientY,n=t.offsetHeight,s=t.getBoundingClientRect(),r=s.top;this.prevPageY=n-(a-r)}},{key:"setupDragging",value:function(){(0,m.default)(document.body,T.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=_.default}},{key:"teardownDragging",value:function(){(0,m.default)(document.body,T.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0}},{key:"handleDragStart",value:function(e){this.dragging=!0,e.stopImmediatePropagation(),this.setupDragging()}},{key:"handleDrag",value:function(e){if(this.prevPageX){var t=e.clientX,a=this.trackHorizontal.getBoundingClientRect(),n=a.left,s=this.getThumbHorizontalWidth(),r=s-this.prevPageX,i=-n+t-r;this.view.scrollLeft=this.getScrollLeftForOffset(i)}if(this.prevPageY){var o=e.clientY,l=this.trackVertical.getBoundingClientRect(),d=l.top,u=this.getThumbVerticalHeight(),c=u-this.prevPageY,f=-d+o-c;this.view.scrollTop=this.getScrollTopForOffset(f)}return!1}},{key:"handleDragEnd",value:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()}},{key:"handleDragEndAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleTrackMouseEnter",value:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()}},{key:"handleTrackMouseEnterAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleTrackMouseLeave",value:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()}},{key:"handleTrackMouseLeaveAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"showTracks",value:function(){clearTimeout(this.hideTracksTimeout),(0,m.default)(this.trackHorizontal,{opacity:1}),(0,m.default)(this.trackVertical,{opacity:1})}},{key:"hideTracks",value:function(){var e=this;if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var t=this.props.autoHideTimeout;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,m.default)(e.trackHorizontal,{opacity:0}),(0,m.default)(e.trackVertical,{opacity:0})},t)}}},{key:"detectScrolling",value:function(){var e=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){e.lastViewScrollLeft===e.viewScrollLeft&&e.lastViewScrollTop===e.viewScrollTop&&(clearInterval(e.detectScrollingInterval),e.scrolling=!1,e.handleScrollStop()),e.lastViewScrollLeft=e.viewScrollLeft,e.lastViewScrollTop=e.viewScrollTop},100))}},{key:"raf",value:function(e){var t=this;this.requestFrame&&c.default.cancel(this.requestFrame),this.requestFrame=(0,c.default)(function(){t.requestFrame=void 0,e()})}},{key:"update",value:function(e){var t=this;this.raf(function(){return t._update(e)})}},{key:"_update",value:function(e){var t=this.props,a=t.onUpdate,n=t.hideTracksWhenNotNeeded,s=this.getValues();if((0,y.default)()){var r=s.scrollLeft,i=s.clientWidth,o=s.scrollWidth,l=(0,C.default)(this.trackHorizontal),d=this.getThumbHorizontalWidth(),u=r/(o-i)*(l-d),c={width:d,transform:"translateX("+u+"px)"},f=s.scrollTop,p=s.clientHeight,h=s.scrollHeight,g=(0,k.default)(this.trackVertical),v=this.getThumbVerticalHeight(),E=f/(h-p)*(g-v),b={height:v,transform:"translateY("+E+"px)"};if(n){var S={visibility:o>i?"visible":"hidden"},_={visibility:h>p?"visible":"hidden"};(0,m.default)(this.trackHorizontal,S),(0,m.default)(this.trackVertical,_)}(0,m.default)(this.thumbHorizontal,c),(0,m.default)(this.thumbVertical,b)}a&&a(s),"function"==typeof e&&e(s)}},{key:"render",value:function(){var e=this,t=(0,y.default)(),a=this.props,n=(a.onScroll,a.onScrollFrame,a.onScrollStart,a.onScrollStop,a.onUpdate,a.renderView),r=a.renderTrackHorizontal,i=a.renderTrackVertical,o=a.renderThumbHorizontal,d=a.renderThumbVertical,u=a.tagName,c=(a.hideTracksWhenNotNeeded,a.autoHide),f=(a.autoHideTimeout,a.autoHideDuration),m=(a.thumbSize,a.thumbMinSize,a.universal),h=a.autoHeight,g=a.autoHeightMin,v=a.autoHeightMax,b=a.style,S=a.children,_=s(a,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),M=this.state.didMountUniversal,C=l({},T.containerStyleDefault,h&&l({},T.containerStyleAutoHeight,{minHeight:g,maxHeight:v}),b),w=l({},T.viewStyleDefault,{marginRight:t?-t:0,marginBottom:t?-t:0},h&&l({},T.viewStyleAutoHeight,{minHeight:(0,E.default)(g)?"calc("+g+" + "+t+"px)":g+t,maxHeight:(0,E.default)(v)?"calc("+v+" + "+t+"px)":v+t}),h&&m&&!M&&{minHeight:g,maxHeight:v},m&&!M&&T.viewStyleUniversalInitial),k={transition:"opacity "+f+"ms",opacity:0},N=l({},T.trackHorizontalStyleDefault,c&&k,(!t||m&&!M)&&{display:"none"}),P=l({},T.trackVerticalStyleDefault,c&&k,(!t||m&&!M)&&{display:"none"});return(0,p.createElement)(u,l({},_,{style:C,ref:function(t){e.container=t}}),[(0,p.cloneElement)(n({style:w}),{key:"view",ref:function(t){e.view=t}},S),(0,p.cloneElement)(r({style:N}),{key:"trackHorizontal",ref:function(t){e.trackHorizontal=t}},(0,p.cloneElement)(o({style:T.thumbHorizontalStyleDefault}),{ref:function(t){e.thumbHorizontal=t}})),(0,p.cloneElement)(i({style:P}),{key:"trackVertical",ref:function(t){e.trackVertical=t}},(0,p.cloneElement)(d({style:T.thumbVerticalStyleDefault}),{ref:function(t){e.thumbVertical=t}}))])}}]),t}(p.Component);t.default=P,P.propTypes={onScroll:g.default.func,onScrollFrame:g.default.func,onScrollStart:g.default.func,onScrollStop:g.default.func,onUpdate:g.default.func,renderView:g.default.func,renderTrackHorizontal:g.default.func,renderTrackVertical:g.default.func,renderThumbHorizontal:g.default.func,renderThumbVertical:g.default.func,tagName:g.default.string,thumbSize:g.default.number,thumbMinSize:g.default.number,hideTracksWhenNotNeeded:g.default.bool,autoHide:g.default.bool,autoHideTimeout:g.default.number,autoHideDuration:g.default.number,autoHeight:g.default.bool,autoHeightMin:g.default.oneOfType([g.default.number,g.default.string]),autoHeightMax:g.default.oneOfType([g.default.number,g.default.string]),universal:g.default.bool,style:g.default.object,children:g.default.node},P.defaultProps={renderView:N.renderViewDefault,renderTrackHorizontal:N.renderTrackHorizontalDefault,renderTrackVertical:N.renderTrackVerticalDefault,renderThumbHorizontal:N.renderThumbHorizontalDefault,renderThumbVertical:N.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}},2285:function(e,t,a){(function(t){for(var n=(a(0),a(0),a(2286)),s="undefined"==typeof window?t:window,r=["moz","webkit"],i="AnimationFrame",o=s["request"+i],l=s["cancel"+i]||s["cancelRequest"+i],d=0;!o&&d<r.length;d++)o=s[r[d]+"Request"+i],l=s[r[d]+"Cancel"+i]||s[r[d]+"CancelRequest"+i];if(!o||!l){var u=0,c=0,f=[];o=function(e){if(0===f.length){var t=n(),a=Math.max(0,1e3/60-(t-u));u=a+t,setTimeout(function(){var e=f.slice(0);f.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(e){setTimeout(function(){throw e},0)}},Math.round(a))}return f.push({handle:++c,callback:e,cancelled:!1}),c},l=function(e){for(var t=0;t<f.length;t++)f[t].handle===e&&(f[t].cancelled=!0)}}e.exports=function(e){return o.call(s,e)},e.exports.cancel=function(){l.apply(s,arguments)},e.exports.polyfill=function(){s.requestAnimationFrame=o,s.cancelAnimationFrame=l}}).call(t,a(23))},2286:function(e,t,a){(function(t){a(0),a(0);(function(){var a,n,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:void 0!==t&&null!==t&&t.hrtime?(e.exports=function(){return(a()-s)/1e6},n=t.hrtime,a=function(){var e;return e=n(),1e9*e[0]+e[1]},s=a()):Date.now?(e.exports=function(){return Date.now()-s},s=Date.now()):(e.exports=function(){return(new Date).getTime()-s},s=(new Date).getTime())}).call(this)}).call(t,a(128))},2287:function(e,t,a){var n=(a(0),a(0),null),s=["Webkit","Moz","O","ms"];e.exports=function(e){n||(n=document.createElement("div"));var t=n.style;if(e in t)return e;for(var a=e.charAt(0).toUpperCase()+e.slice(1),r=s.length;r>=0;r--){var i=s[r]+a;if(i in t)return i}return!1}},2288:function(e,t,a){function n(e){return s(e).replace(/\s(\w)/g,function(e,t){return t.toUpperCase()})}var s=(a(0),a(0),a(2289));e.exports=n},2289:function(e,t,a){function n(e){return s(e).replace(/[\W_]+(.|$)/g,function(e,t){return t?" "+t:""}).trim()}var s=(a(0),a(0),a(2290));e.exports=n},2290:function(e,t,a){function n(e){return i.test(e)?e.toLowerCase():o.test(e)?(s(e)||e).toLowerCase():l.test(e)?r(e).toLowerCase():e.toLowerCase()}function s(e){return e.replace(d,function(e,t){return t?" "+t:""})}function r(e){return e.replace(u,function(e,t,a){return t+" "+a.toLowerCase().split("").join(" ")})}a(0),a(0);e.exports=n;var i=/\s/,o=/(_|-|\.|:)/,l=/([a-z][A-Z]|[A-Z][a-z])/,d=/[\W_]+(.|$)/g,u=/(.)([A-Z]+)/g},2291:function(e,t,a){var n=(a(0),a(0),{animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0});e.exports=function(e,t){return"number"!=typeof t||n[e]?t:t+"px"}},2292:function(e,t,a){a(0),a(0);e.exports=a(2293)()},2293:function(e,t,a){var n=(a(0),a(0),a(169)),s=a(129),r=a(2294);e.exports=function(){function e(e,t,a,n,i,o){o!==r&&s(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var a={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t};return a.checkPropTypes=n,a.PropTypes=a,a}},2294:function(e,t,a){a(0),a(0);e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2295:function(e,t,a){function n(e){return"string"==typeof e}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2296:function(e,t,a){function n(){if(!1!==i)return i;if("undefined"!=typeof document){var e=document.createElement("div");(0,r.default)(e,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(e),i=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}else i=0;return i||0}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var s=a(2065),r=function(e){return e&&e.__esModule?e:{default:e}}(s),i=!1},2297:function(e,t,a){function n(){return!1}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2298:function(e,t,a){function n(e){var t=e.clientWidth,a=getComputedStyle(e),n=a.paddingLeft,s=a.paddingRight;return t-parseFloat(n)-parseFloat(s)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2299:function(e,t,a){function n(e){var t=e.clientHeight,a=getComputedStyle(e),n=a.paddingTop,s=a.paddingBottom;return t-parseFloat(n)-parseFloat(s)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2300:function(e,t,a){a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});t.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"},t.containerStyleAutoHeight={height:"auto"},t.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"},t.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0},t.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0},t.trackHorizontalStyleDefault={position:"absolute",height:6},t.trackVerticalStyleDefault={position:"absolute",width:6},t.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"},t.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"},t.disableSelectStyle={userSelect:"none"},t.disableSelectStyleReset={userSelect:""}},2301:function(e,t,a){function n(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function s(e){return c.default.createElement("div",e)}function r(e){var t=e.style,a=n(e,["style"]),s=d({},t,{right:2,bottom:2,left:2,borderRadius:3});return c.default.createElement("div",d({style:s},a))}function i(e){var t=e.style,a=n(e,["style"]),s=d({},t,{right:2,bottom:2,top:2,borderRadius:3});return c.default.createElement("div",d({style:s},a))}function o(e){var t=e.style,a=n(e,["style"]),s=d({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return c.default.createElement("div",d({style:s},a))}function l(e){var t=e.style,a=n(e,["style"]),s=d({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return c.default.createElement("div",d({style:s},a))}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.renderViewDefault=s,t.renderTrackHorizontalDefault=r,t.renderTrackVerticalDefault=i,t.renderThumbHorizontalDefault=o,t.renderThumbVerticalDefault=l;var u=a(1),c=function(e){return e&&e.__esModule?e:{default:e}}(u)},2302:function(e,t,a){"use strict";function n(e,t){var a=e.requests.posts.createPost.error||{},n=(0,f.makeGetCommentDraft)(t.rootId),s=n(e);return{draft:s,enableAddButton:0!==s.message.trim().length||0!==s.fileInfos.length,ctrlSend:(0,l.getBool)(e,u.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),createPostErrorId:a.server_error_id}}function s(e){return function(t){return(0,c.updateCommentDraft)(e,t)}}function r(){function e(){return(0,d.resetHistoryIndex)(u.Posts.MESSAGE_TYPES.COMMENT)}var t=void 0,a=void 0,n=void 0,r=void 0,i=void 0,l=void 0,f=void 0,m=void 0;return function(d,u){return l!==u.rootId&&(t=s(u.rootId),n=(0,c.makeOnMoveHistoryIndex)(u.rootId,-1),r=(0,c.makeOnMoveHistoryIndex)(u.rootId,1)),l===u.rootId&&f===u.channelId||(i=(0,c.makeOnEditLatestPost)(u.channelId,u.rootId)),l===u.rootId&&f===u.channelId&&m===u.latestPostId||(a=(0,c.makeOnSubmit)(u.channelId,u.rootId,u.latestPostId)),l=u.rootId,f=u.channelId,m=u.latestPostId,(0,o.bindActionCreators)({clearCommentDraftUploads:c.clearCommentDraftUploads,onUpdateCommentDraft:t,onSubmit:a,onResetHistoryIndex:e,onMoveHistoryIndexBack:n,onMoveHistoryIndexForward:r,onEditLatestPost:i},d)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(26),o=a(21),l=a(62),d=a(74),u=a(25),c=a(2303),f=a(218),m=a(2304),p=function(e){return e&&e.__esModule?e:{default:e}}(m);t.default=(0,i.connect)(n,r)(p.default)},2303:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function r(){return(0,x.actionOnGlobalItemsWithPrefix)(G.StoragePrefixes.COMMENT_DRAFT,function(e,t){return t?(0,M.default)({},t,{uploadsInProgress:[]}):t})}function i(e,t){return(0,x.setGlobalItem)(""+G.StoragePrefixes.COMMENT_DRAFT+e,t)}function o(e,t){var a=(0,T.makeGetMessageInHistoryItem)(R.Posts.MESSAGE_TYPES.COMMENT),n=(0,H.makeGetCommentDraft)(e);return function(){return function(s,r){var o=n(r());if(""===o.message||o.message===a(r())){-1===t?s((0,P.moveHistoryIndexBack)(R.Posts.MESSAGE_TYPES.COMMENT)):1===t&&s((0,P.moveHistoryIndexForward)(R.Posts.MESSAGE_TYPES.COMMENT));var l=a(r());s(i(e,(0,M.default)({},o,{message:l})))}}}}function l(e,t,a){return function(n,s){var r=s(),i=(0,w.getCurrentUserId)(r),o=B.getTimestamp(),l={file_ids:[],message:a.message,channel_id:e,root_id:t,parent_id:t,pending_post_id:i+":"+o,user_id:i,create_at:o};A.emitUserCommentedEvent(l),D.createPost(l,a.fileInfos)}}function d(e,t,a){return function(n){"+"===t?n((0,P.addReaction)(e,a)):"-"===t&&n((0,P.removeReaction)(e,a))}}function u(e,t,a){return function(n,s){var r=s(),i=(0,k.getCurrentTeamId)(r),o={channel_id:e,team_id:i,root_id:t,parent_id:t},d=a.message;return new S.default(function(s,r){F.executeCommand(d,o,s,function(s){s.sendMessage?n(l(e,t,a)):r(s)})})}}function c(e,t,a){var n=this,s=(0,H.makeGetCommentDraft)(t);return function(){return function(){var r=(0,b.default)(v.default.mark(function r(o,c){var f,m,p,h,g;return v.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(f=s(c()),m=f.message,o((0,P.addMessageIntoHistory)(m)),o(i(t,null)),p=V.REACTION_PATTERN.exec(m),h=(0,N.getCustomEmojisByName)(c()),g=new U.EmojiMap(h),!p||!g.has(p[2])){n.next=11;break}o(d(a,p[1],p[2])),n.next=17;break;case 11:if(0!==m.indexOf("/")){n.next=16;break}return n.next=14,o(u(e,t,f));case 14:n.next=17;break;case 16:o(l(e,t,f));case 17:case"end":return n.stop()}},r,n)}));return function(e,t){return r.apply(this,arguments)}}()}}function f(e,t){return(0,C.createSelector)(w.getCurrentUserId,function(t){return t.entities.posts.postsInChannel[e]},function(e){return function(t){return(0,T.getPost)(e,t)}},function(e,a,n){var s=null;if(!a)return s;var r=!0,i=!1,o=void 0;try{for(var l,d=(0,h.default)(a);!(r=(l=d.next()).done);r=!0){var u=l.value,c=n(u)||{};if(!(c.user_id!==e||c.props&&c.props.from_webhook||c.state===G.Constants.POST_DELETED||c.type&&c.type.startsWith(G.Constants.SYSTEM_MESSAGE_PREFIX))){if(!t){s=c;break}if(c.root_id===t||c.id===t){s=c;break}}}}catch(e){i=!0,o=e}finally{try{!r&&d.return&&d.return()}finally{if(i)throw o}}return s})}function m(e,t){var a=f(e,t),n=(0,T.makeGetCommentCountForPost)();return function(){return function(e,t){var s=t(),r=a(s);r&&e(D.setEditingPost(r.id,n(s,{post:r}),"#reply_textbox",B.localizeMessage("create_comment.commentTitle","Comment")))}}}Object.defineProperty(t,"__esModule",{value:!0});var p=a(45),h=s(p),g=a(57),v=s(g),E=a(58),b=s(E),y=a(288),S=s(y),_=a(19),M=s(_);t.clearCommentDraftUploads=r,t.updateCommentDraft=i,t.makeOnMoveHistoryIndex=o,t.submitPost=l,t.submitReaction=d,t.submitCommand=u,t.makeOnSubmit=c,t.makeOnEditLatestPost=m;var C=a(63),w=a(46),k=a(81),T=a(92),N=a(225),P=a(74),R=a(25),I=a(71),D=n(I),L=a(56),A=n(L),O=a(82),F=n(O),x=a(289),U=a(127),H=a(218),j=a(16),B=n(j),G=a(9),V=a(1964)},2304:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(115),i=s(r),o=a(57),l=s(o),d=a(58),u=s(d),c=a(19),f=s(c),m=a(5),p=s(m),h=a(3),g=s(h),v=a(4),E=s(v),b=a(6),y=s(b),S=a(7),_=s(S),M=a(0),C=s(M),w=a(8),k=s(w),T=a(1),N=s(T),P=a(17),R=a(56),I=n(R),D=a(9),L=s(D),A=a(73),O=n(A),F=a(16),x=n(F),U=a(284),H=s(U),j=a(700),B=s(j),G=a(701),V=s(G),z=a(702),q=s(z),W=a(703),Y=s(W),K=a(393),J=s(K),X=L.default.KeyCodes,Q=function(e){function t(e){var a=this;(0,g.default)(this,t);var n=(0,y.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return n.toggleEmojiPicker=function(){n.setState({showEmojiPicker:!n.state.showEmojiPicker})},n.hideEmojiPicker=function(){n.setState({showEmojiPicker:!1})},n.handleEmojiClick=function(e){var t=e.name||e.aliases[0];if(t){var a=n.state.draft,s="";s=""===a.message?":"+t+": ":/\s+$/.test(a.message)?a.message+":"+t+": ":a.message+" :"+t+": ",n.props.onUpdateCommentDraft((0,f.default)({},a,{message:s})),n.setState({showEmojiPicker:!1,draft:(0,f.default)({},a,{message:s})}),n.focusTextbox()}},n.handlePostError=function(e){n.setState({postError:e})},n.handleSubmit=function(){var e=(0,u.default)(l.default.mark(function e(t){var s,r,i,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),s=n.props.enableAddButton,r=n.state.draft,s){e.next=5;break}return e.abrupt("return");case 5:if(!(r.uploadsInProgress.length>0)){e.next=7;break}return e.abrupt("return");case 7:if(!n.state.postError){e.next=11;break}return n.setState({errorClass:"animation--highlight"}),setTimeout(function(){n.setState({errorClass:null})},L.default.ANIMATION_TIMEOUT),e.abrupt("return");case 11:return e.prev=11,e.next=14,n.props.onSubmit();case 14:n.setState({postError:null,serverError:null}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(11),n.setState({serverError:e.t0.message});case 20:i=150,o=Date.now()-n.lastBlurAt<i,n.setState({draft:(0,f.default)({},n.props.draft,{uploadsInProgress:[]})}),n.focusTextbox(o);case 24:case"end":return e.stop()}},e,a,[[11,17]])}));return function(t){return e.apply(this,arguments)}}(),n.commentMsgKeyPress=function(e){!O.isMobile()&&(n.props.ctrlSend&&e.ctrlKey||!n.props.ctrlSend)&&(e.which!==X.ENTER||e.shiftKey||e.altKey||(e.preventDefault(),n.refs.textbox.blur(),n.handleSubmit(e))),I.emitLocalUserTypingEvent(n.props.channelId,n.props.rootId)},n.scrollToBottom=function(){var e=(0,C.default)(".post-right__scroll");e[0]&&e.parent().scrollTop(e[0].scrollHeight)},n.handleChange=function(e){var t=e.target.value,a=n.state.draft,s=(0,f.default)({},a,{message:t});n.props.onUpdateCommentDraft(s),n.setState({draft:s}),n.scrollToBottom()},n.handleKeyDown=function(e){if(n.props.ctrlSend&&e.keyCode===X.ENTER&&e.ctrlKey)return void n.commentMsgKeyPress(e);var t=n.state.draft,a=t.message;e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.keyCode!==X.UP||""!==a||(e.preventDefault(),n.props.onEditLatestPost()),!e.ctrlKey&&!e.metaKey||e.altKey||e.shiftKey||(e.keyCode===L.default.KeyCodes.UP?(e.preventDefault(),n.props.onMoveHistoryIndexBack()):e.keyCode===L.default.KeyCodes.DOWN&&(e.preventDefault(),n.props.onMoveHistoryIndexForward()))},n.handleFileUploadChange=function(){n.focusTextbox()},n.handleUploadStart=function(e){var t=n.state.draft,a=[].concat((0,i.default)(t.uploadsInProgress),(0,i.default)(e));n.props.onUpdateCommentDraft((0,f.default)({},t,{uploadsInProgress:a})),n.setState({draft:(0,f.default)({},t,{uploadsInProgress:a})}),n.focusTextbox()},n.handleFileUploadComplete=function(e,t){for(var a=n.state.draft,s=[].concat((0,i.default)(a.uploadsInProgress)),r=[].concat((0,i.default)(a.fileInfos),(0,i.default)(e)),o=0;o<t.length;o++){var l=s.indexOf(t[o]);-1!==l&&s.splice(l,1)}n.props.onUpdateCommentDraft((0,f.default)({},a,{fileInfos:r,uploadsInProgress:s})),n.setState({draft:(0,f.default)({},a,{fileInfos:r,uploadsInProgress:s})}),void 0!==n.refs.preview&&n.refs.preview&&n.refs.preview.refs.container.scrollIntoView()},n.handleUploadError=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(-1!==t){var a=n.state.draft,s=[].concat((0,i.default)(a.uploadsInProgress)),r=s.indexOf(t);-1!==r&&s.splice(r,1),n.props.onUpdateCommentDraft((0,f.default)({},a,{uploadsInProgress:s})),n.setState({draft:(0,f.default)({},a,{uploadsInProgress:s})})}n.setState({serverError:e})},n.removePreview=function(e){var t=n.state.draft,a=[].concat((0,i.default)(t.fileInfos)),s=[].concat((0,i.default)(t.uploadsInProgress));n.handleUploadError(null);var r=a.findIndex(function(t){return t.id===e});-1===r?-1!==(r=s.indexOf(e))&&(s.splice(r,1),n.refs.fileUpload&&n.refs.fileUpload.getWrappedInstance().cancelUpload(e)):a.splice(r,1),n.props.onUpdateCommentDraft((0,f.default)({},t,{fileInfos:a,uploadsInProgress:s})),n.setState({draft:(0,f.default)({},t,{fileInfos:a,uploadsInProgress:s})}),n.handleFileUploadChange()},n.getFileCount=function(){var e=n.state.draft,t=e.fileInfos,a=e.uploadsInProgress;return t.length+a.length},n.getFileUploadTarget=function(){return n.refs.textbox},n.getCreateCommentControls=function(){return n.refs.createCommentControls},n.focusTextbox=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n.refs.textbox||!e&&O.isMobile()||n.refs.textbox.focus()},n.showPostDeletedModal=function(){n.setState({showPostDeletedModal:!0})},n.hidePostDeletedModal=function(){n.setState({showPostDeletedModal:!1})},n.handleBlur=function(){n.lastBlurAt=Date.now()},n.state={showPostDeletedModal:!1,showEmojiPicker:!1,draft:{message:"",uploadsInProgress:[],fileInfos:[]}},n.lastBlurAt=0,n}return(0,_.default)(t,e),(0,E.default)(t,[{key:"componentWillMount",value:function(){this.props.clearCommentDraftUploads(),this.props.onResetHistoryIndex(),this.setState({draft:(0,f.default)({},this.props.draft,{uploadsInProgress:[]})})}},{key:"componentDidMount",value:function(){this.focusTextbox()}},{key:"componentWillReceiveProps",value:function(e){"api.post.create_post.root_id.app_error"===e.createPostErrorId&&e.createPostErrorId!==this.props.createPostErrorId&&this.showPostDeletedModal(),e.rootId!==this.props.rootId&&this.setState({draft:(0,f.default)({},e.draft,{uploadsInProgress:[]})})}},{key:"componentDidUpdate",value:function(e,t){t.draft.uploadsInProgress.length<this.state.draft.uploadsInProgress.length&&this.scrollToBottom(),e.rootId!==this.props.rootId&&this.focusTextbox()}},{key:"render",value:function(){var e=this.state.draft,t=null;this.state.serverError&&(t=N.default.createElement("div",{className:"form-group has-error"},N.default.createElement("label",{className:"control-label"},this.state.serverError)));var a=null;if(this.state.postError){var n="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");a=N.default.createElement("label",{className:n},this.state.postError)}var s=null;(e.fileInfos.length>0||e.uploadsInProgress.length>0)&&(s=N.default.createElement(B.default,{fileInfos:e.fileInfos,onRemove:this.removePreview,uploadsInProgress:e.uploadsInProgress,ref:"preview"}));var r=null;e.uploadsInProgress.length>0&&(r=N.default.createElement("span",{className:"pull-right post-right-comments-upload-in-progress"},1===e.uploadsInProgress.length?N.default.createElement(P.FormattedMessage,{id:"create_comment.file",defaultMessage:"File uploading"}):N.default.createElement(P.FormattedMessage,{id:"create_comment.files",defaultMessage:"Files uploading"})));var i="btn btn-primary comment-btn pull-right";this.props.enableAddButton||(i+=" disabled");var o=N.default.createElement(V.default,{ref:"fileUpload",getFileCount:this.getFileCount,getTarget:this.getFileUploadTarget,onFileUploadChange:this.handleFileUploadChange,onUploadStart:this.handleUploadStart,onFileUpload:this.handleFileUploadComplete,onUploadError:this.handleUploadError,postType:"comment",channelId:this.props.channelId}),l=null;return"true"===window.mm_config.EnableEmojiPicker&&(l=N.default.createElement("span",{className:"emoji-picker__container"},N.default.createElement(H.default,{show:this.state.showEmojiPicker,container:this.props.getSidebarBody,target:this.getCreateCommentControls,onHide:this.hideEmojiPicker,onEmojiClick:this.handleEmojiClick,rightOffset:15,topOffset:55}),N.default.createElement("span",{className:"icon icon--emoji emoji-rhs "+(this.state.showEmojiPicker?"active":""),dangerouslySetInnerHTML:{__html:L.default.EMOJI_ICON_SVG},onClick:this.toggleEmojiPicker}))),N.default.createElement("form",{onSubmit:this.handleSubmit},N.default.createElement("div",{className:"post-create"},N.default.createElement("div",{id:this.props.rootId,className:"post-create-body comment-create-body"},N.default.createElement("div",{className:"post-body__cell"},N.default.createElement(J.default,{onChange:this.handleChange,onKeyPress:this.commentMsgKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:e.message,onBlur:this.handleBlur,createMessage:x.localizeMessage("create_comment.addComment","Add a comment..."),emojiEnabled:"true"===window.mm_config.EnableEmojiPicker,initialText:"",channelId:this.props.channelId,isRHS:!0,popoverMentionKeyClick:!0,id:"reply_textbox",ref:"textbox"}),N.default.createElement("span",{ref:"createCommentControls",className:"post-body__actions"},o,l))),N.default.createElement(q.default,{channelId:this.props.channelId,parentId:this.props.rootId}),N.default.createElement("div",{className:"post-create-footer"},N.default.createElement("input",{type:"button",className:i,value:x.localizeMessage("create_comment.comment","Add Comment"),onClick:this.handleSubmit}),r,a,s,t)),N.default.createElement(Y.default,{show:this.state.showPostDeletedModal,onHide:this.hidePostDeletedModal}))}}]),t}(N.default.PureComponent);Q.propTypes={channelId:k.default.string.isRequired,rootId:k.default.string.isRequired,draft:k.default.shape({message:k.default.string.isRequired,uploadsInProgress:k.default.array.isRequired,fileInfos:k.default.array.isRequired}).isRequired,enableAddButton:k.default.bool.isRequired,ctrlSend:k.default.bool,latestPostId:k.default.string,getSidebarBody:k.default.func,createPostErrorId:k.default.string,clearCommentDraftUploads:k.default.func.isRequired,onUpdateCommentDraft:k.default.func.isRequired,onSubmit:k.default.func.isRequired,onResetHistoryIndex:k.default.func.isRequired,onMoveHistoryIndexBack:k.default.func.isRequired,onMoveHistoryIndexForward:k.default.func.isRequired,onEditLatestPost:k.default.func.isRequired},t.default=Q},2305:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(17),b=function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"date-separator"},v.default.createElement("hr",{className:"separator__hr"}),v.default.createElement("div",{className:"separator__text"},v.default.createElement(E.FormattedDate,{value:this.props.date,weekday:"short",month:"short",day:"2-digit",year:"numeric"})))}}]),t}(v.default.PureComponent);b.propTypes={date:h.default.instanceOf(Date)},t.default=b},2306:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(8),g=s(h),v=a(1),E=s(v),b=a(17),y=a(34),S=a(71),_=a(36),M=s(_),C=a(9),w=s(C),k=a(83),T=n(k),N=a(16),P=n(N),R=a(661),I=s(R),D=a(284),L=s(D),A=a(662),O=s(A),F=a(705),x=s(F),U=a(667),H=s(U),j=a(663),B=s(j),G=a(664),V=s(G),z=a(668),q=s(z),W=a(165),Y=s(W),K=a(391),J=s(K),X=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.toggleEmojiPicker=function(){var e=!t.state.showEmojiPicker;t.setState({showEmojiPicker:e,dropdownOpened:e})},t.getClassName=function(e,a){var n="post post--thread";return t.props.currentUser.id===e.user_id&&(n+=" current--user"),a&&(n+=" post--system"),t.props.compactDisplay&&(n+=" post--compact"),e.is_pinned&&(n+=" post--pinned"),t.state.dropdownOpened&&(n+=" post--hovered"),n},t.removePost=t.removePost.bind(t),t.reactEmojiClick=t.reactEmojiClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.state={currentTeamDisplayName:M.default.getCurrent().name,width:"",height:"",showEmojiPicker:!1,dropdownOpened:!1},t}return(0,p.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){P.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){P.updateWindowDimensions(e)})}},{key:"removePost",value:function(){this.props.removePost(this.props.post)}},{key:"createRemovePostButton",value:function(){return E.default.createElement("button",{className:"post__remove theme color--link style--none",type:"button",onClick:this.removePost},"×")}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(!P.areObjectsEqual(e.post,this.props.post)||(!P.areObjectsEqual(e.currentUser,this.props.currentUser)||(this.state.showEmojiPicker!==t.showEmojiPicker||(e.lastPostCount!==this.props.lastPostCount||(this.state.dropdownOpened!==t.dropdownOpened||(e.isEmbedVisible!==this.props.isEmbedVisible||(this.props.previewEnabled!==e.previewEnabled||!P.areObjectsEqual(e.user,this.props.user))))))))))))}},{key:"timeTag",value:function(e,t){var a=P.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"post__time",dateTime:a.toISOString(),title:a},a.toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return P.isMobile()?this.timeTag(e,t):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,className:"post__permalink"},this.timeTag(e,t))}},{key:"reactEmojiClick",value:function(e){this.setState({showEmojiPicker:!1});var t=e.name||e.aliases[0];(0,S.addReaction)(this.props.post.channel_id,this.props.post.id,t),(0,S.emitEmojiPosted)(t),this.handleDropdownOpened(!1)}},{key:"handleDropdownOpened",value:function(e){this.setState({dropdownOpened:e})}},{key:"render",value:function(){var t=this,a=this.props.post,n=w.default.MATTERMOST_ICON_SVG,s=-1;this.props.lastPostCount>=0&&this.props.lastPostCount<w.default.TEST_ID_COUNT&&(s=this.props.lastPostCount);var r=P.isPostEphemeral(a),i=T.isSystemMessage(a),o=this.props.status;a.props&&"true"===a.props.from_webhook&&(o=null);var l=void 0,d=E.default.createElement(J.default,{user:this.props.user,status:o,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}),u=void 0;a.props&&a.props.from_webhook?(d=a.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?E.default.createElement(J.default,{user:this.props.user,overwriteName:a.props.override_username,disablePopover:!0}):E.default.createElement(J.default,{user:this.props.user,disablePopover:!0}),l=E.default.createElement("div",{className:"col col__name bot-indicator"},"BOT")):i&&(d=E.default.createElement(J.default,{user:{},overwriteName:E.default.createElement(b.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:w.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}),u=E.default.createElement("span",{className:"post__visibility"},E.default.createElement(b.FormattedMessage,{id:"post_info.message.visible",defaultMessage:"(Only visible to you)"})));var c=void 0,f="";a.failed&&(f+=" post-failed",c=E.default.createElement(x.default,{post:this.props.post})),T.isEdited(this.props.post)&&(f+=" post--edited");var m=E.default.createElement(Y.default,{src:T.getProfilePicSrcForPost(a,this.props.user),status:o,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0});a.props&&a.props.from_webhook?m=E.default.createElement(Y.default,{src:T.getProfilePicSrcForPost(a,this.props.user),width:"36",height:"36"}):i&&(m=E.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:n}})),this.props.compactDisplay&&(m=a.props&&a.props.from_webhook?E.default.createElement(Y.default,{src:""}):E.default.createElement(Y.default,{src:"",status:o,user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}));var p=E.default.createElement("div",{className:"post__img"},m),h=null;a.file_ids&&a.file_ids.length>0&&(h=E.default.createElement(O.default,{post:a,compactDisplay:this.props.compactDisplay}));var g=void 0;r||a.failed||i||"true"!==window.mm_config.EnableEmojiPicker||(g=E.default.createElement("span",null,E.default.createElement(L.default,{show:this.state.showEmojiPicker,onHide:this.toggleEmojiPicker,target:function(){return t.refs.dotMenu},onEmojiClick:this.reactEmojiClick,rightOffset:15,spaceRequiredAbove:342,spaceRequiredBelow:342}),E.default.createElement("button",{className:"reacticon__container reaction color--link style--none",onClick:this.toggleEmojiPicker,ref:"rhs_reacticon_"+a.id},E.default.createElement("span",{className:"icon icon--emoji",dangerouslySetInnerHTML:{__html:w.default.EMOJI_ICON_SVG}}))));var v=void 0;if(r)v=E.default.createElement("div",{className:"col col__remove"},this.createRemovePostButton());else if(!i){var y=E.default.createElement(I.default,{idPrefix:w.default.RHS,idCount:s,post:this.props.post,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened});v=E.default.createElement("div",{ref:"dotMenu",className:"col col__reply"},y,g)}var S=void 0;a.is_pinned&&(S=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var _={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime};return E.default.createElement("div",{ref:"post_body_"+a.id,className:this.getClassName(a,i)},E.default.createElement("div",{className:"post__content"},p,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col col__name"},E.default.createElement("strong",null,d)),l,E.default.createElement("div",{className:"col"},this.renderTimeTag(a,_),S,E.default.createElement(B.default,{idPrefix:"rhsCommentFlag",idCount:s,postId:a.id,isFlagged:this.props.isFlagged,isEphemeral:r}),u),v),E.default.createElement("div",{className:"post__body"},E.default.createElement("div",{className:f},c,E.default.createElement(H.default,{post:a,previewCollapsed:this.props.previewCollapsed,previewEnabled:this.props.previewEnabled,isEmbedVisible:this.props.isEmbedVisible},E.default.createElement(V.default,{post:a,isRHS:!0,hasMention:!0}))),h,E.default.createElement(q.default,{post:a})))))}}]),a}(E.default.Component);X.propTypes={post:g.default.object,lastPostCount:g.default.number,user:g.default.object,currentUser:g.default.object.isRequired,compactDisplay:g.default.bool,useMilitaryTime:g.default.bool.isRequired,isFlagged:g.default.bool,status:g.default.string,isBusy:g.default.bool,removePost:g.default.func.isRequired,previewCollapsed:g.default.string.isRequired,previewEnabled:g.default.bool.isRequired,isEmbedVisible:g.default.bool},t.default=X}).call(t,a(23))},2307:function(e,t,a){"use strict";function n(e){return{actions:(0,r.bindActionCreators)({showSearchResults:i.showSearchResults,showMentions:i.showMentions,showFlaggedPosts:i.showFlaggedPosts,showPinnedPosts:i.showPinnedPosts,closeRightHandSide:i.closeRightHandSide},e)}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(26),r=a(21),i=a(219),o=a(2308),l=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=(0,s.connect)(null,n)(l.default)},2308:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(216),r=n(s),i=a(5),o=n(i),l=a(3),d=n(l),u=a(4),c=n(u),f=a(6),m=n(f),p=a(7),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(35),S=a(17),_=a(9),M=n(_),C=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.handleClose=function(e){e.preventDefault(),a.props.actions.closeRightHandSide(),a.props.shrink()},a.toggleSize=function(e){e.preventDefault(),a.props.toggleSize()},a.handleBack=function(e){if(e.preventDefault(),a.props.isWebrtc)return void a.props.actions.showSearchResults();switch(a.props.previousRhsState){case _.RHSStates.SEARCH:a.props.actions.showSearchResults();break;case _.RHSStates.MENTION:a.props.actions.showMentions();break;case _.RHSStates.FLAG:a.props.actions.showFlaggedPosts();break;case _.RHSStates.PIN:a.props.actions.showPinnedPosts()}},a.state={},a}return(0,h.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=void 0,t=b.default.createElement(y.Tooltip,{id:"closeSidebarTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=void 0;switch(this.props.previousRhsState){case _.RHSStates.SEARCH:case _.RHSStates.MENTION:a=b.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.backToResultsTooltip",defaultMessage:"Back to Search Results"}));break;case _.RHSStates.FLAG:a=b.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.backToFlaggedTooltip",defaultMessage:"Back to Flagged Posts"}));break;case _.RHSStates.PIN:a=b.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.backToPinnedTooltip",defaultMessage:"Back to Pinned Posts"}));break;default:this.props.isWebrtc&&(a=b.default.createElement(y.Tooltip,{id:"backToResultsTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.backToCallTooltip",defaultMessage:"Back to Call"})))}var n=b.default.createElement(y.Tooltip,{id:"expandSidebarTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),s=b.default.createElement(y.Tooltip,{id:"shrinkSidebarTooltip"},b.default.createElement(S.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return a&&(e=b.default.createElement("a",{href:"#",onClick:this.handleBack,className:"sidebar--right__back"},b.default.createElement(y.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},b.default.createElement("i",{className:"fa fa-angle-left"})))),b.default.createElement("div",{className:"sidebar--right__header"},b.default.createElement("span",{className:"sidebar--right__title"},e,b.default.createElement(S.FormattedMessage,{id:"rhs_header.details",defaultMessage:"Message Details"})),b.default.createElement("div",{className:"pull-right"},b.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},b.default.createElement(y.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},b.default.createElement("i",{className:"fa fa-expand"})),b.default.createElement(y.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:s},b.default.createElement("i",{className:"fa fa-compress"}))),b.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",onClick:this.handleClose},b.default.createElement(y.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},b.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(b.default.Component);C.propTypes={isWebrtc:v.default.bool,previousRhsState:v.default.oneOf((0,r.default)(_.RHSStates)),toggleSize:v.default.func,shrink:v.default.func,actions:v.default.shape({showMentions:v.default.func,showSearchResults:v.default.func,showFlaggedPosts:v.default.func,showPinnedPosts:v.default.func,closeRightHandSide:v.default.func})},t.default=C},2309:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(8),g=s(h),v=a(1),E=s(v),b=a(17),y=a(34),S=a(71),_=a(27),M=s(_),C=a(31),w=s(C),k=a(36),T=s(k),N=a(9),P=s(N),R=a(83),I=n(R),D=a(16),L=n(D),A=a(661),O=s(A),F=a(284),x=s(F),U=a(662),H=s(U),j=a(667),B=s(j),G=a(663),V=s(G),z=a(664),q=s(z),W=a(668),Y=s(W),K=a(165),J=s(K),X=a(391),Q=s(X),Z=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.toggleEmojiPicker=function(){var e=!t.state.showEmojiPicker;t.setState({showEmojiPicker:e,dropdownOpened:e})},t.getClassName=function(e,a){var n="post post--root post--thread";return M.default.getCurrentId()===e.user_id&&(n+=" current--user"),a&&(n+=" post--system"),t.props.compactDisplay&&(n+=" post--compact"),e.is_pinned&&(n+=" post--pinned"),t.state.dropdownOpened&&(n+=" post--hovered"),n},t.reactEmojiClick=t.reactEmojiClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.state={currentTeamDisplayName:T.default.getCurrent().name,width:"",height:"",showEmojiPicker:!1,testStateObj:!0,dropdownOpened:!1},t}return(0,p.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){L.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){L.updateWindowDimensions(e)})}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(e.isEmbedVisible!==this.props.isEmbedVisible||(e.previewEnabled!==this.props.previewEnabled||(!L.areObjectsEqual(e.post,this.props.post)||(!L.areObjectsEqual(e.user,this.props.user)||(!L.areObjectsEqual(e.currentUser,this.props.currentUser)||(this.state.showEmojiPicker!==t.showEmojiPicker||(this.state.dropdownOpened!==t.dropdownOpened||this.props.previewCollapsed!==e.previewCollapsed)))))))))))}},{key:"timeTag",value:function(e,t){var a=L.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"post__time",dateTime:a.toISOString(),title:a},a.toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return e.type===P.default.PostTypes.FAKE_PARENT_DELETED?null:L.isMobile()?this.timeTag(e,t):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,className:"post__permalink"},this.timeTag(e,t))}},{key:"reactEmojiClick",value:function(e){this.setState({showEmojiPicker:!1});var t=e.name||e.aliases[0];(0,S.addReaction)(this.props.post.channel_id,this.props.post.id,t),(0,S.emitEmojiPosted)(t),this.handleDropdownOpened(!1)}},{key:"handleDropdownOpened",value:function(e){this.setState({dropdownOpened:e})}},{key:"render",value:function(){var t,a=this,n=this.props.post,s=this.props.user,r=P.default.MATTERMOST_ICON_SVG,i=w.default.get(n.channel_id),o=L.isPostEphemeral(n),l=I.isSystemMessage(n);i&&(t="D"===i.type?E.default.createElement(b.FormattedMessage,{id:"rhs_root.direct",defaultMessage:"Direct Message"}):i.display_name);var d=void 0;o||n.failed||l||"true"!==window.mm_config.EnableEmojiPicker||(d=E.default.createElement("span",null,E.default.createElement(x.default,{show:this.state.showEmojiPicker,onHide:this.toggleEmojiPicker,target:function(){return a.refs.dotMenu},onEmojiClick:this.reactEmojiClick,rightOffset:15,spaceRequiredAbove:342,spaceRequiredBelow:342}),E.default.createElement("button",{className:"reacticon__container reaction color--link style--none",onClick:this.toggleEmojiPicker,ref:"rhs_root_reacticon"},E.default.createElement("span",{className:"icon icon--emoji",dangerouslySetInnerHTML:{__html:P.default.EMOJI_ICON_SVG}}))));var u=null;n.file_ids&&n.file_ids.length>0&&(u=E.default.createElement(H.default,{post:n,compactDisplay:this.props.compactDisplay}));var c=void 0,f=void 0;l?c=E.default.createElement(Q.default,{user:{},overwriteName:E.default.createElement(b.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:P.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}):n.props&&n.props.from_webhook?(c=n.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?E.default.createElement(Q.default,{user:s,overwriteName:n.props.override_username,disablePopover:!0}):E.default.createElement(Q.default,{user:s,disablePopover:!0}),f=E.default.createElement("div",{className:"col col__name bot-indicator"},"BOT")):c=E.default.createElement(Q.default,{user:s,status:this.props.status,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0});var m=this.props.status;n.props&&"true"===n.props.from_webhook&&(m=null);var p=void 0;p=l?E.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:r}}):n.props&&n.props.from_webhook?E.default.createElement(J.default,{src:I.getProfilePicSrcForPost(n,s),width:"36",height:"36"}):E.default.createElement(J.default,{src:I.getProfilePicSrcForPost(n,s),status:m,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}),this.props.compactDisplay&&(p=n.props&&n.props.from_webhook?E.default.createElement(J.default,{src:""}):E.default.createElement(J.default,{src:"",status:m,user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}));var h="";I.isEdited(this.props.post)&&(h+=" post--edited");var g=E.default.createElement("div",{className:"post__img"},p),v=void 0;n.is_pinned&&(v=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var y={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime},S=E.default.createElement(O.default,{idPrefix:P.default.RHS_ROOT,post:this.props.post,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened,commentCount:this.props.commentCount}),_=void 0;this.props.post.type!==P.default.PostTypes.FAKE_PARENT_DELETED&&(_=E.default.createElement("div",{ref:"dotMenu",className:"col col__reply"},S,d));var M=void 0;return this.props.post.type!==P.default.PostTypes.FAKE_PARENT_DELETED&&(M=E.default.createElement(V.default,{idPrefix:"rhsRootPostFlag",postId:n.id,isFlagged:this.props.isFlagged})),E.default.createElement("div",{id:"thread--root",className:this.getClassName(n,l)},E.default.createElement("div",{className:"post-right-channel__name"},t),E.default.createElement("div",{className:"post__content"},g,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col__name"},c),f,E.default.createElement("div",{className:"col"},this.renderTimeTag(n,y),v,M),_),E.default.createElement("div",{className:"post__body"},E.default.createElement("div",{className:h},E.default.createElement(B.default,{post:n,previewCollapsed:this.props.previewCollapsed,previewEnabled:this.props.previewEnabled,isEmbedVisible:this.props.isEmbedVisible},E.default.createElement(q.default,{post:n,isRHS:!0,hasMention:!0}))),u,E.default.createElement(Y.default,{post:n})))))}}]),a}(E.default.Component);Z.propTypes={post:g.default.object.isRequired,user:g.default.object.isRequired,currentUser:g.default.object.isRequired,compactDisplay:g.default.bool,useMilitaryTime:g.default.bool.isRequired,commentCount:g.default.number.isRequired,isFlagged:g.default.bool,status:g.default.string,previewCollapsed:g.default.string,previewEnabled:g.default.bool,isBusy:g.default.bool,isEmbedVisible:g.default.bool},Z.defaultProps={commentCount:0},t.default=Z}).call(t,a(23))},2310:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=void 0,t=void 0,a=void 0,n=void 0,s=void 0;return function(r){var o=(0,c.getSearchResults)(r);if(o&&o!==e){e=o,t=e.filter(function(e){return Boolean(e)}),a=new l.default;var d=t.map(function(e){return e.channel_id}),f=!0,p=!1,v=void 0;try{for(var E,y=(0,i.default)(d);!(f=(E=y.next()).done);f=!0){var S=E.value;a.has(S)||a.set(S,(0,u.getChannel)(r,S))}}catch(e){p=!0,v=e}finally{try{!f&&y.return&&y.return()}finally{if(p)throw v}}}var _=b(r,g.Preferences.CATEGORY_FLAGGED_POST);if(_!==n){n=_,s=new l.default;var M=!0,C=!1,w=void 0;try{for(var k,T=(0,i.default)(n);!(M=(k=T.next()).done);M=!0){var N=k.value;s.set(N.name,!0)}}catch(e){C=!0,w=e}finally{try{!M&&T.return&&T.return()}finally{if(C)throw w}}}return{results:t,channels:a,searchTerms:(0,h.getSearchTerms)(r),isFlaggedByPostId:s,loading:(0,h.getIsSearching)(r),compactDisplay:m.get(r,g.Preferences.CATEGORY_DISPLAY_SETTINGS,g.Preferences.MESSAGE_DISPLAY,g.Preferences.MESSAGE_DISPLAY_DEFAULT)===g.Preferences.MESSAGE_DISPLAY_COMPACT}}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(45),i=n(r),o=a(144),l=n(o),d=a(26),u=a(91),c=a(92),f=a(62),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(f),p=a(219),h=a(218),g=a(9),v=a(2311),E=n(v),b=m.makeGetCategory(),y={selectPost:p.selectPostFromRightHandSideSearch};t.default=(0,d.connect)(s,y)(E.default)},2311:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return R.default.createElement("div",(0,C.default)({},e,{className:"scrollbar--view"}))}function r(e){return R.default.createElement("div",(0,C.default)({},e,{className:"scrollbar--horizontal"}))}function i(e){return R.default.createElement("div",(0,C.default)({},e,{className:"scrollbar--vertical"}))}Object.defineProperty(t,"__esModule",{value:!0});var o=a(115),l=n(o),d=a(42),u=n(d),c=a(164),f=n(c),m=a(5),p=n(m),h=a(3),g=n(h),v=a(4),E=n(v),b=a(6),y=n(b),S=a(7),_=n(S),M=a(19),C=n(M);t.renderView=s,t.renderThumbHorizontal=r,t.renderThumbVertical=i;var w=a(0),k=n(w),T=a(8),N=n(T),P=a(1),R=n(P),I=a(17),D=a(2064),L=n(D),A=a(27),O=n(A),F=a(388),x=n(F),U=a(9),H=n(U),j=a(16),B=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(j),G=a(2312),V=n(G),z=a(2314),q=n(z),W=function(t){function a(e){(0,g.default)(this,a);var t=(0,y.default)(this,(a.__proto__||(0,p.default)(a)).call(this,e));return t.handleResize=function(){t.setState({windowWidth:B.windowWidth(),windowHeight:B.windowHeight()})},t.onUserChange=function(){t.setState({profiles:JSON.parse((0,f.default)(O.default.getProfiles()))})},t.onBusy=function(e){t.setState({isBusy:e})},t.onStatusChange=function(){t.setState({statuses:(0,u.default)({},O.default.getStatuses())})},t.resize=function(){(0,k.default)("#search-items-container").scrollTop(0)},t.state={windowWidth:B.windowWidth(),windowHeight:B.windowHeight(),profiles:JSON.parse((0,f.default)(O.default.getProfiles())),isBusy:x.default.isBusy(),statuses:(0,u.default)({},O.default.getStatuses())},t}return(0,_.default)(a,t),(0,E.default)(a,[{key:"componentDidMount",value:function(){O.default.addChangeListener(this.onUserChange),O.default.addStatusesChangeListener(this.onStatusChange),x.default.addBusyListener(this.onBusy),this.resize(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){O.default.removeChangeListener(this.onUserChange),O.default.removeStatusesChangeListener(this.onStatusChange),x.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e){this.props.searchTerms!==e.searchTerms&&this.resize()}},{key:"render",value:function(){var t=this.props.results,a=!t||0===t.length,n=this.props.searchTerms,o=this.state.profiles||{},d=H.default.FLAG_ICON_SVG,u=null;if(this.props.loading)u=R.default.createElement("div",{className:"sidebar--right__subheader"},R.default.createElement("div",{className:"sidebar--right__loading"},R.default.createElement("i",{className:"fa fa-spinner fa-spin"}),R.default.createElement(I.FormattedMessage,{id:"search_header.loading",defaultMessage:"Searching..."})));else if(this.props.isFlaggedPosts&&a){var c=[R.default.createElement("li",{key:"pin1"},R.default.createElement(I.FormattedMessage,{id:"search_results.usageFlag1",defaultMessage:"You haven't flagged any messages yet."})),R.default.createElement("li",{key:"pin2"},R.default.createElement(I.FormattedMessage,{id:"search_results.usageFlag2",defaultMessage:"You can add a flag to messages and comments by clicking the "}),R.default.createElement("span",{className:"usage__icon",dangerouslySetInnerHTML:{__html:d}}),R.default.createElement(I.FormattedMessage,{id:"search_results.usageFlag3",defaultMessage:" icon next to the timestamp."})),R.default.createElement("li",{key:"pin3"},R.default.createElement(I.FormattedMessage,{id:"search_results.usageFlag4",defaultMessage:"Flags are a way to mark messages for follow up. Your flags are personal, and cannot be seen by other users."}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&c.push(R.default.createElement("li",null,R.default.createElement(I.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),u=R.default.createElement("div",{className:"sidebar--right__subheader"},R.default.createElement("ul",null,c))}else if(this.props.isPinnedPosts&&a){var f=[R.default.createElement("li",{key:"pin1"},R.default.createElement(I.FormattedMessage,{id:"search_results.usagePin1",defaultMessage:"There are no pinned messages yet."})),R.default.createElement("li",{key:"pin2"},R.default.createElement(I.FormattedMessage,{id:"search_results.usagePin2",defaultMessage:"All members of this channel can pin important or useful messages."})),R.default.createElement("li",{key:"pin3"},R.default.createElement(I.FormattedMessage,{id:"search_results.usagePin3",defaultMessage:"Pinned messages are visible to all channel members."})),R.default.createElement("li",{key:"pin4"},R.default.createElement(I.FormattedMessage,{id:"search_results.usagePin4",defaultMessage:'To pin a message: Go to the message that you want to pin and click [...] > "Pin to channel".'}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&f.push(R.default.createElement("li",null,R.default.createElement(I.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),u=R.default.createElement("div",{className:"sidebar--right__subheader"},R.default.createElement("ul",null,f))}else if(!n&&a){var m=[R.default.createElement("li",{key:"quotes"},R.default.createElement(I.FormattedMessage,{id:"search_results.usage.phrasesSuggestion",defaultMessage:"Use {quotationMarks} to search for phrases",values:{quotationMarks:R.default.createElement("b",null,R.default.createElement(I.FormattedMessage,{id:"search_results.usage.phrasesSuggestion.quotationMarks",defaultMessage:'"quotation marks"'}))}})),R.default.createElement("li",{key:"fromIn"},R.default.createElement(I.FormattedMessage,{id:"search_results.usage.fromInSuggestion",defaultMessage:"Use {fromUser} to find posts from specific users and {inChannel} to find posts in specific channels",values:{fromUser:"from:",inChannel:"in:"}}))];u=R.default.createElement("div",{className:"sidebar--right__subheader"},R.default.createElement("ul",null,m))}else if(a){var p=[R.default.createElement("li",{key:"partialPhrase"},R.default.createElement(I.FormattedMessage,{id:"search_results.noResults.partialPhraseSuggestion",defaultMessage:'If you\'re searching a partial phrase (ex. searching "rea", looking for "reach" or "reaction"), append a * to your search term.'})),R.default.createElement("li",{key:"stopWords"},R.default.createElement(I.FormattedMessage,{id:"search_results.noResults.stopWordsSuggestion",defaultMessage:'Two letter searches and common words like "this", "a" and "is" won\'t appear in search results due to the excessive results returned.'}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&p.push(R.default.createElement("li",null,R.default.createElement(I.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),u=R.default.createElement("div",{className:"sidebar--right__subheader"},R.default.createElement("h4",null,R.default.createElement(I.FormattedMessage,{id:"search_results.noResults",defaultMessage:"No results found. Try again?"})),R.default.createElement("ul",null,p))}else{var h=void 0;this.props.isPinnedPosts?(h=[].concat((0,l.default)(t)),h.sort(function(e,t){return t.create_at-e.create_at})):h=t,u=h.map(function(e,t,a){var s=void 0;s=O.default.getCurrentId()===e.user_id?O.default.getCurrentUser():o[e.user_id];var r="offline";this.state.statuses&&(r=this.state.statuses[e.user_id]||"offline");var i=!1;this.props.isFlaggedByPostId&&(i=this.props.isFlaggedByPostId.get(e.id)||!1);var l=a.length-t-1;return R.default.createElement(q.default,{key:e.id,channel:this.props.channels.get(e.channel_id),compactDisplay:this.props.compactDisplay,post:e,lastPostCount:l>=0&&l<H.default.TEST_ID_COUNT?l:-1,user:s,term:n,isMentionSearch:this.props.isMentionSearch,isFlaggedSearch:this.props.isFlaggedPosts,useMilitaryTime:this.props.useMilitaryTime,shrink:this.props.shrink,isFlagged:i,isBusy:this.state.isBusy,status:r,onSelect:this.props.selectPost})},this)}return R.default.createElement("div",{className:"sidebar-right__body"},R.default.createElement(V.default,{isMentionSearch:this.props.isMentionSearch,toggleSize:this.props.toggleSize,shrink:this.props.shrink,isFlaggedPosts:this.props.isFlaggedPosts,isPinnedPosts:this.props.isPinnedPosts,channelDisplayName:this.props.channelDisplayName,isLoading:this.props.loading}),R.default.createElement(L.default,{autoHide:!0,autoHideTimeout:500,autoHideDuration:500,renderThumbHorizontal:r,renderThumbVertical:i,renderView:s,onScroll:this.handleScroll},R.default.createElement("div",{id:"search-items-container",className:"search-items-container"},u)))}}]),a}(R.default.PureComponent);W.propTypes={results:N.default.array,channels:N.default.object,searchTerms:N.default.string,isFlaggedByPostId:N.default.object,loading:N.default.bool,compactDisplay:N.default.bool,useMilitaryTime:N.default.bool.isRequired,toggleSize:N.default.func,shrink:N.default.func,isMentionSearch:N.default.bool,isFlaggedPosts:N.default.bool,isPinnedPosts:N.default.bool,channelDisplayName:N.default.string.isRequired,selectPost:N.default.func},t.default=W}).call(t,a(23))},2312:function(e,t,a){"use strict";function n(e){return{actions:(0,r.bindActionCreators)({closeRightHandSide:i.closeRightHandSide},e)}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(26),r=a(21),i=a(219),o=a(2313),l=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=(0,s.connect)(null,n)(l.default)},2313:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(35),b=a(17),y=a(9),S=n(y),_=function(e){function t(){var e,a,n,s;(0,o.default)(this,t);for(var i=arguments.length,l=Array(i),d=0;d<i;d++)l[d]=arguments[d];return a=n=(0,c.default)(this,(e=t.__proto__||(0,r.default)(t)).call.apply(e,[this].concat(l))),n.handleClose=function(e){e.preventDefault(),n.props.actions.closeRightHandSide(),n.props.shrink()},n.toggleSize=function(e){e.preventDefault(),n.props.toggleSize()},s=a,(0,c.default)(n,s)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=v.default.createElement(b.FormattedMessage,{id:"search_header.results",defaultMessage:"Search Results"}),t=v.default.createElement(E.Tooltip,{id:"closeSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=v.default.createElement(E.Tooltip,{id:"expandSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),n=v.default.createElement(E.Tooltip,{id:"shrinkSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return this.props.isMentionSearch?e=v.default.createElement(b.FormattedMessage,{id:"search_header.title2",defaultMessage:"Recent Mentions"}):this.props.isFlaggedPosts?e=v.default.createElement(b.FormattedMessage,{id:"search_header.title3",defaultMessage:"Flagged Posts"}):this.props.isPinnedPosts&&(e=v.default.createElement(b.FormattedMessage,{id:"search_header.title4",defaultMessage:"Pinned posts in {channelDisplayName}",values:{channelDisplayName:this.props.channelDisplayName}})),v.default.createElement("div",{className:"sidebar--right__header"},v.default.createElement("span",{className:"sidebar--right__title"},e),v.default.createElement("div",{className:"pull-right"},v.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:S.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},v.default.createElement("i",{className:"fa fa-expand"})),v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:S.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},v.default.createElement("i",{className:"fa fa-compress"}))),v.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:this.handleClose},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:S.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},v.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(v.default.Component);_.propTypes={isMentionSearch:h.default.bool,isFlaggedPosts:h.default.bool,isPinnedPosts:h.default.bool,toggleSize:h.default.func,shrink:h.default.func,channelDisplayName:h.default.string.isRequired,actions:h.default.shape({closeRightHandSide:h.default.func})},t.default=_},2314:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(8),g=s(h),v=a(1),E=s(v),b=a(17),y=a(34),S=a(56),_=n(S),M=a(664),C=s(M),w=a(662),k=s(w),T=a(706),N=s(T),P=a(661),R=s(P),I=a(663),D=s(I),L=a(36),A=s(L),O=a(9),F=s(O),x=a(83),U=n(x),H=a(16),j=n(H),B=a(165),G=s(B),V=a(391),z=s(V),q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.onUpdateWindowDimensions=function(){j.updateWindowDimensions(t)},t.handleDropdownOpened=function(e){t.setState({dropdownOpened:e})},t.getClassName=function(){var e="post post--thread";return t.props.compactDisplay&&(e+=" post--compact"),t.state.dropdownOpened&&(e+=" post--hovered"),e},t.handleFocusRHSClick=t.handleFocusRHSClick.bind(t),t.handleJumpClick=t.handleJumpClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.shrinkSidebar=t.shrinkSidebar.bind(t),t.state={currentTeamDisplayName:A.default.getCurrent().name,width:"",height:"",dropdownOpened:!1},t}return(0,p.default)(a,t),(0,u.default)(a,[{key:"shouldComponentUpdate",value:function(e,t){return!j.areObjectsEqual(t.post,this.props.post)||(e.isFlagged!==this.props.isFlagged||t.dropdownOpened!==this.state.dropdownOpened)}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onUpdateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onUpdateWindowDimensions)}},{key:"shrinkSidebar",value:function(){var e=this;setTimeout(function(){e.props.shrink()})}},{key:"handleFocusRHSClick",value:function(e){e.preventDefault(),this.props.onSelect(this.props.post)}},{key:"handleJumpClick",value:function(){j.isMobile()&&_.emitCloseRightHandSide(),this.shrinkSidebar(),y.browserHistory.push(A.default.getCurrentTeamRelativeUrl()+"/pl/"+this.props.post.id)}},{key:"timeTag",value:function(e){var t=j.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"search-item-time",dateTime:t.toISOString(),title:t},E.default.createElement(b.FormattedDate,{value:e.create_at,hour12:!this.props.useMilitaryTime,hour:"2-digit",minute:"2-digit"}))}},{key:"renderTimeTag",value:function(e){return j.isMobile()?this.timeTag(e):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e))}},{key:"render",value:function(){var t=null,a=this.props.channel,n=this.props.user||{},s=this.props.post,r=-1;this.props.lastPostCount>=0&&this.props.lastPostCount<F.default.TEST_ID_COUNT&&(r=this.props.lastPostCount),a&&(t=a.display_name,"D"===a.type&&(t=E.default.createElement(b.FormattedMessage,{id:"search_item.direct",defaultMessage:"Direct Message (with {username})",values:{username:j.displayUsernameForUser(j.getDirectTeammate(a.id))}})));var i=void 0,o=!1;s.props&&s.props.from_webhook&&s.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride&&(i=s.props.override_username,o=!0);var l=void 0;s.props&&s.props.from_webhook&&(l=E.default.createElement("div",{className:"bot-indicator"},F.default.BOT_NAME));var d=E.default.createElement(G.default,{src:U.getProfilePicSrcForPost(s,n),user:this.props.user,status:this.props.status,isBusy:this.props.isBusy}),u=E.default.createElement("div",{className:"post__img"},d),c="";U.isEdited(this.props.post)&&(c+=" post--edited");var f=null;s.file_ids&&s.file_ids.length>0&&(f=E.default.createElement(k.default,{post:s,compactDisplay:this.props.compactDisplay}));var m=void 0,p=void 0,h=void 0;s.state===F.default.POST_DELETED?m=E.default.createElement("p",null,E.default.createElement(b.FormattedMessage,{id:"post_body.deleted",defaultMessage:"(message deleted)"})):(p=E.default.createElement(D.default,{idPrefix:"searchPostFlag",idCount:r,postId:s.id,isFlagged:this.props.isFlagged}),h=E.default.createElement("div",{className:"col__controls"},E.default.createElement(R.default,{idPrefix:F.default.SEARCH_POST,idCount:r,post:s,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened}),E.default.createElement(N.default,{idPrefix:"searchCommentIcon",idCount:r,handleCommentClick:this.handleFocusRHSClick,searchStyle:"search-item__comment"}),E.default.createElement("a",{onClick:this.handleJumpClick,className:"search-item__jump"},E.default.createElement(b.FormattedMessage,{id:"search_item.jump",defaultMessage:"Jump"}))),m=E.default.createElement(C.default,{post:s,options:{searchTerm:this.props.term,mentionHighlight:this.props.isMentionSearch}}));var g=void 0;return s.is_pinned&&(g=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"}))),E.default.createElement("div",{className:"search-item__container"},E.default.createElement("div",{className:"date-separator"},E.default.createElement("hr",{className:"separator__hr"}),E.default.createElement("div",{className:"separator__text"},E.default.createElement(b.FormattedDate,{value:s.create_at,day:"numeric",month:"long",year:"numeric"}))),E.default.createElement("div",{className:this.getClassName()},E.default.createElement("div",{className:"search-channel__name"},t),E.default.createElement("div",{className:"post__content"},u,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col col__name"},E.default.createElement("strong",null,E.default.createElement(z.default,{user:n,overwriteName:i,disablePopover:o,status:this.props.status,isBusy:this.props.isBusy}))),l,E.default.createElement("div",{className:"col"},this.renderTimeTag(s),g,p),h),E.default.createElement("div",{className:"search-item-snippet post__body"},E.default.createElement("div",{className:c},m,f))))))}}]),a}(E.default.Component);q.propTypes={post:g.default.object,lastPostCount:g.default.number,user:g.default.object,channel:g.default.object,compactDisplay:g.default.bool,isMentionSearch:g.default.bool,isFlaggedSearch:g.default.bool,term:g.default.string,useMilitaryTime:g.default.bool.isRequired,shrink:g.default.func,isFlagged:g.default.bool,isBusy:g.default.bool,status:g.default.string,onSelect:g.default.func},t.default=q}).call(t,a(23))},2315:function(e,t,a){"use strict";function n(e){return{isMentionSearch:(0,l.getRhsState)(e)===d.RHSStates.MENTION}}function s(e){return{actions:(0,i.bindActionCreators)({showMentions:o.showMentions,showFlaggedPosts:o.showFlaggedPosts,closeRightHandSide:o.closeRightHandSide},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(26),i=a(21),o=a(219),l=a(218),d=a(9),u=a(2316),c=function(e){return e&&e.__esModule?e:{default:e}}(u);t.default=(0,r.connect)(n,s)(c.default)},2316:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),i=s(r),o=a(5),l=s(o),d=a(3),u=s(d),c=a(4),f=s(c),m=a(6),p=s(m),h=a(7),g=s(h),v=a(8),E=s(v),b=a(1),y=s(b),S=a(17),_=a(34),M=a(56),C=n(M),w=a(113),k=s(w),T=a(36),N=s(T),P=a(27),R=s(P),I=a(388),D=s(I),L=a(9),A=a(70),O=a(73),F=n(O),x=a(16),U=n(x),H=a(1958),j=s(H),B=a(1965),G=s(B),V=a(670),z=s(V),q=a(660),W=a(659),Y=s(W),K=L.Constants.Preferences,J=L.Constants.TutorialSteps,X=function(t){function a(e){(0,u.default)(this,a);var t=(0,p.default)(this,(a.__proto__||(0,l.default)(a)).call(this,e));return t.handleClick=function(e){D.default.isBusy()&&(D.default.emitChanged({action:L.WebrtcActionTypes.IN_PROGRESS}),e.preventDefault())},t.handleAboutModal=function(){t.setState({showAboutModal:!0})},t.aboutModalDismissed=function(){t.setState({showAboutModal:!1})},t.showAddUsersToTeamModal=function(e){e.preventDefault(),t.setState({showAddUsersToTeamModal:!0,showDropdown:!1})},t.hideAddUsersToTeamModal=function(){t.setState({showAddUsersToTeamModal:!1})},t.getFlagged=function(e){e.preventDefault(),t.props.actions.showFlaggedPosts(),t.closeRightSidebar()},t.getStateFromStores=function(){var e=k.default.getInt(K.TUTORIAL_STEP,R.default.getCurrentId(),999);return{currentUser:R.default.getCurrentUser(),teamMembers:N.default.getMyTeamMembers(),teamListings:N.default.getTeamListings(),showTutorialTip:e===J.MENU_POPOVER&&U.isMobile()}},t.onChange=function(){t.setState(t.getStateFromStores())},t.searchMentions=function(e){e.preventDefault(),t.props.isMentionSearch?t.props.actions.closeRightHandSide():(t.closeRightSidebar(),t.props.actions.showMentions())},t.closeLeftSidebar=function(){U.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.remove("move--right"),document.querySelector(".app__body .sidebar--left").classList.remove("move--right")})},t.openRightSidebar=function(){U.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.add("move--left-small"),document.querySelector(".app__body .sidebar--menu").classList.add("move--left")})},t.closeRightSidebar=function(){U.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.remove("move--left-small"),document.querySelector(".app__body .sidebar--menu").classList.remove("move--left")})},t.state=(0,i.default)({},t.getStateFromStores(),{showAboutModal:!1,showAddUsersToTeamModal:!1}),t}return(0,g.default)(a,t),(0,f.default)(a,[{key:"componentDidMount",value:function(){N.default.addChangeListener(this.onChange),k.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){N.default.removeChangeListener(this.onChange),k.default.removeChangeListener(this.onChange)}},{key:"render",value:function(){var t=R.default.getCurrentUser(),a=void 0,n=void 0,s=void 0,r=void 0,i=void 0,o=void 0,l=void 0,d=!1,u=!1,c=null;if(null!=t){d=N.default.isTeamAdminForCurrentTeam()||R.default.isSystemAdminForCurrentUser(),u=R.default.isSystemAdminForCurrentUser(),n=y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:C.showInviteMemberModal},y.default.createElement("i",{className:"icon fa fa-user-plus"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.inviteNew",defaultMessage:"Send Email Invite"}))),s=y.default.createElement("li",null,y.default.createElement("a",{id:"addUsersToTeam",href:"#",onClick:this.showAddUsersToTeamModal},y.default.createElement("i",{className:"icon fa fa-user-plus"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.addMemberToTeam",defaultMessage:"Add Members to Team"}))),this.props.teamType===L.Constants.OPEN_TEAM&&"true"===e.mm_config.EnableUserCreation&&(a=y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:C.showGetTeamInviteLinkModal},y.default.createElement("i",{className:"icon fa fa-link"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.teamLink",defaultMessage:"Get Team Invite Link"})))),"true"===e.window.mm_license.IsLicensed&&(e.window.mm_config.RestrictTeamInvite!==L.Constants.PERMISSIONS_SYSTEM_ADMIN||u?e.window.mm_config.RestrictTeamInvite!==L.Constants.PERMISSIONS_TEAM_ADMIN||d||(a=null,n=null,s=null):(a=null,n=null,s=null));var f=!1,m=this.state.teamMembers.reduce(function(e,t){return e[t.team_id]=!0,e},{});for(var p in this.state.teamListings)if(this.state.teamListings.hasOwnProperty(p)&&!m[p]){f=!0;break}f&&(l=y.default.createElement("li",{key:"joinTeam_li"},y.default.createElement(_.Link,{to:"/select_team"},y.default.createElement("i",{className:"icon fa fa-plus-square"}),y.default.createElement(S.FormattedMessage,{id:"navbar_dropdown.join",defaultMessage:"Join Another Team"})))),("true"===e.window.mm_config.EnableTeamCreation||u)&&(c=y.default.createElement("li",{key:"newTeam_li"},y.default.createElement(_.Link,{id:"createTeam",key:"newTeam_a",to:"/create_team",onClick:this.handleClick},y.default.createElement("i",{className:"icon fa fa-plus-square"}),y.default.createElement(S.FormattedMessage,{id:"navbar_dropdown.create",defaultMessage:"Create a New Team"}))))}i=y.default.createElement("li",null,y.default.createElement(Y.default,{dialogType:z.default},y.default.createElement("i",{className:"icon fa fa-users"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.viewMembers",defaultMessage:"View Members"})));var h=y.default.createElement("li",{key:"leaveTeam_li"},y.default.createElement("a",{id:"leaveTeam",href:"#",onClick:C.showLeaveTeamModal},y.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:L.Constants.LEAVE_TEAM_SVG}}),y.default.createElement(S.FormattedMessage,{id:"navbar_dropdown.leave",defaultMessage:"Leave Team"})));d&&(r=y.default.createElement("li",null,y.default.createElement("a",{href:"#","data-toggle":"modal","data-target":"#team_settings"},y.default.createElement("i",{className:"icon fa fa-globe"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.teamSettings",defaultMessage:"Team Settings"}))),i=y.default.createElement("li",null,y.default.createElement(Y.default,{dialogType:z.default,dialogProps:{isAdmin:d}},y.default.createElement("i",{className:"icon fa fa-users"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.manageMembers",defaultMessage:"Manage Members"})))),u&&!U.isMobile()&&(o=y.default.createElement("li",null,y.default.createElement(_.Link,{to:"/admin_console",onClick:this.handleClick},y.default.createElement("i",{className:"icon fa fa-wrench"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.console",defaultMessage:"System Console"}))));var g="";null!=e.window.mm_config.SiteName&&(g=e.window.mm_config.SiteName);var v=g;this.props.teamDisplayName&&(v=this.props.teamDisplayName);var E=null;e.window.mm_config.HelpLink&&(E=y.default.createElement("li",null,y.default.createElement(_.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.HelpLink},y.default.createElement("i",{className:"icon fa fa-question"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.help",defaultMessage:"Help"}))));var b=null;e.window.mm_config.ReportAProblemLink&&(b=y.default.createElement("li",null,y.default.createElement(_.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.ReportAProblemLink},y.default.createElement("i",{className:"icon fa fa-phone"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.report",defaultMessage:"Report a Problem"}))));var M=null;this.state.showTutorialTip&&(M=(0,q.createMenuTip)(function(e){return e.preventDefault()},!0),this.closeLeftSidebar(),this.openRightSidebar());var w=null;e.window.mm_config.AppDownloadLink&&!F.isMobileApp()&&(w=y.default.createElement("li",null,y.default.createElement(_.Link,{target:"_blank",rel:"noopener noreferrer",to:(0,A.useSafeUrl)(e.window.mm_config.AppDownloadLink)},y.default.createElement("i",{className:"icon fa fa-mobile"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.nativeApps",defaultMessage:"Download Apps"}))));var k=void 0;this.state.showAddUsersToTeamModal&&(k=y.default.createElement(G.default,{onModalDismissed:this.hideAddUsersToTeamModal}));var T=null;(r||i||l||c||h)&&(T=y.default.createElement("li",{className:"divider"}));var P=null;return o&&(P=y.default.createElement("li",{className:"divider"})),y.default.createElement("div",{className:"sidebar--menu",id:"sidebar-menu"},y.default.createElement("div",{className:"team__header theme"},y.default.createElement(_.Link,{className:"team__name",to:"/channels/town-square"},v)),y.default.createElement("div",{className:"nav-pills__container"},M,y.default.createElement("ul",{className:"nav nav-pills nav-stacked"},y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:this.searchMentions},y.default.createElement("i",{className:"icon mentions"},"@"),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.recentMentions",defaultMessage:"Recent Mentions"}))),y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:this.getFlagged},y.default.createElement("i",{className:"icon fa fa-flag"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.flagged",defaultMessage:"Flagged Posts"}))),y.default.createElement("li",{className:"divider"}),y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:function(){return C.showAccountSettingsModal()}},y.default.createElement("i",{className:"icon fa fa-cog"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.accountSettings",defaultMessage:"Account Settings"}))),y.default.createElement("li",{className:"divider"}),n,a,s,T,r,i,c,l,h,P,o,y.default.createElement("li",{className:"divider"}),E,b,w,y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:this.handleAboutModal},y.default.createElement("i",{className:"icon fa fa-info"}),y.default.createElement(S.FormattedMessage,{id:"navbar_dropdown.about",defaultMessage:"About Mattermost"}))),y.default.createElement("li",{className:"divider"}),y.default.createElement("li",null,y.default.createElement("a",{href:"#",onClick:function(){return C.emitUserLoggedOutEvent()}},y.default.createElement("i",{className:"icon fa fa-sign-out"}),y.default.createElement(S.FormattedMessage,{id:"sidebar_right_menu.logout",defaultMessage:"Logout"}))))),y.default.createElement(j.default,{show:this.state.showAboutModal,onModalDismissed:this.aboutModalDismissed}),k)}}]),a}(y.default.Component);X.propTypes={teamType:E.default.string,teamDisplayName:E.default.string,isMentionSearch:E.default.bool,actions:E.default.shape({showMentions:E.default.func,showFlaggedPosts:E.default.func,closeRightHandSide:E.default.func})},t.default=X}).call(t,a(23))},2317:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(1),v=n(g),E=a(41),b=n(E),y=a(17),S=a(16),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(S),M=a(2066),C=n(M),w=a(2318),k=n(w),T=(0,y.defineMessages)({generalTab:{id:"team_settings_modal.generalTab",defaultMessage:"General"},importTab:{id:"team_settings_modal.importTab",defaultMessage:"Import"}}),N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.updateTab=a.updateTab.bind(a),a.updateSection=a.updateSection.bind(a),a.state={activeTab:"general",activeSection:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){var e=(0,h.default)(b.default.findDOMNode(this.refs.modal));e.on("click",".modal-back",function(){(0,h.default)(this).closest(".modal-dialog").removeClass("display--content"),(0,h.default)(this).closest(".modal-dialog").find(".settings-table .nav li.active").removeClass("active")}),e.on("click",".modal-header .close",function(){setTimeout(function(){(0,h.default)(".modal-dialog.display--content").removeClass("display--content")},500)}),_.isMobile()||(0,h.default)(".settings-modal .settings-content").perfectScrollbar()}},{key:"updateTab",value:function(e){this.setState({activeTab:e,activeSection:""}),_.isMobile()||(0,h.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update")}},{key:"updateSection",value:function(e){(0,h.default)(".section-max").length&&(0,h.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState({activeSection:e})}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=[];return t.push({name:"general",uiName:e(T.generalTab),icon:"icon fa fa-cog"}),t.push({name:"import",uiName:e(T.importTab),icon:"icon fa fa-upload"}),v.default.createElement("div",{className:"modal fade",ref:"modal",id:"team_settings",role:"dialog",tabIndex:"-1","aria-hidden":"true"},v.default.createElement("div",{className:"modal-dialog settings-modal"},v.default.createElement("div",{className:"modal-content"},v.default.createElement("div",{className:"modal-header"},v.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},v.default.createElement("span",{"aria-hidden":"true"},"×")),v.default.createElement("h4",{className:"modal-title",ref:"title"},v.default.createElement(y.FormattedMessage,{id:"team_settings_modal.title",defaultMessage:"Team Settings"}))),v.default.createElement("div",{className:"modal-body settings-modal__body"},v.default.createElement("div",{className:"settings-table"},v.default.createElement("div",{className:"settings-links"},v.default.createElement(C.default,{tabs:t,activeTab:this.state.activeTab,updateTab:this.updateTab})),v.default.createElement("div",{className:"settings-content minimize-settings"},v.default.createElement(k.default,{activeTab:this.state.activeTab,activeSection:this.state.activeSection,updateSection:this.updateSection})))))))}}]),t}(v.default.Component);N.propTypes={intl:y.intlShape.isRequired},t.default=(0,y.injectIntl)(N)},2318:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(36),b=n(E),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(2319),M=n(_),C=a(2320),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onChange=a.onChange.bind(a),a.state={team:b.default.getCurrent()},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){b.default.removeChangeListener(this.onChange)}},{key:"onChange",value:function(){var e=b.default.getCurrent();S.areObjectsEqual(this.state.team,e)||this.setState({team:e})}},{key:"render",value:function(){if(!this.state.team)return null;var e;switch(this.props.activeTab){case"general":e=v.default.createElement("div",null,v.default.createElement(M.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;case"import":e=v.default.createElement("div",null,v.default.createElement(w.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;default:e=v.default.createElement("div",null)}return e}}]),t}(v.default.Component);t.default=k,k.defaultProps={activeTab:"",activeSection:""},k.propTypes={activeTab:h.default.string.isRequired,activeSection:h.default.string.isRequired,updateSection:h.default.func.isRequired}},2319:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),r=n(s),i=a(5),o=n(i),l=a(3),d=n(l),u=a(4),c=n(u),f=a(6),m=n(f),p=a(7),h=n(p),g=a(0),v=n(g),E=a(8),b=n(E),y=a(1),S=n(y),_=a(17),M=a(387),C=a(9),w=n(C),k=a(16),T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(k),N=a(653),P=n(N),R=a(654),I=n(R),D=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.updateSection=a.updateSection.bind(a),a.handleNameSubmit=a.handleNameSubmit.bind(a),a.handleInviteIdSubmit=a.handleInviteIdSubmit.bind(a),a.handleOpenInviteSubmit=a.handleOpenInviteSubmit.bind(a),a.handleDescriptionSubmit=a.handleDescriptionSubmit.bind(a),a.handleClose=a.handleClose.bind(a),a.onUpdateNameSection=a.onUpdateNameSection.bind(a),a.updateName=a.updateName.bind(a),a.updateDescription=a.updateDescription.bind(a),a.onUpdateDescriptionSection=a.onUpdateDescriptionSection.bind(a),a.onUpdateInviteIdSection=a.onUpdateInviteIdSection.bind(a),a.updateInviteId=a.updateInviteId.bind(a),a.onUpdateOpenInviteSection=a.onUpdateOpenInviteSection.bind(a),a.handleOpenInviteRadio=a.handleOpenInviteRadio.bind(a),a.handleGenerateInviteId=a.handleGenerateInviteId.bind(a),a.state=a.setupInitialState(e),a}return(0,h.default)(t,e),(0,c.default)(t,[{key:"updateSection",value:function(e){(0,v.default)(".section-max").length&&(0,v.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState(this.setupInitialState(this.props)),this.props.updateSection(e)}},{key:"setupInitialState",value:function(e){var t=e.team;return{name:t.display_name,invite_id:t.invite_id,allow_open_invite:t.allow_open_invite,description:t.description,serverError:"",clientError:""}}},{key:"componentWillReceiveProps",value:function(e){this.setState({name:e.team.display_name,description:e.team.description,invite_id:e.team.invite_id,allow_open_invite:e.team.allow_open_invite})}},{key:"handleGenerateInviteId",value:function(e){e.preventDefault();for(var t="",a=0;a<32;a++)t+=Math.floor(16*Math.random()).toString(16);this.setState({invite_id:t})}},{key:"handleOpenInviteRadio",value:function(e){this.setState({allow_open_invite:e})}},{key:"handleOpenInviteSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=(0,r.default)({},this.props.team);n.allow_open_invite=this.state.allow_open_invite,(0,M.updateTeam)(n,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}},{key:"handleNameSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.name.trim()?a.clientError="":(a.clientError=T.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var s=(0,r.default)({},this.props.team);s.display_name=this.state.name,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleInviteIdSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.invite_id.trim()?a.clientError="":(a.clientError=T.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var s=(0,r.default)({},this.props.team);s.invite_id=this.state.invite_id,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleClose",value:function(){this.updateSection("")}},{key:"handleDescriptionSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.description.trim()===this.props.team.description?(a.clientError=T.localizeMessage("general_tab.chooseDescription","Please choose a new description for your team"),n=!1):a.clientError="",this.setState(a),n){var s=(0,r.default)({},this.props.team);s.description=this.state.description,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"componentDidMount",value:function(){(0,v.default)("#team_settings").on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,v.default)("#team_settings").off("hidden.bs.modal",this.handleClose)}},{key:"onUpdateNameSection",value:function(e){e.preventDefault(),"name"===this.props.activeSection?this.updateSection(""):this.updateSection("name")}},{key:"onUpdateDescriptionSection",value:function(e){e.preventDefault(),"description"===this.props.activeSection?this.updateSection(""):this.updateSection("description")}},{key:"onUpdateInviteIdSection",value:function(e){e.preventDefault(),"invite_id"===this.props.activeSection?this.updateSection(""):this.updateSection("invite_id")}},{key:"onUpdateOpenInviteSection",value:function(e){e.preventDefault(),"open_invite"===this.props.activeSection?this.updateSection(""):this.updateSection("open_invite")}},{key:"updateName",value:function(e){this.setState({name:e.target.value})}},{key:"updateDescription",value:function(e){this.setState({description:e.target.value})}},{key:"updateInviteId",value:function(e){this.setState({invite_id:e.target.value})}},{key:"render",value:function(){var e=null,t=null;this.state.clientError&&(e=this.state.clientError),this.state.serverError&&(t=this.state.serverError);var a=void 0;if("open_invite"===this.props.activeSection){var n=[S.default.createElement("div",{key:"userOpenInviteOptions"},S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:"teamOpenInvite",name:"userOpenInviteOptions",type:"radio",defaultChecked:this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!0)}),S.default.createElement(_.FormattedMessage,{id:"general_tab.yes",defaultMessage:"Yes"})),S.default.createElement("br",null)),S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:"teamOpenInviteNo",name:"userOpenInviteOptions",type:"radio",defaultChecked:!this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!1)}),S.default.createElement(_.FormattedMessage,{id:"general_tab.no",defaultMessage:"No"})),S.default.createElement("br",null)),S.default.createElement("div",null,S.default.createElement("br",null),S.default.createElement(_.FormattedMessage,{id:"general_tab.openInviteDesc",defaultMessage:"When allowed, a link to this team will be included on the landing page allowing anyone with an account to join this team."})))];a=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),inputs:n,submit:this.handleOpenInviteSubmit,server_error:t,updateSection:this.onUpdateOpenInviteSection})}else{var s="";s=!0===this.state.allow_open_invite?T.localizeMessage("general_tab.yes","Yes"):T.localizeMessage("general_tab.no","No"),a=S.default.createElement(I.default,{title:T.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),describe:s,updateSection:this.onUpdateOpenInviteSection})}var r=void 0;if("invite_id"===this.props.activeSection){var i=[];i.push(S.default.createElement("div",{key:"teamInviteSetting"},S.default.createElement("div",{className:"row"},S.default.createElement("label",{className:"col-sm-5 control-label visible-xs-block"}),S.default.createElement("div",{className:"col-sm-12"},S.default.createElement("input",{id:"teamInviteId",className:"form-control",type:"text",onChange:this.updateInviteId,value:this.state.invite_id,maxLength:"32"}),S.default.createElement("div",{className:"padding-top x2"},S.default.createElement("button",{id:"teamInviteIdRegenerate",className:"color--link style--none",onClick:this.handleGenerateInviteId},S.default.createElement(_.FormattedMessage,{id:"general_tab.regenerate",defaultMessage:"Regenerate"}))))),S.default.createElement("div",{className:"setting-list__hint"},S.default.createElement(_.FormattedMessage,{id:"general_tab.codeLongDesc",defaultMessage:"The Invite Code is used as part of the URL in the team invitation link created by {getTeamInviteLink} in the main menu. Regenerating creates a new team invitation link and invalidates the previous link.",values:{getTeamInviteLink:S.default.createElement("strong",null,S.default.createElement(_.FormattedMessage,{id:"general_tab.getTeamInviteLink",defaultMessage:"Get Team Invite Link"}))}})))),r=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.codeTitle","Invite Code"),inputs:i,submit:this.handleInviteIdSubmit,server_error:t,client_error:e,updateSection:this.onUpdateInviteIdSection})}else r=S.default.createElement(I.default,{title:T.localizeMessage("general_tab.codeTitle","Invite Code"),describe:T.localizeMessage("general_tab.codeDesc","Click 'Edit' to regenerate Invite Code."),updateSection:this.onUpdateInviteIdSection});var o=void 0;if("name"===this.props.activeSection){var l=[],d=S.default.createElement(_.FormattedMessage,{id:"general_tab.teamName",defaultMessage:"Team Name"});T.isMobile()&&(d=""),l.push(S.default.createElement("div",{key:"teamNameSetting",className:"form-group"},S.default.createElement("label",{className:"col-sm-5 control-label"},d),S.default.createElement("div",{className:"col-sm-7"},S.default.createElement("input",{id:"teamName",className:"form-control",type:"text",maxLength:w.default.MAX_TEAMNAME_LENGTH.toString(),onChange:this.updateName,value:this.state.name}))));var u=S.default.createElement("span",null,T.localizeMessage("general_tab.teamNameInfo","Set the name of the team as it appears on your sign-in screen and at the top of the left-hand sidebar."));o=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.teamName","Team Name"),inputs:l,submit:this.handleNameSubmit,server_error:t,client_error:e,updateSection:this.onUpdateNameSection,extraInfo:u})}else{var c=this.state.name;o=S.default.createElement(I.default,{title:T.localizeMessage("general_tab.teamName","Team Name"),describe:c,updateSection:this.onUpdateNameSection})}var f=void 0;if("description"===this.props.activeSection){var m=[],p=S.default.createElement(_.FormattedMessage,{id:"general_tab.teamDescription",defaultMessage:"Team Description"});T.isMobile()&&(p=""),m.push(S.default.createElement("div",{key:"teamDescriptionSetting",className:"form-group"},S.default.createElement("label",{className:"col-sm-5 control-label"},p),S.default.createElement("div",{className:"col-sm-7"},S.default.createElement("input",{id:"teamDescription",className:"form-control",type:"text",maxLength:w.default.MAX_TEAMDESCRIPTION_LENGTH.toString(),onChange:this.updateDescription,value:this.state.description}))));var h=S.default.createElement("span",null,T.localizeMessage("general_tab.teamDescriptionInfo","Team description provides additional information to help users select the right team. Maximum of 50 characters."));f=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.teamDescription","Team Description"),inputs:m,submit:this.handleDescriptionSubmit,server_error:t,client_error:e,updateSection:this.onUpdateDescriptionSection,extraInfo:h})}else{var g="";g=this.state.description?this.state.description:S.default.createElement(_.FormattedMessage,{id:"general_tab.emptyDescription",defaultMessage:"Click 'Edit' to add a team description."}),f=S.default.createElement(I.default,{title:T.localizeMessage("general_tab.teamDescription","Team Description"),describe:g,updateSection:this.onUpdateDescriptionSection})}return S.default.createElement("div",null,S.default.createElement("div",{className:"modal-header"},S.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},S.default.createElement("span",{"aria-hidden":"true"},"×")),S.default.createElement("h4",{className:"modal-title",ref:"title"},S.default.createElement("div",{className:"modal-back"},S.default.createElement("i",{className:"fa fa-angle-left"})),S.default.createElement(_.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"}))),S.default.createElement("div",{ref:"wrapper",className:"user-settings"},S.default.createElement("h3",{className:"tab-header"},S.default.createElement(_.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"})),S.default.createElement("div",{className:"divider-dark first"}),o,S.default.createElement("div",{className:"divider-light"}),f,S.default.createElement("div",{className:"divider-light"}),a,S.default.createElement("div",{className:"divider-light"}),r,S.default.createElement("div",{className:"divider-dark"})))}}]),t}(S.default.Component);D.propTypes={updateSection:b.default.func.isRequired,team:b.default.object.isRequired,activeSection:b.default.string.isRequired},t.default=D},2320:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(17),v=a(16),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(2321),y=n(b),S=(0,g.defineMessages)({importSlack:{id:"team_import_tab.importSlack",defaultMessage:"Import from Slack (Beta)"}}),_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onImportFailure=a.onImportFailure.bind(a),a.onImportSuccess=a.onImportSuccess.bind(a),a.doImportSlack=a.doImportSlack.bind(a),a.state={status:"ready",link:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"onImportFailure",value:function(){this.setState({status:"fail"})}},{key:"onImportSuccess",value:function(e){this.setState({status:"done",link:"data:application/octet-stream;charset=utf-8,"+encodeURIComponent(atob(e.results))})}},{key:"doImportSlack",value:function(e){this.setState({status:"in-progress",link:""}),E.importSlack(e,this.onImportSuccess,this.onImportFailure)}},{key:"render",value:function(){var e,t=this.props.intl.formatMessage,a=h.default.createElement("a",{href:"https://docs.mattermost.com/administration/migrating.html#migrating-from-slack",target:"_blank",rel:"noopener noreferrer"},h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpDocsLink",defaultMessage:"documentation"})),n=h.default.createElement("strong",null,h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpExportInstructions",defaultMessage:"Slack > Team Settings > Import/Export Data > Export > Start Export"})),s=h.default.createElement("a",{href:"https://github.com/grundleborg/slack-advanced-exporter",target:"_blank",rel:"noopener noreferrer"},h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpExporterLink",defaultMessage:"Slack Advanced Exporter"})),r=h.default.createElement("div",null,h.default.createElement("p",null,h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine1",defaultMessage:"Slack import to Mattermost supports importing of messages in your Slack team's public channels."})),h.default.createElement("p",null,h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine2",defaultMessage:"To import a team from Slack, go to {exportInstructions}. See {uploadDocsLink} to learn more.",values:{exportInstructions:n,uploadDocsLink:a}})),h.default.createElement("p",null,h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine3",defaultMessage:"To import posts with attached files, see {slackAdvancedExporterLink} for details.",values:{slackAdvancedExporterLink:s}}))),i=h.default.createElement(y.default,{title:t(S.importSlack),submit:this.doImportSlack,helpText:r,fileTypesAccepted:".zip"});switch(this.state.status){case"ready":e="";break;case"in-progress":e=h.default.createElement("p",{className:"confirm-import alert alert-warning"},h.default.createElement("i",{className:"fa fa-spinner fa-pulse"}),h.default.createElement(g.FormattedMessage,{id:"team_import_tab.importing",defaultMessage:" Importing..."}));break;case"done":e=h.default.createElement("p",{className:"confirm-import alert alert-success"},h.default.createElement("i",{className:"fa fa-check"}),h.default.createElement(g.FormattedMessage,{id:"team_import_tab.successful",defaultMessage:" Import successful: "}),h.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},h.default.createElement(g.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})));break;case"fail":e=h.default.createElement("p",{className:"confirm-import alert alert-warning"},h.default.createElement("i",{className:"fa fa-warning"}),h.default.createElement(g.FormattedMessage,{id:"team_import_tab.failure",defaultMessage:" Import failure: "}),h.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},h.default.createElement(g.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})))}return h.default.createElement("div",null,h.default.createElement("div",{className:"modal-header"},h.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},h.default.createElement("span",{"aria-hidden":"true"},"×")),h.default.createElement("h4",{className:"modal-title",ref:"title"},h.default.createElement("div",{className:"modal-back"},h.default.createElement("i",{className:"fa fa-angle-left"})),h.default.createElement(g.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"}))),h.default.createElement("div",{ref:"wrapper",className:"user-settings"},h.default.createElement("h3",{className:"tab-header"},h.default.createElement(g.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"})),h.default.createElement("div",{className:"divider-dark first"}),i,h.default.createElement("div",{className:"divider-dark"}),e))}}]),t}(h.default.Component);_.propTypes={intl:g.intlShape.isRequired},t.default=(0,g.injectIntl)(_)},2321:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(41),S=n(y),_=a(17),M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.doFileSelect=a.doFileSelect.bind(a),a.doSubmit=a.doSubmit.bind(a),a.state={clientError:a.props.clientError,serverError:a.props.serverError,filename:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentWillReceiveProps",value:function(){this.setState({clientError:this.props.clientError,serverError:this.props.serverError})}},{key:"doFileSelect",value:function(e){e.preventDefault();var t=(0,h.default)(e.target).val();"fakepath"===t.substring(3,11)&&(t=t.substring(12)),this.setState({clientError:"",serverError:"",filename:t})}},{key:"doSubmit",value:function(e){e.preventDefault();var t=S.default.findDOMNode(this.refs.uploadinput);t.files&&t.files[0]?this.props.submit(t.files[0]):this.setState({clientError:!0})}},{key:"render",value:function(){var e=null;this.state.clientError&&(e=b.default.createElement("div",{className:"file-status"},b.default.createElement(_.FormattedMessage,{id:"setting_upload.noFile",defaultMessage:"No file selected."})));var t=null;this.state.serverError&&(t=b.default.createElement("div",{className:"file-status"},this.state.serverError));var a=null,n="btn btn-sm btn-primary disabled";return this.state.filename&&(a=b.default.createElement("div",{className:"file-status file-name"},this.state.filename),n="btn btn-sm btn-primary"),b.default.createElement("ul",{className:"section-max"},b.default.createElement("li",{className:"col-sm-12 section-title"},this.props.title),b.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},this.props.helpText),b.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},b.default.createElement("ul",{className:"setting-list"},b.default.createElement("li",{className:"setting-list-item"},b.default.createElement("span",{className:"btn btn-sm btn-primary btn-file sel-btn"},b.default.createElement(_.FormattedMessage,{id:"setting_upload.select",defaultMessage:"Select file"}),b.default.createElement("input",{ref:"uploadinput",accept:this.props.fileTypesAccepted,type:"file",onChange:this.doFileSelect})),b.default.createElement("a",{className:n,onClick:this.doSubmit},b.default.createElement(_.FormattedMessage,{id:"setting_upload.import",defaultMessage:"Import"})),a,t,e))))}}]),t}(b.default.Component);t.default=M,M.propTypes={title:v.default.string.isRequired,submit:v.default.func.isRequired,fileTypesAccepted:v.default.string.isRequired,clientError:v.default.string,serverError:v.default.string,helpText:v.default.object}},2322:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(35),v=a(17),E=a(1948),b=n(E),y=a(9),S=n(y),_=S.default.ActionTypes,M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.updateShow=a.updateShow.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleChange=a.handleChange.bind(a),a.state={value:"",inputError:"",show:!1,callback:null},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(_.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(_.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"updateShow",value:function(e,t){this.setState({show:e,callback:t.callback})}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state.value;if(!this.isInputValid(t))return void this.setState({inputError:h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})});var a=t.split(","),n={type:"custom"};n.sidebarBg=a[0],n.sidebarText=a[5],n.sidebarUnreadText=a[5],n.sidebarTextHoverBg=a[4],n.sidebarTextActiveBorder=a[2],n.sidebarTextActiveColor=a[3],n.sidebarHeaderBg=a[1],n.sidebarHeaderTextColor=a[5],n.onlineIndicator=a[6],n.awayIndicator="#E0B333",n.mentionBg=a[7],n.mentionColor="#ffffff",n.centerChannelBg="#ffffff",n.centerChannelColor="#333333",n.newMessageSeparator="#F80",n.linkColor="#2389d7",n.buttonBg="#26a970",n.buttonColor="#ffffff",n.mentionHighlightBg="#fff2bb",n.mentionHighlightLink="#2f81b7",n.codeTheme="github",this.state.callback(n),this.setState({show:!1,callback:null})}},{key:"isInputValid",value:function(e){if(0===e.length)return!1;if(-1!==e.indexOf(" "))return!1;if(e.length>0&&-1===e.indexOf(","))return!1;if(e.length>0){var t=e.split(",");if(8!==t.length)return!1;for(var a=0;a<t.length;a++){if(7!==t[a].length&&4!==t[a].length)return!1;if("#"!==t[a].charAt(0))return!1}}return!0}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({value:t}),this.isInputValid(t)?this.setState({inputError:null}):this.setState({inputError:h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})})}},{key:"render",value:function(){var e=this;return h.default.createElement("span",null,h.default.createElement(g.Modal,{show:this.state.show,onHide:function(){return e.setState({show:!1})}},h.default.createElement(g.Modal.Header,{closeButton:!0},h.default.createElement(g.Modal.Title,null,h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.importHeader",defaultMessage:"Import Slack Theme"}))),h.default.createElement("form",{role:"form",className:"form-horizontal"},h.default.createElement(g.Modal.Body,null,h.default.createElement("p",null,h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.importBody",defaultMessage:'To import a theme, go to a Slack team and look for "Preferences -> Sidebar Theme". Open the custom theme option, copy the theme color values and paste them here:'})),h.default.createElement("div",{className:"form-group less"},h.default.createElement("div",{className:"col-sm-12"},h.default.createElement("input",{id:"themeVector",type:"text",className:"form-control",value:this.state.value,onChange:this.handleChange}),h.default.createElement("div",{className:"input__help"},this.state.inputError)))),h.default.createElement(g.Modal.Footer,null,h.default.createElement("button",{id:"cancelButton",type:"button",className:"btn btn-default",onClick:function(){return e.setState({show:!1})}},h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.cancel",defaultMessage:"Cancel"})),h.default.createElement("button",{id:"submitButton",onClick:this.handleSubmit,type:"submit",className:"btn btn-primary",tabIndex:"3"},h.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submit",defaultMessage:"Submit"}))))))}}]),t}(h.default.Component);t.default=M},2323:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(1),v=n(g),E=a(35),b=a(41),y=n(b),S=a(17),_=a(1948),M=n(_),C=a(27),w=n(C),k=a(9),T=n(k),N=a(16),P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(N),R=a(283),I=n(R),D=a(2066),L=n(D),A=a(2324),O=n(A),F=(0,S.defineMessages)({general:{id:"user.settings.modal.general",defaultMessage:"General"},security:{id:"user.settings.modal.security",defaultMessage:"Security"},notifications:{id:"user.settings.modal.notifications",defaultMessage:"Notifications"},display:{id:"user.settings.modal.display",defaultMessage:"Display"},sidebar:{id:"user.settings.modal.sidebar",defaultMessage:"Sidebar"},advanced:{id:"user.settings.modal.advanced",defaultMessage:"Advanced"},confirmTitle:{id:"user.settings.modal.confirmTitle",defaultMessage:"Discard Changes?"},confirmMsg:{id:"user.settings.modal.confirmMsg",defaultMessage:"You have unsaved changes, are you sure you want to discard them?"},confirmBtns:{id:"user.settings.modal.confirmBtns",defaultMessage:"Yes, Discard"}}),x=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.handleHide=t.handleHide.bind(t),t.handleHidden=t.handleHidden.bind(t),t.handleCollapse=t.handleCollapse.bind(t),t.handleConfirm=t.handleConfirm.bind(t),t.handleCancelConfirmation=t.handleCancelConfirmation.bind(t),t.handleToggle=t.handleToggle.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.closeModal=t.closeModal.bind(t),t.collapseModal=t.collapseModal.bind(t),t.updateTab=t.updateTab.bind(t),t.updateSection=t.updateSection.bind(t),t.onUserChanged=t.onUserChanged.bind(t),t.state={active_tab:"general",active_section:"",showConfirmModal:!1,enforceFocus:!0,currentUser:w.default.getCurrentUser(),show:!1},t.requireConfirm=!1,t.mounted=!1,t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"onUserChanged",value:function(){this.mounted&&this.setState({currentUser:w.default.getCurrentUser()})}},{key:"componentDidMount",value:function(){this.mounted=!0,w.default.addChangeListener(this.onUserChanged),M.default.addModalListener(T.default.ActionTypes.TOGGLE_ACCOUNT_SETTINGS_MODAL,this.handleToggle),document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,M.default.removeModalListener(T.default.ActionTypes.TOGGLE_ACCOUNT_SETTINGS_MODAL,this.handleToggle),document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){w.default.removeChangeListener(this.onUserChanged),P.isMobile()||(0,h.default)(".settings-content .minimize-settings").perfectScrollbar("update")}},{key:"handleKeyDown",value:function(e){P.cmdOrCtrlPressed(e)&&e.shiftKey&&e.keyCode===T.default.KeyCodes.A&&this.setState({show:!this.state.show})}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleHide",value:function(){var e=this;if(this.requireConfirm)return this.afterConfirm=function(){return e.handleHide()},void this.showConfirmModal();this.setState({show:!1})}},{key:"handleHidden",value:function(){this.setState({active_tab:"general",active_section:""})}},{key:"handleCollapse",value:function(){(0,h.default)(y.default.findDOMNode(this.refs.modalBody)).closest(".modal-dialog").removeClass("display--content"),this.setState({active_tab:"",active_section:""})}},{key:"handleConfirm",value:function(){this.setState({showConfirmModal:!1,enforceFocus:!0}),this.requireConfirm=!1,this.afterConfirm&&(this.afterConfirm(),this.afterConfirm=null)}},{key:"handleCancelConfirmation",value:function(){this.setState({showConfirmModal:!1,enforceFocus:!0}),this.afterConfirm=null}},{key:"showConfirmModal",value:function(e){this.setState({showConfirmModal:!0,enforceFocus:!1}),e&&(this.afterConfirm=e)}},{key:"closeModal",value:function(){this.requireConfirm?this.showConfirmModal(this.closeModal):this.handleHide()}},{key:"collapseModal",value:function(){this.requireConfirm?this.showConfirmModal(this.collapseModal):this.handleCollapse()}},{key:"updateTab",value:function(e,t){var a=this;!t&&this.requireConfirm?this.showConfirmModal(function(){return a.updateTab(e,!0)}):this.setState({active_tab:e,active_section:""})}},{key:"updateSection",value:function(e,t){var a=this;!t&&this.requireConfirm?this.showConfirmModal(function(){return a.updateSection(e,!0)}):this.setState({active_section:e})}},{key:"render",value:function(){var t=this,a=this.props.intl.formatMessage;if(null==this.state.currentUser)return v.default.createElement("div",null);var n=[];return n.push({name:"general",uiName:a(F.general),icon:"icon fa fa-gear"}),n.push({name:"security",uiName:a(F.security),icon:"icon fa fa-lock"}),n.push({name:"notifications",uiName:a(F.notifications),icon:"icon fa fa-exclamation-circle"}),n.push({name:"display",uiName:a(F.display),icon:"icon fa fa-eye"}),"true"===e.mm_config.CloseUnusedDirectMessages&&n.push({name:"sidebar",uiName:a(F.sidebar),icon:"icon fa fa-columns"}),n.push({name:"advanced",uiName:a(F.advanced),icon:"icon fa fa-list-alt"}),v.default.createElement(E.Modal,{id:"accountSettingsModal",dialogClassName:"settings-modal",show:this.state.show,onHide:this.handleHide,onExited:this.handleHidden,enforceFocus:this.state.enforceFocus},v.default.createElement(E.Modal.Header,{id:"accountSettingsHeader",closeButton:!0},v.default.createElement(E.Modal.Title,{id:"accountSettingsTitle"},v.default.createElement(S.FormattedMessage,{id:"user.settings.modal.title",defaultMessage:"Account Settings"}))),v.default.createElement(E.Modal.Body,{ref:"modalBody"},v.default.createElement("div",{className:"settings-table"},v.default.createElement("div",{className:"settings-links"},v.default.createElement(L.default,{tabs:n,activeTab:this.state.active_tab,updateTab:this.updateTab})),v.default.createElement("div",{className:"settings-content minimize-settings"},v.default.createElement(O.default,{ref:"userSettings",activeTab:this.state.active_tab,activeSection:this.state.active_section,updateSection:this.updateSection,updateTab:this.updateTab,closeModal:this.closeModal,collapseModal:this.collapseModal,setEnforceFocus:function(e){return t.setState({enforceFocus:e})},setRequireConfirm:function(e){t.requireConfirm=e}})))),v.default.createElement(I.default,{title:a(F.confirmTitle),message:a(F.confirmMsg),confirmButtonText:a(F.confirmBtns),show:this.state.showConfirmModal,onConfirm:this.handleConfirm,onCancel:this.handleCancelConfirmation}))}}]),a}(v.default.Component);x.propTypes={intl:S.intlShape.isRequired},t.default=(0,S.injectIntl)(x)}).call(t,a(23))},2324:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(27),b=n(E),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(2325),M=n(_),C=a(2326),w=n(C),k=a(2334),T=n(k),N=a(2338),P=n(N),R=a(2341),I=n(R),D=a(2347),L=n(D),A=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onListenerChange=a.onListenerChange.bind(a),a.state={user:b.default.getCurrentUser()},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){b.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){var e=b.default.getCurrentUser();S.areObjectsEqual(this.state.user,e)||this.setState({user:e})}},{key:"render",value:function(){return"general"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(T.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"security"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(I.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus})):"notifications"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(P.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"display"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(w.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus,setRequireConfirm:this.props.setRequireConfirm})):"sidebar"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(L.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"advanced"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(M.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):v.default.createElement("div",null)}}]),t}(v.default.Component);t.default=A,A.propTypes={activeTab:h.default.string,activeSection:h.default.string,updateSection:h.default.func,updateTab:h.default.func,closeModal:h.default.func.isRequired,collapseModal:h.default.func.isRequired,setEnforceFocus:h.default.func.isRequired,setRequireConfirm:h.default.func.isRequired}},2325:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(168),r=n(s),i=a(45),o=n(i),l=a(51),d=n(l),u=a(5),c=n(u),f=a(3),m=n(f),p=a(4),h=n(p),g=a(6),v=n(g),E=a(7),b=n(E),y=a(8),S=n(y),_=a(1),M=n(_),C=a(17),w=a(66),k=a(113),T=n(k),N=a(27),P=n(N),R=a(9),I=n(R),D=a(16),L=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(D),A=a(653),O=n(A),F=a(654),x=n(F),U=I.default.PRE_RELEASE_FEATURES,H=function(t){function a(e){(0,m.default)(this,a);var t=(0,v.default)(this,(a.__proto__||(0,c.default)(a)).call(this,e));return t.getStateFromStores=t.getStateFromStores.bind(t),t.updateSection=t.updateSection.bind(t),t.updateSetting=t.updateSetting.bind(t),t.toggleFeature=t.toggleFeature.bind(t),t.saveEnabledFeatures=t.saveEnabledFeatures.bind(t),t.renderFormattingSection=t.renderFormattingSection.bind(t),t.renderJoinLeaveSection=t.renderJoinLeaveSection.bind(t),t.state=t.getStateFromStores(),t}return(0,b.default)(a,t),(0,h.default)(a,[{key:"getStateFromStores",value:function(){var t=(0,d.default)(U),a=T.default.getCategory(I.default.Preferences.CATEGORY_ADVANCED_SETTINGS),n={send_on_ctrl_enter:T.default.get(I.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter","false"),formatting:T.default.get(I.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"formatting","true"),join_leave:T.default.get(I.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave","true")};"true"===e.mm_config.EnableWebrtc||(t=t.filter(function(e){return"WEBRTC_PREVIEW"!==e}));var s=0,i=!0,l=!1,u=void 0;try{for(var c,f=(0,o.default)(a);!(i=(c=f.next()).done);i=!0){var m=(0,r.default)(c.value,2),p=m[0],h=m[1],g=!0,v=!1,E=void 0;try{for(var b,y=(0,o.default)(t);!(g=(b=y.next()).done);g=!0){var S=b.value,_=U[S];p===I.default.FeatureTogglePrefix+_.label&&(n[p]=h,"true"===h&&(s+=1))}}catch(e){v=!0,E=e}finally{try{!g&&y.return&&y.return()}finally{if(v)throw E}}}}catch(e){l=!0,u=e}finally{try{!i&&f.return&&f.return()}finally{if(l)throw u}}var M="true"===e.window.mm_config.EnablePreviewFeatures;return{preReleaseFeatures:U,settings:n,preReleaseFeaturesKeys:t,enabledFeatures:s,isSaving:!1,previewFeaturesEnabled:M}}},{key:"updateSetting",value:function(e,t){var a=this.state.settings;a[e]=t,this.setState(a)}},{key:"toggleFeature",value:function(e,t){var a=this,n=this.state.settings;n[I.default.FeatureTogglePrefix+e]=String(t);var s=0;(0,d.default)(this.state.settings).forEach(function(e){0===e.lastIndexOf(I.default.FeatureTogglePrefix)&&"true"===a.state.settings[e]&&s++}),this.setState({settings:n,enabledFeatures:s})}},{key:"saveEnabledFeatures",value:function(){var e=[];(0,d.default)(this.state.settings).forEach(function(t){0===t.lastIndexOf(I.default.FeatureTogglePrefix)&&e.push(t)}),this.handleSubmit(e)}},{key:"handleSubmit",value:function(e){var t=this,a=[],n=P.default.getCurrentId();(Array.isArray(e)?e:[e]).forEach(function(e){a.push({user_id:n,category:I.default.Preferences.CATEGORY_ADVANCED_SETTINGS,name:e,value:t.state.settings[e]})}),this.setState({isSaving:!0}),(0,w.savePreferences)(a,function(){t.updateSection("")})}},{key:"updateSection",value:function(e){e||this.setState(this.getStateFromStores()),this.setState({isSaving:!1}),this.props.updateSection(e)}},{key:"renderOnOffLabel",value:function(e){return"false"===e?M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"}):M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})}},{key:"renderFormattingSection",value:function(){var e=this;return"formatting"===this.props.activeSection?M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),inputs:[M.default.createElement("div",{key:"formattingSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"postFormattingOn",type:"radio",name:"formatting",checked:"false"!==this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"postFormattingOff",type:"radio",name:"formatting",checked:"false"===this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingDesc",defaultMessage:"If enabled, posts will be formatted to create links, show emoji, style the text, and add line breaks. By default, this setting is enabled. Changing this setting requires the page to be refreshed."})))],submit:function(){return e.handleSubmit("formatting")},saving:this.state.isSaving,server_error:this.state.serverError,updateSection:function(t){e.updateSection(""),t.preventDefault()}}):M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),describe:this.renderOnOffLabel(this.state.settings.formatting),updateSection:function(){return e.props.updateSection("formatting")}})}},{key:"renderJoinLeaveSection",value:function(){var e=this;return"true"===window.mm_config.BuildEnterpriseReady&&window.mm_license&&"true"===window.mm_license.IsLicensed?"join_leave"===this.props.activeSection?M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),inputs:[M.default.createElement("div",{key:"joinLeaveSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"joinLeaveOn",type:"radio",name:"join_leave",checked:"false"!==this.state.settings.join_leave,onChange:this.updateSetting.bind(this,"join_leave","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"joinLeaveOff",type:"radio",name:"join_leave",checked:"false"===this.state.settings.join_leave,onChange:this.updateSetting.bind(this,"join_leave","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveDesc",defaultMessage:'When "On", System Messages saying a user has joined or left a channel will be visible. When "Off", the System Messages about joining or leaving a channel will be hidden. A message will still show up when you are added to a channel, so you can receive a notification.'})))],submit:function(){return e.handleSubmit("join_leave")},saving:this.state.isSaving,server_error:this.state.serverError,updateSection:function(t){e.updateSection(""),t.preventDefault()}}):M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),describe:this.renderOnOffLabel(this.state.settings.join_leave),updateSection:function(){return e.props.updateSection("join_leave")}}):null}},{key:"renderFeatureLabel",value:function(e){switch(e){case"MARKDOWN_PREVIEW":return M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.markdown_preview",defaultMessage:"Show markdown preview option in message input box"});case"WEBRTC_PREVIEW":return M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.webrtc_preview",defaultMessage:"Enable the ability to make and receive one-on-one WebRTC calls"});default:return null}}},{key:"render",value:function(){var e=this,t=this.state.serverError||null,a=void 0;if("advancedCtrlSend"===this.props.activeSection){var n=["true"===this.state.settings.send_on_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter],s=[M.default.createElement("div",{key:"ctrlSendSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"ctrlSendOn",type:"radio",name:"sendOnCtrlEnter",checked:n[0],onChange:this.updateSetting.bind(this,"send_on_ctrl_enter","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"ctrlSendOff",type:"radio",name:"sendOnCtrlEnter",checked:n[1],onChange:this.updateSetting.bind(this,"send_on_ctrl_enter","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendDesc",defaultMessage:"If enabled ENTER inserts a new line and CTRL+ENTER submits the message."})))];a=M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendTitle",defaultMessage:"Send messages on CTRL+ENTER"}),inputs:s,submit:function(){return e.handleSubmit("send_on_ctrl_enter")},saving:this.state.isSaving,server_error:t,updateSection:function(t){e.updateSection(""),t.preventDefault()}})}else a=M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendTitle",defaultMessage:"Send messages on CTRL+ENTER"}),describe:this.renderOnOffLabel(this.state.settings.send_on_ctrl_enter),updateSection:function(){return e.props.updateSection("advancedCtrlSend")}});var r=this.renderFormattingSection(),i=null;r&&(i=M.default.createElement("div",{className:"divider-light"}));var o=this.renderJoinLeaveSection(),l=null;o&&(l=M.default.createElement("div",{className:"divider-light"}));var d=void 0,u=void 0;if(this.state.previewFeaturesEnabled&&this.state.preReleaseFeaturesKeys.length>0)if(u=M.default.createElement("div",{className:"divider-light"}),"advancedPreviewFeatures"===this.props.activeSection){var c=[];this.state.preReleaseFeaturesKeys.forEach(function(t){var a=e.state.preReleaseFeatures[t];c.push(M.default.createElement("div",{key:"advancedPreviewFeatures_"+a.label},M.default.createElement("div",{className:"checkbox"},M.default.createElement("label",null,M.default.createElement("input",{id:"advancedPreviewFeatures"+a.label,type:"checkbox",checked:"true"===e.state.settings[I.default.FeatureTogglePrefix+a.label],onChange:function(t){e.toggleFeature(a.label,t.target.checked)}}),e.renderFeatureLabel(t)))))}),c.push(M.default.createElement("div",{key:"advancedPreviewFeatures_helptext"},M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.preReleaseDesc",defaultMessage:"Check any pre-released features you'd like to preview.  You may also need to refresh the page before the setting will take effect."}))),d=M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.preReleaseTitle",defaultMessage:"Preview pre-release features"}),inputs:c,submit:this.saveEnabledFeatures,saving:this.state.isSaving,server_error:t,updateSection:function(t){e.updateSection(""),t.preventDefault()}})}else d=M.default.createElement(x.default,{title:L.localizeMessage("user.settings.advance.preReleaseTitle","Preview pre-release features"),describe:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.enabledFeatures",defaultMessage:"{count, number} {count, plural, one {Feature} other {Features}} Enabled",values:{count:this.state.enabledFeatures}}),updateSection:function(){return e.props.updateSection("advancedPreviewFeatures")}});return M.default.createElement("div",null,M.default.createElement("div",{className:"modal-header"},M.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},M.default.createElement("span",{"aria-hidden":"true"},"×")),M.default.createElement("h4",{className:"modal-title",ref:"title"},M.default.createElement("div",{className:"modal-back"},M.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"}))),M.default.createElement("div",{className:"user-settings"},M.default.createElement("h3",{className:"tab-header"},M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})),M.default.createElement("div",{className:"divider-dark first"}),a,i,r,l,o,u,d,M.default.createElement("div",{className:"divider-dark"})))}}]),a}(M.default.Component);t.default=H,H.propTypes={user:S.default.object,updateSection:S.default.func,updateTab:S.default.func,activeSection:S.default.string,closeModal:S.default.func.isRequired,collapseModal:S.default.func.isRequired}}).call(t,a(23))},2326:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function r(){return{militaryTime:T.default.get(z.CATEGORY_DISPLAY_SETTINGS,"use_military_time","false"),channelDisplayMode:T.default.get(z.CATEGORY_DISPLAY_SETTINGS,z.CHANNEL_DISPLAY_MODE,z.CHANNEL_DISPLAY_MODE_DEFAULT),messageDisplay:T.default.get(z.CATEGORY_DISPLAY_SETTINGS,z.MESSAGE_DISPLAY,z.MESSAGE_DISPLAY_DEFAULT),collapseDisplay:T.default.get(z.CATEGORY_DISPLAY_SETTINGS,z.COLLAPSE_DISPLAY,z.COLLAPSE_DISPLAY_DEFAULT),linkPreviewDisplay:T.default.get(z.CATEGORY_DISPLAY_SETTINGS,z.LINK_PREVIEW_DISPLAY,z.LINK_PREVIEW_DISPLAY_DEFAULT)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(51),o=s(i),l=a(19),d=s(l),u=a(5),c=s(u),f=a(3),m=s(f),p=a(4),h=s(p),g=a(6),v=s(g),E=a(7),b=s(E),y=a(8),S=s(y),_=a(1),M=s(_),C=a(17),w=a(66),k=a(113),T=s(k),N=a(27),P=s(N),R=a(9),I=s(R),D=a(16),L=n(D),A=a(389),O=n(A),F=a(653),x=s(F),U=a(654),H=s(U),j=a(2327),B=s(j),G=a(2328),V=s(G),z=I.default.Preferences,q=function(t){function a(e){(0,m.default)(this,a);var t=(0,v.default)(this,(a.__proto__||(0,c.default)(a)).call(this,e));return t.handleSubmit=t.handleSubmit.bind(t),t.handleClockRadio=t.handleClockRadio.bind(t),t.updateSection=t.updateSection.bind(t),t.updateState=t.updateState.bind(t),t.state=(0,d.default)({},r(),{isSaving:!1}),t}return(0,b.default)(a,t),(0,h.default)(a,[{key:"handleSubmit",value:function(){var e=this,t=P.default.getCurrentId(),a={user_id:t,category:z.CATEGORY_DISPLAY_SETTINGS,name:"use_military_time",value:this.state.militaryTime},n={user_id:t,category:z.CATEGORY_DISPLAY_SETTINGS,name:z.CHANNEL_DISPLAY_MODE,value:this.state.channelDisplayMode},s={user_id:t,category:z.CATEGORY_DISPLAY_SETTINGS,name:z.MESSAGE_DISPLAY,value:this.state.messageDisplay},r={user_id:t,category:z.CATEGORY_DISPLAY_SETTINGS,name:z.COLLAPSE_DISPLAY,value:this.state.collapseDisplay},i={user_id:t,category:z.CATEGORY_DISPLAY_SETTINGS,name:z.LINK_PREVIEW_DISPLAY,value:this.state.linkPreviewDisplay};this.setState({isSaving:!0}),(0,w.savePreferences)([a,n,s,r,i],function(){e.updateSection("")})}},{key:"handleClockRadio",value:function(e){this.setState({militaryTime:e})}},{key:"handleChannelDisplayModeRadio",value:function(e){this.setState({channelDisplayMode:e})}},{key:"handlemessageDisplayRadio",value:function(e){this.setState({messageDisplay:e})}},{key:"handleCollapseRadio",value:function(e){this.setState({collapseDisplay:e})}},{key:"handleLinkPreviewRadio",value:function(e){this.setState({linkPreviewDisplay:e})}},{key:"handleOnChange",value:function(e){this.setState((0,d.default)({},e))}},{key:"updateSection",value:function(e){this.updateState(),this.props.updateSection(e)}},{key:"updateState",value:function(){var e=r();L.areObjectsEqual(e,this.state)||this.setState(e),this.setState({isSaving:!1})}},{key:"createSection",value:function(e){var t=this,a=e.section,n=e.display,s=e.value,r=e.title,i=e.firstOption,o=e.secondOption,l=e.description,d=M.default.createElement(C.FormattedMessage,{id:i.radionButtonText.id,defaultMessage:i.radionButtonText.message}),u=void 0,c=void 0;i.radionButtonText.moreId&&(u=": ",c=M.default.createElement("span",{className:"font-weight--normal"},M.default.createElement(C.FormattedMessage,{id:i.radionButtonText.moreId,defaultMessage:i.radionButtonText.moreMessage})));var f=void 0;o.radionButtonText.moreId&&(f=M.default.createElement("span",{className:"font-weight--normal"},M.default.createElement(C.FormattedMessage,{id:o.radionButtonText.moreId,defaultMessage:o.radionButtonText.moreMessage})));var m=M.default.createElement(C.FormattedMessage,{id:o.radionButtonText.id,defaultMessage:o.radionButtonText.message}),p=M.default.createElement(C.FormattedMessage,{id:r.id,defaultMessage:r.message}),h=M.default.createElement(C.FormattedMessage,{id:l.id,defaultMessage:l.message});if(this.props.activeSection===a){var g=[!1,!1];s===i.value?g[0]=!0:g[1]=!0;var v=function(e){t.updateSection(""),e.preventDefault()},E=a+"Format",b=a+"UserDisplay",y={};y[n]=i.value;var S={};S[n]=o.value;var _=[M.default.createElement("div",{key:b},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:E+"A",type:"radio",name:E,checked:g[0],onChange:function(){return t.handleOnChange(y)}}),d,u,c),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:E+"B",type:"radio",name:E,checked:g[1],onChange:function(){return t.handleOnChange(S)}}),m,u,f),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),h))];return M.default.createElement("div",null,M.default.createElement(x.default,{title:p,inputs:_,submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:v}),M.default.createElement("div",{className:"divider-dark"}))}var w=void 0;w=s===i.value?d:m;var k=function(){t.props.updateSection(a)};return M.default.createElement("div",null,M.default.createElement(H.default,{title:p,describe:w,updateSection:k}),M.default.createElement("div",{className:"divider-dark"}))}},{key:"render",value:function(){var t=this,a=this.createSection({section:"collapse",display:"collapseDisplay",value:this.state.collapseDisplay,defaultDisplay:"false",title:{id:"user.settings.display.collapseDisplay",message:"Default appearance of image link previews"},firstOption:{value:"false",radionButtonText:{id:"user.settings.display.collapseOn",message:"On"}},secondOption:{value:"true",radionButtonText:{id:"user.settings.display.collapseOff",message:"Off"}},description:{id:"user.settings.display.collapseDesc",message:"Set whether previews of image links show as expanded or collapsed by default. This setting can also be controlled using the slash commands /expand and /collapse."}}),n="true"===e.window.mm_config.EnableLinkPreviews,s=null;n&&(s=this.createSection({section:"linkpreview",display:"linkPreviewDisplay",value:this.state.linkPreviewDisplay,defaultDisplay:"true",title:{id:"user.settings.display.linkPreviewDisplay",message:"Website Link Previews"},firstOption:{value:"true",radionButtonText:{id:"user.settings.display.linkPreviewOn",message:"On"}},secondOption:{value:"false",radionButtonText:{id:"user.settings.display.linkPreviewOff",message:"Off"}},description:{id:"user.settings.display.linkPreviewDesc",message:"When available, the first web link in a message will show a preview of the website content below the message."}}));var r=this.createSection({section:"clock",display:"militaryTime",value:this.state.militaryTime,defaultDisplay:"false",title:{id:"user.settings.display.clockDisplay",message:"Clock Display"},firstOption:{value:"false",radionButtonText:{id:"user.settings.display.normalClock",message:"12-hour clock (example: 4:00 PM)"}},secondOption:{value:"true",radionButtonText:{id:"user.settings.display.militaryClock",message:"24-hour clock (example: 16:00)"}},description:{id:"user.settings.display.preferTime",message:"Select how you prefer time displayed."}}),i=this.createSection({section:z.MESSAGE_DISPLAY,display:"messageDisplay",value:this.state.messageDisplay,defaultDisplay:z.MESSAGE_DISPLAY_CLEAN,title:{id:"user.settings.display.messageDisplayTitle",message:"Message Display"},firstOption:{value:z.MESSAGE_DISPLAY_CLEAN,radionButtonText:{id:"user.settings.display.messageDisplayClean",message:"Standard",moreId:"user.settings.display.messageDisplayCleanDes",moreMessage:"Easy to scan and read."}},secondOption:{value:z.MESSAGE_DISPLAY_COMPACT,radionButtonText:{id:"user.settings.display.messageDisplayCompact",message:"Compact",moreId:"user.settings.display.messageDisplayCompactDes",moreMessage:"Fit as many messages on the screen as we can."}},description:{id:"user.settings.display.messageDisplayDescription",message:"Select how messages in a channel should be displayed."}}),l=this.createSection({section:z.CHANNEL_DISPLAY_MODE,display:"channelDisplayMode",value:this.state.channelDisplayMode,defaultDisplay:z.CHANNEL_DISPLAY_MODE_FULL_SCREEN,title:{id:"user.settings.display.channelDisplayTitle",message:"Channel Display Mode"},firstOption:{value:z.CHANNEL_DISPLAY_MODE_FULL_SCREEN,radionButtonText:{id:"user.settings.display.fullScreen",message:"Full width"}},secondOption:{value:z.CHANNEL_DISPLAY_MODE_CENTERED,radionButtonText:{id:"user.settings.display.fixedWidthCentered",message:"Fixed width, centered"}},description:{id:"user.settings.display.channeldisplaymode",message:"Select the width of the center channel."}}),d=void 0,u=this.props.user.locale;if("languages"===this.props.activeSection)O.isLanguageAvailable(u)||(u=e.window.mm_config.DefaultClientLocale),d=M.default.createElement("div",null,M.default.createElement(B.default,{user:this.props.user,locale:u,updateSection:function(e){t.updateSection(""),e.preventDefault()}}),M.default.createElement("div",{className:"divider-dark"}));else{var c=void 0;c=O.isLanguageAvailable(u)?O.getLanguageInfo(u).name:O.getLanguageInfo(e.window.mm_config.DefaultClientLocale).name,d=M.default.createElement("div",null,M.default.createElement(H.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",describe:c,updateSection:function(){t.updateSection("languages")}}),M.default.createElement("div",{className:"divider-dark"}))}1===(0,o.default)(O.getLanguages()).length&&(d=null);var f=void 0;return"false"!==e.mm_config.EnableThemeSelection&&(f=M.default.createElement("div",null,M.default.createElement(V.default,{selected:"theme"===this.props.activeSection,updateSection:this.updateSection,setRequireConfirm:this.props.setRequireConfirm,setEnforceFocus:this.props.setEnforceFocus}),M.default.createElement("div",{className:"divider-dark"}))),M.default.createElement("div",{id:"displaySettings"},M.default.createElement("div",{className:"modal-header"},M.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},M.default.createElement("span",{"aria-hidden":"true"},"×")),M.default.createElement("h4",{className:"modal-title",ref:"title"},M.default.createElement("div",{className:"modal-back"},M.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),M.default.createElement(C.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"}))),M.default.createElement("div",{className:"user-settings"},M.default.createElement("h3",{id:"displaySettingsTitle",className:"tab-header"},M.default.createElement(C.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"})),M.default.createElement("div",{className:"divider-dark first"}),f,r,s,a,i,l,d))}}]),a}(M.default.Component);t.default=q,q.propTypes={user:S.default.object,updateSection:S.default.func,activeSection:S.default.string,closeModal:S.default.func.isRequired,collapseModal:S.default.func.isRequired,setRequireConfirm:S.default.func.isRequired,setEnforceFocus:S.default.func.isRequired}}).call(t,a(23))},2327:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(51),i=s(r),o=a(19),l=s(o),d=a(5),u=s(d),c=a(3),f=s(c),m=a(4),p=s(m),h=a(6),g=s(h),v=a(7),E=s(v),b=a(8),y=s(b),S=a(1),_=s(S),M=a(17),C=a(56),w=n(C),k=a(66),T=a(389),N=n(T),P=a(653),R=s(P),I=function(e){function t(e){(0,f.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return a.setLanguage=a.setLanguage.bind(a),a.changeLanguage=a.changeLanguage.bind(a),a.submitUser=a.submitUser.bind(a),a.state={locale:e.locale,isSaving:!1},a}return(0,E.default)(t,e),(0,p.default)(t,[{key:"setLanguage",value:function(e){this.setState({locale:e.target.value})}},{key:"changeLanguage",value:function(e){e.preventDefault(),this.submitUser((0,l.default)({},this.props.user,{locale:this.state.locale}))}},{key:"submitUser",value:function(e){var t=this;this.setState({isSaving:!0}),(0,k.updateUser)(e,function(){w.newLocalizationSelected(e.locale)},function(e){var a=void 0;a=e.message?e.message:e,t.setState({serverError:a,isSaving:!1})})}},{key:"render",value:function(){var e=void 0;this.state.serverError&&(e=_.default.createElement("label",{className:"has-error"},this.state.serverError));var t=[],a=N.getLanguages();(0,i.default)(a).map(function(e){return{value:a[e].value,name:a[e].name,order:a[e].order}}).sort(function(e,t){return e.order-t.order}).forEach(function(e){t.push(_.default.createElement("option",{key:e.value,value:e.value},e.name))});var n=_.default.createElement("div",{key:"changeLanguage"},_.default.createElement("br",null),_.default.createElement("label",{className:"control-label"},_.default.createElement(M.FormattedMessage,{id:"user.settings.languages.change",defaultMessage:"Change interface language"})),_.default.createElement("div",{className:"padding-top"},_.default.createElement("select",{id:"displayLanguage",ref:"language",className:"form-control",value:this.state.locale,onChange:this.setLanguage},t),e),_.default.createElement("div",null,_.default.createElement("br",null),_.default.createElement(M.FormattedHTMLMessage,{id:"user.settings.languages.promote",defaultMessage:'Select which language Mattermost displays in the user interface.<br /><br />Would like to help with translations? Join the <a href="http://translate.mattermost.com/" target="_blank">Mattermost Translation Server</a> to contribute.'})));return _.default.createElement(R.default,{title:_.default.createElement(M.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",submit:this.changeLanguage,saving:this.state.isSaving,inputs:[n],updateSection:this.props.updateSection})}}]),t}(_.default.Component);t.default=I,I.propTypes={user:y.default.object.isRequired,locale:y.default.string.isRequired,updateSection:y.default.func.isRequired}},2328:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(51),i=s(r),o=a(42),l=s(o),d=a(19),u=s(d),c=a(5),f=s(c),m=a(3),p=s(m),h=a(4),g=s(h),v=a(6),E=s(v),b=a(7),y=s(b),S=a(0),_=s(S),M=a(8),C=s(M),w=a(1),k=s(w),T=a(41),N=s(T),P=a(17),R=a(66),I=n(R),D=a(113),L=s(D),A=a(36),O=s(A),F=a(27),x=s(F),U=a(9),H=a(16),j=n(H),B=a(39),G=s(B),V=a(653),z=s(V),q=a(654),W=s(q),Y=a(2329),K=s(Y),J=a(2333),X=s(J),Q=function(t){function a(e){(0,p.default)(this,a);var t=(0,E.default)(this,(a.__proto__||(0,f.default)(a)).call(this,e));return t.onChange=t.onChange.bind(t),t.submitTheme=t.submitTheme.bind(t),t.updateTheme=t.updateTheme.bind(t),t.resetFields=t.resetFields.bind(t),t.handleImportModal=t.handleImportModal.bind(t),t.state=(0,u.default)({},t.getStateFromStores(),{isSaving:!1}),t.originalTheme=(0,l.default)({},t.state.theme),t}return(0,y.default)(a,t),(0,g.default)(a,[{key:"componentDidMount",value:function(){x.default.addChangeListener(this.onChange),this.props.selected&&(0,_.default)(N.default.findDOMNode(this.refs[this.state.theme])).addClass("active-border")}},{key:"componentDidUpdate",value:function(){this.props.selected&&((0,_.default)(".color-btn").removeClass("active-border"),(0,_.default)(N.default.findDOMNode(this.refs[this.state.theme])).addClass("active-border"))}},{key:"componentWillReceiveProps",value:function(e){this.props.selected&&!e.selected&&this.resetFields()}},{key:"componentWillUnmount",value:function(){if(x.default.removeChangeListener(this.onChange),this.props.selected){var e=this.getStateFromStores();j.applyTheme(e.theme)}}},{key:"getStateFromStores",value:function(){var t=L.default.getTheme();t.codeTheme||(t.codeTheme=U.Constants.DEFAULT_CODE_THEME);var a=!1,n=!0;return"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.LDAP&&(a=(0,i.default)(O.default.getAll()).length>1,n=L.default.getCategory(U.Preferences.CATEGORY_THEME).size<=1),{teamId:O.default.getCurrentId(),theme:t,type:t.type||"premade",showAllTeamsCheckbox:a,applyToAllTeams:n}}},{key:"onChange",value:function(){var e=this.getStateFromStores();j.areObjectsEqual(this.state,e)||this.setState(e),this.props.setEnforceFocus(!0)}},{key:"scrollToTop",value:function(){(0,_.default)(".ps-container.modal-body").scrollTop(0)}},{key:"submitTheme",value:function(e){var t=this;e.preventDefault();var a=this.state.applyToAllTeams?"":this.state.teamId;this.setState({isSaving:!0}),I.saveTheme(a,this.state.theme,function(){t.props.setRequireConfirm(!1),t.originalTheme=(0,l.default)({},t.state.theme),t.scrollToTop(),t.props.updateSection(""),t.setState({isSaving:!1})})}},{key:"updateTheme",value:function(e){var t=this.state.theme.length===e.length;if(!t)for(var a in e)if(e.hasOwnProperty(a)&&this.state.theme[a]!==e[a]){t=!0;break}this.props.setRequireConfirm(t),this.setState({theme:e}),j.applyTheme(e)}},{key:"updateType",value:function(e){this.setState({type:e})}},{key:"resetFields",value:function(){var e=this.getStateFromStores();e.serverError=null,this.setState(e),this.scrollToTop(),j.applyTheme(e.theme),this.props.setRequireConfirm(!1)}},{key:"handleImportModal",value:function(){G.default.handleViewAction({type:U.ActionTypes.TOGGLE_IMPORT_THEME_MODAL,value:!0,callback:this.updateTheme}),this.props.setEnforceFocus(!1)}},{key:"render",value:function(){var t,a=this;this.state.serverError&&(t=this.state.serverError);var n="custom"===this.state.type,s="false"!==e.mm_config.AllowCustomThemes,r=void 0,i=void 0;n&&s?r=k.default.createElement("div",{key:"customThemeChooser"},k.default.createElement(K.default,{theme:this.state.theme,updateTheme:this.updateTheme})):i=k.default.createElement("div",{key:"premadeThemeChooser"},k.default.createElement("br",null),k.default.createElement(X.default,{theme:this.state.theme,updateTheme:this.updateTheme}));var o=void 0;if(this.props.selected){var l=[];s&&l.push(k.default.createElement("div",{className:"radio",key:"premadeThemeColorLabel"},k.default.createElement("label",null,k.default.createElement("input",{id:"standardThemes",type:"radio",name:"theme",checked:!n,onChange:this.updateType.bind(this,"premade")}),k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.themeColors",defaultMessage:"Theme Colors"})),k.default.createElement("br",null))),l.push(i),s&&(l.push(k.default.createElement("div",{className:"radio",key:"customThemeColorLabel"},k.default.createElement("label",null,k.default.createElement("input",{id:"customThemes",type:"radio",name:"theme",checked:n,onChange:this.updateType.bind(this,"custom")}),k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.customTheme",defaultMessage:"Custom Theme"})))),l.push(r),l.push(k.default.createElement("div",{key:"otherThemes"},k.default.createElement("br",null),k.default.createElement("a",{id:"otherThemes",href:"http://docs.mattermost.com/help/settings/theme-colors.html#custom-theme-examples",target:"_blank",rel:"noopener noreferrer"},k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.otherThemes",defaultMessage:"See other themes"})))),l.push(k.default.createElement("div",{key:"importSlackThemeButton",className:"padding-top"},k.default.createElement("a",{id:"slackImportTheme",className:"theme",onClick:this.handleImportModal},k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.import",defaultMessage:"Import theme colors from Slack"})))));var d=null;this.state.showAllTeamsCheckbox&&(d=k.default.createElement("div",{className:"checkbox user-settings__submit-checkbox"},k.default.createElement("label",null,k.default.createElement("input",{id:"applyThemeToAllTeams",type:"checkbox",checked:this.state.applyToAllTeams,onChange:function(e){return a.setState({applyToAllTeams:e.target.checked})}}),k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.applyToAllTeams",defaultMessage:"Apply new theme to all my teams"})))),o=k.default.createElement(z.default,{inputs:l,submitExtra:d,submit:this.submitTheme,saving:this.state.isSaving,server_error:t,width:"full",updateSection:function(e){a.props.updateSection(""),e.preventDefault()}})}else o=k.default.createElement(W.default,{title:k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),describe:k.default.createElement(P.FormattedMessage,{id:"user.settings.display.theme.describe",defaultMessage:"Open to manage your theme"}),updateSection:function(){a.props.updateSection("theme")}});return o}}]),a}(k.default.Component);t.default=Q,Q.propTypes={selected:C.default.bool.isRequired,updateSection:C.default.func.isRequired,setRequireConfirm:C.default.func.isRequired,setEnforceFocus:C.default.func.isRequired}}).call(t,a(23))},2329:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(42),r=n(s),i=a(164),o=n(i),l=a(220),d=n(l),u=a(19),c=n(u),f=a(5),m=n(f),p=a(3),h=n(p),g=a(4),v=n(g),E=a(6),b=n(E),y=a(7),S=n(y),_=a(0),M=n(_),C=a(8),w=n(C),k=a(1),T=n(k),N=a(35),P=a(17);a(2330);var R=a(9),I=n(R),D=a(73),L=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(D),A=a(2331),O=n(A),F=(0,P.defineMessages)({sidebarBg:{id:"user.settings.custom_theme.sidebarBg",defaultMessage:"Sidebar BG"},sidebarText:{id:"user.settings.custom_theme.sidebarText",defaultMessage:"Sidebar Text"},sidebarHeaderBg:{id:"user.settings.custom_theme.sidebarHeaderBg",defaultMessage:"Sidebar Header BG"},sidebarHeaderTextColor:{id:"user.settings.custom_theme.sidebarHeaderTextColor",defaultMessage:"Sidebar Header Text"},sidebarUnreadText:{id:"user.settings.custom_theme.sidebarUnreadText",defaultMessage:"Sidebar Unread Text"},sidebarTextHoverBg:{id:"user.settings.custom_theme.sidebarTextHoverBg",defaultMessage:"Sidebar Text Hover BG"},sidebarTextActiveBorder:{id:"user.settings.custom_theme.sidebarTextActiveBorder",defaultMessage:"Sidebar Text Active Border"},sidebarTextActiveColor:{id:"user.settings.custom_theme.sidebarTextActiveColor",defaultMessage:"Sidebar Text Active Color"},onlineIndicator:{id:"user.settings.custom_theme.onlineIndicator",defaultMessage:"Online Indicator"},awayIndicator:{id:"user.settings.custom_theme.awayIndicator",defaultMessage:"Away Indicator"},dndIndicator:{id:"user.settings.custom_theme.dndIndicator",defaultMessage:"Do Not Disturb Indicator"},mentionBg:{id:"user.settings.custom_theme.mentionBj",defaultMessage:"Mention Jewel BG"},mentionColor:{id:"user.settings.custom_theme.mentionColor",defaultMessage:"Mention Jewel Text"},centerChannelBg:{id:"user.settings.custom_theme.centerChannelBg",defaultMessage:"Center Channel BG"},centerChannelColor:{id:"user.settings.custom_theme.centerChannelColor",defaultMessage:"Center Channel Text"},newMessageSeparator:{id:"user.settings.custom_theme.newMessageSeparator",defaultMessage:"New Message Separator"},linkColor:{id:"user.settings.custom_theme.linkColor",defaultMessage:"Link Color"},buttonBg:{id:"user.settings.custom_theme.buttonBg",defaultMessage:"Button BG"},buttonColor:{id:"user.settings.custom_theme.buttonColor",defaultMessage:"Button Text"},errorTextColor:{id:"user.settings.custom_theme.errorTextColor",defaultMessage:"Error Text Color"},mentionHighlightBg:{id:"user.settings.custom_theme.mentionHighlightBg",defaultMessage:"Mention Highlight BG"},mentionHighlightLink:{id:"user.settings.custom_theme.mentionHighlightLink",defaultMessage:"Mention Highlight Link"},codeTheme:{id:"user.settings.custom_theme.codeTheme",defaultMessage:"Code Theme"}}),x=function(e){function t(e){(0,h.default)(this,t);var a=(0,b.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));a.handleColorChange=function(e,t){var n=a.props,s=n.updateTheme,r=n.theme;if(r[e]!==t){var i=(0,c.default)({},r,(0,d.default)({type:"custom"},e,t));"mentionBg"===e&&(i.mentionBj=t),s(i)}},a.pasteBoxChange=function(e){var t="";if(t=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.clipboardData.getData("Text"),0!==t.length){var n=void 0;try{n=JSON.parse(t)}catch(e){return}a.setState({copyTheme:(0,o.default)(n)}),n.type="custom",a.props.updateTheme(n)}},a.onChangeHandle=function(e){e.stopPropagation()},a.toggleSidebarStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.sidebarStylesHeader).toggleClass("open"),a.toggleSection(a.refs.sidebarStyles)},a.toggleCenterChannelStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.centerChannelStylesHeader).toggleClass("open"),a.toggleSection(a.refs.centerChannelStyles)},a.toggleLinkAndButtonStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.linkAndButtonStylesHeader).toggleClass("open"),a.toggleSection(a.refs.linkAndButtonStyles)},a.onCodeThemeChange=function(e){var t=a.props.theme;t.codeTheme=e.target.value,a.props.updateTheme(t)},a.selectTheme=a.selectTheme.bind(a);var n=(0,r.default)({},a.props.theme);return delete n.type,delete n.image,a.state={copyTheme:(0,o.default)(n)},a}return(0,S.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){(0,M.default)(".group--code").on("change",this.onCodeThemeChange)}},{key:"componentWillUnmount",value:function(){(0,M.default)(".group--code").off("change",this.onCodeThemeChange)}},{key:"selectTheme",value:function(){var e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.state.copyTheme.length)}},{key:"toggleSection",value:function(e){L.isIos()?(0,M.default)(e).toggleClass("open"):(0,M.default)(e).slideToggle()}},{key:"render",value:function(){var e=this,t=this.props.intl.formatMessage,a=this.props.theme,n=[],s=[],r=[];I.default.THEME_ELEMENTS.forEach(function(i,o){if("codeTheme"===i.id){var l=[],d="";i.themes.forEach(function(e,t){e.id===a[i.id]&&(d=e.iconURL),l.push(T.default.createElement("option",{key:"code-theme-key"+t,value:e.id},e.uiName))});var u=T.default.createElement(N.Popover,{bsStyle:"info",id:"code-popover",className:"code-popover"},T.default.createElement("img",{width:"200",src:d}));s.push(T.default.createElement("div",{className:"col-sm-6 form-group",key:"custom-theme-key"+o},T.default.createElement("label",{className:"custom-label"},t(F[i.id])),T.default.createElement("div",{className:"input-group theme-group group--code dropdown",id:i.id},T.default.createElement("select",{className:"form-control",type:"text",defaultValue:a[i.id]},l),T.default.createElement(N.OverlayTrigger,{trigger:["hover","focus"],placement:"top",overlay:u,ref:"headerOverlay"},T.default.createElement("span",{className:"input-group-addon"},T.default.createElement("img",{src:d}))))))}else if("centerChannelElements"===i.group)s.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:i.id,label:t(F[i.id]),color:a[i.id],onChange:e.handleColorChange})));else if("sidebarElements"===i.group){var c=a[i.id];c||"mentionBg"!==i.id||(c=a.mentionBj),n.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:i.id,label:t(F[i.id]),color:c,onChange:e.handleColorChange})))}else r.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:i.id,label:t(F[i.id]),color:a[i.id],onChange:e.handleColorChange})))});var i=T.default.createElement("div",{className:"col-sm-12"},T.default.createElement("label",{className:"custom-label"},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.copyPaste",defaultMessage:"Copy and paste to share theme colors:"})),T.default.createElement("textarea",{ref:"textarea",className:"form-control",value:this.state.copyTheme,onPaste:this.pasteBoxChange,onChange:this.onChangeHandle,onClick:this.selectTheme}));return T.default.createElement("div",{className:"appearance-section padding-top"},T.default.createElement("div",{className:"theme-elements row"},T.default.createElement("div",{ref:"sidebarStylesHeader",className:"theme-elements__header",onClick:this.toggleSidebarStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.sidebarTitle",defaultMessage:"Sidebar Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"sidebarStyles",className:"theme-elements__body"},n)),T.default.createElement("div",{className:"theme-elements row"},T.default.createElement("div",{ref:"centerChannelStylesHeader",className:"theme-elements__header",onClick:this.toggleCenterChannelStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.centerChannelTitle",defaultMessage:"Center Channel Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"centerChannelStyles",className:"theme-elements__body"},s)),T.default.createElement("div",{className:"theme-elements row form-group"},T.default.createElement("div",{ref:"linkAndButtonStylesHeader",className:"theme-elements__header",onClick:this.toggleLinkAndButtonStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.linkButtonTitle",defaultMessage:"Link and Button Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"linkAndButtonStyles",className:"theme-elements__body"},r)),T.default.createElement("div",{className:"row"},i))}}]),t}(T.default.Component);x.propTypes={intl:P.intlShape.isRequired,theme:w.default.object.isRequired,updateTheme:w.default.func.isRequired},t.default=(0,P.injectIntl)(x)},2330:function(e,t,a){var n,s;a(0),a(0);!function(r,i){n=[a(0)],void 0!==(s=function(e){return i(e)}.apply(t,n))&&(e.exports=s)}(0,function(e){"use strict";var t=function(a,n,s,r,i){this.fallbackValue=s?s&&void 0!==s.h?s:this.value={h:0,s:0,b:0,a:1}:null,this.fallbackFormat=r||"rgba",this.hexNumberSignPrefix=!0===i,this.value=this.fallbackValue,this.origFormat=null,this.predefinedColors=n||{},this.colors=e.extend({},t.webColors,this.predefinedColors),a&&(void 0!==a.h?this.value=a:this.setColor(String(a))),this.value||(this.value={h:0,s:0,b:0,a:1})};t.webColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},t.prototype={constructor:t,colors:{},predefinedColors:{},getValue:function(){return this.value},setValue:function(e){this.value=e},_sanitizeNumber:function(e){return"number"==typeof e?e:isNaN(e)||null===e||""===e||void 0===e?1:""===e?0:void 0!==e.toLowerCase?(e.match(/^\./)&&(e="0"+e),Math.ceil(100*parseFloat(e))/100):1},isTransparent:function(e){return!(!e||!("string"==typeof e||e instanceof String))&&("transparent"===(e=e.toLowerCase().trim())||e.match(/#?00000000/)||e.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/))},rgbaIsTransparent:function(e){return 0===e.r&&0===e.g&&0===e.b&&0===e.a},setColor:function(e){if(e=e.toLowerCase().trim()){if(this.isTransparent(e))return this.value={h:0,s:0,b:0,a:0},!0;var t=this.parse(e);t?(this.value=this.value={h:t.h,s:t.s,b:t.b,a:t.a},this.origFormat||(this.origFormat=t.format)):this.fallbackValue&&(this.value=this.fallbackValue)}return!1},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setBrightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=Math.round(parseInt(100*(1-e),10)/100*100)/100},toRGB:function(e,t,a,n){0===arguments.length&&(e=this.value.h,t=this.value.s,a=this.value.b,n=this.value.a),e*=360;var s,r,i,o,l;return e=e%360/60,l=a*t,o=l*(1-Math.abs(e%2-1)),s=r=i=a-l,e=~~e,s+=[l,o,0,0,o,l][e],r+=[o,l,l,o,0,0][e],i+=[0,0,o,l,l,o][e],{r:Math.round(255*s),g:Math.round(255*r),b:Math.round(255*i),a:n}},toHex:function(e,t,a,n,s){arguments.length<=1&&(t=this.value.h,a=this.value.s,n=this.value.b,s=this.value.a);var r="#",i=this.toRGB(t,a,n,s);return this.rgbaIsTransparent(i)?"transparent":(e||(r=this.hexNumberSignPrefix?"#":""),r+((1<<24)+(parseInt(i.r)<<16)+(parseInt(i.g)<<8)+parseInt(i.b)).toString(16).slice(1))},toHSL:function(e,t,a,n){0===arguments.length&&(e=this.value.h,t=this.value.s,a=this.value.b,n=this.value.a);var s=e,r=(2-t)*a,i=t*a;return i/=r>0&&r<=1?r:2-r,r/=2,i>1&&(i=1),{h:isNaN(s)?0:s,s:isNaN(i)?0:i,l:isNaN(r)?0:r,a:isNaN(n)?0:n}},toAlias:function(e,t,a,n){var s,r=0===arguments.length?this.toHex(!0):this.toHex(!0,e,t,a,n),i="alias"===this.origFormat?r:this.toString(!1,this.origFormat);for(var o in this.colors)if((s=this.colors[o].toLowerCase().trim())===r||s===i)return o;return!1},RGBtoHSB:function(e,t,a,n){e/=255,t/=255,a/=255;var s,r,i,o;return i=Math.max(e,t,a),o=i-Math.min(e,t,a),s=0===o?null:i===e?(t-a)/o:i===t?(a-e)/o+2:(e-t)/o+4,s=(s+360)%6*60/360,r=0===o?0:o/i,{h:this._sanitizeNumber(s),s:r,b:i,a:this._sanitizeNumber(n)}},HueToRGB:function(e,t,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?e+(t-e)*a*6:2*a<1?t:3*a<2?e+(t-e)*(2/3-a)*6:e},HSLtoRGB:function(e,t,a,n){t<0&&(t=0);var s;s=a<=.5?a*(1+t):a+t-a*t;var r=2*a-s,i=e+1/3,o=e,l=e-1/3;return[Math.round(255*this.HueToRGB(r,s,i)),Math.round(255*this.HueToRGB(r,s,o)),Math.round(255*this.HueToRGB(r,s,l)),this._sanitizeNumber(n)]},parse:function(t){if(0===arguments.length)return!1;var a,n,s=this,r=!1,i=void 0!==this.colors[t];return i&&(t=this.colors[t].toLowerCase().trim()),e.each(this.stringParsers,function(e,o){var l=o.re.exec(t);return!(a=l&&o.parse.apply(s,[l]))||(r={},n=i?"alias":o.format?o.format:s.getValidFallbackFormat(),r=n.match(/hsla?/)?s.RGBtoHSB.apply(s,s.HSLtoRGB.apply(s,a)):s.RGBtoHSB.apply(s,a),r instanceof Object&&(r.format=n),!1)}),r},getValidFallbackFormat:function(){var e=["rgba","rgb","hex","hsla","hsl"];return this.origFormat&&-1!==e.indexOf(this.origFormat)?this.origFormat:this.fallbackFormat&&-1!==e.indexOf(this.fallbackFormat)?this.fallbackFormat:"rgba"},toString:function(e,a,n){a=a||this.origFormat||this.fallbackFormat,n=n||!1;var s=!1;switch(a){case"rgb":return s=this.toRGB(),this.rgbaIsTransparent(s)?"transparent":"rgb("+s.r+","+s.g+","+s.b+")";case"rgba":return s=this.toRGB(),"rgba("+s.r+","+s.g+","+s.b+","+s.a+")";case"hsl":return s=this.toHSL(),"hsl("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%)";case"hsla":return s=this.toHSL(),"hsla("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%,"+s.a+")";case"hex":return this.toHex(e);case"alias":return s=this.toAlias(),!1===s?this.toString(e,this.getValidFallbackFormat()):n&&!(s in t.webColors)&&s in this.predefinedColors?this.predefinedColors[s]:s;default:return s}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(e){return[e[1],e[2],e[3],1]}},{re:/rgb\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/hsl\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/hsla\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1]}}],colorNameToHex:function(e){return void 0!==this.colors[e.toLowerCase()]&&this.colors[e.toLowerCase()]}};var a={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",fallbackColor:!1,fallbackFormat:"hex",hexNumberSignPrefix:!0,sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},n=function(t,n){this.element=e(t).addClass("colorpicker-element"),this.options=e.extend(!0,{},a,this.element.data(),n),this.component=this.options.component,this.component=!1!==this.component&&this.element.find(this.component),this.component&&0===this.component.length&&(this.component=!1),this.container=!0===this.options.container?this.element:this.options.container,this.container=!1!==this.container&&e(this.container),this.input=this.element.is("input")?this.element:!!this.options.input&&this.element.find(this.options.input),this.input&&0===this.input.length&&(this.input=!1),this.color=this.createColor(!1!==this.options.color?this.options.color:this.getValue()),this.format=!1!==this.options.format?this.options.format:this.color.origFormat,!1!==this.options.color&&(this.updateInput(this.color),this.updateData(this.color)),this.disabled=!1;var s=this.picker=e(this.options.template);if(this.options.customClass&&s.addClass(this.options.customClass),this.options.inline?s.addClass("colorpicker-inline colorpicker-visible"):s.addClass("colorpicker-hidden"),this.options.horizontal&&s.addClass("colorpicker-horizontal"),-1===["rgba","hsla","alias"].indexOf(this.format)&&!1!==this.options.format&&"transparent"!==this.getValue()||s.addClass("colorpicker-with-alpha"),"right"===this.options.align&&s.addClass("colorpicker-right"),!0===this.options.inline&&s.addClass("colorpicker-no-arrow"),this.options.colorSelectors){var r=this,i=r.picker.find(".colorpicker-selectors");i.length>0&&(e.each(this.options.colorSelectors,function(t,a){var n=e("<i />").addClass("colorpicker-selectors-color").css("background-color",a).data("class",t).data("alias",t);n.on("mousedown.colorpicker touchstart.colorpicker",function(t){t.preventDefault(),r.setValue("alias"===r.format?e(this).data("alias"):e(this).css("background-color"))}),i.append(n)}),i.show().addClass("colorpicker-visible"))}s.on("mousedown.colorpicker touchstart.colorpicker",e.proxy(function(e){e.target===e.currentTarget&&e.preventDefault()},this)),s.find(".colorpicker-saturation, .colorpicker-hue, .colorpicker-alpha").on("mousedown.colorpicker touchstart.colorpicker",e.proxy(this.mousedown,this)),s.appendTo(this.container?this.container:e("body")),!1!==this.input&&(this.input.on({"keyup.colorpicker":e.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":e.proxy(this.change,this)}),!1===this.component&&this.element.on({"focus.colorpicker":e.proxy(this.show,this)}),!1===this.options.inline&&this.element.on({"focusout.colorpicker":e.proxy(this.hide,this)})),!1!==this.component&&this.component.on({"click.colorpicker":e.proxy(this.show,this)}),!1===this.input&&!1===this.component&&this.element.on({"click.colorpicker":e.proxy(this.show,this)}),!1!==this.input&&!1!==this.component&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":e.proxy(this.show,this),"focus.colorpicker":e.proxy(this.show,this)}),this.update(),e(e.proxy(function(){this.element.trigger("create")},this))};n.Color=t,n.prototype={constructor:n,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker","color").off(".colorpicker"),!1!==this.input&&this.input.off(".colorpicker"),!1!==this.component&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(!1!==this.options.inline||this.options.container)return!1;var e=this.container&&this.container[0]!==window.document.body?"position":"offset",t=this.component||this.element,a=t[e]();"right"===this.options.align&&(a.left-=this.picker.outerWidth()-t.outerWidth()),this.picker.css({top:a.top+t.outerHeight(),left:a.left})},show:function(t){this.isDisabled()||(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),e(window).on("resize.colorpicker",e.proxy(this.reposition,this)),!t||this.hasInput()&&"color"!==this.input.attr("type")||t.stopPropagation&&t.preventDefault&&(t.stopPropagation(),t.preventDefault()),!this.component&&this.input||!1!==this.options.inline||e(window.document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color}))},hide:function(t){if(void 0!==t&&t.target&&(e(t.currentTarget).parents(".colorpicker").length>0||e(t.target).parents(".colorpicker").length>0))return!1;this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),e(window).off("resize.colorpicker",this.reposition),e(window.document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(e){return e=e||this.color.toString(!1,this.format),this.element.data("color",e),e},updateInput:function(e){return e=e||this.color.toString(!1,this.format),!1!==this.input&&(this.input.prop("value",e),this.input.trigger("change")),e},updatePicker:function(e){void 0!==e&&(this.color=this.createColor(e));var t=!1===this.options.horizontal?this.options.sliders:this.options.slidersHorz,a=this.picker.find("i");if(0!==a.length)return!1===this.options.horizontal?(t=this.options.sliders,a.eq(1).css("top",t.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",t.alpha.maxTop*(1-this.color.value.a))):(t=this.options.slidersHorz,a.eq(1).css("left",t.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",t.alpha.maxLeft*(1-this.color.value.a))),a.eq(0).css({top:t.saturation.maxTop-this.color.value.b*t.saturation.maxTop,left:this.color.value.s*t.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(!0,this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex(!0)),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(!0,this.format)),e},updateComponent:function(e){var t;if(t=void 0!==e?this.createColor(e):this.color,!1!==this.component){var a=this.component.find("i").eq(0);a.length>0?a.css({backgroundColor:t.toString(!0,this.format)}):this.component.css({backgroundColor:t.toString(!0,this.format)})}return t.toString(!1,this.format)},update:function(e){var t;return!1===this.getValue(!1)&&!0!==e||(t=this.updateComponent(),this.updateInput(t),this.updateData(t),this.updatePicker()),t},setValue:function(e){this.color=this.createColor(e),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:e})},createColor:function(e){return new t(e||null,this.options.colorSelectors,this.options.fallbackColor?this.options.fallbackColor:this.color,this.options.fallbackFormat,this.options.hexNumberSignPrefix)},getValue:function(e){e=void 0===e?this.options.fallbackColor:e;var t;return t=this.hasInput()?this.input.val():this.element.data("color"),void 0!==t&&""!==t&&null!==t||(t=e),t},hasInput:function(){return!1!==this.input},isDisabled:function(){return this.disabled},disable:function(){return this.hasInput()&&this.input.prop("disabled",!0),this.disabled=!0,this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0},enable:function(){return this.hasInput()&&this.input.prop("disabled",!1),this.disabled=!1,this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(t){!t.pageX&&!t.pageY&&t.originalEvent&&t.originalEvent.touches&&(t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY),t.stopPropagation(),t.preventDefault();var a=e(t.target),n=a.closest("div"),s=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!n.is(".colorpicker")){if(n.is(".colorpicker-saturation"))this.currentSlider=e.extend({},s.saturation);else if(n.is(".colorpicker-hue"))this.currentSlider=e.extend({},s.hue);else{if(!n.is(".colorpicker-alpha"))return!1;this.currentSlider=e.extend({},s.alpha)}var r=n.offset();this.currentSlider.guide=n.find("i")[0].style,this.currentSlider.left=t.pageX-r.left,this.currentSlider.top=t.pageY-r.top,this.mousePointer={left:t.pageX,top:t.pageY},e(window.document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"touchmove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this),"touchend.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){!e.pageX&&!e.pageY&&e.originalEvent&&e.originalEvent.touches&&(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((e.pageX||this.mousePointer.left)-this.mousePointer.left))),a=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((e.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=t+"px",this.currentSlider.guide.top=a+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,t/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,a/this.currentSlider.maxTop),!1!==this.options.format||"setAlpha"!==this.currentSlider.callTop&&"setAlpha"!==this.currentSlider.callLeft||(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(window.document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(e){this.keyup(e)},keyup:function(e){38===e.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===e.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=this.createColor(this.input.val()),this.color.origFormat&&!1===this.options.format&&(this.format=this.color.origFormat),!1!==this.getValue(!1)&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},e.colorpicker=n,e.fn.colorpicker=function(t){var a=Array.prototype.slice.call(arguments,1),s=1===this.length,r=null,i=this.each(function(){var s=e(this),i=s.data("colorpicker"),o="object"==typeof t?t:{};i||(i=new n(this,o),s.data("colorpicker",i)),"string"==typeof t?e.isFunction(i[t])?r=i[t].apply(i,a):(a.length&&(i[t]=a[0]),r=i[t]):r=s});return s?r:i},e.fn.colorpicker.constructor=n})},2331:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(8),v=n(g),E=a(2332),b=n(E),y=function(e){function t(){var e,a,n,s;(0,o.default)(this,t);for(var i=arguments.length,l=Array(i),d=0;d<i;d++)l[d]=arguments[d];return a=n=(0,c.default)(this,(e=t.__proto__||(0,r.default)(t)).call.apply(e,[this].concat(l))),n.handleChange=function(e){var t=n.props,a=t.id,s=t.onChange;s&&s(a,e)},s=a,(0,c.default)(n,s)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.label,a=e.color;return h.default.createElement("div",null,h.default.createElement("label",{className:"custom-label"},t),h.default.createElement(b.default,{color:a,onChange:this.handleChange}))}}]),t}(h.default.Component);y.propTypes={id:v.default.string.isRequired,label:v.default.string.isRequired,color:v.default.string.isRequired,onChange:v.default.func},t.default=y},2332:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(1),h=n(p),g=a(41),v=n(g),E=a(8),b=n(E),y=a(1966),S=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.checkClick=function(e){v.default.findDOMNode(a.colorPicker).contains(e.target)||a.setState({isOpened:!1})},a.togglePicker=function(){a.setState({isOpened:!a.state.isOpened})},a.handleChange=function(e){var t=e.hex,n=a.props.onChange;n&&n(t)},a.state={idOpened:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidUpdate",value:function(e,t){var a=t.isOpened,n=this.state.isOpened;n!==a&&(n?document.addEventListener("click",this.checkClick):document.removeEventListener("click",this.checkClick))}},{key:"render",value:function(){var e=this,t=this.props.color,a=this.state.isOpened;return h.default.createElement("div",{className:"color-input input-group"},h.default.createElement("input",{className:"form-control",type:"text",value:t,readOnly:!0}),h.default.createElement("span",{className:"input-group-addon",onClick:this.togglePicker},h.default.createElement("i",{className:"color-icon",style:{backgroundColor:t}})),a&&h.default.createElement("div",{ref:function(t){e.colorPicker=t},className:"color-popover"},h.default.createElement(y.ChromePicker,{color:t,onChange:this.handleChange})))}}]),t}(h.default.Component);S.propTypes={color:b.default.string.isRequired,onChange:b.default.func},t.default=S},2333:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(9),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.state={},t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"render",value:function(){var t=this,a=this.props.theme,n=[],s=e.mm_config.AllowedThemes?e.mm_config.AllowedThemes.split(","):[],r=s.length>1||s[0]&&s[0].trim().length>0;for(var i in S.default.THEMES)if(S.default.THEMES.hasOwnProperty(i)){var o=function(){if(r&&s.indexOf(i)<0)return"continue";var e=h.default.extend(!0,{},S.default.THEMES[i]),o="";e.type===a.type&&(o="active"),n.push(b.default.createElement("div",{className:"col-xs-6 col-sm-3 premade-themes",key:"premade-theme-key"+i},b.default.createElement("div",{className:o,onClick:function(){return t.props.updateTheme(e)}},b.default.createElement("label",null,b.default.createElement("img",{className:"img-responsive",src:e.image}),b.default.createElement("div",{className:"theme-label"},M.toTitleCase(e.type))))))}();if("continue"===o)continue}return b.default.createElement("div",{className:"row appearance-section"},b.default.createElement("div",{className:"clearfix"},n))}}]),a}(b.default.Component);t.default=C,C.propTypes={theme:v.default.object.isRequired,updateTheme:v.default.func.isRequired}}).call(t,a(23))},2334:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function r(e){return{actions:(0,d.bindActionCreators)({getMe:u.getMe},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(61),c=a(2335),f=n(c);t.default=(0,l.connect)(s,r)(f.default)},2335:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(42),r=n(s),i=a(5),o=n(i),l=a(3),d=n(l),u=a(4),c=n(u),f=a(6),m=n(f),p=a(7),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(17),S=a(215),_=a(66),M=a(191),C=n(M),w=a(27),k=n(w),T=a(9),N=n(T),P=a(16),R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(P),I=a(653),D=n(I),L=a(654),A=n(L),O=a(2336),F=n(O),x=(0,y.defineMessages)({usernameReserved:{id:"user.settings.general.usernameReserved",defaultMessage:"This username is reserved, please choose a new one."},usernameRestrictions:{id:"user.settings.general.usernameRestrictions",defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-', and '_'."},validEmail:{id:"user.settings.general.validEmail",defaultMessage:"Please enter a valid email address."},emailMatch:{id:"user.settings.general.emailMatch",defaultMessage:"The new emails you entered do not match."},checkEmail:{id:"user.settings.general.checkEmail",defaultMessage:"Check your email at {email} to verify the address."},validImage:{id:"user.settings.general.validImage",defaultMessage:"Only JPG or PNG images may be used for profile pictures"},imageTooLarge:{id:"user.settings.general.imageTooLarge",defaultMessage:"Unable to upload profile image. File is too large."},uploadImage:{id:"user.settings.general.uploadImage",defaultMessage:"Click 'Edit' to upload an image."},uploadImageMobile:{id:"user.settings.general.mobile.uploadImage",defaultMessage:"Click to upload an image."},fullName:{id:"user.settings.general.fullName",defaultMessage:"Full Name"},nickname:{id:"user.settings.general.nickname",defaultMessage:"Nickname"},username:{id:"user.settings.general.username",defaultMessage:"Username"},profilePicture:{id:"user.settings.general.profilePicture",defaultMessage:"Profile Picture"},close:{id:"user.settings.general.close",defaultMessage:"Close"},position:{id:"user.settings.general.position",defaultMessage:"Position"}}),U=function(t){function a(e){(0,d.default)(this,a);var t=(0,m.default)(this,(a.__proto__||(0,o.default)(a)).call(this,e));return t.submitActive=!1,t.submitUsername=t.submitUsername.bind(t),t.submitNickname=t.submitNickname.bind(t),t.submitName=t.submitName.bind(t),t.submitEmail=t.submitEmail.bind(t),t.submitUser=t.submitUser.bind(t),t.submitPicture=t.submitPicture.bind(t),t.submitPosition=t.submitPosition.bind(t),t.updateUsername=t.updateUsername.bind(t),t.updateFirstName=t.updateFirstName.bind(t),t.updateLastName=t.updateLastName.bind(t),t.updateNickname=t.updateNickname.bind(t),t.updateEmail=t.updateEmail.bind(t),t.updateConfirmEmail=t.updateConfirmEmail.bind(t),t.updatePicture=t.updatePicture.bind(t),t.updateSection=t.updateSection.bind(t),t.updatePosition=t.updatePosition.bind(t),t.state=t.setupInitialState(e),t}return(0,h.default)(a,t),(0,c.default)(a,[{key:"submitUsername",value:function(e){e.preventDefault();var t=(0,r.default)({},this.props.user),a=this.state.username.trim().toLowerCase(),n=this.props.intl.formatMessage,s=R.isValidUsername(a);return"Cannot use a reserved word as a username."===s?void this.setState({clientError:n(x.usernameReserved),serverError:""}):s?void this.setState({clientError:n(x.usernameRestrictions,{min:N.default.MIN_USERNAME_LENGTH,max:N.default.MAX_USERNAME_LENGTH}),serverError:""}):t.username===a?void this.updateSection(""):(t.username=a,(0,S.trackEvent)("settings","user_settings_update",{field:"username"}),void this.submitUser(t,!1))}},{key:"submitNickname",value:function(e){e.preventDefault();var t=(0,r.default)({},this.props.user),a=this.state.nickname.trim();if(t.nickname===a)return void this.updateSection("");t.nickname=a,(0,S.trackEvent)("settings","user_settings_update",{field:"username"}),this.submitUser(t,!1)}},{key:"submitName",value:function(e){e.preventDefault();var t=(0,r.default)({},this.props.user),a=this.state.firstName.trim(),n=this.state.lastName.trim();if(t.first_name===a&&t.last_name===n)return void this.updateSection("");t.first_name=a,t.last_name=n,(0,S.trackEvent)("settings","user_settings_update",{field:"fullname"}),this.submitUser(t,!1)}},{key:"submitEmail",value:function(e){e.preventDefault();var t=(0,r.default)({},this.props.user),a=this.state.email.trim().toLowerCase(),n=this.state.confirmEmail.trim().toLowerCase(),s=this.props.intl.formatMessage;return a!==t.email||""!==n&&n!==t.email?""!==a&&R.isEmail(a)?a!==n?void this.setState({emailError:s(x.emailMatch),clientError:"",serverError:""}):(t.email=a,(0,S.trackEvent)("settings","user_settings_update",{field:"email"}),void this.submitUser(t,!0)):void this.setState({emailError:s(x.validEmail),clientError:"",serverError:""}):void this.updateSection("")}},{key:"submitUser",value:function(t,a){var n=this;this.setState({sectionIsSaving:!0}),(0,_.updateUser)(t,function(){n.updateSection(""),n.props.actions.getMe(),"true"===e.window.mm_config.SendEmailNotifications&&"true"===e.window.mm_config.RequireEmailVerification&&a&&(C.default.storeLastError({message:n.props.intl.formatMessage(x.checkEmail,{email:t.email})}),C.default.emitChange(),n.setState({emailChangeInProgress:!0}))},function(e){var t=void 0;t=e.message?e.message:e,n.setState({serverError:t,emailError:"",clientError:"",sectionIsSaving:!1})})}},{key:"submitPicture",value:function(e){var t=this;if(e.preventDefault(),this.state.pictureFile&&this.submitActive){(0,S.trackEvent)("settings","user_settings_update",{field:"picture"});var a=this.props.intl.formatMessage,n=this.state.pictureFile;if("image/jpeg"!==n.type&&"image/png"!==n.type)return void this.setState({clientError:a(x.validImage),serverError:""});if(n.size>this.state.maxFileSize)return void this.setState({clientError:a(x.imageTooLarge),serverError:""});this.setState({loadingPicture:!0}),(0,_.uploadProfileImage)(n,function(){t.updateSection(""),t.submitActive=!1},function(e){var a=t.setupInitialState(t.props);a.serverError=e.message,t.setState(a)})}}},{key:"submitPosition",value:function(e){e.preventDefault();var t=(0,r.default)({},this.props.user),a=this.state.position.trim();if(t.position===a)return void this.updateSection("");t.position=a,(0,S.trackEvent)("settings","user_settings_update",{field:"position"}),this.submitUser(t,!1)}},{key:"updateUsername",value:function(e){this.setState({username:e.target.value})}},{key:"updateFirstName",value:function(e){this.setState({firstName:e.target.value})}},{key:"updateLastName",value:function(e){this.setState({lastName:e.target.value})}},{key:"updateNickname",value:function(e){this.setState({nickname:e.target.value})}},{key:"updatePosition",value:function(e){this.setState({position:e.target.value})}},{key:"updateEmail",value:function(e){this.setState({email:e.target.value})}},{key:"updateConfirmEmail",value:function(e){this.setState({confirmEmail:e.target.value})}},{key:"updatePicture",value:function(e){e.target.files&&e.target.files[0]?(this.setState({pictureFile:e.target.files[0]}),this.submitActive=!0,this.setState({clientError:null})):this.setState({pictureFile:null})}},{key:"updateSection",value:function(e){var t=this.state.emailChangeInProgress;this.setState((0,r.default)({},this.setupInitialState(this.props),{emailChangeInProgress:t,clientError:"",serverError:"",emailError:"",sectionIsSaving:!1})),this.submitActive=!1,this.props.updateSection(e)}},{key:"setupInitialState",value:function(t){var a=t.user;return{username:a.username,firstName:a.first_name,lastName:a.last_name,nickname:a.nickname,position:a.position,originalEmail:a.email,email:"",confirmEmail:"",pictureFile:null,loadingPicture:!1,emailChangeInProgress:!1,maxFileSize:e.window.mm_config.MaxFileSize,sectionIsSaving:!1}}},{key:"createEmailSection",value:function(){var t=this,a=void 0;if("email"===this.props.activeSection){var n="true"===e.window.mm_config.SendEmailNotifications,s="true"===e.window.mm_config.RequireEmailVerification,r=[],i=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp1",defaultMessage:"Email is used for sign-in, notifications, and password reset. Email requires verification if changed."});if(n)if(s){if(this.state.emailChangeInProgress){var o=k.default.getCurrentUser().email;o&&(i=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp4",defaultMessage:"A verification email was sent to {email}.",values:{email:o}}))}}else i=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp3",defaultMessage:"Email is used for sign-in, notifications, and password reset."});else i=b.default.createElement("div",{className:"setting-list__hint col-sm-12 text-danger"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp2",defaultMessage:"Email has been disabled by your System Administrator. No notification emails will be sent until it is enabled."}));var l=null;""===this.props.user.auth_service?(r.push(b.default.createElement("div",{key:"currentEmailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.currentEmail",defaultMessage:"Current Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("label",{className:"control-label"},this.state.originalEmail))))),r.push(b.default.createElement("div",{key:"emailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.newEmail",defaultMessage:"New Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"primaryEmail",className:"form-control",type:"email",onChange:this.updateEmail,value:this.state.email}))))),r.push(b.default.createElement("div",{key:"confirmEmailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"confirmEmail",className:"form-control",type:"email",onChange:this.updateConfirmEmail,value:this.state.confirmEmail}))),i)),l=this.submitEmail):this.props.user.auth_service===N.default.GITLAB_SERVICE?r.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===N.default.GOOGLE_SERVICE?r.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===N.default.OFFICE365_SERVICE?r.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===N.default.LDAP_SERVICE?r.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"padding-bottom"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})))):this.props.user.auth_service===N.default.SAML_SERVICE&&r.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"padding-bottom"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailSamlCantUpdate",defaultMessage:"Login occurs through SAML. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)),a=b.default.createElement(D.default,{title:b.default.createElement(y.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),inputs:r,submit:l,saving:this.state.sectionIsSaving,server_error:this.state.serverError,client_error:this.state.emailError,updateSection:function(e){t.updateSection(""),e.preventDefault()}})}else{var d="";if(""===this.props.user.auth_service)if(this.state.emailChangeInProgress){var u=k.default.getCurrentUser().email;d=u?b.default.createElement(y.FormattedHTMLMessage,{id:"user.settings.general.newAddress",defaultMessage:"New Address: {email}<br />Check your email to verify the above address.",values:{email:u}}):b.default.createElement(y.FormattedMessage,{id:"user.settings.general.checkEmailNoAddress",defaultMessage:"Check your email to verify your new address"})}else d=k.default.getCurrentUser().email;else this.props.user.auth_service===N.default.GITLAB_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginGitlab",defaultMessage:"Login done through GitLab ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.GOOGLE_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginGoogle",defaultMessage:"Login done through Google Apps ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.OFFICE365_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginOffice365",defaultMessage:"Login done through Office 365 ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.LDAP_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginLdap",defaultMessage:"Login done through AD/LDAP ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.SAML_SERVICE&&(d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginSaml",defaultMessage:"Login done through SAML ({email})",values:{email:this.state.originalEmail}}));a=b.default.createElement(A.default,{title:b.default.createElement(y.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),describe:d,updateSection:function(){t.updateSection("email")}})}return a}},{key:"render",value:function(){var t=this,a=this.props.user,n=this.props.intl.formatMessage,s=null;this.state.clientError&&(s=this.state.clientError);var r=null;this.state.serverError&&(r=this.state.serverError);var i=void 0,o=[];if("name"===this.props.activeSection){var l=void 0,d=null;if("ldap"===this.props.user.auth_service&&("true"===e.window.mm_config.LdapFristNameAttributeSet||"true"===e.window.mm_config.LdapLastNameAttributeSet)||this.props.user.auth_service===N.default.SAML_SERVICE&&("true"===e.window.mm_config.SamlFirstNameAttributeSet||"true"===e.window.mm_config.SamlLastNameAttributeSet))l=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{var u=function(e){e.preventDefault(),this.updateSection(""),this.props.updateTab("notifications")};o.push(b.default.createElement("div",{key:"firstNameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.firstName",defaultMessage:"First Name"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"firstName",className:"form-control",type:"text",onChange:this.updateFirstName,value:this.state.firstName})))),o.push(b.default.createElement("div",{key:"lastNameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.lastName",defaultMessage:"Last Name"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"lastName",className:"form-control",type:"text",onChange:this.updateLastName,value:this.state.lastName}))));var c=b.default.createElement("a",{href:"#",onClick:u.bind(this)},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.notificationsLink",defaultMessage:"Notifications"}));l=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.notificationsExtra",defaultMessage:"By default, you will receive mention notifications when someone types your first name. Go to {notify} settings to change this default.",values:{notify:c}})),d=this.submitName}i=b.default.createElement(D.default,{title:n(x.fullName),inputs:o,submit:d,saving:this.state.sectionIsSaving,server_error:r,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:l})}else{var f="";a.first_name&&a.last_name?f=a.first_name+" "+a.last_name:a.first_name?f=a.first_name:a.last_name?f=a.last_name:(f=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyName",defaultMessage:"Click 'Edit' to add your full name"}),R.isMobile()&&(f=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyName",defaultMessage:"Click to add your full name"}))),i=b.default.createElement(A.default,{title:n(x.fullName),describe:f,updateSection:function(){t.updateSection("name")}})}var m=void 0;if("nickname"===this.props.activeSection){var p=void 0,h=null;if("ldap"===this.props.user.auth_service&&"true"===e.window.mm_config.LdapNicknameAttributeSet||this.props.user.auth_service===N.default.SAML_SERVICE&&"true"===e.window.mm_config.LdapNicknameAttributeSet)p=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));else{var g=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.nickname",defaultMessage:"Nickname"});R.isMobile()&&(g=""),o.push(b.default.createElement("div",{key:"nicknameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},g),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"nickname",className:"form-control",type:"text",onChange:this.updateNickname,value:this.state.nickname,maxLength:N.default.MAX_NICKNAME_LENGTH,autoCapitalize:"off"})))),p=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.nicknameExtra",defaultMessage:"Use Nickname for a name you might be called that is different from your first name and username. This is most often used when two or more people have similar sounding names and usernames."})),h=this.submitNickname}m=b.default.createElement(D.default,{title:n(x.nickname),inputs:o,submit:h,saving:this.state.sectionIsSaving,server_error:r,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:p})}else{var v="";a.nickname?v=a.nickname:(v=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyNickname",defaultMessage:"Click 'Edit' to add a nickname"}),R.isMobile()&&(v=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyNickname",defaultMessage:"Click to add a nickname"}))),m=b.default.createElement(A.default,{title:n(x.nickname),describe:v,updateSection:function(){t.updateSection("nickname")}})}var E=void 0;if("username"===this.props.activeSection){var S=void 0,_=null;if(""===this.props.user.auth_service){var M=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.username",defaultMessage:"Username"});R.isMobile()&&(M=""),o.push(b.default.createElement("div",{key:"usernameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},M),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"username",maxLength:N.default.MAX_USERNAME_LENGTH,className:"form-control",type:"text",onChange:this.updateUsername,value:this.state.username,autoCapitalize:"off"})))),S=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.usernameInfo",defaultMessage:"Pick something easy for teammates to recognize and recall."})),_=this.submitUsername}else S=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));E=b.default.createElement(D.default,{title:n(x.username),inputs:o,submit:_,saving:this.state.sectionIsSaving,server_error:r,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:S})}else E=b.default.createElement(A.default,{title:n(x.username),describe:k.default.getCurrentUser().username,updateSection:function(){t.updateSection("username")}});var C=void 0;if("position"===this.props.activeSection){var w=void 0,T=null;if("ldap"!==this.props.user.auth_service&&this.props.user.auth_service!==N.default.SAML_SERVICE||"true"!==e.window.mm_config.PositionAttributeSet){var P=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.position",defaultMessage:"Position"});R.isMobile()&&(P=""),o.push(b.default.createElement("div",{key:"positionSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},P),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"position",className:"form-control",type:"text",onChange:this.updatePosition,value:this.state.position,maxLength:N.default.MAX_POSITION_LENGTH,autoCapitalize:"off"})))),w=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.positionExtra",defaultMessage:"Use Position for your role or job title. This will be shown in your profile popover."})),T=this.submitPosition}else w=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));C=b.default.createElement(D.default,{title:n(x.position),inputs:o,submit:T,saving:this.state.sectionIsSaving,server_error:r,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:w})}else{var I="";a.position?I=a.position:(I=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyPosition",defaultMessage:"Click 'Edit' to add your job title / position"}),R.isMobile()&&(I=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyPosition",defaultMessage:"Click to add your job title / position"}))),C=b.default.createElement(A.default,{title:n(x.position),describe:I,updateSection:function(){t.updateSection("position")}})}var L=this.createEmailSection(),O=void 0;if("picture"===this.props.activeSection)O=b.default.createElement(F.default,{title:n(x.profilePicture),submit:this.submitPicture,src:R.imageURLForUser(a),serverError:r,clientError:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},file:this.state.pictureFile,onFileChange:this.updatePicture,submitActive:this.submitActive,loadingPicture:this.state.loadingPicture});else{var U=n(x.uploadImage);R.isMobile()&&(U=n(x.uploadImageMobile)),a.last_picture_update&&(U=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.imageUpdated",defaultMessage:"Image last updated {date}",values:{date:b.default.createElement(y.FormattedDate,{value:new Date(a.last_picture_update),day:"2-digit",month:"short",year:"numeric"})}})),O=b.default.createElement(A.default,{title:n(x.profilePicture),describe:U,updateSection:function(){t.updateSection("picture")}})}return b.default.createElement("div",null,b.default.createElement("div",{className:"modal-header"},b.default.createElement("button",{id:"closeUserSettings",type:"button",className:"close","data-dismiss":"modal","aria-label":n(x.close),onClick:this.props.closeModal},b.default.createElement("span",{"aria-hidden":"true"},"×")),b.default.createElement("h4",{className:"modal-title",ref:"title"},b.default.createElement("div",{className:"modal-back"},b.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),b.default.createElement(y.FormattedMessage,{id:"user.settings.general.title",defaultMessage:"General Settings"}))),b.default.createElement("div",{className:"user-settings"},b.default.createElement("h3",{className:"tab-header"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.title",defaultMessage:"General Settings"})),b.default.createElement("div",{className:"divider-dark first"}),i,b.default.createElement("div",{className:"divider-light"}),E,b.default.createElement("div",{className:"divider-light"}),m,b.default.createElement("div",{className:"divider-light"}),C,b.default.createElement("div",{className:"divider-light"}),L,b.default.createElement("div",{className:"divider-light"}),O,b.default.createElement("div",{className:"divider-dark"})))}}]),a}(b.default.Component);U.propTypes={intl:y.intlShape.isRequired,user:v.default.object.isRequired,updateSection:v.default.func.isRequired,updateTab:v.default.func.isRequired,activeSection:v.default.string.isRequired,closeModal:v.default.func.isRequired,collapseModal:v.default.func.isRequired,actions:v.default.shape({getMe:v.default.func.isRequired}).isRequired},t.default=(0,y.injectIntl)(U)}).call(t,a(23))},2336:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),r=n(s),i=a(5),o=n(i),l=a(3),d=n(l),u=a(4),c=n(u),f=a(6),m=n(f),p=a(7),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(17),S=a(2337),_=n(S),M=a(9),C=n(M),w=a(166),k=n(w),T=a(217),N=n(T),P=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.setPicture=function(e){if(e){a.previewBlob=URL.createObjectURL(e);var t=new FileReader;t.onload=function(e){var t=a.getExifOrientation(e.target.result),n=a.getOrientationStyles(t);a.setState({image:a.previewBlob,orientationStyles:n})},t.readAsArrayBuffer(e)}},a.state={image:null},a}return(0,h.default)(t,e),(0,c.default)(t,[{key:"componentWillReceiveProps",value:function(e){e.file!==this.props.file&&(this.setState({image:null}),this.setPicture(e.file))}},{key:"componentWillUnmount",value:function(){this.previewBlob&&URL.revokeObjectURL(this.previewBlob)}},{key:"getExifOrientation",value:function(e){var t=new DataView(e);if(65496!==t.getUint16(0,!1))return-2;for(var a=t.byteLength,n=2;n<a;){var s=t.getUint16(n,!1);if(n+=2,65505===s){if(1165519206!==t.getUint32(n+=2,!1))return-1;var r=18761===t.getUint16(n+=6,!1);n+=t.getUint32(n+4,r);var i=t.getUint16(n,r);n+=2;for(var o=0;o<i;o++)if(274===t.getUint16(n+12*o,r))return t.getUint16(n+12*o+8,r)}else{if(65280!=(65280&s))break;n+=t.getUint16(n,!1)}}return-1}},{key:"getOrientationStyles",value:function(e){var t=(0,_.default)(e);return{transform:t.transform,transformOrigin:t["transform-origin"]}}},{key:"render",value:function(){var e=void 0;if(this.props.file){var t=(0,r.default)({backgroundImage:"url("+this.state.image+")"},this.state.orientationStyles);e=b.default.createElement("div",{className:"profile-img-preview",style:t})}else e=b.default.createElement("img",{ref:"image",className:"profile-img rounded",src:this.props.src});var a=void 0,n=void 0,s=!1;if(this.props.loadingPicture)a=b.default.createElement("img",{className:"spinner",src:k.default}),n=b.default.createElement("span",{className:"icon fa fa-refresh icon--rotate"}),s=!0;else{var i="btn btn-sm";this.props.submitActive?i+=" btn-primary":i+=" btn-inactive disabled",a=b.default.createElement("a",{className:i,onClick:this.props.submit},b.default.createElement(y.FormattedMessage,{id:"setting_picture.save",defaultMessage:"Save"}))}return b.default.createElement("ul",{className:"section-max form-horizontal"},b.default.createElement("li",{className:"col-xs-12 section-title"},this.props.title),b.default.createElement("li",{className:"col-xs-offset-3 col-xs-8"},b.default.createElement("ul",{className:"setting-list"},b.default.createElement("li",{className:"setting-list-item"},e),b.default.createElement("li",{className:"setting-list-item padding-top x2"},b.default.createElement(y.FormattedMessage,{id:"setting_picture.help",defaultMessage:"Upload a profile picture in BMP, JPG, JPEG or PNG format, at least {width}px in width and {height}px height.",values:{width:C.default.PROFILE_WIDTH,height:C.default.PROFILE_WIDTH}})),b.default.createElement("li",{className:"setting-list-item"},b.default.createElement("hr",null),b.default.createElement(N.default,{errors:[this.props.clientError,this.props.serverError],type:"modal"}),b.default.createElement("div",{className:"btn btn-sm btn-primary btn-file sel-btn",disabled:s},n,b.default.createElement(y.FormattedMessage,{id:"setting_picture.select",defaultMessage:"Select"}),b.default.createElement("input",{ref:"input",accept:".jpg,.png,.bmp",type:"file",onChange:this.props.onFileChange,disabled:s})),a,b.default.createElement("a",{className:"btn btn-sm theme",href:"#",onClick:this.props.updateSection},b.default.createElement(y.FormattedMessage,{id:"setting_picture.cancel",defaultMessage:"Cancel"}))))))}}]),t}(E.Component);P.propTypes={clientError:v.default.string,serverError:v.default.string,src:v.default.string,file:v.default.object,loadingPicture:v.default.bool,submitActive:v.default.bool,submit:v.default.func,title:v.default.string,onFileChange:v.default.func,updateSection:v.default.func},t.default=P},2337:function(e,t,a){function n(e){var t={},a=!1;for(var n in e){a||(a=!0);t[l[n]]=e[n]}return a?t:null}function s(e,t){return"r"===e||"ry"===e?t+"deg":"t"===e||"ty"===e?100*t+"%":void 0}function r(e){var t=[];for(var a in e){var n=l[a];t.push(n+"("+s(a,e[a])+")")}return t.length?t.join(" "):null}function i(e){var t={},a=!1;for(var n in e){a||(a=!0);var r=l[n];t[r]=r+"("+s(n,e[n])+")"}return a?t:null}function o(e){var t=String(e),a=d[t],s=r(a),o=u[t],l=n(a),c=i(a),f={};return s&&(f.transform=s),o&&(f["transform-origin"]=o),l&&(f.transforms=l),c&&(f.transformStrings=c),f}var l=(a(0),a(0),{r:"rotate",ry:"rotateY",t:"translateX",ty:"translateY"}),d={2:{ry:180},3:{r:180},4:{r:180,ry:180},5:{r:270,ry:180},6:{ty:-1,r:90},7:{ty:-1,t:-1,r:90,ry:180},8:{t:-1,r:270}},u={5:"top left",6:"bottom left",7:"bottom right",8:"top right"};e.exports=o},2338:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=_.default.getCurrentUser(),t=M.NotificationLevels.DEFAULT,a="true",n="5",s="never",r="true",i=M.NotificationLevels.MENTION,o=C.default.UserStatuses.ONLINE;e.notify_props&&(e.notify_props.desktop&&(t=e.notify_props.desktop),e.notify_props.desktop_sound&&(a=e.notify_props.desktop_sound),e.notify_props.desktop_duration&&(n=e.notify_props.desktop_duration),e.notify_props.comments&&(s=e.notify_props.comments),e.notify_props.email&&(r=e.notify_props.email),e.notify_props.push&&(i=e.notify_props.push),e.notify_props.push_status&&(o=e.notify_props.push_status));var l=!1,d="",u=!1,c=!1;if(e.notify_props){if(e.notify_props.mention_keys){var f=e.notify_props.mention_keys.split(",");-1===f.indexOf(e.username)?l=!1:(l=!0,f.splice(f.indexOf(e.username),1),-1!==f.indexOf("@"+e.username)&&f.splice(f.indexOf("@"+e.username),1)),d=f.join(",")}e.notify_props.first_name&&(u="true"===e.notify_props.first_name),e.notify_props.channel&&(c="true"===e.notify_props.channel)}return{desktopActivity:t,desktopDuration:n,enableEmail:r,pushActivity:i,pushStatus:o,desktopSound:a,usernameKey:l,customKeys:d,customKeysChecked:d.length>0,firstNameKey:u,channelKey:c,notifyCommentsLevel:s,isSaving:!1}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=n(r),o=a(3),l=n(o),d=a(4),u=n(d),c=a(6),f=n(c),m=a(7),p=n(m),h=a(8),g=n(h),v=a(1),E=n(v),b=a(17),y=a(66),S=a(27),_=n(S),M=a(9),C=n(M),w=a(16),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(w),T=a(653),N=n(T),P=a(654),R=n(P),I=a(2339),D=n(I),L=a(2340),A=n(L),O=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.handleSubmit=t.handleSubmit.bind(t),t.handleCancel=t.handleCancel.bind(t),t.updateSection=t.updateSection.bind(t),t.setStateValue=t.setStateValue.bind(t),t.onListenerChange=t.onListenerChange.bind(t),t.handleEmailRadio=t.handleEmailRadio.bind(t),t.updateUsernameKey=t.updateUsernameKey.bind(t),t.updateFirstNameKey=t.updateFirstNameKey.bind(t),t.updateChannelKey=t.updateChannelKey.bind(t),t.updateCustomMentionKeys=t.updateCustomMentionKeys.bind(t),t.updateState=t.updateState.bind(t),t.onCustomChange=t.onCustomChange.bind(t),t.createPushNotificationSection=t.createPushNotificationSection.bind(t),t.state=s(),t}return(0,p.default)(a,t),(0,u.default)(a,[{key:"handleSubmit",value:function(e){var t=this,a=e.enableEmail,n=void 0===a?this.state.enableEmail:a,s={};s.user_id=this.props.user.id,s.email=n,s.desktop_sound=this.state.desktopSound,s.desktop=this.state.desktopActivity,s.desktop_duration=this.state.desktopDuration,s.push=this.state.pushActivity,s.push_status=this.state.pushStatus,s.comments=this.state.notifyCommentsLevel;var r=[];this.state.usernameKey&&r.push(this.props.user.username);var i=r.join(",");this.state.customKeys.length>0&&this.state.customKeysChecked&&(i+=","+this.state.customKeys),s.mention_keys=i,s.first_name=this.state.firstNameKey.toString(),s.channel=this.state.channelKey.toString(),this.setState({isSaving:!0}),(0,y.updateUserNotifyProps)(s,function(){t.props.updateSection("")},function(e){t.setState({serverError:e.message,isSaving:!1})})}},{key:"handleCancel",value:function(e){e.preventDefault(),this.updateState(),this.props.updateSection("")}},{key:"setStateValue",value:function(e,t){var a={};a[e]=t,this.setState(a)}},{key:"updateSection",value:function(e){this.updateState(),this.props.updateSection(e)}},{key:"updateState",value:function(){var e=s();k.areObjectsEqual(e,this.state)||this.setState(e),this.setState({isSaving:!1})}},{key:"componentDidMount",value:function(){_.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){_.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){this.updateState()}},{key:"handleNotifyCommentsRadio",value:function(e){this.setState({notifyCommentsLevel:e}),this.refs.wrapper.focus()}},{key:"handlePushRadio",value:function(e){this.setState({pushActivity:e}),this.refs.wrapper.focus()}},{key:"handlePushStatusRadio",value:function(e){this.setState({pushStatus:e}),this.refs.wrapper.focus()}},{key:"handleEmailRadio",value:function(e){this.setState({enableEmail:e}),this.refs.wrapper.focus()}},{key:"updateUsernameKey",value:function(e){this.setState({usernameKey:e})}},{key:"updateFirstNameKey",value:function(e){this.setState({firstNameKey:e})}},{key:"updateChannelKey",value:function(e){this.setState({channelKey:e})}},{key:"updateCustomMentionKeys",value:function(){if(this.refs.customcheck.checked){var e=this.refs.custommentions.value;this.setState({customKeys:e.replace(/ /g,""),customKeysChecked:!0})}else this.setState({customKeys:"",customKeysChecked:!1})}},{key:"onCustomChange",value:function(){this.refs.customcheck.checked=!0,this.updateCustomMentionKeys()}},{key:"createPushNotificationSection",value:function(){var t=this;if("push"===this.props.activeSection){var a=[],n=null,s=null;if("true"===e.window.mm_config.SendPushNotifications){var r=[!1,!1,!1];this.state.pushActivity===M.NotificationLevels.ALL?r[0]=!0:this.state.pushActivity===M.NotificationLevels.NONE?r[2]=!0:r[1]=!0;var i=[!1,!1,!1];this.state.pushStatus===C.default.UserStatuses.ONLINE?i[0]=!0:this.state.pushStatus===C.default.UserStatuses.AWAY?i[1]=!0:i[2]=!0;var o=void 0;this.state.pushActivity!==M.NotificationLevels.NONE&&(o=E.default.createElement("div",null,E.default.createElement("hr",null),E.default.createElement("label",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.push_notification.status",defaultMessage:"Trigger push notifications when"})),E.default.createElement("br",null),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationOnline",type:"radio",name:"pushNotificationStatus",checked:i[0],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.ONLINE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.online",defaultMessage:"Online, away or offline"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationAway",type:"radio",name:"pushNotificationStatus",checked:i[1],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.AWAY)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.away",defaultMessage:"Away or offline"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationOffline",type:"radio",name:"pushNotificationStatus",checked:i[2],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.OFFLINE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.offline",defaultMessage:"Offline"})))),n=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.status_info",defaultMessage:"Notification alerts are only pushed to your mobile device when your online status matches the selection above."}))),a.push(E.default.createElement("div",{key:"userNotificationLevelOption"},E.default.createElement("label",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.send",defaultMessage:"Send mobile push notifications"})),E.default.createElement("br",null),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationAllActivity",type:"radio",name:"pushNotificationLevel",checked:r[0],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.ALL)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivity",defaultMessage:"For all activity"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationMentions",type:"radio",name:"pushNotificationLevel",checked:r[1],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.MENTION)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentions",defaultMessage:"For mentions and direct messages"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationNever",type:"radio",name:"pushNotificationLevel",checked:r[2],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.NONE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),E.default.createElement("br",null),E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.info",defaultMessage:"Notification alerts are pushed to your mobile device when there is activity in Mattermost."})),o)),s=this.handleSubmit}else a.push(E.default.createElement("div",{key:"oauthEmailInfo",className:"padding-top"},E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.disabled_long",defaultMessage:"Push notifications for mobile devices have been disabled by your System Administrator."})));return E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.push","Mobile push notifications"),extraInfo:n,inputs:a,submit:s,server_error:this.state.serverError,updateSection:this.handleCancel})}var l="";l=this.state.pushActivity===M.NotificationLevels.ALL?this.state.pushStatus===C.default.UserStatuses.AWAY?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityAway",defaultMessage:"For all activity when away or offline"}):this.state.pushStatus===C.default.UserStatuses.OFFLINE?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityOffline",defaultMessage:"For all activity when offline"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityOnline",defaultMessage:"For all activity when online, away or offline"}):this.state.pushActivity===M.NotificationLevels.NONE?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}):"false"===e.window.mm_config.SendPushNotifications?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.disabled",defaultMessage:"Disabled by System Administrator"}):this.state.pushStatus===C.default.UserStatuses.AWAY?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsAway",defaultMessage:"For mentions and direct messages when away or offline"}):this.state.pushStatus===C.default.UserStatuses.OFFLINE?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsOffline",defaultMessage:"For mentions and direct messages when offline"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsOnline",defaultMessage:"For mentions and direct messages when online, away or offline"});var d=function(){t.props.updateSection("push")};return E.default.createElement(R.default,{title:k.localizeMessage("user.settings.notifications.push","Mobile push notifications"),describe:l,updateSection:d})}},{key:"render",value:function(){var e=this,t=this.state.serverError,a=this.props.user,n=void 0,s=void 0;if("keys"===this.props.activeSection){var r=[];if(a.first_name){var i=function(t){e.updateFirstNameKey(t.target.checked)};r.push(E.default.createElement("div",{key:"userNotificationFirstNameOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerFirst",type:"checkbox",checked:this.state.firstNameKey,onChange:i}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveName",defaultMessage:'Your case sensitive first name "{first_name}"',values:{first_name:a.first_name}})))))}var o=function(t){e.updateUsernameKey(t.target.checked)};r.push(E.default.createElement("div",{key:"userNotificationUsernameOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerUsername",type:"checkbox",checked:this.state.usernameKey,onChange:o}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveUsername",defaultMessage:'Your non-case sensitive username "{username}"',values:{username:a.username}})))));var l=function(t){e.updateChannelKey(t.target.checked)};r.push(E.default.createElement("div",{key:"userNotificationChannelOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerShouts",type:"checkbox",checked:this.state.channelKey,onChange:l}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.channelWide",defaultMessage:'Channel-wide mentions "@channel", "@all", "@here"'}))))),r.push(E.default.createElement("div",{key:"userNotificationCustomOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerCustom",ref:"customcheck",type:"checkbox",checked:this.state.customKeysChecked,onChange:this.updateCustomMentionKeys}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveWords",defaultMessage:"Other non-case sensitive words, separated by commas:"}))),E.default.createElement("input",{id:"notificationTriggerCustomText",ref:"custommentions",className:"form-control mentions-input",type:"text",defaultValue:this.state.customKeys,onChange:this.onCustomChange})));var d=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.mentionsInfo",defaultMessage:"Mentions trigger when someone sends a message that includes your username (@{username}) or any of the options selected above.",values:{username:a.username}}));n=E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.wordsTrigger","Words that trigger mentions"),inputs:r,submit:this.handleSubmit,saving:this.state.isSaving,server_error:t,updateSection:this.handleCancel,extraInfo:d})}else{var u=["@"+a.username];this.state.firstNameKey&&u.push(a.first_name),this.state.usernameKey&&u.push(a.username),this.state.channelKey&&(u.push("@channel"),u.push("@all"),u.push("@here")),this.state.customKeys.length>0&&(u=u.concat(this.state.customKeys.split(",")));for(var c="",f=0;f<u.length;f++)""!==u[f]&&(c+='"'+u[f]+'", ');c=c.length>0?c.substring(0,c.length-2):E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.noWords",defaultMessage:"No words configured"}),s=function(){this.props.updateSection("keys")}.bind(this),n=E.default.createElement(R.default,{title:k.localizeMessage("user.settings.notifications.wordsTrigger","Words that trigger mentions"),describe:c,updateSection:s})}var m=void 0,p=void 0;if("comments"===this.props.activeSection){var h=[!1,!1,!1];"never"===this.state.notifyCommentsLevel?h[2]=!0:"root"===this.state.notifyCommentsLevel?h[1]=!0:h[0]=!0;var g=[];g.push(E.default.createElement("div",{key:"userNotificationLevelOption"},E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsAny",type:"radio",name:"commentsNotificationLevel",checked:h[0],onChange:this.handleNotifyCommentsRadio.bind(this,"any")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsAny",defaultMessage:"Mention any comments in a thread you participated in (This will include both mentions to your root post and any comments after you commented on a post)"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsRoot",type:"radio",name:"commentsNotificationLevel",checked:h[1],onChange:this.handleNotifyCommentsRadio.bind(this,"root")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Mention any comments on your post"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsNever",type:"radio",name:"commentsNotificationLevel",checked:h[2],onChange:this.handleNotifyCommentsRadio.bind(this,"never")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsNever",defaultMessage:"No mentions for comments"})))));var v=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsInfo",defaultMessage:"In addition to notifications for when you're mentioned, select if you would like to receive notifications on reply threads."}));m=E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.comments","Reply notifications"),extraInfo:v,inputs:g,submit:this.handleSubmit,saving:this.state.isSaving,server_error:t,updateSection:this.handleCancel})}else{var y="";y="never"===this.state.notifyCommentsLevel?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"}):"root"===this.state.notifyCommentsLevel?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"}),p=function(){this.props.updateSection("comments")}.bind(this),m=E.default.createElement(R.default,{title:k.localizeMessage("user.settings.notifications.comments","Reply notifications"),describe:y,updateSection:p})}var S=this.createPushNotificationSection(),_="true"===this.state.enableEmail;return E.default.createElement("div",null,E.default.createElement("div",{className:"modal-header"},E.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal",onClick:this.props.closeModal},E.default.createElement("span",{"aria-hidden":"true"},"×")),E.default.createElement("h4",{className:"modal-title",ref:"title"},E.default.createElement("div",{className:"modal-back"},E.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.title",defaultMessage:"Notification Settings"}))),E.default.createElement("div",{ref:"wrapper",className:"user-settings"},E.default.createElement("h3",{className:"tab-header"},E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.header",defaultMessage:"Notifications"})),E.default.createElement("div",{className:"divider-dark first"}),E.default.createElement(D.default,{activity:this.state.desktopActivity,sound:this.state.desktopSound,duration:this.state.desktopDuration,updateSection:this.updateSection,setParentState:this.setStateValue,submit:this.handleSubmit,saving:this.state.isSaving,cancel:this.handleCancel,error:this.state.serverError,active:"desktop"===this.props.activeSection}),E.default.createElement("div",{className:"divider-light"}),E.default.createElement(A.default,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,enableEmail:_,emailInterval:k.getEmailInterval(_),onSubmit:this.handleSubmit,onCancel:this.handleCancel,saving:this.state.isSaving,serverError:this.state.serverError}),E.default.createElement("div",{className:"divider-light"}),S,E.default.createElement("div",{className:"divider-light"}),n,E.default.createElement("div",{className:"divider-light"}),m,E.default.createElement("div",{className:"divider-dark"})))}}]),a}(E.default.Component);t.default=O,O.defaultProps={user:null,activeSection:"",activeTab:""},O.propTypes={user:g.default.object,updateSection:g.default.func,updateTab:g.default.func,activeSection:g.default.string,activeTab:g.default.string,closeModal:g.default.func.isRequired,collapseModal:g.default.func.isRequired}}).call(t,a(23))},2339:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(17),b=a(9),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(653),M=n(_),C=a(654),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.buildMaximizedSetting=a.buildMaximizedSetting.bind(a),a.buildMinimizedSetting=a.buildMinimizedSetting.bind(a),a.state={},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"buildMaximizedSetting",value:function(){var e=this,t=[],a=null,n=[!1,!1,!1];this.props.activity===b.NotificationLevels.MENTION?n[1]=!0:this.props.activity===b.NotificationLevels.NONE?n[2]=!0:n[0]=!0;var s=void 0,r=void 0;if(this.props.activity!==b.NotificationLevels.NONE){var i=[!1,!1];"false"===this.props.sound?i[1]=!0:i[0]=!0,s=S.hasSoundOptions()?v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundOn",type:"radio",name:"notificationSounds",checked:i[0],onChange:function(){return e.props.setParentState("desktopSound","true")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.on",defaultMessage:"On"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundOff",type:"radio",name:"notificationSounds",checked:i[1],onChange:function(){return e.props.setParentState("desktopSound","false")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.off",defaultMessage:"Off"})),v.default.createElement("br",null)),v.default.createElement("br",null),v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.sounds_info",defaultMessage:"Notification sounds are available on IE11, Safari, Chrome and Mattermost Desktop Apps."}))):v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),v.default.createElement("br",null),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.soundConfig",defaultMessage:"Please configure notification sounds in your browser settings"}));var o=[!1,!1,!1,!1];"3"===this.props.duration?o[0]=!0:"10"===this.props.duration?o[2]=!0:"0"===this.props.duration?o[3]=!0:o[1]=!0,r=v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.duration",defaultMessage:"Notification duration"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration3",type:"radio",name:"desktopDuration",checked:o[0],onChange:function(){return e.props.setParentState("desktopDuration","3")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"3"}})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration5",type:"radio",name:"desktopDuration",checked:o[1],onChange:function(){return e.props.setParentState("desktopDuration","5")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"5"}})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration10",type:"radio",name:"desktopDuration",checked:o[2],onChange:function(){return e.props.setParentState("desktopDuration","10")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"10"}}))),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDurationUnlimited",type:"radio",name:"desktopDuration",checked:o[3],onChange:function(){return e.props.setParentState("desktopDuration","0")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.unlimited",defaultMessage:"Unlimited"})))),a=v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.durationInfo",defaultMessage:"Sets how long desktop notifications will remain on screen when using Firefox or Chrome. Desktop notifications in Edge, Safari and Mattermost Desktop Apps can only stay on screen for a maximum of 5 seconds."}))}return t.push(v.default.createElement("div",{key:"userNotificationLevelOption"},v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop",defaultMessage:"Send desktop notifications"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationAllActivity",type:"radio",name:"desktopNotificationLevel",checked:n[0],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.ALL)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.allActivity",defaultMessage:"For all activity"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationMentions",type:"radio",name:"desktopNotificationLevel",checked:n[1],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.MENTION)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.onlyMentions",defaultMessage:"Only for mentions and direct messages"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationNever",type:"radio",name:"desktopNotificationLevel",checked:n[2],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.NONE)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),v.default.createElement("br",null),v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.info",defaultMessage:"Desktop notifications are available on Edge, Firefox, Safari, Chrome and Mattermost Desktop Apps."})),s,r)),v.default.createElement(M.default,{title:S.localizeMessage("user.settings.notifications.desktop.title","Desktop notifications"),extraInfo:a,inputs:t,submit:this.props.submit,saving:this.props.saving,server_error:this.props.error,updateSection:this.props.cancel})}},{key:"buildMinimizedSetting",value:function(){var e="";e=this.props.activity===b.NotificationLevels.MENTION?S.hasSoundOptions()&&"false"!==this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundForever",defaultMessage:"For mentions and direct messages, with sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundTimed",defaultMessage:"For mentions and direct messages, with sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):S.hasSoundOptions()&&"false"===this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsNoSoundForever",defaultMessage:"For mentions and direct messages, without sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsNoSoundTimed",defaultMessage:"For mentions and direct messages, without sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundHiddenForever",defaultMessage:"For mentions and direct messages, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundHiddenTimed",defaultMessage:"For mentions and direct messages, shown for {seconds} seconds",values:{seconds:this.props.duration}}):this.props.activity===b.NotificationLevels.NONE?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.off",defaultMessage:"Off"}):S.hasSoundOptions()&&"false"!==this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundForever",defaultMessage:"For all activity, with sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundTimed",defaultMessage:"For all activity, with sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):S.hasSoundOptions()&&"false"===this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allNoSoundForever",defaultMessage:"For all activity, without sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allNoSoundTimed",defaultMessage:"For all activity, without sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundHiddenForever",defaultMessage:"For all activity, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundHiddenTimed",defaultMessage:"For all activity, shown for {seconds} seconds",values:{seconds:this.props.duration}});var t=function(){this.props.updateSection("desktop")}.bind(this);return v.default.createElement(w.default,{title:S.localizeMessage("user.settings.notifications.desktop.title","Desktop notifications"),describe:e,updateSection:t})}},{key:"render",value:function(){return this.props.active?this.buildMaximizedSetting():this.buildMinimizedSetting()}}]),t}(v.default.Component);t.default=k,k.propTypes={activity:h.default.string.isRequired,sound:h.default.string.isRequired,duration:h.default.string.isRequired,updateSection:h.default.func,setParentState:h.default.func,submit:h.default.func,cancel:h.default.func,error:h.default.string,active:h.default.bool,saving:h.default.bool}},2340:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(17),b=a(66),y=a(9),S=a(16),_=a(653),M=n(_),C=a(654),w=n(C),k=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.handleChange=function(e,a){t.setState({enableEmail:e,emailInterval:a})},t.handleSubmit=function(){var e=t.state,a=e.enableEmail,n=e.emailInterval;t.props.enableEmail!==a||t.props.emailInterval!==n?((0,b.savePreference)(y.Preferences.CATEGORY_NOTIFICATIONS,y.Preferences.EMAIL_INTERVAL,n.toString()),t.props.onSubmit({enableEmail:a})):t.props.updateSection("")},t.handleExpand=function(){t.props.updateSection("email")},t.handleCancel=function(e){t.setState({enableEmail:t.props.enableEmail,emailInterval:t.props.emailInterval}),t.props.onCancel(e)},t.state={enableEmail:e.enableEmail,emailInterval:e.emailInterval},t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"componentWillReceiveProps",value:function(e){e.enableEmail===this.props.enableEmail&&e.emailInterval===this.props.emailInterval||this.setState({enableEmail:e.enableEmail,emailInterval:e.emailInterval})}},{key:"render",value:function(){var t=this;if("true"!==e.window.mm_config.SendEmailNotifications&&"email"===this.props.activeSection){var a=[];return a.push(v.default.createElement("div",{key:"oauthEmailInfo",className:"padding-top"},v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.disabled_long",defaultMessage:"Email notifications have been disabled by your System Administrator."}))),v.default.createElement(M.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),inputs:a,server_error:this.state.serverError,updateSection:this.handleCancel})}if("email"!==this.props.activeSection){var n=void 0;if("true"!==e.window.mm_config.SendEmailNotifications)n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.disabled",defaultMessage:"Disabled by System Administrator"});else if(this.props.enableEmail)switch(this.state.emailInterval){case y.Preferences.INTERVAL_IMMEDIATE:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"});break;case y.Preferences.INTERVAL_HOUR:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"});break;default:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count, plural, one {minute} other {{count, number} minutes}}",values:{count:this.state.emailInterval/60}})}else n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.never",defaultMessage:"Never"});return v.default.createElement(w.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),describe:n,updateSection:this.handleExpand})}var s=null,r=null;return"true"===e.window.mm_config.EnableEmailBatching&&(s=v.default.createElement("div",null,v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationMinutes",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_FIFTEEN_MINUTES,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_FIFTEEN_MINUTES)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count} minutes",values:{count:y.Preferences.INTERVAL_FIFTEEN_MINUTES/60}}))),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationHour",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_HOUR,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_HOUR)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"})))),r=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.emailBatchingInfo",defaultMessage:"Notifications received over the time period selected are combined and sent in a single email."})),v.default.createElement(M.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),inputs:[v.default.createElement("div",{key:"userNotificationEmailOptions"},v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.send",defaultMessage:"Send email notifications"})),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationImmediately",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_IMMEDIATE,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_IMMEDIATE)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"}))),s,v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationNever",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_NEVER,onChange:function(){return t.handleChange("false",y.Preferences.INTERVAL_NEVER)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.never",defaultMessage:"Never"}))),v.default.createElement("br",null),v.default.createElement("div",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.emailInfo",defaultMessage:"Email notifications are sent for mentions and direct messages when you are offline or away from {siteName} for more than 5 minutes.",values:{siteName:e.window.mm_config.SiteName}})," ",r))],submit:this.handleSubmit,saving:this.props.saving,server_error:this.props.serverError,updateSection:this.handleCancel})}}]),a}(v.default.Component);k.propTypes={activeSection:h.default.string.isRequired,updateSection:h.default.func.isRequired,enableEmail:h.default.bool.isRequired,emailInterval:h.default.number.isRequired,onSubmit:h.default.func.isRequired,onCancel:h.default.func.isRequired,serverError:h.default.string,saving:h.default.bool},t.default=k}).call(t,a(23))},2341:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a="true"===e.entities.general.config.EnableUserAccessTokens,n=f.hasUserAccessTokenRole(t.user.roles)||f.isSystemAdmin(t.user.roles);return(0,o.default)({},t,{userAccessTokens:e.entities.users.myUserAccessTokens,canUseAccessTokens:a&&n})}function r(e){return{actions:(0,d.bindActionCreators)({getMe:u.getMe,getUserAccessTokensForUser:u.getUserAccessTokensForUser,createUserAccessToken:u.createUserAccessToken,revokeUserAccessToken:u.revokeUserAccessToken,enableUserAccessToken:u.enableUserAccessToken,disableUserAccessToken:u.disableUserAccessToken,clearUserAccessTokens:u.clearUserAccessTokens},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(61),c=a(190),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(c),m=a(2342),p=n(m);t.default=(0,l.connect)(s,r)(p.default)},2342:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(216),i=s(r),o=a(57),l=s(o),d=a(58),u=s(d),c=a(42),f=s(c),m=a(5),p=s(m),h=a(3),g=s(h),v=a(4),E=s(v),b=a(6),y=s(b),S=a(7),_=s(S),M=a(8),C=s(M),w=a(1),k=s(w),T=a(17),N=a(34),P=a(190),R=n(P),I=a(215),D=a(66),L=a(113),A=s(L),O=a(9),F=s(O),x=a(73),U=a(16),H=n(U),j=a(666),B=s(j),G=a(2343),V=s(G),z=a(2345),q=s(z),W=a(283),Y=s(W),K=a(653),J=s(K),X=a(654),Q=s(X),Z=a(659),$=s(Z),ee="creating",te="created",ae="not_creating",ne=function(t){function a(t){var n=this;(0,g.default)(this,a);var s=(0,y.default)(this,(a.__proto__||(0,p.default)(a)).call(this,t));return s.submitPassword=function(e){e.preventDefault();var t=s.props.user,a=s.state.currentPassword,n=s.state.newPassword,r=s.state.confirmPassword;if(""===a)return void s.setState({passwordError:H.localizeMessage("user.settings.security.currentPasswordError","Please enter your current password."),serverError:""});var i=H.isValidPassword(n,H.getPasswordConfig());if(""!==i)return void s.setState({passwordError:i,serverError:""});if(n!==r){var o=(0,f.default)(s.getDefaultState(),{passwordError:H.localizeMessage("user.settings.security.passwordMatchError","The new passwords you entered do not match."),serverError:""});return void s.setState(o)}s.setState({savingPassword:!0}),(0,D.updatePassword)(t.id,a,n,function(){s.props.updateSection(""),s.props.actions.getMe(),s.setState(s.getDefaultState())},function(e){var t=s.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,t.passwordError="",s.setState(t)})},s.setupMfa=function(e){e.preventDefault(),N.browserHistory.push("/mfa/setup")},s.removeMfa=function(){(0,D.deactivateMfa)(function(){if("true"===e.window.mm_license.MFA&&"true"===e.window.mm_config.EnableMultifactorAuthentication&&"true"===e.window.mm_config.EnforceMultifactorAuthentication)return void(window.location.href="/mfa/setup");s.props.updateSection(""),s.setState(s.getDefaultState())},function(e){var t=s.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,s.setState(t)})},s.updateCurrentPassword=function(e){s.setState({currentPassword:e.target.value})},s.updateNewPassword=function(e){s.setState({newPassword:e.target.value})},s.updateConfirmPassword=function(e){s.setState({confirmPassword:e.target.value})},s.deauthorizeApp=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-app");(0,D.deauthorizeOAuthApp)(t,function(){var e=s.state.authorizedApps.filter(function(e){return e.id!==t});s.setState({authorizedApps:e,serverError:null})},function(e){s.setState({serverError:e.message})})},s.createMfaSection=function(){var t=void 0;if("mfa"===s.props.activeSection){var a=void 0,n=void 0;if(s.props.user.mfa_active){var r=void 0,i=void 0;"true"===e.window.mm_config.EnforceMultifactorAuthentication?(r=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.requiredHelp",defaultMessage:"Multi-factor authentication is required on this server. Resetting is only recommended when you need to switch code generation to a new mobile device. You will be required to set it up again immediately."}),i=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.reset",defaultMessage:"Reset MFA on your account"})):(r=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.removeHelp",defaultMessage:"Removing multi-factor authentication means you will no longer require a phone-based passcode to sign-in to your account."}),i=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.remove",defaultMessage:"Remove MFA from your account"})),a=k.default.createElement("div",{key:"mfaQrCode"},k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.removeMfa},i),k.default.createElement("br",null)),n=k.default.createElement("span",null,r)}else a=k.default.createElement("div",{key:"mfaQrCode"},k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.setupMfa},k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.add",defaultMessage:"Add MFA to your account"})),k.default.createElement("br",null)),n=k.default.createElement("span",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.addHelp",defaultMessage:"Adding multi-factor authentication will make your account more secure by requiring a code from your mobile phone each time you sign in."}));var o=[];return o.push(k.default.createElement("div",{key:"mfaSetting",className:"padding-top"},a)),t=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:H.localizeMessage("user.settings.mfa.title","Multi-factor Authentication"),inputs:o,extraInfo:n,submit:void 0,server_error:s.state.serverError,updateSection:t,width:"medium"})}var l=void 0;return l=s.props.user.mfa_active?H.localizeMessage("user.settings.security.active","Active"):H.localizeMessage("user.settings.security.inactive","Inactive"),t=function(){this.props.updateSection("mfa")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.mfa.title","Multi-factor Authentication"),describe:l,updateSection:t})},s.createPasswordSection=function(){var e=void 0;if("password"===s.props.activeSection){var t=[],a=void 0;return""===s.props.user.auth_service?(a=s.submitPassword,t.push(k.default.createElement("div",{key:"currentPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.currentPassword",defaultMessage:"Current Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"currentPassword",className:"form-control",type:"password",onChange:s.updateCurrentPassword,value:s.state.currentPassword})))),t.push(k.default.createElement("div",{key:"newPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.newPassword",defaultMessage:"New Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"newPassword",className:"form-control",type:"password",onChange:s.updateNewPassword,value:s.state.newPassword})))),t.push(k.default.createElement("div",{key:"retypeNewPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"confirmPassword",className:"form-control",type:"password",onChange:s.updateConfirmPassword,value:s.state.confirmPassword}))))):s.props.user.auth_service===F.default.GITLAB_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Password cannot be updated."})))):s.props.user.auth_service===F.default.LDAP_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Password cannot be updated."})))):s.props.user.auth_service===F.default.SAML_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordSamlCantUpdate",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})))):s.props.user.auth_service===F.default.GOOGLE_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Password cannot be updated."})))):s.props.user.auth_service===F.default.OFFICE365_SERVICE&&t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Password cannot be updated."})))),e=function(e){this.props.updateSection(""),this.setState({currentPassword:"",newPassword:"",confirmPassword:"",serverError:null,passwordError:null}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),inputs:t,submit:a,saving:s.state.savingPassword,server_error:s.state.serverError,client_error:s.state.passwordError,updateSection:e})}var n=void 0;if(""===s.props.user.auth_service){var r=new Date(s.props.user.last_password_update),i=!A.default.getBool(F.default.Preferences.CATEGORY_DISPLAY_SETTINGS,F.default.Preferences.USE_MILITARY_TIME,!1);n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.lastUpdated",defaultMessage:"Last updated {date} at {time}",values:{date:k.default.createElement(T.FormattedDate,{value:r,day:"2-digit",month:"short",year:"numeric"}),time:k.default.createElement(T.FormattedTime,{value:r,hour12:i,hour:"2-digit",minute:"2-digit"})}})}else s.props.user.auth_service===F.default.GITLAB_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginGitlab",defaultMessage:"Login done through GitLab"}):s.props.user.auth_service===F.default.LDAP_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginLdap",defaultMessage:"Login done through AD/LDAP"}):s.props.user.auth_service===F.default.SAML_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginSaml",defaultMessage:"Login done through SAML"}):s.props.user.auth_service===F.default.GOOGLE_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginGoogle",defaultMessage:"Login done through Google Apps"}):s.props.user.auth_service===F.default.OFFICE365_SERVICE&&(n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginOffice365",defaultMessage:"Login done through Office 365"}));return e=function(){this.props.updateSection("password")}.bind(s),k.default.createElement(Q.default,{title:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),describe:n,updateSection:e})},s.createSignInSection=function(){var t=void 0,a=s.props.user;if("signin"===s.props.activeSection){var n=void 0,r=void 0,i=void 0,o=void 0,l=void 0,d=void 0;if(""===a.auth_service)"true"===e.window.mm_config.EnableSignUpWithGitLab&&(r=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.GITLAB_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchGitlab",defaultMessage:"Switch to using GitLab SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSignUpWithGoogle&&(i=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.GOOGLE_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchGoogle",defaultMessage:"Switch to using Google SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSignUpWithOffice365&&(o=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.OFFICE365_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchOffice365",defaultMessage:"Switch to using Office 365 SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableLdap&&(l=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_ldap?email="+encodeURIComponent(a.email)},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchLdap",defaultMessage:"Switch to using AD/LDAP"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSaml&&(d=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.SAML_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchSaml",defaultMessage:"Switch to using SAML SSO"})),k.default.createElement("br",null)));else if("true"===e.window.mm_config.EnableSignUpWithEmail){var u=void 0;u=a.auth_service===F.default.LDAP_SERVICE?"/claim/ldap_to_email?email="+encodeURIComponent(a.email):"/claim/oauth_to_email?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service,n=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:u},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchEmail",defaultMessage:"Switch to using email and password"})),k.default.createElement("br",null))}var c=[];c.push(k.default.createElement("div",{key:"userSignInOption"},n,r,i,o,l,d)),t=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s);var f=k.default.createElement("span",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oneSignin",defaultMessage:"You may only have one sign-in method at a time. Switching sign-in method will send an email notifying you if the change was successful."}));return k.default.createElement(J.default,{title:H.localizeMessage("user.settings.security.method","Sign-in Method"),extraInfo:f,inputs:c,server_error:s.state.serverError,updateSection:t})}t=function(){this.props.updateSection("signin")}.bind(s);var m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.emailPwd",defaultMessage:"Email and Password"});return s.props.user.auth_service===F.default.GITLAB_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.gitlab",defaultMessage:"GitLab"}):s.props.user.auth_service===F.default.GOOGLE_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.google",defaultMessage:"Google"}):s.props.user.auth_service===F.default.OFFICE365_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.office365",defaultMessage:"Office 365"}):s.props.user.auth_service===F.default.LDAP_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.ldap",defaultMessage:"AD/LDAP"}):s.props.user.auth_service===F.default.SAML_SERVICE&&(m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.saml",defaultMessage:"SAML"})),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.security.method","Sign-in Method"),describe:m,updateSection:t})},s.createOAuthAppsSection=function(){var e=void 0;if("apps"===s.props.activeSection){var t=void 0;t=s.state.authorizedApps&&s.state.authorizedApps.length>0?s.state.authorizedApps.map(function(e){var t=k.default.createElement("a",{href:e.homepage,target:"_blank",rel:"noopener noreferrer"},e.homepage);return k.default.createElement("div",{key:e.id,className:"padding-bottom x2 authorized-app"},k.default.createElement("div",{className:"col-sm-10"},k.default.createElement("div",{className:"authorized-app__name"},e.name,k.default.createElement("span",{className:"authorized-app__url"}," -"," ",t)),k.default.createElement("div",{className:"authorized-app__description"},e.description),k.default.createElement("div",{className:"authorized-app__deauthorize"},k.default.createElement("a",{href:"#","data-app":e.id,onClick:s.deauthorizeApp},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.deauthorize",defaultMessage:"Deauthorize"})))),k.default.createElement("div",{className:"col-sm-2 pull-right"},k.default.createElement("img",{alt:e.name,src:e.icon_url||B.default})),k.default.createElement("br",null))}):k.default.createElement("div",{className:"padding-bottom x2 authorized-app"},k.default.createElement("div",{className:"setting-list__hint"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.noApps",defaultMessage:"No OAuth 2.0 Applications are authorized."})));var a=[],n=void 0,r=void 0;Array.isArray(t)&&(n="authorized-apps__wrapper",r=k.default.createElement("div",{className:"authorized-apps__help"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthAppsHelp",defaultMessage:"Applications act on your behalf to access your data based on the permissions you grant them."}))),a.push(k.default.createElement("div",{className:n,key:"authorizedApps"},t)),e=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s);var i=k.default.createElement("div",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),r);return k.default.createElement(J.default,{title:i,inputs:a,server_error:s.state.serverError,updateSection:e,width:"full",cancelButtonText:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})})}return e=function(){this.props.updateSection("apps")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.security.oauthApps","OAuth 2.0 Applications"),describe:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthAppsDescription",defaultMessage:"Click 'Edit' to manage your OAuth 2.0 Applications"}),updateSection:e})},s.startCreatingToken=function(){s.setState({tokenCreationState:ee})},s.stopCreatingToken=function(){s.setState({tokenCreationState:ae})},s.handleCreateToken=(0,u.default)(l.default.mark(function e(){var t,a,r,i,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.handleCancelConfirm(),""!==(t=s.refs.newtokendescription?s.refs.newtokendescription.value:"")){e.next=5;break}return s.setState({tokenError:H.localizeMessage("user.settings.tokens.nameRequired","Please enter a description.")}),e.abrupt("return");case 5:return s.setState({tokenError:""}),a=s.props.user?s.props.user.id:"",e.next=9,s.props.actions.createUserAccessToken(a,t);case 9:r=e.sent,i=r.data,o=r.error,i?s.setState({tokenCreationState:te,newToken:i}):o&&s.setState({serverError:o.message});case 13:case"end":return e.stop()}},e,n)})),s.handleCancelConfirm=function(){s.setState({showConfirmModal:!1,confirmTitle:null,confirmMessage:null,confirmButton:null,confirmComplete:null})},s.confirmCreateToken=function(){if(R.isSystemAdmin(s.props.user.roles))return void s.setState({showConfirmModal:!0,confirmTitle:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmCreateTitle",defaultMessage:"Create System Admin Personal Access Token"}),confirmMessage:k.default.createElement("div",{className:"alert alert-danger"},k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.confirmCreateMessage",defaultMessage:"You are generating a personal access token with System Admin permissions. Are you sure want to create this token?"})),confirmButton:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmCreateButton",defaultMessage:"Yes, Create"}),confirmComplete:function(){s.handleCreateToken(),(0,I.trackEvent)("settings","system_admin_create_user_access_token")}});s.handleCreateToken()},s.saveTokenKeyPress=function(e){e.which===F.default.KeyCodes.ENTER&&s.confirmCreateToken()},s.confirmRevokeToken=function(e){var t=s.props.userAccessTokens[e];s.setState({showConfirmModal:!0,confirmTitle:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmDeleteTitle",defaultMessage:"Delete Token?"}),confirmMessage:k.default.createElement("div",{className:"alert alert-danger"},k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.confirmDeleteMessage",defaultMessage:"Any integrations using this token will no longer be able to access the Mattermost API. You cannot undo this action. <br /><br />Are you sure want to delete the {description} token?",values:{description:t.description}})),confirmButton:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmDeleteButton",defaultMessage:"Yes, Delete"}),confirmComplete:function(){s.revokeToken(e),(0,I.trackEvent)("settings","revoke_user_access_token")}})},s.revokeToken=function(){var e=(0,u.default)(l.default.mark(function e(t){var a,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.props.actions.revokeUserAccessToken(t);case 2:a=e.sent,r=a.error,r&&s.setState({serverError:r.message}),s.handleCancelConfirm();case 6:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}(),s.activateToken=function(){var e=(0,u.default)(l.default.mark(function e(t){var a,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.props.actions.enableUserAccessToken(t);case 2:a=e.sent,r=a.error,r?s.setState({serverError:r.message}):(0,I.trackEvent)("settings","activate_user_access_token");case 5:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}(),s.deactivateToken=function(){var e=(0,u.default)(l.default.mark(function e(t){var a,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.props.actions.disableUserAccessToken(t);case 2:a=e.sent,r=a.error,r?s.setState({serverError:r.message}):(0,I.trackEvent)("settings","deactivate_user_access_token");case 5:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}(),s.createTokensSection=function(){var e=void 0,t="";if("tokens"===s.props.activeSection){var a=[];(0,i.default)(s.props.userAccessTokens).forEach(function(e){if(!s.state.newToken||s.state.newToken.id!==e.id){var t=void 0,n=void 0;e.is_active?t=k.default.createElement("a",{name:e.id+"_deactivate",href:"#",onClick:function(t){t.preventDefault(),s.deactivateToken(e.id)}},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.deactivate",defaultMessage:"Deactivate"})):(n=k.default.createElement("span",{className:"has-error setting-box__inline-error"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.deactivatedWarning",defaultMessage:"(Inactive)"})),t=k.default.createElement("a",{name:e.id+"_activate",href:"#",onClick:function(t){t.preventDefault(),s.activateToken(e.id)}},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.activate",defaultMessage:"Activate"}))),a.push(k.default.createElement("div",{key:e.id,className:"setting-box__item"},k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.tokenDesc",defaultMessage:"Token Description: "}),e.description,n),k.default.createElement("div",{className:"setting-box__token-id whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.tokenId",defaultMessage:"Token ID: "}),e.id),k.default.createElement("div",null,t," - ",k.default.createElement("a",{name:e.id+"_delete",href:"#",onClick:function(t){t.preventDefault(),s.confirmRevokeToken(e.id)}},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.delete",defaultMessage:"Delete"}))),k.default.createElement("hr",{className:"margin-bottom margin-top x2"})))}});var n=void 0;0===a.length&&(n=k.default.createElement(T.FormattedMessage,{key:"notokens",id:"user.settings.tokens.userAccessTokensNone",defaultMessage:"No personal access tokens."}));var r=void 0;r=(0,x.isMobile)()?k.default.createElement("span",null,k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.description_mobile",defaultMessage:'<a href="https://about.mattermost.com/default-user-access-tokens" target="_blank">Personal access tokens</a> function similarly to session tokens and can be used by integrations to <a href="https://about.mattermost.com/default-api-authentication" target="_blank">authenticate against the REST API</a>. Create new tokens on your desktop.'})):k.default.createElement("span",null,k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.description",defaultMessage:'<a href="https://about.mattermost.com/default-user-access-tokens" target="_blank">Personal access tokens</a> function similarly to session tokens and can be used by integrations to <a href="https://about.mattermost.com/default-api-authentication" target="_blank">authenticate against the REST API</a>.'}));var o=void 0;s.state.tokenCreationState===ee?o=k.default.createElement("div",{className:"padding-left x2"},k.default.createElement("div",{className:"row"},k.default.createElement("label",{className:"col-sm-auto control-label padding-right x2"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "})),k.default.createElement("div",{className:"col-sm-5"},k.default.createElement("input",{ref:"newtokendescription",className:"form-control",type:"text",maxLength:64,onKeyPress:s.saveTokenKeyPress}))),k.default.createElement("div",null,k.default.createElement("div",{className:"padding-top x2"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.nameHelp",defaultMessage:"Enter a description for your token to remember what it does."})),k.default.createElement("div",null,k.default.createElement("label",{id:"clientError",className:"has-error margin-top margin-bottom"},s.state.tokenError)),k.default.createElement("button",{className:"btn btn-primary",onClick:s.confirmCreateToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.save",defaultMessage:"Save"})),k.default.createElement("button",{className:"btn btn-default",onClick:s.stopCreatingToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.cancel",defaultMessage:"Cancel"})))):s.state.tokenCreationState===te?(0===a.length&&(t=" hidden"),o=k.default.createElement("div",{className:"alert alert-warning"},k.default.createElement("i",{className:"fa fa-warning margin-right"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.copy",defaultMessage:"Please copy the access token below. You won't be able to see it again!"}),k.default.createElement("br",null),k.default.createElement("br",null),k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "}),s.state.newToken.description),k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.id",defaultMessage:"Token ID: "}),s.state.newToken.id),k.default.createElement("strong",{className:"word-break--all"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),s.state.newToken.token))):o=k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.startCreatingToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.create",defaultMessage:"Create New Token"}));var l=[];return l.push(k.default.createElement("div",{key:"tokensSetting",className:"padding-top"},k.default.createElement("div",{key:"tokenList"},k.default.createElement("div",{className:"alert alert-transparent"+t},a,n),o))),e=function(e){this.props.updateSection(""),this.setState({newToken:null,tokenCreationState:ae,serverError:null,tokenError:""}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:H.localizeMessage("user.settings.tokens.title","Personal Access Tokens"),inputs:l,extraInfo:r,infoPosition:"top",server_error:s.state.serverError,updateSection:e,width:"full",cancelButtonText:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})})}var d=H.localizeMessage("user.settings.tokens.clickToEdit","Click 'Edit' to manage your personal access tokens");return e=function(){this.props.updateSection("tokens")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.tokens.title","Personal Access Tokens"),describe:d,updateSection:e})},s.state=s.getDefaultState(),s}return(0,_.default)(a,t),(0,E.default)(a,[{key:"getDefaultState",value:function(){return{currentPassword:"",newPassword:"",confirmPassword:"",passwordError:"",serverError:"",tokenError:"",showConfirmModal:!1,authService:this.props.user.auth_service,savingPassword:!1}}},{key:"componentDidMount",value:function(){var t=this;if("true"===e.mm_config.EnableOAuthServiceProvider&&(0,D.getAuthorizedApps)(function(e){t.setState({authorizedApps:e,serverError:null})},function(e){t.setState({serverError:e.message})}),this.props.canUseAccessTokens){this.props.actions.clearUserAccessTokens();var a=this.props.user?this.props.user.id:"";this.props.actions.getUserAccessTokensForUser(a,0,200)}}},{key:"render",value:function(){var t=this.props.user,a=window.mm_config,n=this.createPasswordSection(),s=0;s="true"===a.EnableSignUpWithGitLab?s+1:s,s="true"===a.EnableSignUpWithGoogle?s+1:s,s="true"===a.EnableLdap?s+1:s,s="true"===a.EnableSaml?s+1:s;var r=void 0;("true"===a.EnableSignUpWithEmail||""===t.auth_service)&&s>0&&"true"===a.ExperimentalEnableAuthenticationTransfer&&(r=this.createSignInSection());var i=void 0;"true"!==a.EnableMultifactorAuthentication||"true"!==e.window.mm_license.IsLicensed||""!==t.auth_service&&t.auth_service!==F.default.LDAP_SERVICE||(i=this.createMfaSection());var o=void 0;"true"===a.EnableOAuthServiceProvider&&(o=this.createOAuthAppsSection());var l=void 0;return this.props.canUseAccessTokens&&(l=this.createTokensSection()),k.default.createElement("div",null,k.default.createElement("div",{className:"modal-header"},k.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":H.localizeMessage("user.settings.security.close","Close"),onClick:this.props.closeModal},k.default.createElement("span",{"aria-hidden":"true"},"×")),k.default.createElement("h4",{className:"modal-title",ref:"title"},k.default.createElement("div",{className:"modal-back"},k.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"}))),k.default.createElement("div",{className:"user-settings"},k.default.createElement("h3",{className:"tab-header"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"})),k.default.createElement("div",{className:"divider-dark first"}),n,k.default.createElement("div",{className:"divider-light"}),i,k.default.createElement("div",{className:"divider-light"}),o,k.default.createElement("div",{className:"divider-light"}),l,k.default.createElement("div",{className:"divider-light"}),r,k.default.createElement("div",{className:"divider-dark"}),k.default.createElement("br",null),k.default.createElement($.default,{className:"security-links color--link",dialogType:V.default},k.default.createElement("i",{className:"fa fa-clock-o"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.viewHistory",defaultMessage:"View Access History"})),k.default.createElement($.default,{className:"security-links color--link margin-top",dialogType:q.default},k.default.createElement("i",{className:"fa fa-clock-o"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.logoutActiveSessions",defaultMessage:"View and Logout of Active Sessions"}))),k.default.createElement(Y.default,{title:this.state.confirmTitle,message:this.state.confirmMessage,confirmButtonText:this.state.confirmButton,show:this.state.showConfirmModal,onConfirm:this.state.confirmComplete||function(){},onCancel:this.handleCancelConfirm}))}}]),a}(k.default.Component);ne.propTypes={user:C.default.object,activeSection:C.default.string,updateSection:C.default.func,updateTab:C.default.func,closeModal:C.default.func.isRequired,collapseModal:C.default.func.isRequired,setEnforceFocus:C.default.func.isRequired,userAccessTokens:C.default.object,canUseAccessTokens:C.default.bool,actions:C.default.shape({getMe:C.default.func.isRequired,getUserAccessTokensForUser:C.default.func.isRequired,createUserAccessToken:C.default.func.isRequired,revokeUserAccessToken:C.default.func.isRequired,enableUserAccessToken:C.default.func.isRequired,disableUserAccessToken:C.default.func.isRequired,clearUserAccessTokens:C.default.func.isRequired}).isRequired},t.default=ne,ne.defaultProps={user:{},activeSection:""}}).call(t,a(23))},2343:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function r(e){return{actions:(0,d.bindActionCreators)({getUserAudits:u.getUserAudits},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(61),c=a(2344),f=n(c);t.default=(0,l.connect)(s,r)(f.default)},2344:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(35),S=a(17),_=a(27),M=n(_),C=a(16),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(C),k=a(1967),T=n(k),N=a(214),P=n(N),R=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));a.onAuditChange=a.onAuditChange.bind(a),a.onShow=a.onShow.bind(a),a.onHide=a.onHide.bind(a);var n=a.getStateFromStoresForAudits();return n.moreInfo=[],n.show=!0,a.state=n,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"getStateFromStoresForAudits",value:function(){return{audits:M.default.getAudits()}}},{key:"onShow",value:function(){this.props.actions.getUserAudits(M.default.getCurrentId(),0,200),w.isMobile()||(0,h.default)(".modal-body").perfectScrollbar()}},{key:"onHide",value:function(){this.setState({show:!1})}},{key:"componentDidMount",value:function(){M.default.addAuditsChangeListener(this.onAuditChange),this.onShow()}},{key:"componentWillUnmount",value:function(){M.default.removeAuditsChangeListener(this.onAuditChange)}},{key:"onAuditChange",value:function(){var e=this.getStateFromStoresForAudits();w.areObjectsEqual(e.audits,this.state.audits)||this.setState(e)}},{key:"render",value:function(){var e=void 0;return e=0===this.state.audits.length?b.default.createElement(P.default,null):b.default.createElement(T.default,{audits:this.state.audits,showIp:!0,showSession:!0}),b.default.createElement(y.Modal,{dialogClassName:"modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large"},b.default.createElement(y.Modal.Header,{closeButton:!0},b.default.createElement(y.Modal.Title,null,b.default.createElement(S.FormattedMessage,{id:"access_history.title",defaultMessage:"Access History"}))),b.default.createElement(y.Modal.Body,{ref:"modalBody"},e))}}]),t}(b.default.Component);R.propTypes={onHide:v.default.func.isRequired,actions:v.default.shape({getUserAudits:v.default.func.isRequired}).isRequired},t.default=R},2345:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function r(e){return{actions:(0,d.bindActionCreators)({getSessions:u.getSessions,revokeSession:u.revokeSession},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(61),c=a(2346),f=n(c);t.default=(0,l.connect)(s,r)(f.default)},2346:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(8),v=n(g),E=a(1),b=n(E),y=a(35),S=a(17),_=a(25),M=a(27),C=n(M),w=a(16),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(w),T=a(214),N=n(T),P=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));a.isMobileSession=function(e){return e.device_id&&(e.device_id.includes("apple")||e.device_id.includes("android"))},a.mobileSessionInfo=function(e){var t=void 0,a=void 0,n=void 0;return e.device_id.includes("apple")?(n="fa fa-apple",t="activity_log_modal.iphoneNativeClassicApp",a="iPhone Native Classic App",e.device_id.includes(_.General.PUSH_NOTIFY_APPLE_REACT_NATIVE)&&(t="activity_log_modal.iphoneNativeApp",a="iPhone Native App")):e.device_id.includes("android")&&(n="fa fa-android",t="activity_log_modal.androidNativeClassicApp",a="Android Native Classic App",e.device_id.includes(_.General.PUSH_NOTIFY_ANDROID_REACT_NATIVE)&&(t="activity_log_modal.androidNativeApp",a="Android Native App")),{devicePicture:n,devicePlatform:b.default.createElement(S.FormattedMessage,{id:t,defaultMessage:a})}},a.submitRevoke=a.submitRevoke.bind(a),a.onListenerChange=a.onListenerChange.bind(a),a.handleMoreInfo=a.handleMoreInfo.bind(a),a.onHide=a.onHide.bind(a),a.onShow=a.onShow.bind(a);var n=a.getStateFromStores();return n.moreInfo=[],n.show=!0,a.state=n,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"getStateFromStores",value:function(){return{sessions:C.default.getSessions(),clientError:null}}},{key:"submitRevoke",value:function(e,t){var a=this;t.preventDefault();var n=(0,h.default)(t.target).closest(".modal-content");n.addClass("animation--highlight"),setTimeout(function(){n.removeClass("animation--highlight")},1500),this.props.actions.revokeSession(C.default.getCurrentId(),e).then(function(){a.props.actions.getSessions(C.default.getCurrentId())})}},{key:"onShow",value:function(){this.props.actions.getSessions(C.default.getCurrentId()),k.isMobile()||(0,h.default)(".modal-body").perfectScrollbar()}},{key:"onHide",value:function(){this.setState({show:!1})}},{key:"componentDidMount",value:function(){C.default.addSessionsChangeListener(this.onListenerChange),this.onShow()}},{key:"componentWillUnmount",value:function(){C.default.removeSessionsChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){var e=this.getStateFromStores();k.areObjectsEqual(e.sessions,this.state.sessions)||this.setState(e)}},{key:"handleMoreInfo",value:function(e){var t=this.state.moreInfo;t[e]=!0,this.setState({moreInfo:t})}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.sessions.length;t++){var a=this.state.sessions[t],n=new Date(a.last_activity_at),s=new Date(a.create_at),r=a.props.platform,i="";if("UserAccessToken"!==a.props.type){if("Windows"===a.props.platform)i="fa fa-windows";else if(this.isMobileSession(a)){var o=this.mobileSessionInfo(a);i=o.devicePicture,r=o.devicePlatform}else"Macintosh"===a.props.platform||"iPhone"===a.props.platform?i="fa fa-apple":"Linux"===a.props.platform?a.props.os.indexOf("Android")>=0?(r=b.default.createElement(S.FormattedMessage,{id:"activity_log_modal.android",defaultMessage:"Android"}),i="fa fa-android"):i="fa fa-linux":-1!==a.props.os.indexOf("Linux")&&(i="fa fa-linux");-1!==a.props.browser.indexOf("Desktop App")&&(r=b.default.createElement(S.FormattedMessage,{id:"activity_log_modal.desktop",defaultMessage:"Native Desktop App"}));var l=void 0;l=this.state.moreInfo[t]?b.default.createElement("div",null,b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.firstTime",defaultMessage:"First time active: {date}, {time}",values:{date:b.default.createElement(S.FormattedDate,{value:s,day:"2-digit",month:"long",year:"numeric"}),time:b.default.createElement(S.FormattedTime,{value:s,hour:"2-digit",minute:"2-digit"})}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.os",defaultMessage:"OS: {os}",values:{os:a.props.os}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.browser",defaultMessage:"Browser: {browser}",values:{browser:a.props.browser}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.sessionId",defaultMessage:"Session ID: {id}",values:{id:a.id}}))):b.default.createElement("a",{className:"theme",href:"#",onClick:this.handleMoreInfo.bind(this,t)},b.default.createElement(S.FormattedMessage,{id:"activity_log.moreInfo",defaultMessage:"More info"})),e[t]=b.default.createElement("div",{key:"activityLogEntryKey"+t,className:"activity-log__table"},b.default.createElement("div",{className:"activity-log__report"},b.default.createElement("div",{className:"report__platform"},b.default.createElement("i",{className:i}),r),b.default.createElement("div",{className:"report__info"},b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.lastActivity",defaultMessage:"Last activity: {date}, {time}",values:{date:b.default.createElement(S.FormattedDate,{value:n,day:"2-digit",month:"long",year:"numeric"}),time:b.default.createElement(S.FormattedTime,{value:n,hour:"2-digit",minute:"2-digit"})}})),l)),b.default.createElement("div",{className:"activity-log__action"},b.default.createElement("button",{onClick:this.submitRevoke.bind(this,a.id),className:"btn btn-primary"},b.default.createElement(S.FormattedMessage,{id:"activity_log.logout",defaultMessage:"Logout"}))))}}var d=void 0;return d=this.state.sessions.loading?b.default.createElement(N.default,null):b.default.createElement("form",{role:"form"},e),b.default.createElement(y.Modal,{dialogClassName:"modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large"},b.default.createElement(y.Modal.Header,{closeButton:!0},b.default.createElement(y.Modal.Title,null,b.default.createElement(S.FormattedMessage,{id:"activity_log.activeSessions",defaultMessage:"Active Sessions"}))),b.default.createElement(y.Modal.Body,{ref:"modalBody"},b.default.createElement("p",{className:"session-help-text"},b.default.createElement(S.FormattedMessage,{id:"activity_log.sessionsDescription",defaultMessage:"Sessions are created when you log in to a new browser on a device. Sessions let you use Mattermost without having to log in again for a time period specified by the System Admin. If you want to log out sooner, use the 'Logout' button below to end a session."})),d))}}]),t}(b.default.Component);P.propTypes={onHide:v.default.func.isRequired,actions:v.default.shape({getSessions:v.default.func.isRequired,revokeSession:v.default.func.isRequired}).isRequired},t.default=P},2347:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(8),h=n(p),g=a(1),v=n(g),E=a(17),b=a(66),y=a(113),S=n(y),_=a(27),M=n(_),C=a(9),w=n(C),k=a(653),T=n(k),N=a(654),P=n(N),R=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.getStateFromStores=a.getStateFromStores.bind(a),a.updateSection=a.updateSection.bind(a),a.updateSetting=a.updateSetting.bind(a),a.renderAutoCloseDMSection=a.renderAutoCloseDMSection.bind(a),a.state=a.getStateFromStores(),a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"getStateFromStores",value:function(){return{settings:{close_unused_direct_messages:S.default.get(w.default.Preferences.CATEGORY_SIDEBAR_SETTINGS,"close_unused_direct_messages","after_seven_days")},isSaving:!1}}},{key:"updateSetting",value:function(e,t){var a=this.state.settings;a[e]=t,this.setState(a)}},{key:"handleSubmit",value:function(e){var t=this,a=[],n=M.default.getCurrentId();a.push({user_id:n,category:w.default.Preferences.CATEGORY_SIDEBAR_SETTINGS,name:e,value:this.state.settings[e]}),this.setState({isSaving:!0}),(0,b.savePreferences)(a,function(){t.updateSection("")})}},{key:"updateSection",value:function(e){e||this.setState(this.getStateFromStores()),this.setState({isSaving:!1}),this.props.updateSection(e)}},{key:"renderAutoCloseDMLabel",value:function(e){return"after_seven_days"===e?v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.never",defaultMessage:"Never"})}},{key:"renderAutoCloseDMSection",value:function(){var e=this;return"autoCloseDM"===this.props.activeSection?v.default.createElement(T.default,{title:v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),inputs:[v.default.createElement("div",{key:"autoCloseDMSetting"},v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"autoCloseDMAfterSevenDays",type:"radio",name:"autoCloseDM",checked:"after_seven_days"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,"close_unused_direct_messages","after_seven_days")}),v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"autoCloseDMNever",type:"radio",name:"autoCloseDM",checked:"never"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,"close_unused_direct_messages","never")}),v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.never",defaultMessage:"Never"})),v.default.createElement("br",null)),v.default.createElement("div",null,v.default.createElement("br",null),v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.autoCloseDMDesc",defaultMessage:"Direct Message conversations can be reopened with the “+” button in the sidebar or using the Channel Switcher (CTRL+K)."})))],submit:function(){return e.handleSubmit("close_unused_direct_messages")},saving:this.state.isSaving,server_error:this.state.serverError,updateSection:function(t){e.updateSection(""),t.preventDefault()}}):v.default.createElement(P.default,{title:v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),describe:this.renderAutoCloseDMLabel(this.state.settings.close_unused_direct_messages),updateSection:function(){return e.props.updateSection("autoCloseDM")}})}},{key:"render",value:function(){var e=this.renderAutoCloseDMSection();return v.default.createElement("div",null,v.default.createElement("div",{className:"modal-header"},v.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},v.default.createElement("span",{"aria-hidden":"true"},"×")),v.default.createElement("h4",{className:"modal-title",ref:"title"},v.default.createElement("div",{className:"modal-back"},v.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"}))),v.default.createElement("div",{className:"user-settings"},v.default.createElement("h3",{className:"tab-header"},v.default.createElement(E.FormattedMessage,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"})),v.default.createElement("div",{className:"divider-dark first"}),e,v.default.createElement("div",{className:"divider-dark"})))}}]),t}(v.default.Component);t.default=R,R.propTypes={user:h.default.object,updateSection:h.default.func,updateTab:h.default.func,activeSection:h.default.string,closeModal:h.default.func.isRequired,collapseModal:h.default.func.isRequired}},2348:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(0),g=s(h),v=a(1),E=s(v),b=a(17),y=a(56),S=n(y),_=a(285),M=n(_),C=a(27),w=s(C),k=a(388),T=s(k),N=a(392),P=s(N),R=a(9),I=a(16),D=n(I),L=a(2067),A=s(L),O=R.Constants.PRE_RELEASE_FEATURES,F=function(e){function t(){(0,l.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.mounted=!1,e.closeNotification=e.closeNotification.bind(e),e.onIncomingCall=e.onIncomingCall.bind(e),e.onCancelCall=e.onCancelCall.bind(e),e.onRhs=e.onRhs.bind(e),e.handleClose=e.handleClose.bind(e),e.handleAnswer=e.handleAnswer.bind(e),e.handleTimeout=e.handleTimeout.bind(e),e.stopRinging=e.stopRinging.bind(e),e.closeRightHandSide=e.closeRightHandSide.bind(e),e.state={userCalling:null,rhsOpened:!1},e}return(0,p.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){T.default.addNotifyListener(this.onIncomingCall),T.default.addChangedListener(this.onCancelCall),T.default.addRhsChangedListener(this.onRhs),this.mounted=!0}},{key:"componentWillUnmount",value:function(){T.default.removeNotifyListener(this.onIncomingCall),T.default.removeChangedListener(this.onCancelCall),T.default.removeRhsChangedListener(this.onRhs),this.refs.ring&&this.refs.ring.removeListener("ended",this.handleTimeout),this.mounted=!1}},{key:"componentDidUpdate",value:function(){this.state.userCalling&&this.refs.ring.addEventListener("ended",this.handleTimeout)}},{key:"closeNotification",value:function(){this.setState({userCalling:null})}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0),this.setState({userCalling:null})}},{key:"closeRightHandSide",value:function(e){e.preventDefault(),S.emitCloseRightHandSide(),setTimeout(function(){(0,g.default)(".app__body .inner-wrap").addClass("move--left")},0)}},{key:"onIncomingCall",value:function(e){if(this.mounted){var t=e.from_user_id,a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;D.isFeatureEnabled(O.WEBRTC_PREVIEW)?T.default.isBusy()?(P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.BUSY,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging()):a?(T.default.setVideoCallWith(t),this.setState({userCalling:w.default.getProfile(t)})):(P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.UNSUPPORTED,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging()):(P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.DISABLED,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging())}}},{key:"onCancelCall",value:function(e){if(e){if(e.action!==R.WebrtcActionTypes.CANCEL)return;if(this.state.userCalling)if(e.from_user_uid===w.default.getCurrentId()&&e.calling_user_id===this.state.userCalling.id);else if(e.from_user_id!==this.state.userCalling.id)return}T.default.setVideoCallWith(null),this.closeNotification()}},{key:"onRhs",value:function(e){this.setState({rhsOpened:e})}},{key:"handleTimeout",value:function(){P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.NO_ANSWER,from_user_id:w.default.getCurrentId(),to_user_id:this.state.userCalling.id}),this.onCancelCall()}},{key:"handleAnswer",value:function(e){e&&e.preventDefault();var t=this.state.userCalling;if(t){var a=t.id,n=w.default.getCurrentId(),s={action:R.WebrtcActionTypes.ANSWER,from_user_id:n,to_user_id:a};S.emitCloseRightHandSide(),M.initWebrtc(a,!1),P.default.sendMessage("webrtc",s),setTimeout(function(){s.from_user_id=a,s.to_user_id=n,M.handle(s),P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.CANCEL,from_user_id:n,to_user_id:n,calling_user_id:a})},0),this.closeNotification()}}},{key:"handleClose",value:function(e){e&&e.preventDefault(),this.state.userCalling&&(P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.CANCEL,from_user_id:w.default.getCurrentId(),to_user_id:w.default.getCurrentId(),calling_user_id:this.state.userCalling.id}),P.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.DECLINE,from_user_id:w.default.getCurrentId(),to_user_id:this.state.userCalling.id})),this.onCancelCall()}},{key:"render",value:function(){var e=this.state.userCalling;if(e){var t=D.displayUsername(e.id),a=D.imageURLForUser(e),n=E.default.createElement("img",{className:"user-popover__image",src:a,height:"128",width:"128",key:"user-popover-image"}),s=E.default.createElement("svg",{className:"webrtc-icons__pickup",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleAnswer},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.answer",defaultMessage:"Answer"}))),E.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"})),r=E.default.createElement("svg",{className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleClose},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.decline",defaultMessage:"Decline"}))),E.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})),i=E.default.createElement("div",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.incoming_call",defaultMessage:"{username} is calling you.",values:{username:t}}),E.default.createElement("div",{className:"webrtc-buttons webrtc-icons active",style:{marginTop:"5px"}},s,r));return E.default.createElement("div",{className:"webrtc-notification"},E.default.createElement("audio",{ref:"ring",src:A.default,autoPlay:!0}),E.default.createElement("div",null,n),i)}return this.state.rhsOpened&&T.default.isBusy()?E.default.createElement("div",{className:"webrtc__notification--rhs",onClick:this.closeRightHandSide},E.default.createElement("i",{className:"fa fa-phone"}),E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.returnToCall",defaultMessage:"Return to ongoing call with {username}",values:{username:D.displayUsername(T.default.getVideoCallWith())}})):E.default.createElement("div",null)}}]),t}(E.default.Component);t.default=F},2349:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(5),r=n(s),i=a(3),o=n(i),l=a(4),d=n(l),u=a(6),c=n(u),f=a(7),m=n(f),p=a(0),h=n(p),g=a(1),v=n(g),E=a(27),b=n(E),y=a(388),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=a(2350),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.plScrolledToBottom=!0,a.onShrink=a.onShrink.bind(a),a.toggleSize=a.toggleSize.bind(a),a.onInitializeVideoCall=a.onInitializeVideoCall.bind(a),a.doStrangeThings=a.doStrangeThings.bind(a),a.state={expanded:!1,currentUser:b.default.getCurrentUser(),videoCallVisible:!1,isCaller:!1,videoCallWithUserId:null},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){S.default.addInitListener(this.onInitializeVideoCall),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){S.default.removeInitListener(this.onInitializeVideoCall)}},{key:"shouldComponentUpdate",value:function(e,t){return!M.areObjectsEqual(t,this.state)}},{key:"doStrangeThings",value:function(){return(0,h.default)(".app__body .inner-wrap").removeClass("move--right"),(0,h.default)(".app__body .inner-wrap").addClass("webrtc--show move--left"),(0,h.default)(".app__body .sidebar--left").removeClass("move--right"),(0,h.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,h.default)(".app__body .webrtc").addClass("webrtc--show"),this.state.videoCallVisible?null:((0,h.default)(".app__body .inner-wrap").removeClass("webrtc--show move--left move--right"),(0,h.default)(".app__body .webrtc").removeClass("webrtc--show"),v.default.createElement("div",null))}},{key:"componentDidUpdate",value:function(){this.doStrangeThings()}},{key:"onShrink",value:function(){this.setState({expanded:!1})}},{key:"toggleSize",value:function(e){e&&e.preventDefault(),this.setState(function(e){return{expanded:!e.expanded}})}},{key:"onInitializeVideoCall",value:function(e,t){var a=this.state.expanded;null===e&&(a=!1),this.setState({videoCallVisible:null!==e,isCaller:t,videoCallWithUserId:e,expanded:a}),null!==e&&this.forceUpdate()}},{key:"render",value:function(){var e=null,t="";return this.state.expanded&&(t="sidebar--right--expanded"),this.state.videoCallVisible&&(e=v.default.createElement(w.default,{currentUser:this.state.currentUser,userId:this.state.videoCallWithUserId,isCaller:this.state.isCaller,expanded:this.state.expanded,toggleSize:this.toggleSize})),v.default.createElement("div",{className:"sidebar--right webrtc "+t,id:"sidebar-webrtc"},v.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),v.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(v.default.Component);t.default=k},2350:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(5),i=s(r),o=a(3),l=s(o),d=a(4),u=s(d),c=a(6),f=s(c),m=a(7),p=s(m),h=a(8),g=s(h),v=a(1),E=s(v),b=a(17),y=a(2351),S=s(y),_=a(215),M=a(285),C=n(M),w=a(31),k=s(w),T=a(27),N=s(T),P=a(388),R=s(P),I=a(392),D=s(I),L=a(9),A=a(16),O=n(A),F=a(2067),x=s(F),U=a(214),H=s(U),j=a(669),B=s(j),G=a(2363),V=s(G),z=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));t.mounted=!1,t.localMedia=null,t.session=null,t.videocall=null,t.handleResize=t.handleResize.bind(t),t.handleClose=t.handleClose.bind(t),t.close=t.close.bind(t),t.clearError=t.clearError.bind(t),t.getLocalMedia=t.getLocalMedia.bind(t),t.stopMediaStream=t.stopMediaStream.bind(t),t.previewVideo=t.previewVideo.bind(t),t.stopRinging=t.stopRinging.bind(t),t.handleMakeOffer=t.handleMakeOffer.bind(t),t.handleCancelOffer=t.handleCancelOffer.bind(t),t.handleWebrtcEvent=t.handleWebrtcEvent.bind(t),t.handleVideoCallEvent=t.handleVideoCallEvent.bind(t),t.handleRemoteStream=t.handleRemoteStream.bind(t),t.onStatusChange=t.onStatusChange.bind(t),t.onCallDeclined=t.onCallDeclined.bind(t),t.onUnsupported=t.onUnsupported.bind(t),t.onNoAnswer=t.onNoAnswer.bind(t),t.onBusy=t.onBusy.bind(t),t.onDisabled=t.onDisabled.bind(t),t.onFailed=t.onFailed.bind(t),t.onCancelled=t.onCancelled.bind(t),t.onConnectCall=t.onConnectCall.bind(t),t.onSessionCreated=t.onSessionCreated.bind(t),t.onSessionError=t.onSessionError.bind(t),t.doCall=t.doCall.bind(t),t.doAnswer=t.doAnswer.bind(t),t.doHangup=t.doHangup.bind(t),t.doCleanup=t.doCleanup.bind(t),t.renderButtons=t.renderButtons.bind(t),t.onToggleVideo=t.onToggleVideo.bind(t),t.onToggleAudio=t.onToggleAudio.bind(t),t.onToggleRemoteMute=t.onToggleRemoteMute.bind(t),t.toggleIcons=t.toggleIcons.bind(t);var n=N.default.getCurrentUser(),s=N.default.getProfile(e.userId),r=O.imageURLForUser(s);return t.state={windowWidth:O.windowWidth(),windowHeight:O.windowHeight(),channelId:k.default.getCurrentId(),currentUser:n,currentUserImage:O.imageURLForUser(n),remoteUserImage:r,localMediaLoaded:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,errorType:"",ended:null},t}return(0,p.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),R.default.addChangedListener(this.handleWebrtcEvent),N.default.addStatusesChangeListener(this.onStatusChange),this.mounted=!0,this.previewVideo(),this.props.isCaller&&this.handleMakeOffer()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),R.default.removeChangedListener(this.handleWebrtcEvent),N.default.removeStatusesChangeListener(this.onStatusChange),this.mounted=!1,this.close()}},{key:"componentWillReceiveProps",value:function(e){if(e.currentUser!==this.props.currentUser||e.userId!==this.props.userId||e.isCaller!==this.props.isCaller){var t=N.default.getProfile(e.userId),a=O.imageURLForUser(t);this.setState({error:null,remoteUserImage:a})}e.isCaller&&e.expanded===this.props.expanded&&(this.startCall=!0)}},{key:"componentDidUpdate",value:function(){this.props.isCaller&&this.startCall&&(this.startCall=!1,this.handleMakeOffer())}},{key:"handleResize",value:function(){this.setState({windowWidth:O.windowWidth(),windowHeight:O.windowHeight()})}},{key:"clearError",value:function(){var e=this;setTimeout(function(){e.setState({error:null,ended:null,errorType:""})},L.Constants.WEBRTC_CLEAR_ERROR_DELAY)}},{key:"getLocalMedia",value:function(e,t,a){var n=e||{audio:!0,video:!0};navigator.mediaDevices.getUserMedia(n).then(function(e){t&&(t.srcObject=e),a&&"function"==typeof a&&a(null,e)}).catch(function(e){a(e)})}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){e.stop()})}},{key:"previewVideo",value:function(){var e=this;this.mounted&&(this.localMedia?(this.setState({localMediaLoaded:!0,error:null}),this.localMedia.enabled=!0):this.getLocalMedia({audio:!0,video:{minAspectRatio:1.777,maxAspectRatio:1.778,width:640,height:360}},this.refs["local-video"],function(t,a){if(t)return void e.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.mediaError",defaultMessage:"Unable to access Camera and Microphone"})});e.localMedia=a,e.setState({localMediaLoaded:!0})}))}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0)}},{key:"handleMakeOffer",value:function(){if(N.default.getStatus(this.props.userId)===L.UserStatuses.OFFLINE)this.onStatusChange();else{var e=E.default.createElement(b.FormattedMessage,{id:"calling_screen",defaultMessage:"Calling"});this.setState({isCalling:!0,isAnswering:!1,callInProgress:!1,error:null,ended:null,connectingMsg:e}),R.default.setVideoCallWith(this.props.userId);var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:L.WebrtcActionTypes.NOTIFY,from_user_id:t.id,to_user_id:this.props.userId})}}},{key:"handleCancelOffer",value:function(){this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,ended:null});var e=this.state.currentUser;D.default.sendMessage("webrtc",{action:L.WebrtcActionTypes.CANCEL,from_user_id:e.id,to_user_id:this.props.userId}),this.doCleanup()}},{key:"handleWebrtcEvent",value:function(e){switch(e.action){case L.WebrtcActionTypes.DECLINE:this.onCallDeclined(),this.clearError();break;case L.WebrtcActionTypes.UNSUPPORTED:this.onUnsupported(),this.clearError();break;case L.WebrtcActionTypes.BUSY:this.onBusy(),this.clearError();break;case L.WebrtcActionTypes.NO_ANSWER:this.onNoAnswer(),this.clearError();break;case L.WebrtcActionTypes.FAILED:this.onFailed(),this.clearError();break;case L.WebrtcActionTypes.ANSWER:this.onConnectCall();break;case L.WebrtcActionTypes.CANCEL:this.onCancelled(),this.clearError();break;case L.WebrtcActionTypes.MUTED:this.onToggleRemoteMute(e);break;case L.WebrtcActionTypes.IN_PROGRESS:this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}),this.clearError();break;case L.WebrtcActionTypes.DISABLED:this.onDisabled(),this.clearError()}}},{key:"handleVideoCallEvent",value:function(e,t){var a=e.result;if(a){switch(a.event){case"registered":this.state.isCalling&&this.doCall();break;case"incomingcall":this.doAnswer(t);break;case"accepted":this.stopRinging(),t&&this.videocall.handleRemoteJsep({jsep:t});break;case"hangup":this.doHangup(!1)}}else{var n=e.error_code;477!==n&&476!==n?this.doHangup(!0):this.state.isCalling&&this.doCall()}}},{key:"handleRemoteStream",value:function(e){this.refs["main-video"].srcObject=e;var t=!1,a=!1,n=e.getVideoTracks(),s=e.getAudioTracks();n&&0!==n.length&&!n[0].muted&&n[0].enabled||(t=!0),s&&0!==s.length&&!s[0].muted&&s[0].enabled||(a=!0),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!0,isMuted:!1,isPaused:!1,error:null,ended:null,isRemotePaused:t,isRemoteMuted:a});var r=this.refs.icons;r&&(r.classList.remove("hidden"),r.classList.add("active"))}},{key:"handleClose",value:function(e){e.preventDefault(),this.state.callInProgress?this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}):this.state.isCalling?(this.handleCancelOffer(),this.close()):this.close()}},{key:"close",value:function(){this.doCleanup(),this.session&&(this.session.destroy(),this.session=null),this.localMedia&&(this.stopMediaStream(this.localMedia),this.localMedia=null),C.initWebrtc(null,!1)}},{key:"onStatusChange",value:function(){var e=N.default.getStatus(this.props.userId);if(e===L.UserStatuses.OFFLINE){var t=E.default.createElement(b.FormattedMessage,{id:"webrtc.offline",defaultMessage:"{username} is offline",values:{username:O.displayUsername(this.props.userId)}});this.state.isCalling||this.state.isAnswering?this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:t}):this.setState({error:t})}else e!==L.UserStatuses.OFFLINE&&this.state.error&&this.setState({error:null,ended:null})}},{key:"onCallDeclined",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.declined",defaultMessage:"Your call has been declined by {username}",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onUnsupported",value:function(){this.mounted&&(this.stopRinging(),this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.unsupported",defaultMessage:"Call to {username} not successful. Their client does not support video calls.",values:{username:O.displayUsername(this.props.userId)}}),callInProgress:!1,isCalling:!1,isAnswering:!1})),this.doCleanup()}},{key:"onNoAnswer",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.noAnswer",defaultMessage:"{username} is not answering the call",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onBusy",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.busy",defaultMessage:"{username} is busy",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onDisabled",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.disabled",defaultMessage:"{username} has WebRTC disabled, and cannot receive calls. To enable the feature, they must go to Account Settings > Advanced > Preview pre-release features and turn on WebRTC.",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onFailed",value:function(){(0,_.trackEvent)("api","api_users_webrtc_failed"),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:E.default.createElement(b.FormattedMessage,{id:"webrtc.failed",defaultMessage:"There was a problem connecting the video call"})}),this.stopRinging(),this.doCleanup()}},{key:"onCancelled",value:function(){this.mounted&&this.state.isAnswering&&(this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:E.default.createElement(b.FormattedMessage,{id:"webrtc.cancelled",defaultMessage:"{username} cancelled the call",values:{username:O.displayUsername(this.props.userId)}})})),this.doCleanup()}},{key:"onConnectCall",value:function(){var t=this;C.webrtcToken(function(a){var n=E.default.createElement(b.FormattedMessage,{id:"connecting_screen",defaultMessage:"Connecting"});if(t.setState({isAnswering:!t.state.isCalling,connectingMsg:n}),t.session)t.onSessionCreated();else{var s=[];a.stun_uri&&s.push({urls:a.stun_uri.split(" ")}),a.turn_uri&&s.push({urls:a.turn_uri.split(" "),username:a.turn_username,credential:a.turn_password}),S.default.init({debug:"true"===e.mm_config.EnableDeveloper}),t.session=new S.default({server:a.gateway_url,iceServers:s,token:a.token,success:t.onSessionCreated,error:t.onSessionError})}},function(){t.onSessionError()})}},{key:"onSessionCreated",value:function(){var e=this;this.videocall?this.doCall():this.session.attach({plugin:"janus.plugin.videocall",success:function(t){e.videocall=t,e.videocall.send({message:{request:"register",username:e.state.currentUser.id}})},error:this.onSessionError,onmessage:this.handleVideoCallEvent,onremotestream:this.handleRemoteStream})}},{key:"onSessionError",value:function(){var e=this.state.currentUser;D.default.sendMessage("webrtc",{action:L.WebrtcActionTypes.FAILED,from_user_id:e.id,to_user_id:this.props.userId}),this.onFailed()}},{key:"doCall",value:function(){var e=this;setTimeout(function(){e.videocall.createOffer({stream:e.localMedia,success:function(t){var a={request:"call",username:e.props.userId};e.videocall.send({message:a,jsep:t})},error:function(){e.doHangup(!0)}})},L.Constants.WEBRTC_TIME_DELAY)}},{key:"doAnswer",value:function(e){var t=this;(0,_.trackEvent)("api","api_users_webrtc_start"),this.videocall.createAnswer({jsep:e,stream:this.localMedia,success:function(e){var a={request:"accept"};t.videocall.send({message:a,jsep:e})},error:function(){t.doHangup(!0)}})}},{key:"doHangup",value:function(e,t){return(0,_.trackEvent)("api","api_users_webrtc_end"),this.videocall&&this.state.callInProgress&&(this.videocall.send({message:{request:"hangup"}}),this.videocall.hangup(),this.toggleIcons(),this.localMedia&&(this.localMedia.getVideoTracks()[0].enabled=!0,this.localMedia.getAudioTracks()[0].enabled=!0)),e?(this.onSessionError(),this.doCleanup()):(R.default.setVideoCallWith(null),R.default.emitRhsChanged(!1),t?this.close():(this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:null,ended:E.default.createElement(b.FormattedMessage,{id:"webrtc.callEnded",defaultMessage:"Call with {username} ended.",values:{username:O.displayUsername(this.props.userId)}})}),this.clearError(),this.doCleanup()))}},{key:"doCleanup",value:function(){R.default.setVideoCallWith(null),this.videocall&&(this.videocall.detach(),this.videocall=null)}},{key:"onToggleVideo",value:function(){var e=!this.state.isPaused;e?this.videocall.unmuteVideo():this.videocall.muteVideo();var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:L.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"video",mute:e}),this.setState({isPaused:e,error:null,ended:null})}},{key:"onToggleAudio",value:function(){var e=!this.state.isMuted;e?this.videocall.unmuteAudio():this.videocall.muteAudio();var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:L.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"audio",mute:e}),this.setState({isMuted:e,error:null,ended:null})}},{key:"onToggleRemoteMute",value:function(e){"video"===e.type?this.setState({isRemotePaused:e.mute}):this.setState({isRemoteMuted:e.mute,error:null,ended:null})}},{key:"toggleIcons",value:function(){var e=this.refs.icons;e&&(e.classList.toggle("hidden"),e.classList.toggle("active"))}},{key:"renderButtons",value:function(){var e=this,t=void 0;if(this.state.isCalling)t=E.default.createElement("svg",{id:"cancel",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleCancelOffer()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.cancel",defaultMessage:"Cancel Call"}))),E.default.createElement("path",{transform:"scale(0.8), translate(6,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"}));else if(!this.state.callInProgress&&this.state.localMediaLoaded)t=E.default.createElement("svg",{id:"call",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleMakeOffer()},disabled:"offline"===N.default.getStatus(this.props.userId)},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.call",defaultMessage:"Call"}))),E.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"}));else if(this.state.callInProgress){var a="off",n="on",s="off",r="on",i=E.default.createElement(b.FormattedMessage,{id:"webrtc.mute_audio",defaultMessage:"Mute"}),o=E.default.createElement(b.FormattedMessage,{id:"webrtc.pause_video",defaultMessage:"Turn off Video"});this.state.isMuted&&(a="on",n="off",i=E.default.createElement(b.FormattedMessage,{id:"webrtc.unmute_audio",defaultMessage:"Unmute"})),this.state.isPaused&&(s="on",r="off",o=E.default.createElement(b.FormattedMessage,{id:"webrtc.unpause_video",defaultMessage:"Turn on Video"})),t=E.default.createElement("div",{ref:"icons",className:"webrtc-icons hidden"},E.default.createElement("svg",{id:"mute-audio",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleAudio()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,i)),E.default.createElement("path",{className:a,transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),E.default.createElement("path",{className:n,transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"})),E.default.createElement("svg",{id:"mute-video",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleVideo()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,o)),E.default.createElement("path",{className:s,transform:"scale(0.6), translate(17,16)",d:"M40 8H15.64l8 8H28v4.36l1.13 1.13L36 16v12.36l7.97 7.97L44 36V12c0-2.21-1.79-4-4-4zM4.55 2L2 4.55l4.01 4.01C4.81 9.24 4 10.52 4 12v24c0 2.21 1.79 4 4 4h29.45l4 4L44 41.46 4.55 2zM12 16h1.45L28 30.55V32H12V16z",fill:"white"}),E.default.createElement("path",{className:r,transform:"scale(0.6), translate(17,16)",d:"M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm-4 24l-8-6.4V32H12V16h16v6.4l8-6.4v16z",fill:"white"})),E.default.createElement("svg",{id:"hangup",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.doHangup(!1,!0)}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.hangup",defaultMessage:"Hang up"}))),E.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})))}return t}},{key:"render",value:function(){var e=N.default.getCurrentId(),t=E.default.createElement("img",{src:this.state.remoteUserImage}),a=void 0,n="",s="hidden",r=void 0,i=void 0,o="webrtc__local-image hidden",l="webrtc__remote-image";this.state.error?r=E.default.createElement("div",{className:"webrtc__error"},E.default.createElement("div",{className:"form-group has-error"},E.default.createElement("label",{className:"control-label"+this.state.errorType},this.state.error))):this.state.ended&&(r=E.default.createElement("div",{className:"webrtc__error"},E.default.createElement("div",{className:"form-group"},E.default.createElement("label",{className:"control-label"},this.state.ended)))),this.state.isRemoteMuted&&(i=E.default.createElement("div",{className:"webrtc__remote-mute"},E.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"-10 -10 68 68"},E.default.createElement("path",{className:"off",transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),E.default.createElement("path",{className:"on",transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"}))));var d=void 0;null!=e&&(d=E.default.createElement(B.default,null));var u=this.renderButtons(),c=this.state.isCalling,f=void 0,m=void 0;return(c||this.state.isAnswering)&&(c&&(m=E.default.createElement("audio",{ref:"ring",src:x.default,autoPlay:!0})),f=E.default.createElement("div",{className:"connecting"},E.default.createElement(H.default,{position:"absolute",message:this.state.connectingMsg}),m)),this.state.callInProgress&&(this.state.isPaused&&(n="hidden",o="webrtc__local-image",a=E.default.createElement("img",{src:this.state.currentUserImage})),this.state.isRemotePaused?(s="hidden",l="webrtc__remote-image"):(s="",l="webrtc__remote-image hidden")),E.default.createElement("div",{className:"post-right__container"},E.default.createElement("div",{className:"search-bar__container channel-header alt"},d),E.default.createElement("div",{className:"sidebar-right__body"},E.default.createElement(V.default,{username:O.displayUsername(this.props.userId),onClose:this.handleClose,toggleSize:this.props.toggleSize}),E.default.createElement("div",{className:"post-right__scroll"},E.default.createElement("div",{id:"videos"},i,E.default.createElement("div",{id:"main-video",className:s,autoPlay:!0},E.default.createElement("video",{ref:"main-video",autoPlay:!0})),E.default.createElement("div",{id:"local-video",className:n},E.default.createElement("video",{ref:"local-video",autoPlay:!0,muted:!0})),E.default.createElement("div",{className:l},t),E.default.createElement("div",{className:o},a)),r,f,E.default.createElement("div",{className:"webrtc-buttons"},u))))}}]),a}(E.default.Component);t.default=z,z.propTypes={currentUser:g.default.object,userId:g.default.string.isRequired,isCaller:g.default.bool.isRequired,expanded:g.default.bool.isRequired,toggleSize:g.default.func}}).call(t,a(23))},2351:function(e,t,a){function n(e){function t(){if(null!=X){if(n.debug("Long poll..."),!J)return void n.warn("Is the gateway down? (connected=false)");var s=j+"/"+X+"?rid="+(new Date).getTime();void 0!==W&&null!==W&&(s=s+"&maxev="+W),null!==Y&&void 0!==Y&&(s=s+"&token="+Y),null!==K&&void 0!==K&&(s=s+"&apisecret="+K),n.httpAPICall(s,{verb:"GET",withCredentials:q,success:a,timeout:6e4,error:function(a,s){if(n.error(a+": "+s),++$>3)return J=!1,void e.error("Lost connection to the gateway (is it down?)");t()}})}}function a(e,s){if($=0,A||void 0===X||null===X||!0===s||setTimeout(t,200),A||!n.isArray(e)){if("keepalive"===e.janus)return void n.vdebug("Got a keepalive on session "+X);if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus){n.debug("Got a webrtcup event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var i=Q[r];return void 0===i||null===i?void n.debug("This handle is not attached to this session"):void i.webrtcState(!0)}if("hangup"===e.janus){n.debug("Got a hangup event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var i=Q[r];if(void 0===i||null===i)return void n.debug("This handle is not attached to this session");i.webrtcState(!1,e.reason),i.hangup()}else if("detached"===e.janus){n.debug("Got a detached event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var i=Q[r];if(void 0===i||null===i)return;i.detached=!0,i.ondetached(),i.detach()}else if("media"===e.janus){n.debug("Got a media event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var i=Q[r];if(void 0===i||null===i)return void n.debug("This handle is not attached to this session");i.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){n.debug("Got a slowlink event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var i=Q[r];if(void 0===i||null===i)return void n.debug("This handle is not attached to this session");i.slowLink(e.uplink,e.nacks)}else{if("error"===e.janus){n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug(e);var o=e.transaction;if(null!==o&&void 0!==o){var l=ee[o];null!==l&&void 0!==l&&l(e),delete ee[o]}return}if("event"===e.janus){n.debug("Got a plugin event on session "+X),n.debug(e);var r=e.sender;if(void 0===r||null===r)return void n.warn("Missing sender...");var d=e.plugindata;if(void 0===d||null===d)return void n.warn("Missing plugindata...");n.debug("  -- Event is coming from "+r+" ("+d.plugin+")");var u=d.data;n.debug(u);var i=Q[r];if(void 0===i||null===i)return void n.warn("This handle is not attached to this session");var c=e.jsep;void 0!==c&&null!==c&&(n.debug("Handling SDP as well..."),n.debug(c));var f=i.onmessage;null!==f&&void 0!==f?(n.debug("Notifying application..."),f(u,c)):n.debug("No provided notification callback")}else n.warn("Unkown message/event  '"+e.janus+"' on session "+X),n.debug(e)}}else{n.debug("Got a success on session "+X),n.debug(e);var o=e.transaction;if(null!==o&&void 0!==o){var l=ee[o];null!==l&&void 0!==l&&l(e),delete ee[o]}}else{n.debug("Got an ack on session "+X),n.debug(e);var o=e.transaction;if(null!==o&&void 0!==o){var l=ee[o];null!==l&&void 0!==l&&l(e),delete ee[o]}}}else for(var m=0;m<e.length;m++)a(e[m],!0)}function s(){if(null!==j&&A&&J){x=setTimeout(s,3e4);var e={janus:"keepalive",session_id:X,transaction:n.randomString(12)};null!==Y&&void 0!==Y&&(e.token=Y),null!==K&&void 0!==K&&(e.apisecret=K),O.send(JSON.stringify(e))}}function r(i){var o=n.randomString(12),l={janus:"create",transaction:o};if(null!==Y&&void 0!==Y&&(l.token=Y),null!==K&&void 0!==K&&(l.apisecret=K),null===j&&n.isArray(U)&&(j=U[H],0===j.indexOf("ws")?(A=!0,n.log("Server #"+(H+1)+": trying WebSockets to contact Janus ("+j+")")):(A=!1,n.log("Server #"+(H+1)+": trying REST API to contact Janus ("+j+")"))),A){O=n.newWebSocket(j,"janus-protocol"),F={error:function(){if(n.error("Error connecting to the Janus WebSockets server... "+j),n.isArray(U))return++H==U.length?void i.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(j=null,void setTimeout(function(){r(i)},200));i.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){ee[o]=function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void i.error(e.error.reason);x=setTimeout(s,3e4),J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=Z,i.success()},O.send(JSON.stringify(l))},message:function(e){a(JSON.parse(e.data))},close:function(){null!==j&&J&&(J=!1,e.error("Lost connection to the gateway (is it down?)"))}};for(var d in F)O.addEventListener(d,F[d])}else n.httpAPICall(j,{verb:"POST",withCredentials:q,body:l,success:function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void i.error(e.error.reason);J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=Z,t(),i.success()},error:function(e,t){if(n.error(e+": "+t),n.isArray(U))return++H==U.length?void i.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(j=null,void setTimeout(function(){r(i)},200));""===t?i.error(e+": Is the gateway down?"):i.error(e+": "+t)}})}function i(t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop;var a=!0;if(void 0!==t.asyncRequest&&null!==t.asyncRequest&&(a=!0===t.asyncRequest),n.log("Destroying session "+X+" (async="+a+")"),!J)return n.warn("Is the gateway down? (connected=false)"),void t.success();if(void 0===X||null===X)return n.warn("No session to destroy"),t.success(),void e.destroyed();delete n.sessions[X];var s={janus:"destroy",transaction:n.randomString(12)};if(null!==Y&&void 0!==Y&&(s.token=Y),null!==K&&void 0!==K&&(s.apisecret=K),A){s.session_id=X;var r=function(){for(var e in F)O.removeEventListener(e,F[e]);O.removeEventListener("message",i),O.removeEventListener("error",o),x&&clearTimeout(x)},i=function(a){var n=JSON.parse(a.data);n.session_id==s.session_id&&n.transaction==s.transaction&&(r(),t.success(),e.destroyed())},o=function(a){r(),t.error("Failed to destroy the gateway: Is the gateway down?"),e.destroyed()};return O.addEventListener("message",i),O.addEventListener("error",o),void O.send(JSON.stringify(s))}n.httpAPICall(j+"/"+X,{verb:"POST",async:a,withCredentials:q,body:s,success:function(a){n.log("Destroyed session:"),n.debug(a),X=null,J=!1,"success"!==a.janus&&n.error("Ooops: "+a.error.code+" "+a.error.reason),t.success(),e.destroyed()},error:function(a,s){n.error(a+": "+s),X=null,J=!1,t.success(),e.destroyed()}})}function o(e){if(e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.iceState="function"==typeof e.iceState?e.iceState:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void e.error("Is the gateway down? (connected=false)");var t=e.plugin;if(void 0===t||null===t)return n.error("Invalid plugin"),void e.error("Invalid plugin");var a=e.opaqueId,s=n.randomString(12),r={janus:"attach",plugin:t,opaque_id:a,transaction:s};if(null!==Y&&void 0!==Y&&(r.token=Y),null!==K&&void 0!==K&&(r.apisecret=K),"chrome"!=n.webRTCAdapter.browserDetails.browser&&"firefox"!=n.webRTCAdapter.browserDetails.browser&&"safari"!=n.webRTCAdapter.browserDetails.browser||(r["force-bundle"]=!0,r["force-rtcp-mux"]=!0),A)return ee[s]=function(a){if(n.debug(a),"success"!==a.janus)return n.error("Ooops: "+a.error.code+" "+a.error.reason),void e.error("Ooops: "+a.error.code+" "+a.error.reason);var s=a.data.id;n.log("Created handle: "+s);var r={session:Z,plugin:t,id:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return s},getPlugin:function(){return t},getVolume:function(){return b(s)},isAudioMuted:function(){return y(s,!1)},muteAudio:function(){return S(s,!1,!0)},unmuteAudio:function(){return S(s,!1,!1)},isVideoMuted:function(){return y(s,!0)},muteVideo:function(){return S(s,!0,!0)},unmuteVideo:function(){return S(s,!0,!1)},getBitrate:function(){return _(s)},send:function(e){l(s,e)},data:function(e){u(s,e)},dtmf:function(e){c(s,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){p(s,e)},createAnswer:function(e){p(s,e)},handleRemoteJsep:function(e){h(s,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){C(s,!0===e)},detach:function(e){f(s,e)}};Q[s]=r,e.success(r)},r.session_id=X,void O.send(JSON.stringify(r));n.httpAPICall(j+"/"+X,{verb:"POST",withCredentials:q,body:r,success:function(a){if(n.debug(a),"success"!==a.janus)return n.error("Ooops: "+a.error.code+" "+a.error.reason),void e.error("Ooops: "+a.error.code+" "+a.error.reason);var s=a.data.id;n.log("Created handle: "+s);var r={session:Z,plugin:t,id:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return s},getPlugin:function(){return t},getVolume:function(){return b(s)},isAudioMuted:function(){return y(s,!1)},muteAudio:function(){return S(s,!1,!0)},unmuteAudio:function(){return S(s,!1,!1)},isVideoMuted:function(){return y(s,!0)},muteVideo:function(){return S(s,!0,!0)},unmuteVideo:function(){return S(s,!0,!1)},getBitrate:function(){return _(s)},send:function(e){l(s,e)},data:function(e){u(s,e)},dtmf:function(e){c(s,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){p(s,e)},createAnswer:function(e){p(s,e)},handleRemoteJsep:function(e){h(s,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){C(s,!0===e)},detach:function(e){f(s,e)}};Q[s]=r,e.success(r)},error:function(e,t){n.error(e+": "+t)}})}function l(e,t){if(t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void t.error("Is the gateway down? (connected=false)");var a=t.message,s=t.jsep,r=n.randomString(12),i={janus:"message",body:a,transaction:r};if(null!==Y&&void 0!==Y&&(i.token=Y),null!==K&&void 0!==K&&(i.apisecret=K),null!==s&&void 0!==s&&(i.jsep=s),n.debug("Sending message to plugin (handle="+e+"):"),n.debug(i),A)return i.session_id=X,i.handle_id=e,ee[r]=function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var a=e.plugindata;if(void 0===a||null===a)return n.warn("Request succeeded, but missing plugindata..."),void t.success();n.log("Synchronous transaction successful ("+a.plugin+")");var s=a.data;return n.debug(s),void t.success(s)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),t.error("Unknown error")));t.success()},void O.send(JSON.stringify(i));n.httpAPICall(j+"/"+X+"/"+e,{verb:"POST",withCredentials:q,body:i,success:function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var a=e.plugindata;if(void 0===a||null===a)return n.warn("Request succeeded, but missing plugindata..."),void t.success();n.log("Synchronous transaction successful ("+a.plugin+")");var s=a.data;return n.debug(s),void t.success(s)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),t.error("Unknown error")));t.success()},error:function(e,a){n.error(e+": "+a),t.error(e+": "+a)}})}function d(e,t){if(!J)return void n.warn("Is the gateway down? (connected=false)");var a={janus:"trickle",candidate:t,transaction:n.randomString(12)};if(null!==Y&&void 0!==Y&&(a.token=Y),null!==K&&void 0!==K&&(a.apisecret=K),n.vdebug("Sending trickle candidate (handle="+e+"):"),n.vdebug(a),A)return a.session_id=X,a.handle_id=e,void O.send(JSON.stringify(a));n.httpAPICall(j+"/"+X+"/"+e,{verb:"POST",withCredentials:q,body:a,success:function(e){if(n.vdebug("Candidate sent!"),n.vdebug(e),"ack"!==e.janus)return void n.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){n.error(e+": "+t)}})}function u(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var s=a.webrtcStuff,r=t.text;if(null===r||void 0===r)return n.warn("Invalid text"),void t.error("Invalid text");n.log("Sending string on data channel: "+r),s.dataChannel.send(r),t.success()}function c(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var s=a.webrtcStuff;if(null===s.dtmfSender||void 0===s.dtmfSender){if(void 0!==s.myStream&&null!==s.myStream){var r=s.myStream.getAudioTracks();if(null!==r&&void 0!==r&&r.length>0){var i=r[0];s.dtmfSender=s.pc.createDTMFSender(i),n.log("Created DTMF Sender"),s.dtmfSender.ontonechange=function(e){n.debug("Sent DTMF tone: "+e.tone)}}}if(null===s.dtmfSender||void 0===s.dtmfSender)return n.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(null===o||void 0===o)return n.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var l=o.tones;if(null===l||void 0===l)return n.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var d=o.duration;null!==d&&void 0!==d||(d=500);var u=o.gap;null!==u&&void 0!==u||(u=50),n.debug("Sending DTMF string "+l+" (duration "+d+"ms, gap "+u+"ms)"),s.dtmfSender.insertDTMF(l,d,u)}function f(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop,n.warn(t);var a=!0;if(void 0!==t.asyncRequest&&null!==t.asyncRequest&&(a=!0===t.asyncRequest),n.log("Destroying handle "+e+" (async="+a+")"),C(e),Q[e].detached)return delete Q[e],void t.success();if(!J)return n.warn("Is the gateway down? (connected=false)"),void t.error("Is the gateway down? (connected=false)");var s={janus:"detach",transaction:n.randomString(12)};if(null!==Y&&void 0!==Y&&(s.token=Y),null!==K&&void 0!==K&&(s.apisecret=K),A)return s.session_id=X,s.handle_id=e,O.send(JSON.stringify(s)),delete Q[e],void t.success();n.httpAPICall(j+"/"+X+"/"+e,{verb:"POST",async:a,withCredentials:q,body:s,success:function(a){n.log("Destroyed handle:"),n.debug(a),"success"!==a.janus&&n.error("Ooops: "+a.error.code+" "+a.error.reason),delete Q[e],t.success()},error:function(a,s){n.error(a+": "+s),delete Q[e],t.success()}})}function m(e,t,a,s,r){var i=Q[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return n.warn("Invalid handle"),void s.error("Invalid handle");var o=i.webrtcStuff;n.debug("streamsDone:",r),o.myStream=r;var l={iceServers:B,iceTransportPolicy:G,bundlePolicy:V},u={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===z&&u.optional.push({googIPv6:!0}),s.rtcConstraints&&"object"==typeof s.rtcConstraints){n.debug("Adding custom PeerConnection constraints:",s.rtcConstraints);for(var c in s.rtcConstraints)u.optional.push(s.rtcConstraints[c])}if("edge"===n.webRTCAdapter.browserDetails.browser&&(l.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(u),o.pc=new RTCPeerConnection(l,u),n.debug(o.pc),o.pc.getStats&&(o.volume.value=0,o.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+o.trickle+")"),o.pc.oniceconnectionstatechange=function(e){o.pc&&i.iceState(o.pc.iceConnectionState)},o.pc.onicecandidate=function(t){if(null==t.candidate||"edge"===n.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),o.iceDone=!0,!0===o.trickle?d(e,{completed:!0}):E(e,s);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===o.trickle&&d(e,a)}},null!==r&&void 0!==r&&(n.log("Adding local stream"),r.getTracks().forEach(function(e){o.pc.addTrack(e,r)}),i.onlocalstream(r)),o.pc.ontrack=function(e){n.log("Handling Remote Track"),n.debug(e),e.streams&&(o.remoteStream=e.streams[0],i.onremotestream(o.remoteStream))},D(a)){n.log("Creating data channel");var f=function(e){n.log("Received message on data channel: "+e.data),i.ondata(e.data)},m=function(){var e=null!==o.dataChannel?o.dataChannel.readyState:"null";n.log("State change on data channel: "+e),"open"===e&&i.ondataopen()},p=function(e){n.error("Got error on data channel:",e)};o.dataChannel=o.pc.createDataChannel("JanusDataChannel",{ordered:!1}),o.dataChannel.onmessage=f,o.dataChannel.onopen=m,o.dataChannel.onclose=m,o.dataChannel.onerror=p}null===t||void 0===t?g(e,a,s):o.pc.setRemoteDescription(new RTCSessionDescription(t),function(){n.log("Remote description accepted!"),v(e,a,s)},s.error)}function p(e,t){function a(a,n){o.consentDialog(!1),a?t.error({code:a.code,name:a.name,message:a.message}):m(e,r,i,t,n)}function s(e,t,a){n.log("Adding media constraint (screen capture)"),n.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(a){e.addTrack(a.getAudioTracks()[0]),t(null,e)}):t(null,e)}).catch(function(e){o.consentDialog(!1),t(e)})}t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:M;var r=t.jsep,i=t.media,o=Q[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var l=o.webrtcStuff;if(void 0!==l.pc&&null!==l.pc)return n.log("Updating existing media session"),void(null===r||void 0===r?g(e,i,t):l.pc.setRemoteDescription(new RTCSessionDescription(r),function(){n.log("Remote description accepted!"),v(e,i,t)},t.error));if(l.trickle=L(t.trickle),null!==t.stream&&void 0!==t.stream){var d=t.stream;return n.log("MediaStream provided by the application"),n.debug(d),l.streamExternal=!0,void m(e,r,i,t,d)}if(k(i)||P(i)){var u={mandatory:{},optional:[]};o.consentDialog(!0);var c=k(i);!0===c&&void 0!=i&&null!=i&&"object"==typeof i.audio&&(c=i.audio);var f=P(i);if(!0===f&&void 0!=i&&null!=i){if(!(!0===t.simulcast)||r||void 0!==i.video&&!1!==i.video||(i.video="hires"),i.video&&"screen"!=i.video&&"window"!=i.video){var p=0,h=0,E=0;if("lowres"===i.video)h=240,E=240,p=320;else if("lowres-16:9"===i.video)h=180,E=180,p=320;else if("hires"===i.video||"hires-16:9"===i.video){if(h=720,E=720,p=1280,navigator.mozGetUserMedia){var b=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);b<38&&(n.warn(i.video+" unsupported, falling back to stdres (old Firefox)"),h=480,E=480,p=640)}}else"stdres"===i.video?(h=480,E=480,p=640):"stdres-16:9"===i.video?(h=360,E=360,p=640):(n.log("Default video setting is stdres 4:3"),h=480,E=480,p=640);if(n.log("Adding media constraint:",i.video),navigator.mozGetUserMedia){var b=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);f=b<38?{require:["height","width"],height:{max:E,min:h},width:{max:p,min:p}}:{height:{ideal:h},width:{ideal:p}}}else f={mandatory:{maxHeight:E,minHeight:h,maxWidth:p,minWidth:p},optional:[]};"object"==typeof i.video&&(f=i.video),n.debug(f)}else if("screen"===i.video||"window"===i.video){if(i.screenshareFrameRate||(i.screenshareFrameRate=3),"https:"!==window.location.protocol)return n.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),o.consentDialog(!1),void t.error("Screen sharing only works on HTTPS, try the https:// version of this page");var y={};if("chrome"===n.webRTCAdapter.browserDetails.browser){var S=n.webRTCAdapter.browserDetails.version,_=33;if(window.navigator.userAgent.match("Linux")&&(_=35),S>=26&&S<=_)u={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate,chromeMediaSource:"screen"}},audio:k(i)},s(u,a);else{var C=window.setTimeout(function(){return N=new Error("NavigatorUserMediaError"),N.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',o.consentDialog(!1),t.error(N)},1e3);y[C]=[a,null],window.postMessage({type:"janusGetScreen",id:C},"*")}}else if(window.navigator.userAgent.match("Firefox")){var w=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(w>=33)){var N=new Error("NavigatorUserMediaError");return N.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void t.error(N)}u={video:{mozMediaSource:i.video,mediaSource:i.video},audio:k(i)},s(u,function(e,t){if(a(e,t),!e)var n=t.currentTime,s=window.setInterval(function(){t||window.clearInterval(s),t.currentTime==n&&(window.clearInterval(s),t.onended&&t.onended()),n=t.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&y[e.data.id]){var a=y[e.data.id],n=a[0];if(delete y[e.data.id],""===e.data.sourceId){var r=new Error("NavigatorUserMediaError");r.name="You cancelled the request for permission, giving up...",o.consentDialog(!1),t.error(r)}else u={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},u.video.mandatory.chromeMediaSourceId=e.data.sourceId,s(u,n,k(i))}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}}null!==i&&void 0!==i&&"screen"===i.video||navigator.mediaDevices.enumerateDevices().then(function(a){var n=a.some(function(e){return"audioinput"===e.kind}),s=a.some(function(e){return"videoinput"===e.kind}),l=k(i),d=P(i),u=T(i),p=R(i);if(l||d||u||p){var h=!!l&&n,g=!!d&&s;if(!h&&!g)return o.consentDialog(!1),t.error("No capture device found"),!1;if(!h&&u)return o.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!g&&p)return o.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!n&&c,video:!!s&&f}).then(function(a){o.consentDialog(!1),m(e,r,i,t,a)}).catch(function(e){o.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){o.consentDialog(!1),t.error("enumerateDevices error",e)})}else m(e,r,i,t)}function h(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:M;var a=t.jsep,s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=s.webrtcStuff;if(void 0!==a&&null!==a){if(null===r.pc)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.pc.setRemoteDescription(new RTCSessionDescription(a),function(){n.log("Remote description accepted!"),t.success()},t.error)}else t.error("Invalid JSEP")}function g(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var r=s.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating offer (iceDone="+r.iceDone+", simulcast="+i+")"):n.log("Creating offer (iceDone="+r.iceDone+")");var o=null;o="firefox"==n.webRTCAdapter.browserDetails.browser||"edge"==n.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:N(t),offerToReceiveVideo:I(t)}:{mandatory:{OfferToReceiveAudio:N(t),OfferToReceiveVideo:I(t)}},n.debug(o);var l=P(t);if(l&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var d=r.pc.getSenders()[1];n.log(d);var u=d.getParameters();n.log(u),d.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}r.pc.createOffer(function(e){if(n.debug(e),null!==r.mySdp&&void 0!==r.mySdp||(n.log("Setting local description"),l&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser?(n.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=w(e.sdp)):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e)),!r.iceDone&&!r.trickle)return void n.log("Waiting for all candidates...");if(r.sdpSent)return void n.log("Offer already sent, not sending it again");n.log("Offer ready"),n.debug(a),r.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function v(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var r=s.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating answer (iceDone="+r.iceDone+", simulcast="+i+")"):n.log("Creating answer (iceDone="+r.iceDone+")");var o=null;o="firefox"==n.webRTCAdapter.browserDetails.browser||"edge"==n.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:N(t),offerToReceiveVideo:I(t)}:{mandatory:{OfferToReceiveAudio:N(t),OfferToReceiveVideo:I(t)}},n.debug(o);var l=P(t);if(l&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var d=r.pc.getSenders()[1];n.log(d);var u=d.getParameters();n.log(u),d.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}r.pc.createAnswer(function(e){if(n.debug(e),null!==r.mySdp&&void 0!==r.mySdp||(n.log("Setting local description"),l&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser?n.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e)),!r.iceDone&&!r.trickle)return void n.log("Waiting for all candidates...");if(r.sdpSent)return void n.log("Answer already sent, not sending it again");r.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function E(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return void n.warn("Invalid handle, not sending anything");var s=a.webrtcStuff;return n.log("Sending offer/answer SDP..."),null===s.mySdp||void 0===s.mySdp?void n.warn("Local SDP instance is invalid, not sending anything..."):(s.mySdp={type:s.pc.localDescription.type,sdp:s.pc.localDescription.sdp},s.sdpSent?void n.log("Offer/Answer SDP already sent, not sending it again"):(!1===s.trickle&&(s.mySdp.trickle=!1),n.debug(t),s.sdpSent=!0,void t.success(s.mySdp)))}function b(e){var t=Q[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),0;var a=t.webrtcStuff;return a.pc.getStats&&"chrome"==n.webRTCAdapter.browserDetails.browser?null===a.remoteStream||void 0===a.remoteStream?(n.warn("Remote stream unavailable"),0):null===a.volume.timer||void 0===a.volume.timer?(n.log("Starting volume monitor"),a.volume.timer=setInterval(function(){a.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var s=t[n];"ssrc"==s.type&&s.stat("audioOutputLevel")&&(a.volume.value=s.stat("audioOutputLevel"))}})},200),0):a.volume.value:(n.log("Getting the remote volume unsupported by browser"),0)}function y(e,t){var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),!0;var s=a.webrtcStuff;return null===s.pc||void 0===s.pc?(n.warn("Invalid PeerConnection"),!0):void 0===s.myStream||null===s.myStream?(n.warn("Invalid local MediaStream"),!0):t?null===s.myStream.getVideoTracks()||void 0===s.myStream.getVideoTracks()||0===s.myStream.getVideoTracks().length?(n.warn("No video track"),!0):!s.myStream.getVideoTracks()[0].enabled:null===s.myStream.getAudioTracks()||void 0===s.myStream.getAudioTracks()||0===s.myStream.getAudioTracks().length?(n.warn("No audio track"),!0):!s.myStream.getAudioTracks()[0].enabled}function S(e,t,a){var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),!1;var r=s.webrtcStuff;return null===r.pc||void 0===r.pc?(n.warn("Invalid PeerConnection"),!1):void 0===r.myStream||null===r.myStream?(n.warn("Invalid local MediaStream"),!1):t?null===r.myStream.getVideoTracks()||void 0===r.myStream.getVideoTracks()||0===r.myStream.getVideoTracks().length?(n.warn("No video track"),!1):(r.myStream.getVideoTracks()[0].enabled=!a,!0):null===r.myStream.getAudioTracks()||void 0===r.myStream.getAudioTracks()||0===r.myStream.getAudioTracks().length?(n.warn("No audio track"),!1):(r.myStream.getAudioTracks()[0].enabled=!a,!0)}function _(e){var t=Q[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;return null===a.pc||void 0===a.pc?"Invalid PeerConnection":a.pc.getStats?null===a.bitrate.timer||void 0===a.bitrate.timer?(n.log("Starting bitrate timer (via getStats)"),a.bitrate.timer=setInterval(function(){a.pc.getStats().then(function(e){e.forEach(function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(a.bitrate.bsnow=e.bytesReceived,a.bitrate.tsnow=e.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var s=a.bitrate.tsnow-a.bitrate.tsbefore;"safari"==n.webRTCAdapter.browserDetails.browser&&(s/=1e3);var r=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/s);a.bitrate.value=r+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):a.bitrate.value:(n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function M(e){n.error("WebRTC error:",e)}function C(e,t){n.log("Cleaning WebRTC stuff");var a=Q[e];if(null!==a&&void 0!==a){var s=a.webrtcStuff;if(null!==s&&void 0!==s){if(!0===t){var r={janus:"hangup",transaction:n.randomString(12)};null!==Y&&void 0!==Y&&(r.token=Y),null!==K&&void 0!==K&&(r.apisecret=K),n.debug("Sending hangup request (handle="+e+"):"),n.debug(r),A?(r.session_id=X,r.handle_id=e,O.send(JSON.stringify(r))):n.httpAPICall(j+"/"+X+"/"+e,{verb:"POST",withCredentials:q,data:r})}s.remoteStream=null,s.volume.timer&&clearInterval(s.volume.timer),s.volume.value=null,s.bitrate.timer&&clearInterval(s.bitrate.timer),s.bitrate.timer=null,s.bitrate.bsnow=null,s.bitrate.bsbefore=null,s.bitrate.tsnow=null,s.bitrate.tsbefore=null,s.bitrate.value=null;try{if(!s.streamExternal&&null!==s.myStream&&void 0!==s.myStream){n.log("Stopping local stream tracks");var i=s.myStream.getTracks();for(var o in i){var l=i[o];n.log(l),null!==l&&void 0!==l&&l.stop()}}}catch(e){}s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(e){}s.pc=null,s.mySdp=null,s.iceDone=!1,s.sdpSent=!1,s.dataChannel=null,s.dtmfSender=null}a.oncleanup()}}function w(e){for(var t=e.split("\r\n"),a=!1,s=[-1],r=-1,i=null,o=null,l=null,d=null,u=-1,c=0;c<t.length;c++){var f=t[c].match(/m=(\w+) */);if(f){var m=f[1];if("video"===m){if(!(s[0]<0)){u=c;break}a=!0}else if(s[0]>-1){u=c;break}}else if(a){var p=t[c].match(/a=ssrc-group:FID (\d+) (\d+)/);if(p)s[0]=p[1],r=p[2],t.splice(c,1),c--;else{if(s[0]){var h=t[c].match("a=ssrc:"+s[0]+" cname:(.+)");if(h&&(i=h[1]),h=t[c].match("a=ssrc:"+s[0]+" msid:(.+)"),h&&(o=h[1]),h=t[c].match("a=ssrc:"+s[0]+" mslabel:(.+)"),h&&(l=h[1]),h=t[c].match("a=ssrc:"+s+" label:(.+)"),h&&(d=h[1]),0===t[c].indexOf("a=ssrc:"+r)){t.splice(c,1),c--;continue}if(0===t[c].indexOf("a=ssrc:"+s[0])){t.splice(c,1),c--;continue}}0!=t[c].length||(t.splice(c,1),c--)}}}if(s[0]<0){u=-1,a=!1;for(var c=0;c<t.length;c++){var f=t[c].match(/m=(\w+) */);if(f){var m=f[1];if("video"===m){if(!(s[0]<0)){u=c;break}a=!0}else if(s[0]>-1){u=c;break}}else if(a){if(s[0]<0){var g=t[c].match(/a=ssrc:(\d+)/);if(g){s[0]=g[1],t.splice(c,1),c--;continue}}else{var h=t[c].match("a=ssrc:"+s[0]+" cname:(.+)");if(h&&(i=h[1]),h=t[c].match("a=ssrc:"+s[0]+" msid:(.+)"),h&&(o=h[1]),h=t[c].match("a=ssrc:"+s[0]+" mslabel:(.+)"),h&&(l=h[1]),h=t[c].match("a=ssrc:"+s+" label:(.+)"),h&&(d=h[1]),0===t[c].indexOf("a=ssrc:"+r)){t.splice(c,1),c--;continue}if(0===t[c].indexOf("a=ssrc:"+s[0])){t.splice(c,1),c--;continue}}0!=t[c].length||(t.splice(c,1),c--)}}}if(s[0]<0)return n.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;u<0&&(u=t.length),s[1]=Math.floor(4294967295*Math.random()),s[2]=Math.floor(4294967295*Math.random());for(var c=0;c<s.length;c++)i&&(t.splice(u,0,"a=ssrc:"+s[c]+" cname:"+i),u++),o&&(t.splice(u,0,"a=ssrc:"+s[c]+" msid:"+o),u++),l&&(t.splice(u,0,"a=ssrc:"+s[c]+" mslabel:"+o),u++),d&&(t.splice(u,0,"a=ssrc:"+s[c]+" label:"+o),u++);return t.splice(u,0,"a=ssrc-group:SIM "+s[0]+" "+s[1]+" "+s[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function k(e){return n.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function T(e){return n.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function N(e){return n.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function P(e){return n.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function R(e){return n.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function I(e){return n.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function D(e){return n.debug("isDataEnabled:",e),"edge"==n.webRTCAdapter.browserDetails.browser?(n.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function L(e){return n.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}if(void 0===n.initDone)return e.error("Library not initialized"),{};if(!n.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(n.log("Library initialized: "+n.initDone),e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,null===e.server||void 0===e.server)return e.error("Invalid gateway url"),{};var A=!1,O=null,F={},x=null,U=null,H=0,j=e.server;n.isArray(j)?(n.log("Multiple servers provided ("+j.length+"), will use the first that works"),j=null,U=e.server,n.debug(U)):0===j.indexOf("ws")?(A=!0,n.log("Using WebSockets to contact Janus: "+j)):(A=!1,n.log("Using REST API to contact Janus: "+j));var B=e.iceServers;void 0!==B&&null!==B||(B=[{urls:"stun:stun.l.google.com:19302"}]);var G=e.iceTransportPolicy,V=e.bundlePolicy,z=e.ipv6;void 0!==z&&null!==z||(z=!1);var q=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(q=!0===e.withCredentials);var W=null;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(W=e.max_poll_events),W<1&&(W=1);var Y=null;void 0!==e.token&&null!==e.token&&(Y=e.token);var K=null;void 0!==e.apisecret&&null!==e.apisecret&&(K=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var J=!1,X=null,Q={},Z=this,$=0,ee={};r(e),this.getServer=function(){return j},this.isConnected=function(){return J},this.getSessionId=function(){return X},this.destroy=function(e){i(e)},this.attach=function(e){o(e)}}var s=(a(0),a(0)),r=a(2352);n.sessions={},n.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",n.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||n.checkJanusExtension()}return!0},n.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,a=e&&e.Promise||Promise,s=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new s(e,t)},isArray:function(e){return Array.isArray(e)},checkJanusExtension:function(){return null!==document.querySelector("#janus-extension-installed")},webRTCAdapter:e&&e.adapter||r,httpAPICall:function(e,s){var r={method:s.verb,cache:"no-cache"};void 0!==s.withCredentials&&(r.credentials=!0===s.withCredentials?"include":s.withCredentials?s.withCredentials:"omit"),void 0!==s.body&&(r.body=JSON.stringify(s.body));var i=t(e,r).catch(function(e){return a.reject({message:"Probably a network error, is the gateway down?",error:e})});if(void 0!==s.timeout){var o=new a(function(e,t){var a=setTimeout(function(){return clearTimeout(a),t({message:"Request timed out",timeout:s.timeout})},s.timeout)});i=a.race([i,o])}return i.then(function(e){return e.ok?typeof s.success==typeof n.noop?e.json().then(function(e){s.success(e)}).catch(function(t){return a.reject({message:"Failed to parse response body",error:t,response:e})}):void 0:a.reject({message:"API call failed",response:e})}).catch(function(e){typeof s.error==typeof n.noop&&s.error(e.message||"<< internal error >>",e)}),i}}},n.useOldDependencies=function(e){var t=e&&e.jQuery||s,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},isArray:function(e){return t.isArray(e)},checkJanusExtension:function(){return t("#janus-extension-installed").length>0},webRTCAdapter:e&&e.adapter||r,httpAPICall:function(e,a){var s=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},r=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(s,r,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success==typeof n.noop&&a.success(e)},error:function(e,t,s){typeof a.error==typeof n.noop&&a.error(t,s)}}))}}},n.noop=function(){},n.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:n.noop,!0===n.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),n.trace=n.noop,n.debug=n.noop,n.vdebug=n.noop,n.log=n.noop,n.warn=n.noop,n.error=n.noop,!0===e.debug||"all"===e.debug)n.trace=console.trace.bind(console),n.debug=console.debug.bind(console),n.vdebug=console.debug.bind(console),n.log=console.log.bind(console),n.warn=console.warn.bind(console),n.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t in e.debug){var a=e.debug[t];switch(a){case"trace":n.trace=console.trace.bind(console);break;case"debug":n.debug=console.debug.bind(console);break;case"vdebug":n.vdebug=console.debug.bind(console);break;case"log":n.log=console.log.bind(console);break;case"warn":n.warn=console.warn.bind(console);break;case"error":n.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+a+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}n.log("Initializing library");var s=e.dependencies||n.useDefaultDependencies();n.isArray=s.isArray,n.webRTCAdapter=s.webRTCAdapter,n.httpAPICall=s.httpAPICall,n.checkJanusExtension=s.checkJanusExtension,n.newWebSocket=s.newWebSocket,n.listDevices=function(e,t){e="function"==typeof e?e:n.noop,null==t&&(t={audio:!0,video:!0}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(t).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(a){n.debug(a),e(a);try{var s=t.getTracks();for(var r in s){var i=s[r];null!==i&&void 0!==i&&i.stop()}}catch(e){}})}).catch(function(t){n.error(t),e([])}):(n.warn("navigator.mediaDevices unavailable"),e([]))},n.attachMediaStream=function(e,t){if("chrome"===n.webRTCAdapter.browserDetails.browser){n.webRTCAdapter.browserDetails.version>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):n.error("Error attaching stream to element")}else e.srcObject=t},n.reattachMediaStream=function(e,t){if("chrome"===n.webRTCAdapter.browserDetails.browser){n.webRTCAdapter.browserDetails.version>=43?e.srcObject=t.srcObject:void 0!==e.src?e.src=t.src:n.error("Error reattaching stream to element")}else e.srcObject=t.srcObject};var r=window.onbeforeunload;window.onbeforeunload=function(){n.log("Closing window");for(var e in n.sessions)null!==n.sessions[e]&&void 0!==n.sessions[e]&&n.sessions[e].destroyOnUnload&&(n.log("Destroying session "+e),n.sessions[e].destroy({asyncRequest:!1}));r&&"function"==typeof r&&r()},n.initDone=!0,e.callback()}},n.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},n.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var s=Math.floor(Math.random()*t.length);a+=t.substring(s,s+1)}return a},e.exports=n},2352:function(e,t,a){(function(t){var n=(a(0),a(0),a(2353));e.exports=n({window:t.window})}).call(t,a(23))},2353:function(e,t,a){var n=(a(0),a(0),a(2035));e.exports=function(e,t){var s=e&&e.window,r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var i in t)hasOwnProperty.call(t,i)&&(r[i]=t[i]);var o=n.log,l=n.detectBrowser(s),d={browserDetails:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings},u=a(2354)||null,c=a(2356)||null,f=a(2359)||null,m=a(2361)||null,p=a(2362)||null;switch(l.browser){case"chrome":if(!u||!u.shimPeerConnection||!r.shimChrome)return o("Chrome shim is not included in this adapter release."),d;o("adapter.js shimming chrome."),d.browserShim=u,p.shimCreateObjectURL(s),u.shimGetUserMedia(s),u.shimMediaStream(s),u.shimSourceObject(s),u.shimPeerConnection(s),u.shimOnTrack(s),u.shimAddTrackRemoveTrack(s),u.shimGetSendersWithDtmf(s),p.shimRTCIceCandidate(s);break;case"firefox":if(!f||!f.shimPeerConnection||!r.shimFirefox)return o("Firefox shim is not included in this adapter release."),d;o("adapter.js shimming firefox."),d.browserShim=f,p.shimCreateObjectURL(s),f.shimGetUserMedia(s),f.shimSourceObject(s),f.shimPeerConnection(s),f.shimOnTrack(s),f.shimRemoveStream(s),p.shimRTCIceCandidate(s);break;case"edge":if(!c||!c.shimPeerConnection||!r.shimEdge)return o("MS edge shim is not included in this adapter release."),d;o("adapter.js shimming edge."),d.browserShim=c,p.shimCreateObjectURL(s),c.shimGetUserMedia(s),c.shimPeerConnection(s),c.shimReplaceTrack(s);break;case"safari":if(!m||!r.shimSafari)return o("Safari shim is not included in this adapter release."),d;o("adapter.js shimming safari."),d.browserShim=m,p.shimCreateObjectURL(s),m.shimRTCIceServerUrls(s),m.shimCallbacksAPI(s),m.shimLocalStreamsAPI(s),m.shimRemoteStreamsAPI(s),m.shimTrackEventTransceiver(s),m.shimGetUserMedia(s),m.shimCreateOfferLegacy(s),p.shimRTCIceCandidate(s);break;default:o("Unsupported browser!")}return d}},2354:function(e,t,a){var n=(a(0),a(0),a(2035)),s=n.log,r={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return a._ontrackpoly||(a._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var s;s=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var r=new Event("track");r.track=n.track,r.receiver=s,r.transceiver={receiver:s},r.streams=[t.stream],a.dispatchEvent(r)}),t.stream.getTracks().forEach(function(n){var s;s=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var r=new Event("track");r.track=n,r.receiver=s,r.transceiver={receiver:s},r.streams=[t.stream],a.dispatchEvent(r)})},a.addEventListener("addstream",a._ontrackpoly)),t.apply(a,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var s=this,r=a.apply(s,arguments);return r||(r=t(s,e),s._senders.push(r)),r};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var a=t._senders.indexOf(e);-1!==a&&t._senders.splice(a,1)}}var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var a=this;a._senders=a._senders||[],s.apply(a,[e]),e.getTracks().forEach(function(e){a._senders.push(t(a,e))})};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],r.apply(t,[e]),e.getTracks().forEach(function(e){var a=t._senders.find(function(t){return t.track===e});a&&t._senders.splice(t._senders.indexOf(a),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var a=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var a=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],s=e._streams[n.id];a=a.replace(new RegExp(s.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:a})}function a(e,t){var a=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],s=e._streams[n.id];a=a.replace(new RegExp(n.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:a})}var s=n.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&s.version>=64)){var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var a=this;if(a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},t.getTracks().forEach(function(e){if(a.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!a._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());a._streams[t.id]=n,a._reverseStreams[n.id]=t,t=n}i.apply(a,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,a){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var r=n._streams[a.id];if(r)r.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var i=new e.MediaStream([t]);n._streams[a.id]=i,n._reverseStreams[i.id]=a,n.addStream(i)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(a){var n=e.RTCPeerConnection.prototype[a];e.RTCPeerConnection.prototype[a]=function(){var e=this,a=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var s=t(e,n);a[0].apply(null,[s])},function(e){a[1]&&a[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(a){return t(e,a)})}});var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=a(e,arguments[0]),l.apply(e,arguments)):l.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,a=d.get.apply(this);return""===a.type?a:t(e,a)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var a;Object.keys(t._streams).forEach(function(n){t._streams[n].getTracks().find(function(t){return e.track===t})&&(a=t._streams[n])}),a&&(1===a.getTracks().length?t.removeStream(t._reverseStreams[a.id]):a.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection){var a=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var s=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,s.push(i)):s.push(e.iceServers[r])}e.iceServers=s}return new a(e,t)},e.RTCPeerConnection.prototype=a.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}})}else e.RTCPeerConnection=function(t,a){return s("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,a)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,a){var n=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var i=function(e){var t={};return e.result().forEach(function(e){var a={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){a[t]=e.stat(t)}),t[a.id]=a}),t},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var l=function(e){s[1](o(i(e)))};return r.apply(this,[l,arguments[0]])}return new Promise(function(e,t){r.apply(n,[function(t){e(o(i(t)))},t])}).then(t,a)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,s){a.apply(t,[e[0],n,s])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,s){a.apply(e,[n,s,t])})}return a.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:r.shimMediaStream,shimOnTrack:r.shimOnTrack,shimAddTrackRemoveTrack:r.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:r.shimGetSendersWithDtmf,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:a(2355)}},2355:function(e,t,a){var n=(a(0),a(0),a(2035)),s=n.log;e.exports=function(e){var t=n.detectBrowser(e),a=e&&e.navigator,r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n="object"==typeof e[a]?e[a]:{ideal:e[a]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var r={};"number"==typeof n.ideal?(r[s("min",a)]=n.ideal,t.optional.push(r),r={},r[s("max",a)]=n.ideal,t.optional.push(r)):(r[s("",a)]=n.ideal,t.optional.push(r))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",a)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,a)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var i=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","googAutoGainControl"),i(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var l=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var d;if("environment"===o.exact||"environment"===o.ideal?d=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(d=["front"]),d)return a.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var a=t.find(function(e){return d.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!a&&t.length&&-1!==d.indexOf("back")&&(a=t[t.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),s("chrome: "+JSON.stringify(e)),n(e)})}e.video=r(e.video)}return s("chrome: "+JSON.stringify(e)),n(e)},o=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},l=function(e,t,n){i(e,function(e){a.webkitGetUserMedia(e,t,function(e){n&&n(o(e))})})};a.getUserMedia=l;var d=function(e){return new Promise(function(t,n){a.getUserMedia(e,t,n)})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var a={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),a.mediaDevices.getUserMedia){var u=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return i(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(o(e))})})}}else a.mediaDevices.getUserMedia=function(e){return d(e)};void 0===a.mediaDevices.addEventListener&&(a.mediaDevices.addEventListener=function(){s("Dummy mediaDevices.addEventListener called.")}),void 0===a.mediaDevices.removeEventListener&&(a.mediaDevices.removeEventListener=function(){s("Dummy mediaDevices.removeEventListener called.")})}},2356:function(e,t,a){var n=(a(0),a(0),a(2035)),s=a(2357);e.exports={shimGetUserMedia:a(2358),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var a=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){a.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=s(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},2357:function(e,t,a){function n(e,t,a,n,s){var r=l.writeRtpDescription(e.kind,t);if(r+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":s||"active"),r+="a=mid:"+e.mid+"\r\n",e.direction?r+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var i="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+i,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),r}function s(e,t){var a=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s="string"==typeof n;return s&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||a?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(a=!0,!0)}),delete e.url,e.urls=s?n[0]:n,!!n.length}return!1})}function r(e,t){var a={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===e||t[a].preferredPayloadType===e)return t[a]},s=function(e,t,a,s){var r=n(e.parameters.apt,a),i=n(t.parameters.apt,s);return r&&i&&r.name.toLowerCase()===i.name.toLowerCase()};return e.codecs.forEach(function(n){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(n.name.toLowerCase()===i.name.toLowerCase()&&n.clockRate===i.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&i.parameters.apt&&!s(n,i,e.codecs,t.codecs))continue;i=JSON.parse(JSON.stringify(i)),i.numChannels=Math.min(n.numChannels,i.numChannels),a.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var s=t.headerExtensions[n];if(e.uri===s.uri){a.headerExtensions.push(s);break}}}),a}function i(e,t,a){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(a)}function o(e,t){var a=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return a||e.addRemoteCandidate(t),!a}var l=(a(0),a(0),a(2068));e.exports=function(e,t){var a=function(a){var n=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=r[e].bind(r)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",a=JSON.parse(JSON.stringify(a||{})),this.usingBundle="max-bundle"===a.bundlePolicy,"negotiate"===a.rtcpMuxPolicy){var i=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw i.name="NotSupportedError",i}switch(a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require"),a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all"}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced"}if(a.iceServers=s(a.iceServers||[],t),this._iceGatherers=[],a.iceCandidatePoolSize)for(var o=a.iceCandidatePoolSize;o>0;o--)this._iceGatherers=new e.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy});else a.iceCandidatePoolSize=0;this._config=a,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0};return a.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();a.iceTransport=n.iceTransport,a.dtlsTransport=n.dtlsTransport}return this.transceivers.push(a),a},a.prototype.addTrack=function(t,a){for(var n,s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==t.kind||(n=this.transceivers[s]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(a)&&this.localStreams.push(a),n.track=t,n.stream=a,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},a.prototype.addStream=function(e){var a=this;if(t>=15025)e.getTracks().forEach(function(t){a.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var a=n.getTracks()[t];e.addEventListener("enabled",function(e){a.enabled=e.enabled})}),n.getTracks().forEach(function(e){a.addTrack(e,n)})}},a.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},a.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},a.prototype._createIceGatherer=function(t,a){var n=this;if(a&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var a=!e.candidate||0===Object.keys(e.candidate).length;s.state=a?"completed":"gathering",null!==n.transceivers[t].candidates&&n.transceivers[t].candidates.push(e.candidate)},s.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),s},a.prototype._gather=function(t,a){var n=this,s=this.transceivers[a].iceGatherer;if(!s.onlocalcandidate){var r=this.transceivers[a].candidates;this.transceivers[a].candidates=null,s.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),s.onlocalcandidate=function(e){if(!(n.usingBundle&&a>0)){var r=new Event("icecandidate");r.candidate={sdpMid:t,sdpMLineIndex:a};var i=e.candidate,o=!i||0===Object.keys(i).length;o?"new"!==s.state&&"gathering"!==s.state||(s.state="completed"):("new"===s.state&&(s.state="gathering"),i.component=1,r.candidate.candidate=l.writeCandidate(i));var d=l.splitSections(n.localDescription.sdp);d[r.candidate.sdpMLineIndex+1]+=o?"a=end-of-candidates\r\n":"a="+r.candidate.candidate+"\r\n",n.localDescription.sdp=d.join("");var u=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),o||(n.dispatchEvent(r),"function"==typeof n.onicecandidate&&n.onicecandidate(r)),u&&(n.dispatchEvent(new Event("icecandidate")),"function"==typeof n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){r.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,s.onlocalcandidate(t)})},0)}},a.prototype._createIceAndDtlsTransports=function(){var t=this,a=new e.RTCIceTransport(null);a.onicestatechange=function(){t._updateConnectionState()};var n=new e.RTCDtlsTransport(a);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:a,dtlsTransport:n}},a.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var a=this.transceivers[e].iceTransport;a&&(delete a.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},a.prototype._transceive=function(e,a,n){var s=r(e.localCapabilities,e.remoteCapabilities);a&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:l.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),n&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),s.encodings=e.recvEncodingParameters,s.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},a.prototype.setLocalDescription=function(e){var t=this,a=arguments;if(!i("setLocalDescription",e.type,this.signalingState))return new Promise(function(n,s){var r=new Error("Can not set local "+e.type+" in state "+t.signalingState);r.name="InvalidStateError",a.length>2&&"function"==typeof a[2]&&a[2].apply(null,[r]),s(r)});var n,s;if("offer"===e.type)n=l.splitSections(e.sdp),s=n.shift(),n.forEach(function(e,a){var n=l.parseRtpParameters(e);t.transceivers[a].localCapabilities=n}),this.transceivers.forEach(function(e,a){t._gather(e.mid,a)});else if("answer"===e.type){n=l.splitSections(t.remoteDescription.sdp),s=n.shift();var o=l.matchPrefix(s,"a=ice-lite").length>0;n.forEach(function(e,a){var n=t.transceivers[a],i=n.iceGatherer,d=n.iceTransport,u=n.dtlsTransport,c=n.localCapabilities,f=n.remoteCapabilities;if(!(l.isRejected(e)&&1===!l.matchPrefix(e,"a=bundle-only").length||n.isDatachannel)){var m=l.getIceParameters(e,s),p=l.getDtlsParameters(e,s);o&&(p.role="server"),t.usingBundle&&0!==a||(t._gather(n.mid,a),"new"===d.state&&d.start(i,m,o?"controlling":"controlled"),"new"===u.state&&u.start(p));var h=r(c,f);t._transceive(n,h.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var d=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){d&&d.apply(null),e()})},a.prototype.setRemoteDescription=function(a){var n=this,s=arguments;if(!i("setRemoteDescription",a.type,this.signalingState))return new Promise(function(e,t){var r=new Error("Can not set remote "+a.type+" in state "+n.signalingState);r.name="InvalidStateError",s.length>2&&"function"==typeof s[2]&&s[2].apply(null,[r]),t(r)});var r={};this.remoteStreams.forEach(function(e){r[e.id]=e});var d=[],u=l.splitSections(a.sdp),c=u.shift(),f=l.matchPrefix(c,"a=ice-lite").length>0,m=l.matchPrefix(c,"a=group:BUNDLE ").length>0;this.usingBundle=m;var p=l.matchPrefix(c,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(s,i){var u=l.splitLines(s),p=l.getKind(s),h=l.isRejected(s)&&1===!l.matchPrefix(s,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],v=l.getDirection(s,c),E=l.parseMsid(s),b=l.getMid(s)||l.generateIdentifier();if("application"===p&&"DTLS/SCTP"===g)return void(n.transceivers[i]={mid:b,isDatachannel:!0});var y,S,_,M,C,w,k,T,N,P,R,I=l.parseRtpParameters(s);h||(P=l.getIceParameters(s,c),R=l.getDtlsParameters(s,c),R.role="client"),k=l.parseRtpEncodingParameters(s);var D=l.parseRtcpParameters(s),L=l.matchPrefix(s,"a=end-of-candidates",c).length>0,A=l.matchPrefix(s,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===a.type||"answer"===a.type)&&!h&&m&&i>0&&n.transceivers[i]&&(n._disposeIceAndDtlsTransports(i),n.transceivers[i].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[i].iceTransport=n.transceivers[0].iceTransport,n.transceivers[i].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[i].rtpSender&&n.transceivers[i].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[i].rtpReceiver&&n.transceivers[i].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),"offer"!==a.type||h)"answer"!==a.type||h||(y=n.transceivers[i],S=y.iceGatherer,_=y.iceTransport,M=y.dtlsTransport,C=y.rtpReceiver,w=y.sendEncodingParameters,T=y.localCapabilities,n.transceivers[i].recvEncodingParameters=k,n.transceivers[i].remoteCapabilities=I,n.transceivers[i].rtcpParameters=D,A.length&&"new"===_.state&&(!f&&!L||m&&0!==i?A.forEach(function(e){o(y.iceTransport,e)}):_.setRemoteCandidates(A)),m&&0!==i||("new"===_.state&&_.start(S,P,"controlling"),"new"===M.state&&M.start(R)),n._transceive(y,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!C||"sendrecv"!==v&&"sendonly"!==v?delete y.rtpReceiver:(N=C.track,E?(r[E.stream]||(r[E.stream]=new e.MediaStream),r[E.stream].addTrack(N),d.push([N,C,r[E.stream]])):(r.default||(r.default=new e.MediaStream),r.default.addTrack(N),d.push([N,C,r.default]))));else{y=n.transceivers[i]||n._createTransceiver(p),y.mid=b,y.iceGatherer||(y.iceGatherer=n._createIceGatherer(i,m)),A.length&&"new"===y.iceTransport.state&&(!L||m&&0!==i?A.forEach(function(e){o(y.iceTransport,e)}):y.iceTransport.setRemoteCandidates(A)),T=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(T.codecs=T.codecs.filter(function(e){return"rtx"!==e.name})),w=y.sendEncodingParameters||[{ssrc:1001*(2*i+2)}];var O=!1;if(("sendrecv"===v||"sendonly"===v)&&(O=!y.rtpReceiver,C=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,p),O)){var F;N=C.track,E?(r[E.stream]||(r[E.stream]=new e.MediaStream,Object.defineProperty(r[E.stream],"id",{get:function(){return E.stream}})),Object.defineProperty(N,"id",{get:function(){return E.track}}),F=r[E.stream]):(r.default||(r.default=new e.MediaStream),F=r.default),F.addTrack(N),d.push([N,C,F])}y.localCapabilities=T,y.remoteCapabilities=I,y.rtpReceiver=C,y.rtcpParameters=D,y.sendEncodingParameters=w,y.recvEncodingParameters=k,n._transceive(n.transceivers[i],!1,O)}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===a.type?"active":"passive"),this.remoteDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return Object.keys(r).forEach(function(t){var a=r[t];if(a.getTracks().length){if(-1===n.remoteStreams.indexOf(a)){n.remoteStreams.push(a);var s=new Event("addstream");s.stream=a,e.setTimeout(function(){n.dispatchEvent(s),"function"==typeof n.onaddstream&&n.onaddstream(s)})}d.forEach(function(t){var s=t[0],r=t[1];if(a.id===t[2].id){var i=new Event("track");i.track=s,i.receiver=r,i.transceiver={receiver:r},i.streams=[a],e.setTimeout(function(){n.dispatchEvent(i),"function"==typeof n.ontrack&&n.ontrack(i)})}})}}),e.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){s.length>1&&"function"==typeof s[1]&&s[1].apply(null),e()})},a.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},a.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},a.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var a=new Event("iceconnectionstatechange");this.dispatchEvent(a),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(a)}},a.prototype.createOffer=function(){var a,s=this,r=arguments;1===arguments.length&&"function"!=typeof arguments[0]?a=arguments[0]:3===arguments.length&&(a=arguments[2]);var i=this.transceivers.filter(function(e){return"audio"===e.kind}).length,o=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(i=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});i>0||o>0;)i>0&&(this._createTransceiver("audio"),i--),o>0&&(this._createTransceiver("video"),o--);var d=l.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(a,n){var r=a.track,i=a.kind,o=l.generateIdentifier();a.mid=o,a.iceGatherer||(a.iceGatherer=s._createIceGatherer(n,s.usingBundle));var d=e.RTCRtpSender.getCapabilities(i);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=a.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];r&&t>=15019&&"video"===i&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,i)),a.localCapabilities=d,a.sendEncodingParameters=u}),"max-compat"!==this._config.bundlePolicy&&(d+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){d+=n(e,e.localCapabilities,"offer",e.stream,s._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:d});return new Promise(function(e){if(r.length>0&&"function"==typeof r[0])return r[0].apply(null,[u]),void e();e(u)})},a.prototype.createAnswer=function(){var a=this,s=arguments,i=l.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(i+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var o=l.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.isDatachannel)return void(i+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var l;"audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]),l&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var d=r(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=n(e,d,"answer",e.stream,a._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:i});return new Promise(function(e){if(s.length>0&&"function"==typeof s[0])return s[0].apply(null,[d]),void e();e(d)})},a.prototype.addIceCandidate=function(e){var t,a;if(e&&""!==e.candidate){if(void 0===e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var n=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<this.transceivers.length;s++)if(this.transceivers[s].mid===e.sdpMid){n=s;break}var r=this.transceivers[n];if(r){if(r.isDatachannel)return Promise.resolve();var i=Object.keys(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return Promise.resolve();if(i.component&&1!==i.component)return Promise.resolve();if((0===n||n>0&&r.iceTransport!==this.transceivers[0].iceTransport)&&(o(r.iceTransport,i)||(t=new Error("Can not add ICE candidate"),t.name="OperationError")),!t){var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),a=l.splitSections(this.remoteDescription.sdp),a[n+1]+="a="+(i.type?d:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else t=new Error("Can not add ICE candidate"),t.name="OperationError"}else t=new Error("Can not add ICE candidate without a remote description"),t.name="InvalidStateError"}else for(var u=0;u<this.transceivers.length&&(this.transceivers[u].isDatachannel||(this.transceivers[u].iceTransport.addRemoteCandidate({}),a=l.splitSections(this.remoteDescription.sdp),a[u+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));u++);var c=arguments;return new Promise(function(e,a){t?(c.length>2&&"function"==typeof c[2]&&c[2].apply(null,[t]),a(t)):(c.length>1&&"function"==typeof c[1]&&c[1].apply(null),e())})},a.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(a){t[a]&&e.push(t[a].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],a=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var s=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=a(e[t]),s.set(t,e[t])})}),t&&t.apply(null,s),n(s)})})},a}},2358:function(e,t,a){a(0),a(0);e.exports=function(e){var t=e&&e.navigator,a=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(a(e))})}}},2359:function(e,t,a){var n=(a(0),a(0),a(2035)),s={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var a=new Event("track");a.track=t,a.receiver={track:t},a.transceiver={receiver:a.receiver},a.streams=[e.stream],this.dispatchEvent(a)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(a,n){if(t.version<38&&a&&a.iceServers){for(var s=[],r=0;r<a.iceServers.length;r++){var i=a.iceServers[r];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var l={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(l.username=i.username,l.credential=i.credential),s.push(l)}else s.push(a.iceServers[r])}a.iceServers=s}return new e.mozRTCPeerConnection(a,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var s=function(e){var t=new Map;return Object.keys(e).forEach(function(a){t.set(a,e[a]),t[a]=e[a]}),t},r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,a,n){return i.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=s(e)),t.version<53&&!a)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,a){e.set(a,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(a,n)}}},shimRemoveStream:function(e){"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(a){a.track&&-1!==e.getTracks().indexOf(a.track)&&t.removeTrack(a)})})}};e.exports={shimOnTrack:s.shimOnTrack,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimRemoveStream:s.shimRemoveStream,shimGetUserMedia:a(2360)}},2360:function(e,t,a){var n=(a(0),a(0),a(2035)),s=n.log;e.exports=function(e){var t=n.detectBrowser(e),a=e&&e.navigator,r=e&&e.MediaStreamTrack,i=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,n,r){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n=e[a]="object"==typeof e[a]?e[a]:{ideal:e[a]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(a),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[a]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var s={};"number"==typeof n.ideal?s[a]={min:n.ideal,max:n.ideal}:s[a]=n.ideal,e.advanced.push(s),delete n.ideal,Object.keys(n).length||delete e[a]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(s("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),s("ff37: "+JSON.stringify(e))),a.mozGetUserMedia(e,n,function(e){r(i(e))})},l=function(e){return new Promise(function(t,a){o(e,t,a)})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:l,addEventListener:function(){},removeEventListener:function(){}}),a.mediaDevices.enumerateDevices=a.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var d=a.mediaDevices.enumerateDevices.bind(a.mediaDevices);a.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(i(e))})}}if(!(t.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){var c=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])},f=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),c(e.audio,"autoGainControl","mozAutoGainControl"),c(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},r&&r.prototype.getSettings){var m=r.prototype.getSettings;r.prototype.getSettings=function(){var e=m.apply(this,arguments);return c(e,"mozAutoGainControl","autoGainControl"),c(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var p=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),c(e,"autoGainControl","mozAutoGainControl"),c(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}a.getUserMedia=function(e,s,r){if(t.version<44)return o(e,s,r);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(e).then(s,r)}}},2361:function(e,t,a){var n=(a(0),a(0),a(2035)),s={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(a){a.id===e&&(t=a)}),this._remoteStreams&&this._remoteStreams.forEach(function(a){a.id===e&&(t=a)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var a=this;e.getTracks().forEach(function(n){t.call(a,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,a){a&&(this._localStreams?-1===this._localStreams.indexOf(a)&&this._localStreams.push(a):this._localStreams=[a]),t.call(this,e,a)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var a=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&a.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var a=new Event("addstream");a.stream=e.streams[0],this.dispatchEvent(a)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,a=t.createOffer,n=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,i=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],s=a.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){var a=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[a]);return t?(s.then(e,t),Promise.resolve()):s};var o=function(e,t,a){var n=s.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n};t.setLocalDescription=o,o=function(e,t,a){var n=r.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n},t.setRemoteDescription=o,o=function(e,t,a){var n=i.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n},t.addIceCandidate=o}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,a,n){t.mediaDevices.getUserMedia(e).then(a,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,a){if(e&&e.iceServers){for(var s=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,s.push(i)):s.push(e.iceServers[r])}e.iceServers=s}return new t(e,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var a=this;if(e){var n=a.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection("sendonly"):"recvonly"===n.direction&&n.setDirection("inactive"):!0!==e.offerToReceiveAudio||n||a.addTransceiver("audio");var s=a.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&s?"sendrecv"===s.direction?s.setDirection("sendonly"):"recvonly"===s.direction&&s.setDirection("inactive"):!0!==e.offerToReceiveVideo||s||a.addTransceiver("video")}return t.apply(a,arguments)}}};e.exports={shimCallbacksAPI:s.shimCallbacksAPI,shimLocalStreamsAPI:s.shimLocalStreamsAPI,shimRemoteStreamsAPI:s.shimRemoteStreamsAPI,shimGetUserMedia:s.shimGetUserMedia,shimRTCIceServerUrls:s.shimRTCIceServerUrls,shimTrackEventTransceiver:s.shimTrackEventTransceiver,shimCreateOfferLegacy:s.shimCreateOfferLegacy}},2362:function(e,t,a){function n(e,t,a){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,s=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return s.apply(this,arguments);var r=function(e){n(a(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=r,s.apply(this,[e,r])};var r=n.removeEventListener;n.removeEventListener=function(e,a){if(e!==t||!this._eventMap||!this._eventMap[a])return r.apply(this,arguments);var n=this._eventMap[a];return delete this._eventMap[a],r.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var s=(a(0),a(0),a(2068)),r=a(2035);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var a=new t(e),n=s.parseCandidate(e.candidate),r=Object.assign(a,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r},n(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var a=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),s=new Map,i=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++i;return s.set(t,e),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return a(e)},t.revokeObjectURL=function(e){n(e),s.delete(e)};var o=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return o.get.apply(this)},set:function(e){return this.srcObject=s.get(e)||null,o.set.apply(this,[e])}});var l=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),l.apply(this,arguments)}}}}},2363:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=l.default.createElement(u.FormattedMessage,{id:"webrtc.header",defaultMessage:"Call with {username}",values:{username:e.username}}),a=l.default.createElement(d.Tooltip,{id:"closeSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.closeTooltip",defaultMessage:"Close Sidebar"})),n=l.default.createElement(d.Tooltip,{id:"expandSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Expand Sidebar"})),s=l.default.createElement(d.Tooltip,{id:"shrinkSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Shrink Sidebar"}));return l.default.createElement("div",{className:"sidebar--right__header"},l.default.createElement("span",{className:"sidebar--right__title"},t),l.default.createElement("div",{className:"pull-right"},l.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:e.toggleSize},l.default.createElement(d.OverlayTrigger,{trigger:["hover","focus"],delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},l.default.createElement("i",{className:"fa fa-expand"})),l.default.createElement(d.OverlayTrigger,{trigger:["hover","focus"],delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:s},l.default.createElement("i",{className:"fa fa-compress"}))),l.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:e.onClose},l.default.createElement(d.OverlayTrigger,{delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},l.default.createElement("i",{className:"fa fa-sign-out"})))))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=a(8),i=n(r),o=a(1),l=n(o),d=a(35),u=a(17),c=a(9),f=n(c);s.propTypes={username:i.default.string.isRequired,onClose:i.default.func.isRequired,toggleSize:i.default.func}},2364:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t,{modals:e.views.modals})}function r(e){return{actions:(0,d.bindActionCreators)({closeModal:u.closeModal},e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),o=n(i),l=a(26),d=a(21),u=a(404),c=a(2365),f=n(c);t.default=(0,l.connect)(s,r)(f.default)},2365:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(42),r=n(s),i=a(102),o=n(i),l=a(5),d=n(l),u=a(3),c=n(u),f=a(4),m=n(f),p=a(6),h=n(p),g=a(7),v=n(g),E=a(8),b=n(E),y=a(1),S=n(y),_=function(e){function t(){return(0,c.default)(this,t),(0,h.default)(this,(t.__proto__||(0,d.default)(t)).apply(this,arguments))}return(0,v.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this.props,t=e.modals,a=(0,o.default)(e,["modals"]),n=t.modalState;if(!t)return S.default.createElement("div",null);var s=[];for(var i in n)if(n.hasOwnProperty(i)){var l=n[i];if(l.open){var d=S.default.createElement(l.dialogType,(0,r.default)({},l.dialogProps,{onHide:a.actions.closeModal.bind(this,i),key:i+"_modal"}));s.push(d)}}return S.default.createElement("div",null,s)}}]),t}(S.default.Component);_.propTypes={modals:b.default.object.isRequired,actions:b.default.shape({closeModal:b.default.func.isRequired}).isRequired},t.default=_}});
//# sourceMappingURL=7.8aae2556af2f13d4beaa.js.map